!function(P,v,C){"use strict";var K="ht";if(!P[K]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),P.performance&&P.performance.now||function(){var H=Date.now();P.performance||(P.performance={}),P.performance.now=function(){return Date.now()-H}}();for(var Q=Date.now(),i=16,u=["ms","moz","webkit","o"],X=0;X<u.length&&!P.requestAnimationFrame;++X)P.requestAnimationFrame=P[u[X]+"RequestAnimationFrame"],P.cancelAnimationFrame=P[u[X]+"CancelAnimationFrame"]||P[u[X]+"CancelRequestAnimationFrame"];P.requestAnimationFrame||(P.requestAnimationFrame=function(K){var D=Date.now(),N=i+Q-D;return 0>N&&(N=0),Q=D,P.setTimeout(function(){Q=Date.now(),K(performance.now())},N)}),P.cancelAnimationFrame||(P.cancelAnimationFrame=function(I){return P.clearTimeout(I)}),v.assign===C&&(v.assign=function(c){if(c===C||null===c)throw new TypeError("Cannot convert undefined or null to object");for(var d=v(c),L=1;L<arguments.length;L++){var k=arguments[L];if(k!==C&&null!==k)for(var t in k)v.prototype.hasOwnProperty.call(k,t)&&(d[t]=k[t])}return d})}();var V=P.document,o=null,M=P[K]={},l=P[K+"config"],w=M.Default=l&&l.Default||{},k=M.Style=l&&l.Style||{},D=M.Attr=l&&l.Attr||{},x=M.Color=l&&l.Color||{},j=M.IsGetter=l&&l.IsGetter||{};!function(){var e=!1;try{var r=v.defineProperty({},"passive",{get:function(){e=!0}});P.addEventListener("test",r,r),P.removeEventListener("test",r,r)}catch(p){e=!1}w.passiveSupported=e}();var t,_,d,X,e=w.passiveSupported,R=w.eventListenerOptionsFalse=e?{passive:!1,capture:!1}:!1,Q=w.eventListenerOptionsTrue=e?{passive:!1,capture:!0}:!0,S=Math,f=S.round,y=S.floor,E=S.ceil,u=S.sqrt,J=S.max,m=S.min,T=S.abs,i=S.cos,W=S.acos,F=S.sin,Y=S.pow,Z=S.asin,s=S.PI,g=2*s,A=s/2,G=S.tan,h=S.atan2,H=S.random,I=S.log,B=!0,U=!1,z=P.parseInt||global.parseInt,n="2019-08-01",L=P.navigator?P.navigator.platform.indexOf("Win")>-1:!1,r=function(b){return b*b},a=P.setTimeout,q=P.clearTimeout,N=P.location,c=P.navigator?P.navigator.userAgent.toLowerCase():"",p=function(Q){return Q.test(c)},b=p(/msie/),$=p(/msie/)||p(/trident/),O=p(/msie 10/),Zm=p(/edge/),Le=p(/firefox/),Td=p(/mac/),Em=w.isTouchable===C?L?!1:V?"ontouchend"in V:!1:w.isTouchable,Tf="default",Nb="single",_b="multiple",Qm="front",Zo="back",de="left",rb="right",kl="top",uo="bottom",ak="center",mg="eye",jc="middle",vq="east",bl="west",md="north",sl="none",lo="px",wh="absolute",Vp="border",Cm="triangle",jo="rect",wn="circle",vg="cylinder",Dg="shape",mn="items",Go="normal",nm="remove",fq="clear",lk="width",$e="height",gn="ingroup",rg="check",ch="uncheck",og="radio",oe="radioOn",gc="radioOff",_g="points",af="values",yl="series",pd="body",uq="label",qm="label2",Fk="note",Sn="note2",ze="icons",mh="labelFont",tr="labelColor",rh="labelSelectColor",If="note.expanded",Vb="note2.expanded",Hc="edge.expanded",to="edge.points",Xq="edge.type",oq="rotation",xp="hidden",Qr="visible",Sg="tuv",wm="no",fj="draw",od="select",Pb="currentSubGraph",bo="selectBackground",Np="autoMakeVisible",vf="autoHideScrollBar",Gp="scrollBarColor",Mi="scrollBarSize",$g="indent",pb="rowHeight",xb="columnLineColor",Jn="rowLineColor",gg="columnLineVisible",Cb="rowLineVisible",El="visibleFunc",Db="expandIcon",qd="collapseIcon",Gf="checkMode",Ae="sortFunc",hn="editable",Bj="batchEditable",Wh="tristate",Gq="asc",mf="desc",lm="position",Zb="elevation",ce="children",db="translateX",Kk="translateY",Ur="dataModel",Pp="maxSize",he="state",pi="shape3d",kp="shape3d.resolution",Jf="shape3d.visible",Tp="shape3d.from.visible",Rb="shape3d.to.visible",kg="shape3d.top.visible",Ck="shape3d.bottom.visible",Nn="repeat.uv.length",qp="serializeValue",uj="deserializeValue",dg="centerUniform",xi="uniform",Qj="rgba(255,255,255,0)",Pk="style",Cl="attr",ui="field",Gh="string",pp="boolean",Fm="color",qh="int",So="number",wk="ew-resize",uk="ns-resize",eb="pointer",ip="auto",_c="mousedown",zl="mousemove",kr="mouseup",Jm="mouseout",nn="touchstart",Hq="touchmove",Hk="touchend",vn="keydown",Vn="keyup",rd=["DOMMouseScroll","mousewheel"],nl=Le?rd[0]:rd[1],Ne=Em?[nn,Hq,Hk,vn,Vn,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[vn,Vn,"keypress","input",_c,zl,kr,Jm,nl,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],mj=o,go=o,wg=o,um=kr.length,kn=function(){wg&&(q(wg.timeout),wg=o)},ne=function(){wg&&tg(wg.e,wg.info)};P.addEventListener&&(Em||(P.addEventListener(Jm,function(){kn()},R),P.addEventListener(nl,function(){Ul()},R)),P.addEventListener(Vn,function(E){91===E.keyCode?De={}:delete De[E.keyCode]},Q),P.addEventListener(vn,function(c){De[c.keyCode]=!0},Q),P.addEventListener("blur",function(){De={}},R));var Pc,sj,Bo,ti=0,zg=o,gh=function(t,B){var Q=a(function(){delete zg[Q],Od(zg)&&(zg=o),t()},B);return Q},Ld=o,Bq=o,Zp={},Im={},Al={},Zl={},fg={},De={},wq={},qj={},am={},Pl={},Po=/.json$/,dl=/^data:image\/svg\+xml/,Aj={},nc=[],xd={},nf=o,sp=o,Mc=function(){},Ak=function(){throw"Oops!"},Vc=[0,0,0],xh={x:0,y:0,width:0,height:0},zk=o,zm=o,Cf=o,Re=function(h,c){Im[h]=c,c&&c.comps&&!c.uuid&&(c.uuid=M.Math.generateUUID()),Vd[h]&&(c.cacheRule=Vd[h],delete Vd[h])},Zn=function(E){zm&&!E._72O&&(Cf||(Cf={}),Cf[E._72O=fe()]=E),Pc!=o?Yc()<.05&&X&&!sj&&(ln=kn):ln=Yb},rc=function(F,Q,e,v){zm||(zm={});var C=zm[F];if(C){if(C.url===Q)return;C.image?(C.image.onload=Mc,C.image.onerror=Mc):C.request&&(C.request.onload=Mc,C.request.onerror=Mc)}if(Po.test(Q)){var c=new gm;if(zm[F]={request:c,url:Q},Q=w.beforeLoadURL(Q),Q.data){var f=w.parse(Q.data);Nr(F,f),w.handleImageLoaded(F,f)}else{c.onload=function(){if(200===this.status||0===this.status){var j=w.parse(c.getResponseText());Nr(F,j),w.handleImageLoaded(F,j)}else Nr(F,w.handleUnfoundImage(F,Q)||o)},c.onerror=function(){Nr(F,w.handleUnfoundImage(F,Q)||o)};var l={};l.url=encodeURI(Q),l.sync=!1,c.send(l)}}else{var f=new Image;zm[F]={image:f,url:Q},/^data:image/.test(Q)||(Q=w.beforeLoadURL(Q),Q=w.appendTimeStamp(Q),Q=encodeURI(Q),f.crossOrigin=w.crossOrigin),w.convertImageSrc(Q,function(Y){$&&(Q.toLowerCase().indexOf(".svg")>0||dl.test(Q))?(V.body.appendChild(f),f.style.visibility="hidden",f.onload=function(){a(function(){if(e&&(f.width=e),v&&(f.height=v),!f.width||!f.height){var p=f.width||f.clientWidth,H=f.height||f.clientHeight;f.width=p,f.height=H}w.handleImageLoaded(F,f),Nr(F,f),V.body.removeChild(f),f.style.visibility=""},180)},f.onerror=function(){Nr(F,w.handleUnfoundImage(F,Q)||o),V.body.removeChild(f),f.style.visibility=""}):(f.onload=function(){e&&(f.width=e),v&&(f.height=v),w.handleImageLoaded(F,f),Nr(F,f)},f.onerror=function(){Nr(F,w.handleUnfoundImage(F,Q)||o)}),f.src=Y})}},Nr=function(P,W){if(Re(P,W),delete zm[P],Od(zm)&&(zm=o,Cf)){for(var s in Cf){var y=Cf[s];y._2O&&y._2O[P]&&(y.deleteTexture(P),delete y._2O[P]),y.invalidateAll&&y.invalidateAll(C,"imageLoaded",P),y.redraw&&y.redraw(),y.iv(),delete y._72O}Cf=o}if(W&&Cf)for(var s in Cf){var y=Cf[s];y.invalidateAll&&y.invalidateAll(C,"imageLoading",P),y.redraw&&y.redraw(),y.iv()}},Pg=function(){return I=S&&Date,function(){return P.performance&&P.performance.now?P.performance.now():Date.now()}}(),Cs=function(Q,m){m?q(Q):P.cancelAnimationFrame(Q)},Ei=function(T,q,W){return{width:T,height:q,comps:Ef(W)?W:[W]}},sq=function(F,q){return{type:wn,rect:[F,q,1.6,1.6],borderWidth:1,borderColor:Nh,gradient:Xj,gradientColor:em,background:Nh}},Hf=function(H,D){return Ei(16,16,{type:Cm,rect:[4,4,10,8],background:H,rotation:D?1.57:3.14})},Lb=function(Z,Y){return Ei(16,16,{type:Cm,rect:[4,4,8,7],background:Z,rotation:Y?3.14:0})},Fj=function(Q){var Z=Q._orientation;return"horizontal"===Z||"h"===Z},ld=function(N){var n=o||4,j=o||1,f=o||1;0>n?n=0:n>.25&&(n=.25);var p,Q,m,T,r,E,v,C=.5,Y=[],w=[],D=[],S=g/f,b=g/j,L=C-n;for(Q=0;j>=Q;Q++)for(T=-s+Q*b,E=i(T),r=F(T),p=0;f>=p;p++)m=p*S,v=L+n*E,Y.push(i(m)*v,r*n,-F(m)*v),(_=N)&&w.push(p/f,1-Q/j);for(Q=0;j>Q;Q++){var $=Q*(f+1),l=(Q+1)*(f+1);for(p=0;f>p;p++)D.push($+p,l+p+1,l+p,$+p,$+p+1,l+p+1),Eg.z=wo.z=N}},Hg=function(X){var f=2,P=0;for(var I in X)I.length===f&&z(I,32)===ab&&(nf=sp=X[I]),P++;return P},Jr=function(N,e,Q,i){return Q||(Q=Em?5:3,Q/=i||1),{x:N-Q,y:e-Q,width:2*Q,height:2*Q}},Th=function(X,Z,u,K){var g=this;Z||(Z=Em?5:3,u=20,K=20);var F={x:X,y:Z,width:u,height:K};if(u)for(var M=0;u>M;M++)if(3===u)K=20;else for(var e=0;K>e;e++)g=P?P:u;var I={x:s,y:2*s};if(lq(F,I)){var W=$e[0]+kl[0]+fq[1]+(Gq.length-1);Mq[mg]=g[W],g[W]=Zr[mg]}},ir=function(P){return(/ble$/.test(P)||/ed$/.test(P)||j[P]?"is":"get")+P.charAt(0).toUpperCase()+P.slice(1)},Zr=function(b){return"set"+b.charAt(0).toUpperCase()+b.slice(1)},pl=function(Y){return typeof Y===Gh||Y instanceof String},Pn=function(R){return typeof R===So},Yb=function(r){return typeof r===pp},kf=function(v){return v&&"object"==typeof v},pg=function(m){return"function"==typeof m},Ef=function(V){return V instanceof Array},Jq=function(Z){return Z instanceof Uh},Lk=function($){return Ef($)?new Uh($):$},yr=function(n){return n instanceof lf},ps=function(S){return S instanceof cf},zi=function(J){return J instanceof Kg},ad=function(s,a){if(!(s instanceof M.Group))return!1;if(!a)return s.isExpanded();var A=a.getDataUI(s);return A&&A._88I?!0:!1},Qk=function(n){return n instanceof Uk},ci=function(E){return E&&"IFRAME"===E.tagName},eo=function(E){return E==o||w.numberDigits==o?E:parseFloat(E.toFixed(w.numberDigits))},hh=function(v,t,J){var b,T=t.length;if(J)for(var Q=0;J>Q;Q++)if(3===T)v.push(t[0]),v.push(t[1]),v.push(t[2]);else for(b=0;T>b;b++)v.push(t[b]);else if(3===T)v.push(t[0]),v.push(t[1]),v.push(t[2]);else for(b=0;T>b;b++)v.push(t[b])},yo=function(U){return U?kf(U)?U:{}:!1},Iq=function(J,k,u){var H,a=kf(J)?J:J.prototype;for(H in k)u&&a[H]!==C||(a[H]=k[H]);return J},qc=function(x){return String.fromCharCode(x)},Mb=function(i){for(var c,m=0,z="";m<i.length;m++)c=i[i.length-1-m],"%"===c?c="'":"a"===c?c='"':"]"===c&&(c="\\"),z+=qc(c.charCodeAt(0)-1);return z},ek=function(M,I,P){M.superClass.constructor.apply(I,P)},Od=function(g){for(var M in g)return!1;return!0},dr=function(i){return i?0===i.length:!0},ys=function(){var c="";return[ch[0],Jn[0],uq[0]].forEach(function(q){c+=Zr(q).slice(3)}),xi=V&&V[c]||dg,function(w,R){return w===R?!0:w.x===R.x&&w.y===R.y&&w.width===R.width&&w.height===R.height}}(),wb=function(Q,R,T){return R>Q?R:Q>T?T:Q},ef=function(C){return 0>C?-1:C>0?1:0},Yc=function(){var e=1e4*F(um++);return e-y(e)},se=function(T,H,t){return fk(T.x,T.y,H.x,H.y,t.x,t.y,t.x+t.width,t.y,!0)||fk(T.x,T.y,H.x,H.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,!0)||fk(T.x,T.y,H.x,H.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height,!0)||fk(T.x,T.y,H.x,H.y,t.x,t.y+t.height,t.x,t.y,!0)},fk=function($,T,z,f,g,v,d,E,W){var K=(d-g)*(T-v)-(E-v)*($-g),u=(E-v)*(z-$)-(d-g)*(f-T);if(0!==u){var U=K/u,y=$+U*(z-$),w=T+U*(f-T);return W&&(y+Mp<m($,z)||y-Mp>J($,z)||y+Mp<m(g,d)||y-Mp>J(g,d)||w+Mp<m(T,f)||w-Mp>J(T,f)||w+Mp<m(v,E)||w-Mp>J(v,E))?o:[y,w]}return o},Uo=function(c,Z,Q){if(c&&Q)if(Z){if(Z===Pk)return c.getStyle(Q);if(Z===Cl)return c.getAttr(Q);if(Z===ui)return c[Q]}else if(Q=ir(Q),c[Q])return c[Q]();return C},Kh=function(K,$,L,B){if(K&&L)if($){if($===Pk)K.s(L,B);else if($===Cl)K.a(L,B);else if($===ui){var e=K[L];K[L]=B,K.fp("f:"+L,e,B)}}else L=Zr(L),K[L]&&K[L](B)},zh=function(y,v,t){return v&&"top"!==v?"bottom"===v?{x:y.x,y:y.y,width:y.width,height:y.height*t}:"right"===v?{x:y.x,y:y.y,width:y.width*t,height:y.height}:"left"===v?{x:y.x+y.width*(1-t),y:y.y,width:y.width*t,height:y.height}:void 0:{x:y.x,y:y.y+y.height*(1-t),width:y.width,height:y.height*t}},_h=function(T,p,U,h,C){p&&Ql(T,U,h,1,C,p)},ei=function(s,d,y,k){var u=1-s;return u*u*d+2*s*u*y+s*s*k},Eg=function(G,V,U,j,z){var c=1-G;return c*c*c*V+3*c*c*G*U+3*c*G*G*j+G*G*G*z},cb=function(n){var Q,W,g,R,D=0;return n.forEach(function(p){if(Q=p.length,Q>0)for(W=p[0],R=1;Q>R;R++)g=p[R],D+=$q(W,g),W=g}),D},Ig=function(c,Z,I){var B="__"+c,L=function(t){I.disabled||I["handle_"+c](t)};I[B]||(I[B]=L,Z.addEventListener(c,L,R))},jf=function(g,e,a){var q="__"+g,Q=a[q];Q&&(e.removeEventListener(g,Q,R),delete a[q])},ar=function(k,Z){var J="_"+Z;k[ir(Z)]=function(){return this[J]},k[Zr(Z)]=function(S){var U=this[J];this[J]=S,this.fp(Z,U,S)}},ug=function(E){return v.create(E)},cl=function(h){if(!h.element){var $,i;($=h.textField)?i=Zi(ym.TextField,$):($=h.textArea)?i=Zi(ym.TextArea,$):($=h.button)?i=Zi(ym.Button,$):($=h.comboBox)?i=Zi(ym.ComboBox,$):($=h.checkBox)?i=Zi(ym.CheckBox,$):($=h.radioButton)?i=Zi(ym.RadioButton,$):($=h.slider)?i=Zi(ym.Slider,$):($=h.colorPicker)?i=Zi(ym.ColorPicker,$):($=h.image)&&(i=Zi(ym.Image,$)),i&&(h.element=i)}},jh=function(t,L){var _=tq(t);return _._ht=L,_},tq=function(k,$){var B=V.createElement("div"),A=B.style;return B.tabIndex=-1,B.onkeydown=Eb,A.msTouchAction=sl,Qp(B,o,0),Em&&A.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",o),k&&(A.overflow=xp),$&&ke($,B),B},ep=function(u,H){var G=V.createElement("canvas"),D=G.style;return D.msTouchAction=sl,H||(D.pointerEvents=sl),Qp(G,o,0),u&&ke(u,G),G},Qp=function(m,n,G){var s=m.style;s.border=n?n+" solid 1px":0,s.outline=0,s.padding=G?"0 "+G+lo:0,Il(m)},Il=function(l){var $=l.style;$.position=wh,$.margin=0,$.setProperty("box-sizing","border-box",o),$.setProperty("-moz-box-sizing","border-box",o)},ol=function(N,i,x,F){F||(F=tb),i!=o&&(N.width=i*F,N.style.width=i+lo),x!=o&&(N.height=x*F,N.style.height=x+lo)},ke=function(x,Q,g){x.appendChild(Q),g&&(Q.style.position=wh)},_r=function(S,u){u.split||(u+="");for(var W,w=u.split("\n"),I=0,D=w.length,C=0;D>C;C++){var c=Xd(S.font,w[C]);c.width>I&&(I=c.width),W||(W=c.height)}return S.ss=w,{width:I,height:W*D}},Mm=function(P,m,R,U,a,t){var r=m.length;if(1===r)km(P,m[0],R,U,a);else for(var X=R.height/r,p={x:R.x,y:R.y,width:R.width,height:X},T=0;T<m.length;T++)t?mc(P,m[T],U,a,p.x,p.y,p.width,p.height,t):km(P,m[T],p,U,a),p.y+=X},km=function(j,E,s,U,y){j.font=U?U:hg,j.fillStyle=y?y:cc,j.textAlign=ak,j.textBaseline=jc;var R,_;s?s.width===C?(R=s.x,_=s.y):(R=s.x+s.width/2,_=s.y+s.height/2):(R=0,_=0),j.fillText(E,f(R),f(_))},vr=function(U){U.getView&&(U=U.getView());var B=U.offsetWidth||U.scrollWidth;return!B&&U.style.width&&(B=z(U.style.width)),B},bq=function(D){D.getView&&(D=D.getView());var C=D.offsetHeight||D.scrollHeight;return!C&&D.style.height&&(C=z(D.style.height)),C},Vm=function(d,c,p){var h=c[0].toUpperCase()+c.substring(1,c.length);d["webkit"+h]=p,d["moz"+h]=p,d["ms"+h]=p,d["o"+h]=p,d[c]=p},rr=function(){var J=function(X){Eb(X),X.stopPropagation()},r=function(z){Eb(z)},F=Em?[nn]:[vn,_c];return function(O,L){var C=tq(),z=C.style;return z.backgroundColor=w.disabledBackground,O&&(z.backgroundImage="url("+O+")",z.backgroundPosition="50% 50%",z.backgroundRepeat="no-repeat no-repeat"),L===!1?F.forEach(function(V){C.addEventListener(V,r,R)}):F.forEach(function(q){C.addEventListener(q,J,R)}),C}}(),vp=function(I){var X=I.getContext("2d");return X.save(),X.lineCap=ll,X.lineJoin=Nf,X},ln=function(Y,H,K,y){Ii(Y,H*tb,K*tb),y*=tb,1!==y&&Y.scale(y,y)},Ii=function(L,t,c){L.translate(t,c)},Gg=function(l,L){L&&l.rotate(L)},ff=function(d,O,n){O===C&&(O=1),n===C&&(n=1),(1!==O||1!==n)&&d.scale(O,n)},oc=!1,fp=function(w){var i=V.activeElement;if(V.activeElement!==w){i&&i.forceOnblur&&i.forceOnblur();for(var M=[],v=w.parentNode;v;)M.push([v,v.scrollLeft,v.scrollTop]),v=v.parentNode;if(!oc){var $=[],D=[];try{for(var a=P.parent,R=P;a!==R;)$.push([a,a.scrollX,a.scrollY]),R=a,a=P.parent;var G=P.frameElement;if(G)for(var F=G.parentNode;F;)D.push([F,F.scrollLeft,F.scrollTop]),F=F.parentNode}catch(f){oc=!0}}if(Em)w.focus();else{var u=lb(),T=u.target;w.focus(),T.scrollLeft=u.left,T.scrollTop=u.top}M.forEach(function(C){C[0].scrollLeft=C[1],C[0].scrollTop=C[2]}),oc||($.forEach(function(d){d[0].scrollTo(d[1],d[2])}),D.forEach(function(c){c[0].scrollLeft=c[1],c[0].scrollTop=c[2]}))}},jg=function(c){return c&&c.getView?c.getView():c},pq=function(g,B,D,i,A){if(2===arguments.length&&(D=B.y,i=B.width,A=B.height,B=B.x),g.isSelfViewEvent)g.setX(B),g.setY(D),g.setWidth(i),g.setHeight(A);else{var X=jg(g),T=X.style;if((V.fullscreenElement||V.mozFullScreenElement||V.webkitFullscreenElement||V.msFullscreenElement)!==X)B!==C&&(T.left=B+lo),D!==C&&(T.top=D+lo),i!==C&&(T.width=i+lo),A!==C&&(T.height=A+lo);else{var x=w.getWindowInfo();T.left=(B=x.left)+lo,T.top=(D=x.top)+lo,T.width=(i=x.width)+lo,T.height=(A=x.height)+lo}g.endEditing&&!Em&&g.endEditing(),g.redraw&&g.redraw(),g.invalidate&&g.invalidate(),g.onLayouted&&g.onLayouted(B,D,i,A),g.fireViewEvent&&g.fireViewEvent("layout")}},fd=function(v){if(!v.touches)return v;var F=v.touches[0];return F?F:v.changedTouches[0]},Ce=function(d){return Em?fd(d).target:d.target},Jb=function(_){w.popup&&w.popup.close(),w.popup=_},mm=o,ap=function(K){mm.handleWindowTouchMove(K)},Gr=function(E){mm.handleWindowTouchEnd(E),P.removeEventListener(Hq,ap,R),P.removeEventListener(Hk,Gr,R),mm=o},sb=function(A){mm.handleWindowMouseMove(A)},ul=function(T){mm.handleWindowMouseUp(T),P.removeEventListener(zl,sb,R),P.removeEventListener(kr,ul,R),mm=o},$p=function(T){return 1===Am(T)},Ub=function(o,P){return P?P.keyCode===o:De[o]},Fp=function(J){return tl(J)&&Ub(65,J)},jp=function(I){return Ub(46,I)||Ub(8,I)},Ni=function(o){return function(D){return D?D.keyCode===o:De[o]}},ab=573,ub=[65,83,68,87,37,38,39,40,32,13,27],zf=Ni(ub[0]),cp=Ni(ub[1]),Pq=Ni(ub[2]),Yl=Ni(ub[3]),us=Ni(ub[4]),ni=Ni(ub[5]),nq=Ni(ub[6]),Bd=Ni(ub[7]),rp=Ni(ub[8]),sk=Ni(ub[9]),Ph=Ni(ub[10]),tp={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Hp=[2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,7,13,199],_l=o,Bg=o,Kc=function(D,H){_l||(_l=ep()),ol(_l,D,H,1);var i=vp(_l);return i.clearRect(0,0,D,H),i},Md=function(){var i,j={};for(var d in P){var U=_b.length;if(d.length==U&&d[0]===_b[2]&&d[1]===sl[1]&&d[4]===_b[3]&&d[5]===_b[4]&&d.substr(U-2)===sl[1]+sl[2]){var w=P[d];for(var H in w)H.length===U&&H.substr(0,3)===rb[3]+nm[3]+od[0]&&H.substr(U-2)===_b[0]+Fk[3]&&(rd=w[H])}}return function(V){var Y,B=j[V];return B||(i||(i=ep(),ol(i,1,1,1)),Y=i.getContext("2d"),Y.clearRect(0,0,1,1),Ql(Y,0,0,1,1,V),B=Y.getImageData(0,0,1,1).data,B=j[V]=[B[0],B[1],B[2],B[3]]),B}}(),Zk=function(b){if(!pl(b))return b;var j=Md(b);return j.CA||(j.CA=[j[0]/255,j[1]/255,j[2]/255,j[3]/255]),j.CA},up=function(i,w,n,$,b){var E=ep();E.width=n,E.height=$;var e=E.getContext("2d");e.drawImage(i,0,0,n,$);try{for(var H=e.getImageData(0,0,n,$),y=H.data,V=0,G=y.length;G>V;V+=4){var I=y[V+0],M=y[V+1],T=y[V+2],g=y[V+3];"override_a"===b?y[V+3]=255*w[3]:"override_rgb"===b?(y[V+0]=255*w[0],y[V+1]=255*w[1],y[V+2]=255*w[2]):"override"===b?(y[V+0]=255*w[0],y[V+1]=255*w[1],y[V+2]=255*w[2],y[V+3]=255*w[3]):(y[V+0]=w[0]*I,y[V+1]=w[1]*M,y[V+2]=w[2]*T,y[V+3]=w[3]*g)}e.putImageData(H,0,0)}catch(Y){return i}return E},Mq=function(q,w,h){return w&&(w="miter"===h?8*w+20:w+1,q&&Bi(q,w)),w},kh=function(Q,H){if(H){var x=new Tr(H),M=Q.width/2,s=Q.height/2,W=nb([x.tf(-M,-s),x.tf(M,-s),x.tf(M,s),x.tf(-M,s)]);return W.x+=Q.x+M,W.y+=Q.y+s,W}return Q},Bb=function(_,u,p,O,v,z,X,S){O*=Math.PI/180;var W={x:Math.cos(O)*(_.x-X.x)/2+Math.sin(O)*(_.y-X.y)/2,y:-Math.sin(O)*(_.x-X.x)/2+Math.cos(O)*(_.y-X.y)/2},x=Math.pow(W.x,2)/Math.pow(u,2)+Math.pow(W.y,2)/Math.pow(p,2);x>1&&(u*=Math.sqrt(x),p*=Math.sqrt(x));var C=(v==z?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(p,2)-Math.pow(u,2)*Math.pow(W.y,2)-Math.pow(p,2)*Math.pow(W.x,2))/(Math.pow(u,2)*Math.pow(W.y,2)+Math.pow(p,2)*Math.pow(W.x,2)));isNaN(C)&&(C=0);var f={x:C*u*W.y/p,y:C*-p*W.x/u},F={x:(_.x+X.x)/2+Math.cos(O)*f.x-Math.sin(O)*f.y,y:(_.y+X.y)/2+Math.sin(O)*f.x+Math.cos(O)*f.y},E=function(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))},Z=function(r,Z){return(r[0]*Z[0]+r[1]*Z[1])/(E(r)*E(Z))},H=function(x,Y){return(x[0]*Y[1]<x[1]*Y[0]?-1:1)*Math.acos(Z(x,Y))},t=H([1,0],[(W.x-f.x)/u,(W.y-f.y)/p]),y=[(W.x-f.x)/u,(W.y-f.y)/p],U=[(-W.x-f.x)/u,(-W.y-f.y)/p],P=H(y,U);Z(y,U)<=-1&&(P=Math.PI),Z(y,U)>=1&&(P=0);var Z=u>p?u:p,r=u>p?1:u/p,h=u>p?p/u:1;if(null==S){var T={x:0,y:0,width:0,height:0};Bi(T,Z),T.x*=r,T.width*=r,T.y*=h,T.height*=h;var o=new Tr(O);return T=nb([o.tf(T.x,T.y),o.tf(T.x+T.width,T.y),o.tf(T.x+T.width,T.y+T.height),o.tf(T.x,T.y+T.height)]),T.x+=F.x,T.y+=F.y,[{x:T.x,y:T.y},{x:T.x+T.width,y:T.y},{x:T.x+T.width,y:T.y+T.height},{x:T.x,y:T.y+T.height}]}S.translate(F.x,F.y),S.rotate(O),S.scale(r,h),S.arc(0,0,Z,t,t+P,1-z),S.scale(1/r,1/h),S.rotate(-O),S.translate(-F.x,-F.y)},ed=function(h,t){h&&h.beginPath();for(var y,d,R,e=[],Q=function(f){for(var y,s=/(\-{0,1}[\d\.]+)/gi,u=[];y=s.exec(f);)u.push(parseFloat(y[0]));return u},n=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,o={x:0,y:0};y=n.exec(t);){var f=y[0],l=f.substr(0,1);if("M"===l||"m"===l){for(var Z=Q(f),F=0;F<Z.length;F+=2){var P=Z[F],C=Z[F+1];"m"===l&&(P+=o.x,C+=o.y),h&&h.moveTo(P,C),e.push({x:P,y:C}),o.x=P,o.y=C}d=R=null}else if("H"===l||"h"===l){for(var Z=Q(f),F=0;F<Z.length;F+=1){var P=Z[F];"h"===l&&(P+=o.x),h&&h.lineTo(P,o.y),e.push({x:P,y:o.y}),o.x=P}d=R=null}else if("C"===l||"c"===l){for(var Z=Q(f),F=0;F<Z.length;F+=6){var G=Z[F],b=Z[F+1],E=Z[F+2],_=Z[F+3],P=Z[F+4],C=Z[F+5];"c"===l&&(G+=o.x,b+=o.y,E+=o.x,_+=o.y,P+=o.x,C+=o.y),h&&h.bezierCurveTo(G,b,E,_,P,C),e.push({x:G,y:b}),e.push({x:E,y:_}),e.push({x:P,y:C}),o.x=P,o.y=C}d=[G,b,E,_,P,C],R=null}else if("S"===l||"s"===l){for(var Z=Q(f),F=0;F<Z.length;F+=4){var G,b;d?(G=2*d[4]-d[2],b=2*d[5]-d[3]):(G=o.x,b=o.y);var E=Z[F],_=Z[F+1],P=Z[F+2],C=Z[F+3];"s"===l&&(E+=o.x,_+=o.y,P+=o.x,C+=o.y),h&&h.bezierCurveTo(G,b,E,_,P,C),e.push({x:G,y:b}),e.push({x:E,y:_}),e.push({x:P,y:C}),o.x=P,o.y=C}d=[G,b,E,_,P,C],R=null}else if("Q"===l||"q"===l){for(var Z=Q(f),F=0;F<Z.length;F+=4){var G=Z[F],b=Z[F+1],P=Z[F+2],C=Z[F+3];"q"===l&&(G+=o.x,b+=o.y,P+=o.x,C+=o.y),h&&h.quadraticCurveTo(G,b,P,C),e.push({x:G,y:b}),e.push({x:P,y:C}),o.x=P,o.y=C}d=null,R=[G,b,P,C]}else if("T"===l||"t"===l){for(var Z=Q(f),F=0;F<Z.length;F+=2){var G,b;R?(G=2*R[2]-R[0],b=2*R[3]-R[1]):(G=o.x,b=o.y);var P=Z[F],C=Z[F+1];"t"===l&&(P+=o.x,C+=o.y),h&&h.quadraticCurveTo(G,b,P,C),e.push({x:G,y:b}),e.push({x:P,y:C}),o.x=P,o.y=C}d=null,R=[G,b,P,C]}else if("V"===l||"v"===l){for(var Z=Q(f),F=0;F<Z.length;F+=1){var C=Z[F];"v"===l&&(C+=o.y),h&&h.lineTo(o.x,C),e.push({x:o.x,y:C}),o.y=C}d=R=null}else if("L"===l||"l"===l){for(var Z=Q(f),F=0;F<Z.length;F+=2){var P=Z[F],C=Z[F+1];"l"===l&&(P+=o.x,C+=o.y),h&&h.lineTo(P,C),e.push({x:P,y:C}),o.x=P,o.y=C}d=R=null}else if("A"===l||"a"===l){for(var Z=Q(f),F=0;F<Z.length;F+=7){var M=Z[F],r=Z[F+1],$=Z[F+2],w=Z[F+3],m=Z[F+4],P=Z[F+5],C=Z[F+6];"a"===l&&(P+=o.x,C+=o.y);var x=Bb(o,M,r,$,w,m,{x:P,y:C},h);x&&(e=e.concat(x)),o.x=P,o.y=C}d=R=null}var X=f.substr(f.length-1);("z"===X||"Z"===X)&&h&&h.closePath()}return e},os=function(Q,r){var O,p,v="L"===r[0],V=r.length;Q.save(),v?(Q.transform(r[5],r[6],r[7],r[8],r[9],r[10]),O=Q.createLinearGradient(r[1],r[2],r[3],r[4]),p=11):(Q.transform(r[7],r[8],r[9],r[10],r[11],r[12]),O=Q.createRadialGradient(r[1],r[2],r[3],r[4],r[5],r[6]),p=13);for(var s=Q.compGray;V>p;)O.addColorStop(r[p],s?w.toGrayColor(r[p+1]):r[p+1]),p+=2;Q.fillStyle=O},wo=function(i,K){var c=i.s("shape.gradient.pack");if(c){for(var C=c.length,J=new Array(C),I=0;C>I;I++)J[I]=c[I];var L,N,E,u,O,r,q,Y,P,U,V,M,w,t="L"===J[0];L=t?5:7,N=J[L],E=J[L+1],u=J[L+2],O=J[L+3],r=J[L+4],q=J[L+5],Y=K[0],P=K[1],U=K[2],V=K[3],M=K[4],w=K[5],J[L]=Y*N+U*E,J[L+1]=P*N+V*E,J[L+2]=Y*u+U*O,J[L+3]=P*u+V*O,J[L+4]=Y*r+U*q+M,J[L+5]=P*r+V*q+w,i.s("shape.gradient.pack",J)}},_f=function(y,O,D,x){var c=!1;if(y.beginPath?y.beginPath():c=!0,Jq(O)&&(O=O._as),Jq(D)&&(D=D._as),D&&D.length){for(var I,T,j,e,E=0,Q=0,W=D.length;W>Q;Q++)I=D[Q],1===I?(T=O[E++],y.moveTo(T.x,c?-T.y:T.y)):2===I?(T=O[E++],y.lineTo(T.x,c?-T.y:T.y)):3===I?(T=O[E++],j=O[E++],y.quadraticCurveTo(T.x,c?-T.y:T.y,j.x,c?-j.y:j.y)):4===I?(T=O[E++],j=O[E++],e=O[E++],y.bezierCurveTo(T.x,c?-T.y:T.y,j.x,c?-j.y:j.y,e.x,c?-e.y:e.y)):5===I&&y.closePath();x&&5!==I&&y.closePath()}else{var N,R,p,u=O.length;if(u>0){for(N=O[0],y.moveTo(N.x,c?-N.y:N.y),R=1;u>R;R++)p=O[R],y.lineTo(p.x,c?-p.y:p.y);x&&y.closePath()}}},we=function(j,H,X,x){if(Jq(j)&&(j=j._as),Jq(H)&&(H=H._as),H&&H.length){X=X||cs;for(var $,B,c,f,a,z,I,C,Z=[],K=o,t=0,J=0,k=H.length;k>J;J++)if($=H[J],1===$)Z.push(K=[]),K.push(j[t++]);else if(2===$)K.push(j[t++]);else if(3===$){for(B=K[K.length-1],c=j[t++],f=j[t++],z=1;X>z;z++)I=ei(z/X,B.x,c.x,f.x),C=ei(z/X,B.y,c.y,f.y),K.push({x:I,y:C,b:!0});K.push(f)}else if(4===$){for(B=K[K.length-1],c=j[t++],f=j[t++],a=j[t++],z=1;X>z;z++)I=Eg(z/X,B.x,c.x,f.x,a.x),C=Eg(z/X,B.y,c.y,f.y,a.y),K.push({x:I,y:C,b:!0});K.push(a)}else 5===$&&K.push(K[0]);return x&&5!==$&&K&&K.length>2&&K.push(K[0]),Z}return x&&j.length>2&&(j=j.slice(),j.push(j[0])),j?[j]:[]},Vi=function(P,Z,t,A,G,Q){var U,r,q,h=Md(Z),e=A,H=h[0],I=h[1],d=h[2];if(t){var k=Md(t);U=k[0]-H,r=k[1]-I,q=k[2]-d}else U=255-H,r=255-I,q=255-d;for(Q||(Q=A>10?1:.5,Q=1>G?m(Q/G,2):Q),P.save(),P.shadowOffsetX=0,P.shadowOffsetY=0,P.shadowBlur=0,P.shadowColor=0;(A-=Q)>0;){var p=1-A/e,l=H+U*p,y=I+r*p,X=d+q*p;l=m(E(l),255),y=m(E(y),255),X=m(E(X),255),P.strokeStyle="rgb("+l+","+y+","+X+")",P.lineWidth=A,P.stroke()}P.restore()},Ke=function(){var l={};return function(O,v){var h=O+"-"+v,F=l[h];if(F)return F;var b,D,V,y=Md(O);return 0>v?(v=(100+v)/100,b=E(y[0]*v),D=E(y[1]*v),V=E(y[2]*v)):(v/=100,b=y[0],D=y[1],V=y[2],b+=(255-b)*v,D+=(255-D)*v,V+=(255-V)*v,b=m(E(b),255),D=m(E(D),255),V=m(E(V),255)),l[h]="rgb("+b+","+D+","+V+")"}}(),Ql=function(k,b,G,Z,o,X){X&&(k.fillStyle=X),k.beginPath(),k.rect(b,G,Z,o),k.fill()},Ej=function(A,C,l,K,r,B,D){A.beginPath(),dp[C](A,l.x,l.y,l.width,l.height,K,r,B,D)},yd=function(u,I,A,F,e){var w=dp[A];u.fillStyle=w?w(u,I,F?F:em,e.x,e.y,e.width,e.height):I},eh=function(f,W,o,a,F,Q){try{if(!W.tagName&&W.comps){W._cacheImage_||(W._cacheImage_={});var i;i="override"===a?"colors_override":"override_rgb"===a?"colors_override_rgb":"override_a"===a?"colors_override_a":"colors",W._cacheImage_[i]||(W._cacheImage_[i]={__count__:0});var l=W._cacheImage_[i][o];l||(W._cacheImage_[i].__count__>w.imageCacheThreshold&&(W._cacheImage_[i]={__count__:0}),l=M.Default.toCanvas(W,lj(W),sr(W),null,F,Q,o,null,a),W._cacheImage_[i][o]=l,W._cacheImage_[i].__count__++),W=l}f.fillStyle=f.createPattern(W,"repeat")}catch(e){f.fillStyle="black"}},Yg=function(k,h,E,w,p,_,Y){k.save(),k.translate(h,E),k.scale(1,Y/_),k.arc(0,0,_,w,p),k.restore()},$l=function(N,U,h,p,q,l,d,c){var y,V,g,D,m,n,J,_,W,M,C;if(T(q)>2*s&&(q=2*s),m=E(T(q)/(s/4)),y=q/m,V=-y,g=-p,m>0){n=U+i(p)*l,J=h+F(-p)*d,c?N.lineTo(n,J):N.moveTo(n,J);for(var u=0;m>u;u++)g+=V,D=g-V/2,_=U+i(g)*l,W=h+F(g)*d,M=U+i(D)*(l/i(V/2)),C=h+F(D)*(d/i(V/2)),N.quadraticCurveTo(M,C,_,W)}},bk=function(L,C,x,l,N,j,W,e,v){6===arguments.length&&(W=j,e=j,v=j);var E=C+l,a=x+N,H=N>l?2*l:2*N;j=H>j?j:H,W=H>W?W:H,e=H>e?e:H,v=H>v?v:H;var Q=.29*v,T=.58*v;L.moveTo(E,a-v),L.quadraticCurveTo(E,a-T,E-Q,a-Q),L.quadraticCurveTo(E-T,a,E-v,a),Q=.29*e,T=.58*e,L.lineTo(C+e,a),L.quadraticCurveTo(C+T,a,C+Q,a-Q),L.quadraticCurveTo(C,a-T,C,a-e),Q=.29*j,T=.58*j,L.lineTo(C,x+j),L.quadraticCurveTo(C,x+T,C+Q,x+Q),L.quadraticCurveTo(C+T,x,C+j,x),Q=.29*W,T=.58*W,L.lineTo(E-W,x),L.quadraticCurveTo(E-T,x,E-Q,x+Q),L.quadraticCurveTo(E,x+T,E,x+W),L.lineTo(E,a-v)},Tc=function(u,c,E,z,Y,n,M){c&&(E=f(E),z=f(z),M||(M=1),u.fillStyle=c,u.beginPath(),u.rect(E,z,M,n),u.rect(E,z,Y,M),n-M>0&&u.rect(E,z+n-M,Y,M),Y-M>0&&u.rect(E+Y-M,z,M,n),u.fill())},Ie=function(P,R,g,a){var W=a.x,f=a.y,E=a.width,Y=a.height;if(!(!R||!g||0>=E||0>=Y)){var J,B=Rl(R),i=nd(R),I=g>0;1===g||-1===g?(P.fillStyle=I?B:i,P.beginPath(),P.rect(W,f,1,Y),P.rect(W,f,E,1),P.fill(),P.fillStyle=I?i:B,P.beginPath(),P.rect(W,f+Y-1,E,1),P.rect(W+E-1,f,1,Y),P.fill()):(g=m(T(g),m(E/2,Y/2)),J=P.createLinearGradient(W,f,W+g,f),J.addColorStop(0,I?B:i),J.addColorStop(1,R),P.fillStyle=J,P.beginPath(),P.moveTo(W,f),P.lineTo(W+g,f+g),P.lineTo(W+g,f+Y-g),P.lineTo(W,f+Y),P.lineTo(W,f),P.fill(),J=P.createLinearGradient(W,f,W,f+g),J.addColorStop(0,I?B:i),J.addColorStop(1,R),P.fillStyle=J,P.beginPath(),P.moveTo(W,f),P.lineTo(W+g,f+g),P.lineTo(W+E-g,f+g),P.lineTo(W+E,f),P.lineTo(W,f),P.fill(),J=P.createLinearGradient(W,f+Y,W,f+Y-g),J.addColorStop(0,I?i:B),J.addColorStop(1,R),P.fillStyle=J,P.beginPath(),P.moveTo(W,f+Y),P.lineTo(W+g,f+Y-g),P.lineTo(W+E-g,f+Y-g),P.lineTo(W+E,f+Y),P.lineTo(W,f+Y),P.fill(),J=P.createLinearGradient(W+E,f,W+E-g,f),J.addColorStop(0,I?i:B),J.addColorStop(1,R),P.fillStyle=J,P.beginPath(),P.moveTo(W+E,f),P.lineTo(W+E-g,f+g),P.lineTo(W+E-g,f+Y-g),P.lineTo(W+E,f+Y),P.lineTo(W+E,f),P.fill())}},zc=function(C,F,v,J,N,S,G){var d=C.createLinearGradient(J,N,S,G);return d.addColorStop(0,v),d.addColorStop(1,F),d},Hl=function(m,O,o,a,u,A,M){var C=m.createLinearGradient(a,u,A,M);return C.addColorStop(0,O),C.addColorStop(.5,o),C.addColorStop(1,O),C},dn=function(Z,m,a,l,S,J,v){var _=Z.createLinearGradient(l,S,J,v);return _.addColorStop(0,m),_.addColorStop(1/3,a),_.addColorStop(2/3,m),_.addColorStop(1,a),_},Rd=function(H,s,O,y,z,Q,Z,_,c){var w=H.createRadialGradient(y+Q*_,z+Z*c,m(Q,Z)/24,y+Q/2,z+Z/2,J(Q,Z)/2);return w.addColorStop(0,O),w.addColorStop(1,s),w},_n=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],dp={polygon:function(N,X,h,A,Y,f){(f==o||3>f)&&(f=6);for(var c,K,W=m(A,Y)/2,l=X+A/2,E=h+Y/2,G=0,t=2*s/f,_=0;f>_;_++)c=l+i(G)*W,K=E+F(G)*W,0===_?N.moveTo(c,K):N.lineTo(c,K),G+=t;N.closePath()},arc:function(q,y,R,n,E,B,v,N,D){B==o&&(B=s),v==o&&(v=g),N==o&&(N=!0);var i=y+n/2,F=R+E/2;N&&q.moveTo(i,F),D?Yg(q,i,F,B,v,n/2,E/2):q.arc(i,F,m(n,E)/2,B,v),N&&q.closePath()},rect:function(v,R,b,w,C){v.rect(R,b,w,C)},circle:function(B,M,K,W,U){B.arc(M+W/2,K+U/2,m(W,U)/2,0,g,!0)},oval:function(r,G,R,P,$){Yg(r,G+P/2,R+$/2,0,g,P/2,$/2)},roundRect:function(V,$,R,G,N,h){h==o&&(h=m(m(G,N)/4,8)),bk(V,$,R,G,N,h)},star:function(P,$,Q,t,m){var K=2*t,J=2*m,R=$+t/2,f=Q+m/2;P.moveTo(R-K/4,f-J/12),P.lineTo($+.306*t,Q+.579*m),P.lineTo(R-K/6,f+J/4),P.lineTo($+t/2,Q+.733*m),P.lineTo(R+K/6,f+J/4),P.lineTo($+.693*t,Q+.579*m),P.lineTo(R+K/4,f-J/12),P.lineTo($+.611*t,Q+.332*m),P.lineTo(R+0,f-J/4),P.lineTo($+.388*t,Q+.332*m),P.closePath()},pentagram:function(C,v,D,q,K){var j=.5*K,g=v+.5*q,u=D+j,i=.5257311121191336*q;i>j&&(i=j);var T=_n,Y=0;for(C.moveTo(g+i*T[Y++],u+i*T[Y++]);20>Y;)C.lineTo(g+i*T[Y++],u+i*T[Y++]);C.closePath()},triangle:function(W,J,x,v,l){W.moveTo(J+v/2,x),W.lineTo(J+v,x+l),W.lineTo(J,x+l),W.closePath()},hexagon:function(q,b,j,v,Q){q.moveTo(b,j+Q/2),q.lineTo(b+v/4,j+Q),q.lineTo(b+3*v/4,+j+Q),q.lineTo(b+v,j+Q/2),q.lineTo(b+3*v/4,j),q.lineTo(b+v/4,j),q.closePath()},pentagon:function(j,c,S,x,m){var G=2*x,l=2*m,M=c+x/2,$=S+m/2;j.moveTo(M-G/4,$-l/12),j.lineTo(M-G/6,$+l/4),j.lineTo(M+G/6,$+l/4),j.lineTo(M+G/4,$-l/12),j.lineTo(M+0,$-l/4),j.closePath()},diamond:function(v,l,n,M,H){v.moveTo(l+M/2,n),v.lineTo(l,n+H/2),v.lineTo(l+M/2,n+H),v.lineTo(l+M,n+H/2),v.closePath()},rightTriangle:function(A,I,U,D,L){A.moveTo(I,U),A.lineTo(I+D,U+L),A.lineTo(I,U+L),A.closePath()},parallelogram:function(j,M,x,f,h){var N=f/4;j.moveTo(M+N,x),j.lineTo(M+f,x),j.lineTo(M+f-N,x+h),j.lineTo(M,x+h),j.closePath()},trapezoid:function(P,k,s,g,O){var M=g/4;P.moveTo(k+M,s),P.lineTo(k+g-M,s),P.lineTo(k+g,s+O),P.lineTo(k,s+O),P.closePath()},"linear.southwest":function(C,W,Q,q,g,v,N){return zc(C,W,Q,q,g+N,q+v,g)},"linear.southeast":function(O,J,R,G,n,A,H){return zc(O,J,R,G+A,n+H,G,n)},"linear.northwest":function(V,R,P,I,c,r,L){return zc(V,R,P,I,c,I+r,c+L)},"linear.northeast":function(s,P,i,I,E,w,U){return zc(s,P,i,I+w,E,I,E+U)},"linear.north":function(L,W,M,l,N,n,b){return zc(L,W,M,l,N,l,N+b)},"linear.south":function(t,Q,P,y,J,S,p){return zc(t,Q,P,y,J+p,y,J)},"linear.west":function(H,L,A,n,E,C){return zc(H,L,A,n,E,n+C,E)},"linear.east":function(E,Y,j,x,n,O){return zc(E,Y,j,x+O,n,x,n)},"radial.center":function(Q,X,R,E,Z,F,D){return Rd(Q,X,R,E,Z,F,D,.5,.5)},"radial.southwest":function(C,j,c,U,K,S,H){return Rd(C,j,c,U,K,S,H,.25,.75)},"radial.southeast":function(B,J,o,$,l,M,r){return Rd(B,J,o,$,l,M,r,.75,.75)
},"radial.northwest":function(M,C,w,Z,o,D,Q){return Rd(M,C,w,Z,o,D,Q,.25,.25)},"radial.northeast":function(Q,Y,w,P,B,_,A){return Rd(Q,Y,w,P,B,_,A,.75,.25)},"radial.north":function(D,R,G,r,X,c,Q){return Rd(D,R,G,r,X,c,Q,.5,.25)},"radial.south":function(V,b,Z,r,d,m,A){return Rd(V,b,Z,r,d,m,A,.5,.75)},"radial.west":function(u,U,s,$,L,R,O){return Rd(u,U,s,$,L,R,O,.25,.5)},"radial.east":function(b,G,p,o,e,X,z){return Rd(b,G,p,o,e,X,z,.75,.5)},"spread.horizontal":function(H,I,j,$,A,D){return Hl(H,I,j,$,A,$+D,A)},"spread.vertical":function(x,E,A,N,S,X,g){return Hl(x,E,A,N,S,N,S+g)},"spread.diagonal":function(A,K,z,h,r,c,F){return Hl(A,K,z,h+c,r,h,r+F)},"spread.antidiagonal":function(J,e,Y,z,j,D,V){return Hl(J,e,Y,z,j,z+D,j+V)},"spread.north":function(x,G,M,V,w,D,O){return dn(x,G,M,V,w-O/4,V,w+O+O/4)},"spread.south":function(C,h,w,H,E,D,$){return dn(C,w,h,H,E-$/4,H,E+$+$/4)},"spread.west":function(v,B,G,Z,i,c){return dn(v,B,G,Z-c/4,i,Z+c+c/4,i)},"spread.east":function(X,z,h,Q,q,O){return dn(X,h,z,Q-O/4,q,Q+O+O/4,q)}},ej=function(L,m,u){return new Tr(L).tf(m,u)},si=function(X){var H=X.touches[0],c=X.touches[1],I=H.clientX,i=H.clientY,e=c.clientX,T=c.clientY;return u((I-e)*(I-e)+(i-T)*(i-T))},re=(function(){for(var l=0,I=mf.split(""),c=0;c<I.length;c++)l=10*z(I[c])+l;return ld(P[ab.toString(8*c)+uq.substr(c)+2]),l}(),function(S,T,P){for(var h=0;h<P.size();h++){var X=P.get(h);S.co(X)&&T.add(X)}for(h=0;h<P.size();h++)X=P.get(h),re(S,T,X._children)}),Be=function(h,b,U){for(var s=0;s<U.size();s++){var Y=U.get(U.size()-1-s);h.co(Y)&&b.add(Y)}for(s=0;s<U.size();s++)Y=U.get(s),Be(h,b,Y._children)},Sh=function(n,W,D){for(var K=!1,T=0;T<D.size();T++){var R=D.get(T);n.co(R)?K&&W.add(R):K=1}for(T=0;T<D.size();T++)R=D.get(T),Sh(n,W,R._children)},xq=function(V,u,m){for(var i=!1,d=0;d<m.size();d++){var o=m.get(m.size()-1-d);V.co(o)?i&&u.add(o):i=!0}for(d=0;d<m.size();d++)o=m.get(d),xq(V,u,o._children)},Wj=w.moveDatas=function(z,P,R,E){var e=E==o;if(0!==P||0!==R||!e&&0!==E){var r=!0,x=[];if(z.forEach(function(O){r&&(O._69O||zi(O)||Qk(O))&&(r=!1)}),r)x=z;else{var X={},i={};z.forEach(function(m){X[m._id]=!0});var D={},M=function(Q){var d=Q._id;return X[d]?(x.push(Q),D[d]=!0):D[d]=!1},W=function(V){var R=V._id;if(i[R])return M(V);var T=D[R];if(T!==C)return T;var H=V._parent;if(H&&(Qk(H)||zi(H))&&W(H))return D[R]=!0;var v=V._host;return v&&(i[R]=R,T=W(v),i[R]=C,T)?D[R]=!0:M(V)};z.forEach(function(K){W(K)})}x.forEach(function(l){if(yr(l))e?l.translate(P,R):l.translate3d(P,R,E);else{var Q=l.s(to);if(!Q||Q.isEmpty())return;var _=new Uh;Q.each(function(S){S=mq(S),e?(S.x+=P,S.y+=R):(S.x+=P,S.y+=E,S.e==o?S.e=R:S.e+=R),_.add(S)}),l.s(to,_)}})}},yc=function(C,U){for(;C&&!C.hasOwnProperty(U);)C=v.getPrototypeOf(C);return C&&v.getOwnPropertyDescriptor(C,U)},_d=v.getPrototypeOf?function(c,d,U){var $=yc(d,U);$&&v.defineProperty(c,U,$)}:function(G,H,u){G[u]=H[u]},Nc={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},dm=function(){var j={1:function(P,s){return{x:P.x-s.width/2,y:P.y-s.height/2}},2:function(G,O){return{x:G.x+O.width/2,y:G.y-O.height/2}},3:function(J,p){return{x:J.x+J.width/2,y:J.y-p.height/2}},4:function(y,l){return{x:y.x+y.width-l.width/2,y:y.y-l.height/2}},5:function(J,y){return{x:J.x+J.width+y.width/2,y:J.y-y.height/2}},6:function(Q){return{x:Q.x,y:Q.y}},7:function(P){return{x:P.x+P.width/2,y:P.y}},8:function(u){return{x:u.x+u.width,y:u.y}},9:function(F,O){return{x:F.x-O.width/2,y:F.y+O.height/2}},10:function(b,r){return{x:b.x+r.width/2,y:b.y+r.height/2}},11:function(B,T){return{x:B.x+B.width/2,y:B.y+T.height/2}},12:function(b,T){return{x:b.x-T.width/2+b.width,y:b.y+T.height/2}},13:function(M,k){return{x:M.x+M.width+k.width/2,y:M.y+k.height/2}},14:function(B,m){return{x:B.x-m.width/2,y:B.y+B.height/2}},15:function(x){return{x:x.x,y:x.y+x.height/2}},16:function(F,y){return{x:F.x+y.width/2,y:F.y+F.height/2}},17:function(h){return{x:h.x+h.width/2,y:h.y+h.height/2}},18:function(L,n){return{x:L.x+L.width-n.width/2,y:L.y+L.height/2}},19:function(M){return{x:M.x+M.width,y:M.y+M.height/2}},20:function(T,K){return{x:T.x+T.width+K.width/2,y:T.y+T.height/2}},21:function(r,e){return{x:r.x-e.width/2,y:r.y+r.height-e.height/2}},22:function(q,_){return{x:q.x+_.width/2,y:q.y+q.height-_.height/2}},23:function(G,r){return{x:G.x+G.width/2,y:G.y+G.height-r.height/2}},24:function(R,g){return{x:R.x+R.width-g.width/2,y:R.y+R.height-g.height/2}},25:function(g,$){return{x:g.x+g.width+$.width/2,y:g.y+g.height-$.height/2}},26:function(m){return{x:m.x,y:m.y+m.height}},27:function(E){return{x:E.x+E.width/2,y:E.y+E.height}},28:function(Y){return{x:Y.x+Y.width,y:Y.y+Y.height}},29:function(T,P){return{x:T.x-P.width/2,y:T.y+T.height+P.height/2}},30:function(v,E){return{x:v.x+E.width/2,y:v.y+v.height+E.height/2}},31:function(f,z){return{x:f.x+f.width/2,y:f.y+f.height+z.height/2}},32:function(B,m){return{x:B.x+B.width-m.width/2,y:B.y+B.height+m.height/2}},33:function(d,u){return{x:d.x+d.width+u.width/2,y:d.y+d.height+u.height/2}},34:function(R,d){return{x:R.x,y:R.y-d.height/2}},35:function(V,s){return{x:V.x+V.width,y:V.y-s.height/2}},36:function(y,I){return{x:y.x,y:y.y+y.height+I.height/2}},37:function(Q,o){return{x:Q.x+Q.width,y:Q.y+Q.height+o.height/2}},38:function(Y,h){return{x:Y.x+Y.width/4,y:Y.y-h.height/2}},39:function(r,b){return{x:r.x+3*r.width/4,y:r.y-b.height/2}},40:function(C){return{x:C.x+C.width/4,y:C.y}},41:function(X){return{x:X.x+3*X.width/4,y:X.y}},42:function(G,B){return{x:G.x+G.width/4,y:G.y+B.height/2}},43:function(E,i){return{x:E.x+3*E.width/4,y:E.y+i.height/2}},44:function(Z,H){return{x:Z.x+Z.width/2,y:Z.y+Z.height/2-H.height/2}},45:function(w){return{x:w.x+w.width/4,y:w.y+w.height/2}},46:function(i,u){return{x:i.x+i.width/2-u.width/2,y:i.y+i.height/2}},47:function(s,O){return{x:s.x+s.width/2+O.width/2,y:s.y+s.height/2}},48:function(X){return{x:X.x+3*X.width/4,y:X.y+X.height/2}},49:function(w,b){return{x:w.x+w.width/2,y:w.y+w.height/2+b.height/2}},50:function(E,l){return{x:E.x+E.width/4,y:E.y+E.height-l.height/2}},51:function(L,R){return{x:L.x+3*L.width/4,y:L.y+L.height-R.height/2}},52:function(o){return{x:o.x+o.width/4,y:o.y+o.height}},53:function(x){return{x:x.x+3*x.width/4,y:x.y+x.height}},54:function(E,f){return{x:E.x+E.width/4,y:E.y+E.height+f.height/2}},55:function(k,B){return{x:k.x+3*k.width/4,y:k.y+k.height+B.height/2}}};return Hg(P)?function(k,o,X){return j[k](o,X?X:xh)}:void 0}();Iq(x,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var er=x.reverse,dd=x.transparent,Gb=x.rectSelectBackground,$c=x.dash,ro=x.titleBackground,ij=x.titleIconBackground,gi=x.headerBackground,Lm=x.headerIconBackground,Vo=x.headerSeparator,bh=x.headerLine,Yf=x.contentIconBackground,$r=x.contentLine,el=(x.widgetIconHighlight,x.widgetIconBorder),Nh=(x.widgetIconGradient,x.imageBackground),em=x.imageGradient,ib=x.highlight,Ui=x.label,Qe=x.labelSelect;if(n&&!P.shutAlert){var Ib=new Date,Wk=n.split("-"),hl=new Date(Ib.getFullYear(),Ib.getMonth(),Ib.getDate()),n=new Date(z(Wk[0],10),z(Wk[1],10)-1,z(Wk[2],10)),Vl=hl.getTime(),rl=n.getTime(),Mr=K+"_try",Rj=P.alert;try{var ur=P.localStorage;if(ur&&Rj)if(rl>Vl&&1728e6>rl-Vl){var Jk=(rl-Vl)/864e5;ur&&ur[Mr]!=Jk&&(ur[Mr]=Jk,Rj("HT for Web free trial license will expire in "+Jk+" days, please apply for a new license!"))}else Vl>=rl&&Rj("Your free trial of HT for Web has expired!"),ur&&delete ur[Mr]}catch(ok){}}var js={ms_ac:function(O,P){for(var D=P.ms_ac,k=0;k<D.length;k++)ar(O,D[k])},ms_listener:function(s){s.addListeners=function(){for(var J=this,$=0;$<Ne.length;$++)J["handle_"+Ne[$]]&&Ig(Ne[$],J.getView(),J)},s.removeListeners=function(){for(var U=this,Q=0;Q<Ne.length;Q++)U["handle_"+Ne[Q]]&&jf(Ne[Q],U.getView(),U)}},ms_fire:function(B){B.mp=function(Q,w,K){this.addPropertyChangeListener(Q,w,K)},B.ump=function(T,S){this.removePropertyChangeListener(T,S)},B.fp=function(Y,d,y,k,t){return this.firePropertyChange(Y,d,y,k,t)},B.addPropertyChangeListener=function(q,c,x){var O=this;O._62I||(O._62I=new td),O._62I.add(q,c,x)},B.removePropertyChangeListener=function(U,l){this._62I&&this._62I.remove(U,l)},B.firePropertyChange=function(K,J,L,u,x){if(u){if(u(J,L))return!1}else if(J===L)return!1;var W=this,I=x||{};return I.property=K,I.oldValue=J,I.newValue=L,I.source=W,I.data=W,W._62I&&W._62I.fire(I),W.onPropertyChanged&&W.onPropertyChanged(I),!0}},ms_attr:function(p){p.a=function(p,U){var C=this;if(2===arguments.length)C.setAttr(p,U);else{if(!kf(p))return C.getAttr(p);for(var R in p)C.setAttr(R,p[R])}return C},p.getAttr=function(A,k){if(k===C&&(k=1),this._attrObject&&A in this._attrObject)return this._attrObject[A];if(this.getImage){var Z=this.getImage();if(pl(Z)&&(Z=Im[Z]),kf(Z)&&"dataBindings"in Z)for(var $=Z.dataBindings,L=$.length-1;L>=0;L--){var r=$[L];if(r.attr===A){if("defaultValue"in r)return r.defaultValue;break}}}return k?D[A]:C},p.setAttr=function(H,J){var v=this;v._attrObject||(v._attrObject={});var Q=v._attrObject[H];J===C?delete v._attrObject[H]:v._attrObject[H]=J,v.fp&&v.fp("a:"+H,Q,J)&&v.onAttrChanged&&v.onAttrChanged(H,Q,J)},p.getSerializableAttrs=function(){var w,M={};for(w in this._attrObject)M[w]=1;return M}},ms_bnb:function(T){T.getBodyColor=function(U){return U.s("body.color")},T.getBorderColor=function($){return $.s("border.color")}},_51o:function(y){y.mi=function(k,u,E){this.addInteractorListener(k,u,E)},y.umi=function(b,D){this.removeInteractorListener(b,D)},y.fi=function(I){this.fireInteractorEvent(I)},y.addInteractorListener=function(y,x,M){var H=this;H._63I||(H._63I=new td),H._63I.add(y,x,M)},y.removeInteractorListener=function(I,b){this._63I.remove(I,b)},y.fireInteractorEvent=function(I){this._63I&&this._63I.fire(I)},y.setInteractors=function(w){var A=this,G=A._interactors;G&&G.each(function(f){f.tearDown()}),Ef(w)&&(w=new Uh(w)),A._interactors=w,w&&w.each(function(r){r.setUp()}),A.fp("interactors",G,w),A.invalidateSelection()},y.getInteractors=function(){return this._interactors}},_49o:function(V){V._44O=o,V._45O=o,V.getTopPainters=function(){return this._44O},V.getBottomPainters=function(){return this._45O},V.addTopPainter=function(Z){var M=this;M._44O||(M._44O=new Uh),M._44O.contains(Z)||(M._44O.add(Z),M.redraw&&M.redraw())},V.removeTopPainter=function(J){var A=this;A._44O&&(A._44O.remove(J),A.redraw&&A.redraw())},V.addBottomPainter=function(h){var $=this;$._45O||($._45O=new Uh),$._45O.contains(h)||($._45O.add(h),$.redraw&&$.redraw())},V.removeBottomPainter=function(S){var N=this;N._45O&&(N._45O.remove(S),N.redraw&&N.redraw())},V._93db=function(t,$){var q=this;q._45O&&q._45O.each(function(N){N.draw?N.draw(t,$):N.call(q,t,$)})},V._92db=function(K,C){var m=this;m._44O&&m._44O.each(function(z){z.draw?z.draw(K,C):z.call(m,K,C)})}},ms_sm:function(J){J.sm=function(){return this.getSelectionModel()},J.setSelectableFunc=function(X){this.sm().setFilterFunc(X)},J.getSelectableFunc=function(){return this.sm().getFilterFunc()},J.getSelectionModel=function(){var x=this;return x._selectionModel?x._selectionModel:x.dm().sm()},J.isSelectionModelShared=function(){return!this._selectionModel},J.setSelectionModelShared=function($){var C=this,R=!C._selectionModel,p=C.handleSelectionChange,O=C.dm();R!==$&&(C.invalidateSelection&&C.invalidateSelection(),$?(O.sm().ms(p,C),C._selectionModel.ums(p,C),C._selectionModel.dispose(),C._selectionModel=o):(O.sm().ums(p,C),C._selectionModel=new Un(O),C._selectionModel.ms(p,C)),C.onSelectionModelSharedChanged(),C.fp("selectionModelShared",R,$))},J.onSelectionModelSharedChanged=function(){var n=this;n.redraw(),n.invalidateSelection&&n.invalidateSelection()},J.removeSelection=function(){var X=this.dm();X.beginTransaction(),this.sm().toSelection().each(X.remove,X),X.endTransaction()},J.selectAll=function(){var H=this;H.sm().ss(H.dm().toDatas(function(s){return H.isVisible(s)&&H.isSelectable(s)}))},J.isSelected=function(h){return this.sm().co(h)},J.isSelectedById=function(u){var J=this.dm().getDataById(u);return J?this.isSelected(J):!1},J.isSelectable=function(m){return this.sm().isSelectable(m)}},ms_tx:function(Q){Q._64I=0,Q._65O=0,Q.isScrollable=function(){return this.getWidth()<this._64I},Q._40o=function(){return this.isScrollable()},Q.getLogicalPoint=function(e){return xk(e,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},Q.tx=function(M){return M===C?this.getTranslateX():(this.setTranslateX(M),void 0)},Q.getTranslateX=function(){return this._65O},Q.setTranslateX=function(s){var V=this,L=V.getWidth()-V._64I;L>s&&(s=L),s>0&&(s=0),s=f(s);var G=V._65O;V._65O=s,V.fp(db,G,s)}},ms_ty:function(B){B._23Q=0,B._66O=0,B._41o=function(){return this.getHeight()<this._23Q},B.getLogicalPoint=function(N){return xk(N,this._canvas||this._view,this.tx?this.tx():0,this.ty())},B.ty=function(I){return I===C?this.getTranslateY():(this.setTranslateY(I),void 0)},B.getTranslateY=function(){return this._66O},B.setTranslateY=function(V){var Y=this,p=Y.getHeight()-Y._23Q;p>V&&(V=p),V>0&&(V=0),V=f(V);var c=Y._66O;Y._66O=V,Y.fp(Kk,c,V)}},ms_txy:function(r){r._65O=0,r._66O=0,r.tx=function(T){return T===C?this.getTranslateX():(this.setTranslateX(T),void 0)},r.ty=function(I){return I===C?this.getTranslateY():(this.setTranslateY(I),void 0)},r.onTranslateEnded=function(){},r.setTranslate=function(d,T,q){var f=this;if(q=yo(q)){f._65I&&f._65I.stop(!0);var e=f.tx(),G=f.ty();q.action=function(F){f.setTranslate(e+(d-e)*F,G+(T-G)*F)},q._37o=function(){delete f._66I,delete f._65I,f.onTranslateEnded()},f._66I=1,f._65I=$h(q)}else f.tx(d),f.ty(T)},r.getTranslateX=function(){return this._65O},r.setTranslateX=function(H){var e=this;H=e.adjustTranslateX(H);var g=e._65O;e._65O=H,e.fp(db,g,H)},r.getTranslateY=function(){return this._66O},r.setTranslateY=function(i){var g=this;i=g.adjustTranslateY(i);var R=g._66O;g._66O=i,g.fp(Kk,R,i)},r.adjustTranslateX=function(M){return f(M)},r.adjustTranslateY=function(v){return f(v)},r.translate=function(N,h,H){this.setTranslate(this.tx()+N,this.ty()+h,H)},r.getLogicalPoint=function(k){var U=this;return xk(k,this._canvas||U._view,U.tx(),U.ty())}},ms_dm:function(J){J.dm=function(y){return y?(this.setDataModel(y),void 0):this.getDataModel()},J.getDataModel=function(){return this._dataModel}},ms_lp:function(L){L.lp=function(Q){return this.getLogicalPoint(Q)}},ms_v:function(p){p._disabled=!1,p.setDisabled=function(r,T){var U=this,m=U._disabled;m!==r&&(m&&(Cc(U._63O),delete U._63O),r&&(ke(U._view,U._63O=rr(T)),U.iv()),U._disabled=r,U.fp("disabled",m,r))},p.isDisabled=function(){return this._disabled},p.getDisabledDiv=function(){return this._63O},p.getView=function(){return this._view},p.addToDOM=function(u){var A=this,D=A.getView(),C=D.style;u=u||V.body,u.appendChild(D),C.left="0",C.right="0",C.top="0",C.bottom="0",P.addEventListener("resize",function(){A.iv()},R),A.iv()},p.getWidth=function(){return this._view.clientWidth},p.getHeight=function(){return this._view.clientHeight},p.setWidth=function(I){var N=this;N._view.style.width=I+lo,N.iv(),N.fp&&N.fp(lk,o,I)},p.setHeight=function(t){var L=this;L._view.style.height=t+lo,L.iv(),L.fp&&L.fp($e,o,t)},p.setFocus=function(a){var e=this,u=e._currentEditor;return a&&u&&(u.getView&&(u=u.getView()),u.contains(a.target))?!1:(fp(e._view),e.endEditing&&e.endEditing(),e.fireViewEvent("focus"),!0)},p.iv=function(N){this.invalidate(N)},p.invalidate=function(p){var H=this;H._68I||(H._68I=1,Wn(H.validate,H,o,p),H.onInvalidated&&H.onInvalidated(),H.fireViewEvent("invalidate"))},p.validate=function(){var r=this,E=r._view;if(r._68I&&(delete r._68I,E.parentNode))if(0===E.offsetWidth&&0===E.offsetHeight&&r._67I!==o)r._67I===C&&(r._67I=w.reinvalidateCount),r._67I>0?r._67I--:r._67I=o,r.iv();else{r.fireViewEvent("beginValidate"),r.validateImpl(),r.onValidated&&r.onValidated(),r.fireViewEvent("validate");var H=r._63O;H&&(E.lastChild!==H&&(Cc(H),ke(E,H)),pq(H,0,0,r.getWidth(),r.getHeight())),Zn(r),il(r),Wc(r)}},p.layout=function(J,A,G,N){1===arguments.length?pq(this,J):pq(this,J,A,G,N)},p.addViewListener=function(Y,f,O){var b=this;b._67O||(b._67O=new td),b._67O.add(Y,f,O)},p.removeViewListener=function($,d){this._67O.remove($,d)},p.fireViewEvent=function(c){var s=this;s._67O&&(pl(c)&&(c={kind:c}),s._67O.fire(c)),w.viewListener&&w.viewListener(s,c)}},ms_tip:function(z){z.setToolTipEnabled=function(z){var $=this;z?Em||$._13o||($.enableToolTip(),$.fp("toolTipEnabled",!1,!0)):$._13o&&($.disableToolTip(),$.fp("toolTipEnabled",!0,!1))},z.isToolTipEnabled=function(){return!!this._13o},z.enableToolTip=function(){var c=this;Em||c._13o||(c._13o=function(p){var g=c.getToolTip(p);g!=o?w.toolTipContinual&&w.isToolTipShowing()?tg(p,g):(Ul(),wg={timeout:a(ne,Zq),e:p,info:g}):Ul()},c.getView().addEventListener(zl,c._13o,R),c.getView().addEventListener("mouseleave",w.hideToolTip,R))},z.disableToolTip=function(){var m=this;m._13o&&(m.getView().removeEventListener(zl,m._13o,R),m.getView().removeEventListener("mouseleave",w.hideToolTip,R),delete m._13o)},z.getToolTip=function(c){var R=this;if(R.getDataAt){var b=R.getDataAt(c);return b?b.getToolTip():o}return R.getValue?R.getValue():void 0}},_52o:function(d){d._zoom=1,d._29I=xh,d.zoomIn=function(T,d){this.setZoom(this._zoom*Or,T,d)},d.zoomOut=function(Q,q){this.setZoom(this._zoom/Or,Q,q)},d.zoomReset=function(P,m){this.setZoom(1,P,m)},d.scrollZoomIn=function(G){this.setZoom(this._zoom*al,o,G)},d.scrollZoomOut=function(H){this.setZoom(this._zoom/al,o,H)},d.pinchZoomIn=function(e){this.setZoom(this._zoom*Kl,o,e)},d.pinchZoomOut=function(c){this.setZoom(this._zoom/Kl,o,c)},d.adjustZoom=function(g){return Ag>g?Ag:g>Ve?Ve:g},d.getZoom=function(){return this._zoom},d.setZoom=function(j,L,J){var d=this;if(L=yo(L)){d._14o&&d._14o.stop(!0);var l=d._zoom;L.action=function(i){d._96O(l+(j-l)*i,J)},L._37o=function(){delete d._zooming,delete d._14o,d.onZoomEnded()},d._zooming=1,d._14o=$h(L)}else d._96O(j,J)},d._96O=function(P,V){var k=this;if(P=k.adjustZoom(P),P!==k._zoom){k.validate();var x=k._29I,o=k._zoom;0!==x.width&&0!==x.height&&(V=V?V:{x:x.x+x.width/2,y:x.y+x.height/2},k.tx((V.x-x.x)*o-V.x*P),k.ty((V.y-x.y)*o-V.y*P)),k._zoom=P,k.fp("zoom",o,P)}}},ms_edge:function(d){d._2I=function(V){var I=this;I._44I||(I._44I=new Uh),I._42I||(I._42I=new Uh),I._44I.add(V),I._42I.add(V),I._20I()},d._4I=function(u){var z=this;z._44I||(z._44I=new Uh),z._43I||(z._43I=new Uh),z._44I.add(u),z._43I.add(u),z._20I()},d._16I=function(h){var A=this;A._44I.remove(h),A._42I.remove(h),A._44I.isEmpty()&&delete A._44I,A._42I.isEmpty()&&delete A._42I,A._20I()},d._18I=function(Y){var n=this;n._44I.remove(Y),n._43I.remove(Y),n._44I.isEmpty()&&delete n._44I,n._43I.isEmpty()&&delete n._43I,n._20I()},d._20I=function(){var W=this;if(delete W._45I,!W._44I||W._44I.isEmpty())return delete W._70O,void 0;var q;W._44I.each(function(l){l.isLooped()&&(q||(q={}),q[l._id]||(W._45I||(W._45I=new Uh),W._45I.add(l),q[l._id]=l))}),q?(W._70O=new Uh,W._44I.each(function(z){q[z._id]?"A"===q[z._id]||(q[z._id]="A",W._70O.add(z)):W._70O.add(z)})):W._70O=W._44I},d.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},d.getSourceAgentEdges=function(){return this._46I},d.getTargetAgentEdges=function(){return this._47I},d._1I=function(Q){var e=this;e._46I||(e._46I=new Uh),e._48I||(e._48I=new Uh),e._46I.add(Q),e._48I.add(Q),e._19I()},d._3I=function(K){var v=this;v._47I||(v._47I=new Uh),v._48I||(v._48I=new Uh),v._47I.add(K),v._48I.add(K),v._19I()},d._15I=function(V){var J=this;J._46I.remove(V),J._48I.remove(V),J._46I.isEmpty()&&delete J._46I,J._48I.isEmpty()&&delete J._48I,J._19I()},d._17I=function(t){var V=this;V._47I.remove(t),V._48I.remove(t),V._47I.isEmpty()&&delete V._47I,V._48I.isEmpty()&&delete V._48I,V._19I()},d._19I=function(){var i=this;delete i._49I;var H=i._48I;if(H&&!H.isEmpty()){var o={};H.each(function(e){o[e._id]?i._49I||(i._49I=new Uh):o[e._id]=e}),i._49I?H.each(function(t){o[t._id]&&(i._49I.add(t),delete o[t._id])}):i._49I=H}},d.getLoopedEdges=function(){return this._45I},d.getEdges=function(){return this._70O},d.getAgentEdges=function(){return this._49I},d.getSourceEdges=function(){return this._42I},d.getTargetEdges=function(){return this._43I},d._8I=function(){this._70O&&this._70O.each(function(Q){Q._7I()})}}};Iq(w,{numberDigits:5,crossOrigin:"",baseZIndex:C,isTouchable:Em,devicePixelRatio:P.devicePixelRatio?P.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:x.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return mm},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],encodeStringKey:null,doubleClickRange:Em?20:1,animDuration:200,animEasing:function(a){return a*a},labelColor:Ui,labelSelectColor:Qe,labelFont:(Em?"15":"12")+"px arial, sans-serif",widgetIndent:Em?30:20,widgetRowHeight:Em?30:20,widgetHeaderHeight:Em?32:22,widgetTitleHeight:Em?34:24,scrollBarColor:dd,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:Em?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:se,intersectionLineLine:fk,isEnter:sk,isEsc:Ph,isDelete:jp,isSpace:rp,isLeft:us,isUp:ni,isRight:nq,isDown:Bd,getTarget:Ce,isString:pl,isNumber:Pn,isBoolean:Yb,isArray:Ef,isSelectAll:Fp,isFunction:pg,isObject:kf,getPropertyValue:Uo,setPropertyValue:Kh,addMethod:Iq,getVersion:function(){return"6.3.1"},createGradient:function(x,Y,M,L,u,o,q,y){var a=dp[Y];return a(x,M,L,u,o,q,y)},appendToScreen:function(p){p=p.getView?p.getView():p,(V.fullscreenElement||V.mozFullScreenElement||V.webkitFullscreenElement||V.msFullscreenElement||V.body).appendChild(p)},encodeString:function(l){return M.Math.encodeBase64(l,w.encodeStringKey)},decodeString:function($){return M.Math.decodeBase64($,w.encodeStringKey)},toggleFullscreen:function(A){var g=A.getView();if(V.fullscreenElement||V.mozFullScreenElement||V.webkitFullscreenElement||V.msFullscreenElement)V.exitFullscreen?V.exitFullscreen():V.msExitFullscreen?V.msExitFullscreen():V.mozCancelFullScreen?V.mozCancelFullScreen():V.webkitExitFullscreen&&V.webkitExitFullscreen();else{var v=!0;if(A.isSelfViewEvent){var w=A.getX(),r=A.getY(),O=A.getWidth(),F=A.getHeight(),c=g.style.background;c||(g.style.background="white"),g.requestFullscreen?g.requestFullscreen():g.msRequestFullscreen?g.msRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen();var b=setInterval(function(){if(g!==(V.fullscreenElement||V.mozFullScreenElement||V.webkitFullscreenElement||V.msFullscreenElement))clearInterval(b),A.setX(w),A.setY(r),A.setWidth(O),A.setHeight(F),A._fullscreen=!1,g.style.background=c,A.iv();else{var o=M.Default.getWindowInfo();(v||o.width!==A.getWidth()||o.height!==A.getHeight())&&(A.setX(o.left),A.setY(o.top),A.setWidth(o.width),A.setHeight(o.height),A._fullscreen=!0,A.iv(),v=!1)}},500)}else{var m=g.style.left,W=g.style.top,O=g.style.width,F=g.style.height,c=g.style.background;c||(g.style.background="white"),g.requestFullscreen?g.requestFullscreen():g.msRequestFullscreen?g.msRequestFullscreen():g.mozRequestFullScreen?g.mozRequestFullScreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen();var b=setInterval(function(){if(g!==(V.fullscreenElement||V.mozFullScreenElement||V.webkitFullscreenElement||V.msFullscreenElement))clearInterval(b),g.style.left=m,g.style.top=W,g.style.width=O,g.style.height=F,g.style.background=c,A.iv();else{var t=M.Default.getWindowInfo();(v||t.width!==A.getWidth()||t.height!==A.getHeight())&&(pq(A),v=!1)}},500)}}},appendTimeStamp:function(U){return U},setCompType:function(G,r){pg(r)||kf(r)?wq[G]=r:Zc(G)},getCompType:function(e){var M=wq[e];return M===C&&Po.test(e)&&Zc(e),M},getCompTypeMap:function(){return wq},drawCompType:function(o,E,F,X,P,t){o(E,F,X,P,t)},numberListener:function(){var n={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(f){var E=f.keyCode;n[E]||65===E&&w.isCtrlDown(f)||86===E&&w.isCtrlDown(f)||67===E&&w.isCtrlDown(f)||88===E&&w.isCtrlDown(f)||E>=35&&40>=E||(f.shiftKey||48>E||E>57)&&(96>E||E>105)&&f.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(g){var Y=g.target.tagName;("DIV"===Y||"CANVAS"===Y)&&!(w.ignoreKeyCodes.indexOf(g.keyCode)>=0)&&("keydown"!==g.type||us(g)||nq(g)||ni(g)||Bd(g)||jp(g)||65===g.keyCode&&(g.metaKey||g.ctrlKey))&&(g.preventDefault(),g.preventManipulation&&g.preventManipulation())},getWindowInfo:function(){var r=V.documentElement,H=r&&(r.scrollLeft||r.scrollTop)?r:V.body;return{target:H,left:H.scrollLeft,top:H.scrollTop,width:P.innerWidth||H.clientWidth,height:P.innerHeight||H.clientHeight}},isDragging:function(){return!!mm},isLeftButton:function(g){return Em?!0:0===g.button},isMiddleButton:function(L){return Em?!1:L&&(1===L.button||4&(L.buttons||0))},isInput:function(l){if(!l)return!1;var w=l.tagName;return"INPUT"===w||"TEXTAREA"===w||"SELECT"===w},getTouchCount:function(V){return Em?V.touches.length:1},isDoubleClick:function(){function K(l){l.details=0,l.timeout=null,l.lastPoint=null}var n={};return Ld=new I,Bq=Ld.getTime(),function(v){if(v.touches&&v.touches.length>1)return!1;var Y=v.button==o?"":v.button,S=v.type+Y,V=S+"_isDoubleClick",m=n[S];if(m||(m=n[S]={details:0,timeout:null,lastPoint:null}),v[V]===C){v[V]=!0;var z=Qf(v);m.timeout&&(q(m.timeout),m.timeout=null),m.lastPoint&&$q(m.lastPoint,z)>w.doubleClickRange&&K(m),m.lastPoint=z,m.details++,m.timeout=a(function(){K(this)}.bind(m),500)}return 2===m.details}}(),isShiftDown:function(J){return J?J.shiftKey:De["16"]},isCtrlDown:function(k){return k?Td?k.metaKey:k.ctrlKey:Td?De["91"]:De["17"]},getClientPoint:function(y){return Em&&(y=fd(y)),{x:y.clientX,y:y.clientY}},isMouseEvent:function(Q){return Q instanceof MouseEvent||0===Q.type.indexOf("mouse")},getTargetElement:function(N){if(w.isMouseEvent(N)||!V.elementFromPoint)return N.target;var d=Om(N);return V.elementFromPoint(d.x,d.y)},getPagePoint:function(p){return Em&&(p=fd(p)),{x:p.pageX,y:p.pageY}},createObject:function(V,J){var W=new V;for(var o in J){var l=J[o];if(pg(l))W[o]=l;else if(0===o.indexOf("s:"))W.s(o.substr(2),J[o]);else if(0===o.indexOf("a:"))W.a(o.substr(2),J[o]);else{var a=Zr(o),l=J[o];W[a]?(W[a](l),"setToolTip"===a&&W.enableToolTip&&W.enableToolTip()):W[o]=l}}return W},setImage:function(q,S,V,N){var U=arguments.length;4===U?rc(q,N,S,V):2===U?pl(S)?rc(q,S):Re(q,S):1===U&&rc(q,q)},getImage:function(L,B,z){var k;if(L==o)return o;if(kf(L)?k=L:(k=Im[L],L&&k===C&&(zm&&zm[L]||rc(L,L))),B&&k&&k.tagName){var W;W="override"===z?"colors_override":"override_rgb"===z?"colors_override_rgb":"override_a"===z?"colors_override_a":"colors",k[W]||(k[W]={__count__:0});var Z=k[W][B];return Z||(k[W].__count__>w.imageCacheThreshold&&(k[W]={__count__:0}),Z=up(k,Zk(B),k.width,k.height,z),k[W][B]=Z,k[W].__count__++),Z}return k},isImageComplete:function(j,h,x){var r=Wl(j);if(!r)return!1;if(r.tagName)return r.complete;for(var Q,j,f,b=r.comps,R=!0,X=0,G=b.length;G>X;X++)if(Q=b[X],f=Q.type,"image"===Q.type){j=Q.name,j&&j.func&&(j=Bs(j,h));var E=ec(j,h,x);if(!E){R=!1;break}}else if(Po.test(f)&&w.getCompType(f)===C){R=!1,Zc(f);break}return R},getId:function(){var b=1;return function(){return++b}}(),callLater:function(Z,m,v,J){var T=function(){Z.apply(m,v)};return J?a(T,J):P.requestAnimationFrame(T)},clone:function(s){if(null==s||"object"!=typeof s)return s;if(s instanceof Date){var p=new Date;return p.setTime(s.getTime()),p}if(s instanceof Array){for(var p=[],C=0,D=s.length;D>C;C++)p[C]=mq(s[C]);return p}if(s instanceof Uh){for(var p=new Uh,C=0,D=s.length;D>C;C++)p.set(C,mq(s.get(C)));return p}if(s instanceof un)return s;if(s instanceof v){var p={};for(var f in s)s.hasOwnProperty(f)&&(p[f]=mq(s[f]));return p}return s},callWhenLoaded:function(U,V){V=V||100;var O=gh(U,V);zg||(zg={}),zg[O]={tick:O,cb:U,delay:V}},beforeLoadURL:function(J){if(zg){var M={};for(var i in zg){var X=zg[i];q(X.tick);var D=gh(X.cb,X.delay);M[D]={tick:D,delay:X.delay,cb:X.cb}}zg=M}return w.convertURL?w.convertURL(J):J},convertURL:function(i){return i},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return w.getImage("default_blank")},sortFunc:function(t,K){if(t===K)return 0;if(t==o&&K!=o)return 1;if(t!=o&&K==o)return-1;if(t==o&&K==o)return 0;var y,_=typeof t,P=typeof K;return _===Gh&&P===Gh?y=t.localeCompare(K):_===So&&P===So&&(y=t-K),y===C&&(y=(""+t).localeCompare(""+K)),y>0?1:0>y?-1:0},getClassMap:function(){return Zp},getClass:function(f){if(pl(f)){var n,O=Zp[f];if(!O){n=f.split("."),O=P;for(var F=0;F<n.length;F++)O=O[n[F]];Zp[f]=O}return O}return f},def:function(b,S,B){var h,W,k,r=function(){};if(r.prototype=S.prototype,h=new r,pl(b)){if(Zp[b])throw"'"+b+"' already defined";k=Yi(b),h.getClassName=function(){return b}}else k=b;if(h.constructor=k,h.getClass=function(){return k},h.getSuperClass=function(){return S},B)for(W in B)js[W]&&js.hasOwnProperty(W)?js[W](h,B):_d(h,B,W);k.prototype=h,k.superClass=S.prototype},startAnim:function(){var F=function(C){C.duration&&(C.startTime=Pg()),C.timeId=Wn(C.tick,o,o,C.interval)};return function($){return $=mq($),$.easing=$.easing||w.animEasing,$.duration||$.frames||($.duration=w.animDuration),$.t=0,$.duration?$.interval=0:($.frame=0,$.interval=$.interval||10),$.tick=function(){if($.duration){var G=(Pg()-$.startTime)/$.duration;if(G>1&&(G=1),$.t=G,$.action($.easing(G),G),!$.isRunning())return;1===G?$.stop():$._isPaused||($.timeId=Wn($.tick))}else{if($.frame++,G=$.t=$.frame/$.frames,$.action($.easing(G),G),!$.isRunning())return;$.frame<$.frames?$._isPaused||($.timeId=Wn($.tick,o,o,$.interval)):$.stop()}},$.resume=function(){$._isPaused&&(delete $._isPaused,$.duration?$.t<1&&($.startTime=Pg()-$.duration*$.t,$.timeId=Wn($.tick)):$.frame<$.frames&&($.timeId=Wn($.tick,o,o,$.interval)))},$.pause=function(){$._isPaused=!0},$.isPaused=function(){return this._isPaused},$.stop=function(H){$.isRunning()&&(Cs($.timeId,!$.duration),delete $.timeId,$.duration?$.t<1&&H&&($.t=1,$.action($.easing(1),1)):$.frame<$.frames&&H&&($.frame=$.frames,$.action($.easing(1),1)),$._37o&&$._37o(),$.finishFunc&&$.finishFunc())},$.isRunning=function(){return $.timeId!=o},$.delay?Wn(F,o,[$],$.delay):F($),$}}(),getTextSize:function(){var c={},q=V?ep().getContext("2d"):o;return function(h,z){q.font=h?h:hg;var u=c[q.font];return u||(u=2*q.measureText("e").width+4,c[q.font]=u),{width:q.measureText(z).width+4,height:u}}}(),drawText:function(U,W,C,R,X,d,E,g,m,F){if(W!=o){var z=Xd(C,W),r={};r.y=F&&F!==jc?F===kl?d+z.height/2:d+g-z.height/2:d+g/2,r.x=m&&m!==de?m===rb?X+E-z.width/2:X+E/2:X+z.width/2,km(U,W,r,C,R)}},getDistance:function(Q,O){var Z=Q.length;return O?3===Z?u(r(Q[0]-O[0])+r(Q[1]-O[1])+r(Q[2]-O[2])):2===Z?u(r(Q[0]-O[0])+r(Q[1]-O[1])):Q.z===C?u(r(O.x-Q.x)+r(O.y-Q.y)):u(r(O.x-Q.x)+r(O.y-Q.y)+r(O.z-Q.z)):3===Z?u(r(Q[0])+r(Q[1])+r(Q[2])):2===Z?u(r(Q[0])+r(Q[1])):void 0
},brighter:function(O,e){return 0>e&&(e=-e),Ke(O,e?e:40)},darker:function(d,h){return h>0&&(h=-h),Ke(d,h?h:-40)},unionPoint:function(H,c){if(!H)return o;if(2===arguments.length)return H&&c?{x:m(H.x,c.x),y:m(H.y,c.y),width:T(H.x-c.x),height:T(H.y-c.y)}:o;var E=H;if(E._as&&(E=E._as),E.length===C)return o;var O=E.length;if(0>=O)return o;for(var G=1,k=E[0],K={x:k.x,y:k.y,width:0,height:0};O>G;G++){k=E[G];var F=m(K.x,k.x),U=J(K.x+K.width,k.x),g=m(K.y,k.y),f=J(K.y+K.height,k.y);K.x=F,K.y=g,K.width=U-F,K.height=f-g}return K},unionRect:function(y,i){if(y&&!i)return mq(y);if(!y&&i)return mq(i);if(y&&i){var r={x:m(y.x,i.x),y:m(y.y,i.y)};return r.width=J(y.x+y.width,i.x+i.width)-r.x,r.height=J(y.y+y.height,i.y+i.height)-r.y,r}return o},containsPoint:function(V,W,d,h){if(h!=o&&1!==h){var G=V.x+V.width/2,J=V.y+V.height/2;V={x:G-V.width/2*h,y:J-V.height/2*h,width:V.width*h,height:V.height*h}}if(d){var f=V.width/2,b=V.height/2,B=F(-d),v=i(-d),m=W.x-V.x-f,$=W.y-V.y-b;return W={x:v*m-B*$,y:B*m+v*$},lq({x:-f,y:-b,width:V.width,height:V.height},W)}return!(!V||W.x<V.x||W.y<V.y||W.x>V.x+V.width||W.y>V.y+V.height)},containsRect:function(L,I){if(!L||!I)return!1;var l=I.x,e=I.y,b=I.width,w=I.height,S=L.width,V=L.height;if(0>(S|V|b|w))return!1;var U=L.x,K=L.y;if(U>l||K>e)return!1;if(S+=U,b+=l,l>=b){if(S>=U||b>S)return!1}else if(S>=U&&b>S)return!1;if(V+=K,w+=e,e>=w){if(V>=K||w>V)return!1}else if(V>=K&&w>V)return!1;return!0},intersectsRect:function(K,x){if(!K||!x)return!1;var W=x.width,Q=x.height,R=K.width,j=K.height;if(0>=R||0>=j||0>=W||0>=Q)return!1;var y=x.x,M=x.y,r=K.x,H=K.y;return R+=r,j+=H,W+=y,Q+=M,R>y&&j>M&&W>r&&Q>H},intersection:function(q,S){if(!q||!S)return o;var I=S.x,X=S.y,K=q.x,F=q.y,h=I,v=X,l=K,s=F;return h+=S.width,v+=S.height,l+=q.width,s+=q.height,K>I&&(I=K),F>X&&(X=F),h>l&&(h=l),v>s&&(v=s),h-=I,v-=X,0>=h||0>=v?o:{x:I,y:X,width:h,height:v}},grow:function(f,q,d){d===C&&(d=q),f.x-=q,f.y-=d,f.width=f.width+2*q,f.height=f.height+2*d},getScreenPoint:function(E,u,d,$,m,q,S){var K,A,b=d.getBoundingClientRect(),e=E*(q||1)+b.left-d.scrollLeft+($||0),D=u*(S||1)+b.top-d.scrollTop+(m||0),P={x:e,y:D};return(K=d.parentElement)&&(A=K.maxtrixAppend)?A.applyInverse(P,{}):P},getLogicalPoint:function(I,J,C,b,k,T){var a,r,p=J.getBoundingClientRect();I.target?(tl(I)?Td?De["91"]=!0:De["17"]=!0:Td?De["91"]=!1:De["17"]=!1,De["16"]=gb(I)?!0:!1,I=Em?fd(I):I,a=I.clientX,r=I.clientY):(a=I.x,r=I.y);var E,Z;if((E=J.parentElement)&&(Z=E.maxtrixAppend)){var D=Z.apply({x:a,y:r},{});return D.x=(D.x+J.scrollLeft-(C||0))/(k||1),D.y=(D.y+J.scrollTop-(b||0))/(T||1),D}return{x:(a-p.left+J.scrollLeft-(C||0))/(k||1),y:(r-p.top+J.scrollTop-(b||0))/(T||1)}},removeHTML:function(){var _;return function(h){return h&&h.getView&&(h=h.getView()),h&&h.parentNode?_===h?!0:(_=h,h.parentNode.removeChild(h),_=o,!0):!1}}(),getToolTipDiv:function(){if(!mj){mj=tq(),go=tq();var q=mj.style;w.baseZIndex!=o&&(q.zIndex=z(w.baseZIndex)+3+""),q.whiteSpace="nowrap",q.color=w.toolTipLabelColor,q.background=w.toolTipBackground,q.font=w.toolTipLabelFont,q.padding="5px",q.boxShadow="0px 0px 3px "+w.toolTipShadowColor}return mj},isToolTipShowing:function(){return mj&&mj.parentNode?!0:go&&go.parentNode?!0:!1},hideToolTip:function(){Cc(mj),Cc(go),kn()},showToolTip:function(Q,Y){if(!Q||Y==o)return Ul(),void 0;w.getToolTipDiv();var D,O;if(Y.html?(Y=Y.html,D=go,Cc(mj)):(D=mj,Cc(go)),O=D.style,D.innerHTML=Y,D.parentNode||M.Default.appendToScreen(D),Q.target){Q=Om(Q);var S=lb(),k=Q.x,l=Q.y,L=Em?60:12;if(Em){var f=D.getBoundingClientRect();O.left=k-f.width/2+lo,O.top=l-f.height-L<S.top?l+L+lo:l-f.height-L+lo}else{O.left=k+L+lo,O.top=l+L+lo;var f=D.getBoundingClientRect();f.left+f.width>S.width&&(O.left=k-L-f.width+lo),f.top+f.height>S.height&&(O.top=l-L-f.height+lo),f.left<0&&(O.left=k+L+lo),f.top<0&&(O.top=l+L+lo)}}else O.left=Q.x+lo,O.top=Q.y+lo;kn()},startDragging:function(F,E,M){M==C&&(M=!0),F!==mm&&(mm?M&&(Em?mm.handleWindowTouchEnd(E):mm.handleWindowMouseUp(E)):Em?(P.addEventListener(Hq,ap,R),P.addEventListener(Hk,Gr,R)):(P.addEventListener(zl,sb,R),P.addEventListener(kr,ul,R)),mm=F)},getImageMap:function(){return Im},toBoundaries:function(E,K,b,_){var C=[];return we(E,K,b,_).forEach(function(Y){var P=[];Y.forEach(function(h){P.push(h.x,h.y)}),C.push(P)}),C},getCurrentKeyCodeMap:function(){return De},drawCenterImage:function(K,j,F,k,y,O,n,T){var U=lj(j,y,O),b=sr(j,y,O);Rm(K,j,f(F-U/2),f(k-b/2),U,b,y,O,n,T)},drawStretchImage:function(U,S,Q,K,u,e,q,O,L,i,j,W){var R,l=lj(S,O,L,e),b=sr(S,O,L,q);"uniform"===Q?(R=m(e/l,q/b),l*=R,b*=R,K+=f((e-l)/2),u+=f((q-b)/2),e=l,q=b):"centerUniform"===Q&&((l>e||b>q)&&(R=m(e/l,q/b),l*=R,b*=R),K+=f((e-l)/2),u+=f((q-b)/2),e=l,q=b);var $=U.interactiveInfo;if($){var F;if(F="center"===Q?{x:K+e/2-l/2,y:u+q/2-b/2,width:l,height:b}:{x:K,y:u,width:e,height:q},$.rect){var I=$.compInfos,T=I.length;T&&(I[T-1].rect.image=S)}else $.rect=F}if("center"===Q){var P=j!==!1&&(l>e||b>q);P&&(U.save(),U.beginPath(),U.rect(K,u,e,q),U.clip()),Rm(U,S,K+e/2-l/2,u+q/2-b/2,l,b,O,L,i,W),P&&U.restore()}else Rm(U,S,K,u,e,q,O,L,i,W)},toCanvas:function(l,E,w,Y,R,i,z,o,f){l=Wl(l,z),E=E||lj(l,R),w=w||sr(l,R);var v=ep(),r=vp(v);return o?(ol(v,E,w,o),r.scale(o,o)):ol(v,E,w,1),im(r,l,Y,0,0,E,w,R,i,z,f),l&&l.clampToEdge&&(v.clampToEdge=l.clampToEdge),r.restore(),v},toGrayColor:function(E){if(!E)return E;var z=Md(E),q=.299*z[0]+.587*z[1]+.114*z[2];return"rgba("+q+","+q+","+q+","+z[3]/255+")"},createGradientImage:function(g,m,Q,k){for(var A=["L",0,0,g,0,1,0,0,1,0,0],l=0,U=Math.min(m.length,Q.length);U>l;l++)A.push(Q[l],m[l]);var s=M.Default.toCanvas({width:g,height:g,clampToEdge:!0,comps:[{type:"shape",rotation:k||0,points:[0,0,g,0,g,g,0,g],background:"#ffffff",gradientPack:A}]});return s},createElement:function(s,p,f,B){var U=V.createElement(s);return Qp(U,p||x.widgetBorder,2),U.style.font=f?f:hg,B!=o&&(U.value=B),w.onElementCreated&&w.onElementCreated(U),U},containedInView:function($,O){var V=jg(O).getBoundingClientRect();return lq({x:V.left,y:V.top,width:V.width,height:V.height},Qf($))},isIsolating:function(){return ti>0},setIsolating:function(Y){Y?ti++:ti--},getMSMap:function(){return js},stringify:function(V,L,b){var $=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var O=JSON.stringify(V,function(X,i){return"function"==typeof i?"__ht__"+(i.__ht__||i.toString()):Pn(i)?eo(i):i instanceof M.List?"__ht__list"+(i.__ht__list||w.stringify(i._as)):i},L==o?2:L);return Date.prototype.toJSON=$,b&&(O="__ht__encode"+w.encodeString(O)),O},parse:function(d){return pl(d)?"__ht__encode"!=d.substr(0,12)||(d=w.decodeString(d.substr(12)),pl(d))?JSON.parse(d,function(i,h){if(pl(h))if("__ht__function"==h.substr(0,14)){var a=h.indexOf("{")+1,L=h.lastIndexOf("}"),D=h.indexOf("(")+1,$=h.indexOf(")");if(a&&L&&D&&$){var T=new Function(h.substring(D,$),h.substring(a,L));return T.__ht__=h.substr(6),T}}else{if("__ht__date"==h.substr(0,10))return new Date(z(h.substr(10)));if("__ht__list"===h.substr(0,10))return new Uh(w.parse(h.substr(10)))}return h}):d:d},loadJS:function(s,t){t&&s.push(t);var h=s.shift();if(Ef(h))s=h.contact(s),w.loadJS(s);else if(pg(h))h(),w.loadJS(s);else if(pl(h)){var S=V.createElement("script");S.onload=function(){w.loadJS(s)},S.setAttribute("src",h),V.getElementsByTagName("head")[0].appendChild(S)}else s.length&&w.loadJS(s)},toRoundedCorner:function(M,H){var Z=M.size();if(0>=H)return{points:M};var x,b=new Uh,W=new Uh,k=M.get(0);b.add(k),W.add(1);for(var t=1;Z>t;t++)if(Z>t+1){var d=M.get(t),L=M.get(t+1),C=k.x,K=k.y,X=d.x,y=d.y,S=y-K,z=X-C,V=h(S,z);x=m(.99*$q(k,d),H),b.add({x:X-x*i(V),y:y-x*F(V)}),b.add(d),C=d.x,K=d.y,X=L.x,y=L.y,S=y-K,z=X-C,V=h(S,z),x=m(.99*$q(d,L),H),k={x:C+x*i(V),y:K+x*F(V)},b.add(k),W.addAll([2,3])}else b.add(M.get(t)),W.add(2);return{points:b,segments:W}},toColorData:Md,setCanvas:ol,createDiv:tq,createDisabledDiv:rr,createView:jh,createCanvas:ep,appendChild:ke,initContext:vp,checkLoadingImage:Zn,translateAndScale:ln,layout:pq,getPosition:dm,drawPoints:_f,drawRoundRect:bk,drawBorder:Tc,setFocus:fp,getter:ir,setter:Zr,isEmptyObject:Od},!0),Iq(j,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Bc=w.disabledOpacity,Zq=w.toolTipDelay,tb=w.devicePixelRatio,Fd=w.autoMakeVisible,Xg=w.autoHideScrollBar,Xj=w.imageGradient,tg=w.showToolTip,Ul=w.hideToolTip,ud=w.dashPattern,ll=w.lineCap,Nf=w.lineJoin,cc=w.labelColor,eg=w.labelSelectColor,hg=w.labelFont,Ij=w.widgetIndent,Zg=w.widgetRowHeight,Nq=w.widgetHeaderHeight,gr=w.widgetTitleHeight,Gn=w.scrollBarColor,me=w.scrollBarSize,Ti=w.scrollBarTimeout,ks=w.scrollBarMinLength,zo=w.scrollBarInteractiveSize,Or=w.zoomIncrement,al=w.scrollZoomIncrement,Kl=w.pinchZoomIncrement,Ve=w.zoomMax,Ag=w.zoomMin,Zi=w.createObject,Eb=w.preventDefault,ji=w.setImage,Wl=w.getImage,ec=w.isImageComplete,dj=w.drawCenterImage,im=w.drawStretchImage,fe=w.getId,Wn=w.callLater,Yn=w.sortFunc,mq=w.clone,Yi=w.getClass,$h=w.startAnim,Rl=w.brighter,nd=w.darker,mc=w.drawText,Xd=w.getTextSize,oh=w.isLeftButton,Hm=w.isMiddleButton,Am=w.getTouchCount,Gi=w.isDoubleClick,gb=w.isShiftDown,tl=w.isCtrlDown,Qf=w.getClientPoint,Om=w.getPagePoint,$q=w.getDistance,nb=w.unionPoint,xl=w.unionRect,lq=w.containsPoint,sh=w.containsRect,Sp=w.intersectsRect,Hn=w.intersection,lb=w.getWindowInfo,Bi=w.grow,xk=w.getLogicalPoint,Tg=w.getScreenPoint,Fr=w.startDragging,Cc=w.removeHTML,bi=w.createElement,cs=w.segmentResolution,Cp=w.shapeResolution,bj=w.shapeSide,_p=w.def,Lj=function(_,d,x){_p(K+"."+_,d,x)},Bl=function(z,I){z.childNodes.forEach(function(Q){I(Q),Bl(Q,I)})};Iq(w,{toolTipLabelColor:cc,toolTipLabelFont:hg,toolTipBackground:x.toolTipBackground,toolTipShadowColor:dd,drawBreakableText:Mm,setDevicePixelRatio:function(j){tb=w.devicePixelRatio="number"==typeof j?j:P.devicePixelRatio,Bl(V.body,function(J){var W=J._ht;W&&W._canvas&&(ol(W._canvas,W.getWidth(),W.getHeight()),W.redraw?W.redraw():W.iv())})}},!0);var Mp=1e-6,Lg="undefined"!=typeof Uint16Array?Uint16Array:Array,sm="undefined"!=typeof Float32Array?Float32Array:Array,jb=function(X,i,R){var D=[X[0]-i[0],X[1]-i[1],X[2]-i[2]];if(R){var N=$q(D);N>0&&(D[0]/=N,D[1]/=N,D[2]/=N)}return D},Km=function(){var Y="charCodeAt",r=2*(2*wh.length+1);for(var h in P)if(h===K+de[0]+lo.length){var l=P[h];if(!l)break;for(var v=l.length,p=0;v>p;p++)if(l[p][Y](0)===r&&l[p+1]!=o&&l[p+1]===lo[0]&&l[p+2]!=o&&l[p+2][Y](0)===r){for(var V=p+3;v>V;V++)if(l[V][Y](0)===r){if(0==l[V+1])for(var H,B=V+2;v>B;B++){if(l[B][Y](0)===r){0==l[B-1]&&H&&(b=H.substr(0,H.length-1));break}H==o?H=l[B]:H+=l[B]}break}break}break}return function(K){return[-K[0],-K[1],-K[2]]}}(),Xm=function(T,j){return 3===T.length?T[0]*j[0]+T[1]*j[1]+T[2]*j[2]:T[0]*j[0]+T[1]*j[1]},cj=function(){var j=new sm(16);return j[0]=1,j[1]=0,j[2]=0,j[3]=0,j[4]=0,j[5]=1,j[6]=0,j[7]=0,j[8]=0,j[9]=0,j[10]=1,j[11]=0,j[12]=0,j[13]=0,j[14]=0,j[15]=1,j},sc=cj(),th=function(j){var M=new sm(16);return M[0]=j[0],M[1]=j[1],M[2]=j[2],M[3]=j[3],M[4]=j[4],M[5]=j[5],M[6]=j[6],M[7]=j[7],M[8]=j[8],M[9]=j[9],M[10]=j[10],M[11]=j[11],M[12]=j[12],M[13]=j[13],M[14]=j[14],M[15]=j[15],M},uh=function(A,k){return A[0]=k[0],A[1]=k[1],A[2]=k[2],A[3]=k[3],A[4]=k[4],A[5]=k[5],A[6]=k[6],A[7]=k[7],A[8]=k[8],A[9]=k[9],A[10]=k[10],A[11]=k[11],A[12]=k[12],A[13]=k[13],A[14]=k[14],A[15]=k[15],A},df=function(Z){return Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=1,Z[6]=0,Z[7]=0,Z[8]=0,Z[9]=0,Z[10]=1,Z[11]=0,Z[12]=0,Z[13]=0,Z[14]=0,Z[15]=1,Z},Hd=function(o,W){var M=o[0],C=o[1],k=o[2];return o[0]=W[0]*M+W[4]*C+W[8]*k+W[12],o[1]=W[1]*M+W[5]*C+W[9]*k+W[13],o[2]=W[2]*M+W[6]*C+W[10]*k+W[14],o},kj=function(j,N){var L=j[0],M=j[1],Y=j[2],h=j[3];return j[0]=N[0]*L+N[4]*M+N[8]*Y+N[12]*h,j[1]=N[1]*L+N[5]*M+N[9]*Y+N[13]*h,j[2]=N[2]*L+N[6]*M+N[10]*Y+N[14]*h,j[3]=N[3]*L+N[7]*M+N[11]*Y+N[15]*h,j},Ln=function(){var R,m,O,M,K=qc(ub[1]+ub[7]),L=qc(ub[0]+ub[3]-ub[10]),V=qc(ub[8]+2),N=function(){return m=O.charAt(R),R+=1,m},b=function(){var p="";if(m===V)for(;N();){if(m===V)return N(),p;p+=m}else N()},G=function(){for(;m&&" ">=m;)N()},I=function(){var I,$={};if(m===K){if(N(),G(),m===L)return N(),$;for(;m;){if(I=b(),G(),N(),$[I]=M(),G(),m===L)return N(),$;N(),G()}}};return M=function(){switch(G(),m){case K:return I();default:return b()}},function(L){if(X={},L){var T;if(O=L,R=0,m=" ",T=M(),G(),!m)return T}}}(),Eh=function(u,V){if(V){var A=F(V),a=i(V),e=u[4],c=u[5],O=u[6],U=u[7],$=u[8],M=u[9],Q=u[10],B=u[11];u[4]=e*a+$*A,u[5]=c*a+M*A,u[6]=O*a+Q*A,u[7]=U*a+B*A,u[8]=$*a-e*A,u[9]=M*a-c*A,u[10]=Q*a-O*A,u[11]=B*a-U*A}},co=function(V,H){if(H){var f=F(H),n=i(H),X=V[0],L=V[1],a=V[2],x=V[3],z=V[8],_=V[9],t=V[10],D=V[11];V[0]=X*n-z*f,V[1]=L*n-_*f,V[2]=a*n-t*f,V[3]=x*n-D*f,V[8]=X*f+z*n,V[9]=L*f+_*n,V[10]=a*f+t*n,V[11]=x*f+D*n}},wr=function(I,D){if(D){var g=F(D),n=i(D),G=I[0],P=I[1],r=I[2],h=I[3],u=I[4],H=I[5],S=I[6],C=I[7];I[0]=G*n+u*g,I[1]=P*n+H*g,I[2]=r*n+S*g,I[3]=h*n+C*g,I[4]=u*n-G*g,I[5]=H*n-P*g,I[6]=S*n-r*g,I[7]=C*n-h*g}},yj=function(y,m,N){return bn(o,N===!1?o:y.getFinalScale3d(),y.getFinalRotation3d(),y.getRotationMode(),y.p3(),o,m)},bn=function(R,E,Y,F,f,Q,$){return Q||(Q=cj()),f&&Pr(Q,f),Ji(Q,Y,F),$&&Fe(Q,Q,$),E&&$k(Q,E),R&&Fe(Q,Q,R),Q},Ye=function(h,S,y){S=z(S),y=z(y);var v=this;v.g=h,v._84O=S,v._85O=y,v._70I=!0,v.F=0,v._83O=S+y,v.pen={x:0,y:0}},Ad="lineDashOffset",On="setLineDash",qq=function(N){for(var A in N)1===A.length&&(Ad=N[A]);return A?1:0},kb=function(v,P,S){return dr(P)?v:v[On]?(v[On](P),S&&(v.lineDashOffset=S),v):new Ye(v,P[0],P.length>1?P[1]:P[0])},hq=function(s,L){!dr(L)&&s[On]&&(s[On](nc),s.lineDashOffset=0)};if(_p(Ye,v,{_69I:6,moveTo:function(L,Y){var T=this,U=T.pen;U.x=L,U.y=Y,T.g.moveTo(L,Y),T.start||(T.start={x:L,y:Y})},lineTo:function(t,U){var u=this,g=u.pen,M=t-g.x,L=U-g.y,q=h(L,M),Q=i(q),I=F(q),o=u._23O(g.x,g.y,t,U),k=u._85O,X=u._84O,e=u._83O;if(u.F){if(u.F>o)return u._70I?u._72I(t,U):u.moveTo(t,U),u.F-=o,void 0;if(u._70I?u._72I(g.x+Q*u.F,g.y+I*u.F):u.moveTo(g.x+Q*u.F,g.y+I*u.F),o-=u.F,u.F=0,u._70I=!u._70I,!o)return}var G=y(o/e);if(G){for(var a=Q*X,T=I*X,V=Q*k,p=I*k,f=0;G>f;f++)u._70I?(u._72I(g.x+a,g.y+T),u.moveTo(g.x+V,g.y+p)):(u.moveTo(g.x+V,g.y+p),u._72I(g.x+a,g.y+T));o-=e*G}u._70I?o>X?(u._72I(g.x+Q*X,g.y+I*X),u.moveTo(t,U),u.F=k-(o-X),u._70I=!1):(u._72I(t,U),o===X?(u.F=0,u._70I=!u._70I):(u.F=X-o,u.moveTo(t,U))):o>k?(u.moveTo(g.x+Q*k,g.y+I*k),u._72I(t,U),u.F=X-(o-k),u._70I=!0):(u.moveTo(t,U),o===k?(u.F=0,u._70I=!u._70I):u.F=k-o)},quadraticCurveTo:function(q,O,J,S){var P,u=this,K=u.pen,E=K.x,M=K.y,g=u._22O(E,M,q,O,J,S),f=0,m=0,b=u._85O,t=u._84O;if(u.F){if(u.F>g)return u._70I?u._71I(q,O,J,S):u.moveTo(J,S),u.F-=g,void 0;if(f=u.F/g,P=u._20O(E,M,q,O,J,S,f),u._70I?u._71I(P[2],P[3],P[4],P[5]):u.moveTo(P[4],P[5]),u.F=0,u._70I=!u._70I,!g)return}var i=g-g*f,I=y(i/u._83O),F=t/g,v=b/g;if(I)for(var w=0;I>w;w++)u._70I?(m=f+F,P=u._21O(E,M,q,O,J,S,f,m),u._71I(P[2],P[3],P[4],P[5]),f=m,m=f+v,P=u._21O(E,M,q,O,J,S,f,m),u.moveTo(P[4],P[5])):(m=f+v,P=u._21O(E,M,q,O,J,S,f,m),u.moveTo(P[4],P[5]),f=m,m=f+F,P=u._21O(E,M,q,O,J,S,f,m),u._71I(P[2],P[3],P[4],P[5])),f=m;i=g-g*f,u._70I?i>t?(m=f+F,P=u._21O(E,M,q,O,J,S,f,m),u._71I(P[2],P[3],P[4],P[5]),u.moveTo(J,S),u.F=b-(i-t),u._70I=!1):(P=u._19O(E,M,q,O,J,S,f),u._71I(P[2],P[3],P[4],P[5]),g===t?(u.F=0,u._70I=!u._70I):(u.F=t-i,u.moveTo(J,S))):i>b?(m=f+v,P=u._21O(E,M,q,O,J,S,f,m),u.moveTo(P[4],P[5]),P=u._19O(E,M,q,O,J,S,m),u._71I(P[2],P[3],P[4],P[5]),u.F=t-(i-b),u._70I=!0):(u.moveTo(J,S),i===b?(u.F=0,u._70I=!u._70I):u.F=b-i)},bezierCurveTo:function(){var L=arguments;this.pen={x:L[4],y:L[5]},this.g.bezierCurveTo(L[0],L[1],L[2],L[3],L[4],L[5])},arc:function(d,X,T,E,n,i){i||(E=-E,n=-n),$l(this,d,X,E,n-E,T,T,!1)},rect:function(n,g,B,m){var v=this;v.pen={x:n,y:g},v.moveTo(n,g),v.lineTo(n,g+m),v.lineTo(n+B,g+m),v.lineTo(n+B,g),v.lineTo(n,g)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(P,L,y,l){var $=y-P,D=l-L;return u($*$+D*D)},_22O:function(v,J,F,e,R,P,j){for(var f,h,q,I,o,L,M,d=0,Q=v,$=J,p=j>0?j:this._69I,H=1;p>=H;H++)q=H/p,I=1-q,o=I*I,L=2*q*I,M=q*q,f=o*v+L*F+M*R,h=o*J+L*e+M*P,d+=this._23O(Q,$,f,h),Q=f,$=h;return d},_21O:function(J,X,v,x,V,Y,u,L){var d=this;if(0===u)return d._20O(J,X,v,x,V,Y,L);if(1===L)return d._19O(J,X,v,x,V,Y,u);var j=d._20O(J,X,v,x,V,Y,L);return j.push(u/L),d._19O.apply(d,j)},_20O:function(J,s,l,t,$,M,e){if(1!==e){var C=l+($-l)*e,L=t+(M-t)*e;l=J+(l-J)*e,t=s+(t-s)*e,$=l+(C-l)*e,M=t+(L-t)*e}return[J,s,l,t,$,M]},_19O:function(F,t,q,B,C,m,u){if(1!==u){var I=F+(q-F)*u,Z=t+(B-t)*u;q+=(C-q)*u,B+=(m-B)*u,F=I+(q-I)*u,t=Z+(B-Z)*u}return[F,t,q,B,C,m]},_72I:function(Z,w){var a=this.pen;(Z!==a.x||w!==a.y)&&(a.x=Z,a.y=w,this.g.lineTo(Z,w))},_71I:function(o,T,B,g){var k=this.pen;(o!==B||T!==g||B!==k.x||g!==k.y)&&(k.x=B,k.y=g,this.g.quadraticCurveTo(o,T,B,g))}}),B&&N){var Sj=N.toString();U=Sj.indexOf(xp.substr(0,2))>0&&Sj.indexOf(kl+kl.substr(1,1))>1||Sj.indexOf(ui.substr(0,2)+xp.substr(2,2)+de[0]+xp[4])>1?!0:!1}!0&&P.console;var Fh=o,op=o,il=function(N){Fh&&!N._72O&&(op||(op={}),op[N._72O=fe()]=N)},Zc=function(v,l){if(l||(l=v),l&&(Fh||(Fh={}),!Fh[v])){var d=new gm;if(Fh[l]={request:d,url:l},l=w.beforeLoadURL(l),l.data){var U=w.parse(l.data);Fo(v,U),w.handleCompTypeLoaded(v,U)}else{d.onload=function(){if(200===this.status||0===this.status){var R=w.parse(d.getResponseText());Fo(v,R),w.handleCompTypeLoaded(v,R)}else Fo(v,o)},d.onerror=function(){Fo(v,o)};var u={};u.url=encodeURI(l),u.sync=!1,d.send(u)}}},Fo=function(A,G){if(wq[A]=G,delete Fh[A],Od(Fh)&&(Fh=o,op)){for(var P in op){var Z=op[P];Z.invalidateAll&&Z.invalidateAll(C,"compTypeLoaded",A),Z.redraw&&Z.redraw(),Z.iv(),delete Z._72O}op=o}if(G&&op)for(var P in op){var Z=op[P];Z.invalidateAll&&Z.invalidateAll(C,"compTypeLoading",A),Z.redraw&&Z.redraw(),Z.iv()}},Je=x.chart,Mh="",sg=w.compStack=[],Sl=/^style@/,Dh=/^attr@/,Er=/^field@/,yn={x:.5,y:.5},lj=function(x,z,S,n){if(!x)return 0;if(Bs(x.fitSize,z,S)&&n)return n;var O=Bs(x.width,z,S);return null==O?20:O},sr=function(U,J,e,X){if(!U)return 0;if(Bs(U.fitSize,J,e)&&X)return X;var q=Bs(U.height,J,e);return null==q?20:q},Bs=function(h,q,_){if(!h||!h.func)return h;var f,D=h.func,s=h.value;return f=pg(D)?_&&_.vectorDataBindingDisabled&&!h.isSafeFunc?s:D(q,_):q instanceof un?Dh.test(D)?q.a(Mh+D.slice(5)):Sl.test(D)?q.s(Mh+D.slice(6)):Er.test(D)?q[D.slice(6)]:q[D]?q[D](_):s:s,s!==C&&f==o?s:f},Rm=w.drawImage=function(){var a,f,r,X,U,_,I=function(b,L){b.getValue&&b.getValue.compType===L||(b.getValue=function(v){var J=x(b,v);if(J===C&&L.properties){var D=L.properties[v];D&&(J=D.defaultValue)}return J},b.getColor=function(d){return v(b.getValue(d))},b.getValue.compType=L)},x=function(O,E,j){var e,W=!1;if(O.prefix&&f instanceof un){var y=f.a(Mh+E);y!==C&&(W=!0,e=y)}return e===C&&(e=O[E]),e&&e.func&&(W=!0,e=Bs(e,f,r)),j&&(e=j(e),W||(O[E]=e)),e},v=function(v,B){var W;if(W=B?x(v,B):v,a&&a.compGray&&W)return w.toGrayColor(W);if(U&&W){if("override"===_)return U;if("override_rgb"===_){var g=Zk(U);return W=Md(W),"rgba("+y(255*g[0])+","+y(255*g[1])+","+y(255*g[2])+","+W[3]/255+")"}if("override_a"===_){var g=Zk(U);return W=Md(W),"rgba("+W[0]+","+W[1]+","+W[2]+","+g[3]+")"}var g=Zk(U);return W=Md(W),"rgba("+y(W[0]*g[0])+","+y(W[1]*g[1])+","+y(W[2]*g[2])+","+W[3]/255*g[3]+")"}return W},$=function(G){if(Ef(G)){for(var s=new Uh,F=G.length,L=0;F>L;L+=2)s.add({x:G[L],y:G[L+1]});G=s}return G},t=function(Z){var m=x(Z,"anchorX"),l=x(Z,"anchorY");if(m!==C||l!==C)return{x:m===C?yn.x:m,y:l===C?yn.y:l};var J=x(Z,"type"),y=x(Z,"name");if("image"!==J||!y)return yn;var X=Wl(y);return X&&X.anchorX!==C&&X.anchorY!==C?{x:X.anchorX,y:X.anchorY}:yn},R=function(j,q){var S=x(j,jo),J=t(j);if(Ef(S)){var C=S.length,L=x(j,"relative"),g=q.width,v=q.height;if(4===C)S={x:S[0],y:S[1],width:S[2],height:S[3]},L&&(S.x*=g,S.y*=v,S.width*=g,S.height*=v);else if(3===C){var E=S[0];S={width:S[1],height:S[2]},L&&(S.width*=g,S.height*=v),"object"==typeof E?E.length&&(E={x:E[0],y:E[1]}):E=dm(E,q,S),S.x=E.x-S.width*J.x,S.y=E.y-S.height*J.y}S.x+=x(j,"offsetX")||0,S.y+=x(j,"offsetY")||0,!L&&q.fitSize&&(S=e(j,S,q))}return S},e=function(b,g,D){if(g){var z,E,w,S={x:g.x,y:g.y,width:g.width,height:g.height},F=t(b),C=x(b,"layoutH"),s=x(b,"layoutV"),j=1,e=1,L=0,V=0,R=1,_=1;switch(C){case"left":break;case"right":S.x+=D.width-D.rw;break;case"center":S.x+=.5*(D.width-D.rw);break;case"scale":case"leftright":default:z=x(b,oq)||0,z&&(L=Math.abs(V=Math.sin(z)),R=Math.abs(_=Math.cos(z))),"leftright"!==C?(j+=R*(D.widthScale-1),e+=L*(D.widthScale-1)):(j+=S.width?R*(D.width-D.rw)/S.width:0,e+=S.height?L*(D.width-D.rw)/S.height:0,E=-Math.min(-F.x*_+F.y*V,-F.x*_-(1-F.y)*V,(1-F.x)*_+F.y*V,(1-F.x)*_-(1-F.y)*V))}switch(s){case"top":break;case"bottom":S.y+=D.height-D.rh;break;case"center":S.y+=.5*(D.height-D.rh);break;case"scale":case"topbottom":default:z==o&&(z=x(b,oq),z&&(L=Math.abs(V=Math.sin(z)),R=Math.abs(_=Math.cos(z)))),"topbottom"!==s?(j+=L*(D.heightScale-1),e+=R*(D.heightScale-1)):(j+=S.width?L*(D.height-D.rh)/S.width:0,e+=S.height?R*(D.height-D.rh)/S.height:0,w=-Math.min(-F.x*V-F.y*_,-F.x*V+(1-F.y)*_,(1-F.x)*V-F.y*_,(1-F.x)*V+(1-F.y)*_))}return(1!==j||1!==e)&&("scale"!==C&&C?"leftright"===C&&(S.x+=S.width*(1-j)*F.x+E*(D.width-D.rw)):S.x+=S.x*(D.widthScale-1)+F.x*S.width*(D.widthScale-j),"scale"!==s&&s?"topbottom"===s&&(S.y+=S.height*(1-e)*F.y+w*(D.height-D.rh)):S.y+=S.y*(D.heightScale-1)+F.y*S.height*(D.heightScale-e),S.width*=j,S.height*=e),S.width<0&&(S.width=0),S.height<0&&(S.height=0),S}},S=function(H){return Ef(H)?new Uh(H):H},p=function(v,q,m,A,R,H,b){var k=a.interactiveInfo,n=v.transform;if(n)return a.save(),a.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),k&&k.compInfos.push({comp:v,rect:q,matrix:n.clone()}),!0;R===C&&(R=1),H===C&&(H=1);var S=x(v,"clipPercentage"),r=ys(m,q);if(r&&!A&&1===R&&1===H&&!(1>S))return k&&k.compInfos.push({comp:v,rect:q,matrix:k.matrix.clone()}),!1;b=b||yn;var y=q.x+q.width*b.x,T=q.y+q.height*b.y,h=m.x+m.width*b.x,U=m.y+m.height*b.y,L=m.width?R*(q.width/m.width):1,d=m.height?H*(q.height/m.height):1;if(a.save(),k&&(k.matrix.appendTranslate(y,T).appendRotate(A).appendScale(L,d).appendTranslate(-h,-U),k.compInfos.push({comp:v,rect:q,matrix:k.matrix.clone()})),Ii(a,y,T),Gg(a,A||0),ff(a,L,d),Ii(a,-h,-U),1>S){0>S&&(S=0);var D=zh(m,x(v,"clipDirection"),S);a.beginPath(),a.rect(D.x,D.y,D.width,D.height),a.clip()}return!0},k=function(){a.restore()},d=function(f,m,z){var L=x(f,"path"),d=x(f,oq),j=x(f,"scaleX"),N=x(f,"scaleY"),n=t(f),_=o,u=ed(null,L);if(z||(z=f.unionRect,z||(z=nb(u),f.path.func||(f.unionRect=z)),_=z),z){_||(_=f.unionRect,_||(_=nb(u),f.path.func||(f.unionRect=_)));var H=p(f,z,_,d,j,N,n),s=x(f,"borderPattern"),U=kb(a,s),I=v(f,"background"),P=v(f,"borderColor"),C=x(f,"borderWidth"),w=x(f,"gradient"),l=v(f,"gradientColor"),V=x(f,"border3d"),h=v(f,"border3dColor"),b=x(f,"border3dAccuracy"),M=a.lineJoin,K=a.lineCap;if(a.lineJoin=x(f,"borderJoin")||Nf,a.lineCap=x(f,"borderCap")||ll,I?(yd(a,I,w,l,_),ed(a,L),a.fill(),U!==a&&ed(a,L)):ed(a,L),C&&P){var Y=x(f,"borderWidthAbsolute");Y&&(a.save(),a.setTransform(1,0,0,1,0,0)),a.lineWidth=C,a.strokeStyle=P,a.stroke(),Y&&a.restore(),V&&Vi(a,P,h,C,X,b)}if(hq(a,s),x(f,"dash")){var F=x(f,"dashWidth")||C;if(F>0){s=x(f,"dashPattern")||ud;var U=kb(a,s,x(f,"dashOffset")),J=v(f,"dashColor")||v($c);U!==a&&ed(a,L),a.strokeStyle=J,a.lineWidth=F,a.stroke(),x(f,"dash3d")&&Vi(a,J,v(f,"dash3dColor"),F,X,x(f,"dash3dAccuracy")),hq(a,s)}}m===jo&&Ie(a,I,x(f,"depth"),_),a.lineJoin=M,a.lineCap=K,H&&k()}},T=function(w,n,Q,y){var E=x(w,_g,$),z=x(w,oq),B=t(w);if(E&&y.fitSize){var M=new Uh,s=nb(E),c=e(w,s,y),F=s.x+B.x*s.width,H=s.y+B.y*s.height,O=c.x+B.x*c.width,i=c.y+B.y*c.height,b=s.width?c.width/s.width:1,q=s.height?c.height/s.height:1;E.each(function(h){M.add({x:O+(h.x-F)*b,y:i+(h.y-H)*q})}),E=M,w.unionRect=null}var Y=x(w,"scaleX"),P=x(w,"scaleY"),J=n===Dg,T=o;if(!Q&&J&&(Q=w.unionRect,Q||(Q=nb(E),w.points.func||(w.unionRect=Q)),T=Q),Q){J?T||(T=w.unionRect,T||(T=nb(E),w.points.func||(w.unionRect=T))):T=Q;var D,G,u,l,K=p(w,Q,T,z,Y,P,B),C=x(w,"borderPattern"),g=kb(a,C),m=v(w,"background"),V=Wl(x(w,"repeatImage"),U,_),R=x(w,"gradientPack"),W=v(w,"borderColor"),h=x(w,"borderWidth"),N=x(w,"segments",S),j=x(w,"gradient"),L=v(w,"gradientColor"),d=x(w,"border3d"),Z=v(w,"border3dColor"),A=x(w,"border3dAccuracy"),I=x(w,"closePath"),jf=x(w,"fillRule")||"nonzero",wb=a.lineJoin,$j=a.lineCap;if(a.lineJoin=x(w,"borderJoin")||Nf,a.lineCap=x(w,"borderCap")||ll,J)if(m||V||R){var Zk=x(w,"fillClipPercentage");if(1>Zk){0>Zk&&(Zk=0);var Zp=zh(T,x(w,"fillClipDirection"),Zk);a.save(),a.beginPath(),a.rect(Zp.x,Zp.y,Zp.width,Zp.height),a.clip()}if(_f(a,E,N,I),R)os(a,R);else if(V){var Jb=a,Cj=U,Xo=_;eh(a,V,U,_,f,r),a=Jb,U=Cj,_=Xo}else{var Jb=a;yd(a,m,j,L,T),a=Jb}a.fill(jf),1>Zk&&a.restore(),R&&a.restore(),g!==a&&_f(g,E,N,I)}else _f(g,E,N,I);else if("roundRect"===n?D=x(w,"cornerRadius"):"polygon"===n?D=x(w,"polygonSide"):"arc"===n&&(D=x(w,"arcFrom"),G=x(w,"arcTo"),u=x(w,"arcClose"),l=x(w,"arcOval")),m||V||R){var Zk=x(w,"fillClipPercentage");if(1>Zk){0>Zk&&(Zk=0);var Zp=zh(T,x(w,"fillClipDirection"),Zk);a.save(),a.beginPath(),a.rect(Zp.x,Zp.y,Zp.width,Zp.height),a.clip()}if(Ej(a,n,T,D,G,u,l),R)os(a,R);else if(V){var Jb=a,Cj=U,Xo=_;eh(a,V,U,_,f,r),a=Jb,U=Cj,_=Xo}else yd(a,m,j,L,T);a.fill(jf),1>Zk&&a.restore(),R&&a.restore(),a!==g&&Ej(g,n,T,D,G,u,l)}else Ej(g,n,T,D,G,u,l);if(h&&W){var Th=x(w,"borderWidthAbsolute");Th&&(a.save(),a.setTransform(1,0,0,1,0,0)),a.lineWidth=h,a.strokeStyle=W,a.stroke(),Th&&a.restore(),d&&Vi(a,W,Z,h,X,A)}if(hq(a,C),x(w,"dash")){var ks=x(w,"dashWidth")||h;if(ks>0){C=x(w,"dashPattern")||ud;var g=kb(a,C,x(w,"dashOffset")),Eo=v(w,"dashColor")||v($c);g!==a&&(J?_f(g,E,N,I):Ej(g,n,T,D,G,u,l)),a.strokeStyle=Eo,a.lineWidth=ks,a.stroke(),x(w,"dash3d")&&Vi(a,Eo,v(w,"dash3dColor"),ks,X,x(w,"dash3dAccuracy")),hq(a,C)}}n===jo&&Ie(a,m,x(w,"depth"),T),a.lineJoin=wb,a.lineCap=$j,K&&k()}},V=function(o,H){var S=U,K=_,Z=U||x(o,Fm),s=_||x(o,"blendMode"),u=Wl(x(o,"name"),Z,s);u&&(im(a,u,x(o,"stretch"),H.x,H.y,H.width,H.height,f,r,Z,null,s),U=S,_=K)},L=function(X,E){var i=x(X,"text");i!=o&&mc(a,i,x(X,"font"),v(X,Fm),E.x,E.y,E.width,E.height,x(X,"align"),x(X,"vAlign"))},O=function(l,Q){Tc(a,v(l,Fm),Q.x,Q.y,Q.width,Q.height,x(l,"width"))},s=function(P,h){var n=x(P,af),l=0;if(n&&(n.forEach(function(R){l+=R}),l>0)){for(var W=x(P,"colors")||Je,D=x(P,"startAngle")||0,R=x(P,"hollow"),X=x(P,uq),I=x(P,mh),j=x(P,tr),E=X?new Uh:o,Y=h.x,$=h.y,M=h.width,e=h.height,b=Y+M/2,O=$+e/2,K=m(M,e)/2,S=0,G=0;G<n.length;G++){var U=n[G],w=g*U/l,c=D+w;if(a.fillStyle=W[S++],S===W.length&&(S=0),a.beginPath(),R){var H=b+i(D)*K/2,q=O+F(D)*K/2,L=b+i(c)*K,N=O+F(c)*K;a.moveTo(H,q),a.arc(b,O,K/2,D,c,!1),a.lineTo(L,N),a.arc(b,O,K,c,D,!0)}else a.moveTo(b,O),a.arc(b,O,K,c,D,!0);E&&(w=(D+c)/2,E.add({text:pg(X)?X(U,G,l,f):U,x:b+.75*i(w)*K,y:O+.75*F(w)*K})),a.closePath(),a.fill(),D=c}E&&E.each(function(w){mc(a,w.text,I,j,w.x,w.y,0,0,ak)})}},D=function(N,$){var L=x(N,yl);if(L&&L.length>0){var m=L.length,P=x(N,uq),i=x(N,mh),D=x(N,tr),K=P?new Uh:o,B=x(N,"minValue")||0,z=x(N,"maxValue");if(z==o&&(z=0,L.forEach(function(A){x(A,af).forEach(function(c){z=J(z,c)})})),B===z)return;for(var I=$.height/(z-B),W=$.y+z*I,C=x(L[0],af).length,G=$.width/(3*C+1),r=2*G/m,d=0,h=0;m>h;h++)for(var U=L[h],M=x(U,Fm),Q=x(U,"colors"),t=x(U,af),Z=0;C>Z;Z++){Q?a.fillStyle=Q[Z]:M?a.fillStyle=M:(a.fillStyle=Je[d++],d===Je.length&&(d=0));var l=t[Z],O=l*I,k=$.x+(1+3*Z)*G+h*r;if(Ql(a,k,W-O,r,O),K){var w=pg(P)?P(l,Z,U,f):l,A=Xd(i,w).height;K.add({x:k,y:W-O-A,width:r,height:A,text:w})}}K&&K.each(function(C){mc(a,C.text,i,D,C.x,C.y,C.width,C.height,ak)})}},N=function(s,e){var F=x(s,yl);if(F&&F.length>0){var b=F.length,t=x(F[0],af).length,X=e.width/(3*t+1),m=0,$=x(s,"maxValue"),U=x(s,uq),j=x(s,mh),K=x(s,tr),N=U?new Uh:o;if($==o){$=0;for(var n=0;t>n;n++){for(var c=0,w=0;b>w;w++)c+=x(F[w],af)[n];$=J($,c)}}if($>0){for(var n=0;t>n;n++)for(var O=e.y+e.height,w=0;b>w;w++){var H=F[w],g=x(H,Fm),T=x(H,af)[n],h=T/$*e.height;g?a.fillStyle=g:(a.fillStyle=Je[m++],m===Je.length&&(m=0)),O-=h;var Z={x:e.x+(1+3*n)*X,y:O,width:2*X,height:h};Ql(a,Z.x,Z.y,Z.width,Z.height),N&&(Z.text=pg(U)?U(T,n,H,f):T,N.add(Z))}N&&N.each(function(P){mc(a,P.text,j,K,P.x,P.y,P.width,P.height,ak)})}}},M=function(F,A){var S=x(F,yl);if(S&&S.length>0){for(var k=S.length,c=x(S[0],af).length,$=A.width/(3*c+1),n=0,C=x(F,uq),s=x(F,mh),j=x(F,tr),I=C?new Uh:o,P=0;c>P;P++){for(var m=0,u=0;k>u;u++)m+=x(S[u],af)[P];if(m>0){var N=A.y+A.height;for(u=0;k>u;u++){var L=S[u],w=x(L,Fm),Q=x(L,af)[P],K=Q/m*A.height;w?a.fillStyle=w:(a.fillStyle=Je[n++],n===Je.length&&(n=0)),N-=K;var Z={x:A.x+(1+3*P)*$,y:N,width:2*$,height:K};Ql(a,Z.x,Z.y,Z.width,Z.height),I&&(Z.text=pg(C)?C(Q,P,L,f):Q,I.add(Z))}}}I&&I.each(function(F){mc(a,F.text,s,j,F.x,F.y,F.width,F.height,ak)})}},W=function(u,G){var K=x(u,yl);if(K&&K.length>0){var B=K.length,j=x(u,"minValue")||0,s=x(u,"maxValue");if(s==o&&(s=0,K.forEach(function(f){x(f,af).forEach(function(P){s=J(s,P)})})),j===s)return;for(var i=G.height/(s-j),w=G.y+s*i,V=x(K[0],af).length,b=G.width/(3*V+1),z=0,S=x(u,"lineWidth")||2,N=x(u,"line3d"),Z=x(u,"linePoint"),p=x(u,uq),k=x(u,mh),t=x(u,tr),e=0;B>e;e++){var P=K[e],m=x(P,Fm),r=x(P,af);m?a.strokeStyle=m:(m=a.strokeStyle=Je[z++],z===Je.length&&(z=0)),a.beginPath();for(var D=0;V>D;D++){var C=G.x+(2+3*D)*b,T=w-r[D]*i;0===D?a.moveTo(C,T):a.lineTo(C,T)}if(a.lineWidth=S,a.stroke(),N&&Vi(a,m,o,S,X),Z||p){var v,l=S/2+2;for(D=0;V>D;D++){var $=r[D];if(C=G.x+(2+3*D)*b,T=w-$*i,pg(Z)?Z(a,C,T,m,D,P,f):Z&&(a.fillStyle=m,a.beginPath(),a.arc(C,T,l,0,g,!0),a.fill()),pg(p)?v=p($,D,P,f):p&&(v=$),v){var E=Xd(k,v).height,L=a.shadowBlur;if(L){var A=a.shadowOffsetX,h=a.shadowOffsetY,O=a.shadowColor;a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=o}mc(a,v,k,t,C,T-E-l+2,0,E,ak),L&&(a.shadowOffsetX=A,a.shadowOffsetY=h,a.shadowBlur=L,a.shadowColor=O)}}}}}},A=function(){a=null,f=null,r=null},h=function(L,v){var O=f instanceof un?f.s(he):null;(O===C||null===O)&&(O=x(L,he));var p=x(v,he);return p!==C&&null!==p&&p!==O?!1:x(v,Qr)},u={border:O,image:V,text:L,pieChart:s,columnChart:D,stackedColumnChart:N,percentageColumnChart:M,lineChart:W};return function(q,J,j,g,L,n,c,s,z,V){if(J&&L&&n){var O=a?!1:!0;a=q,f=c,r=s,X=r?r._zoom?r._zoom:1:1,U=z,_=V;var N=L,Q=n;if(In()){var W,y,e;0===a[Pp]?In[0]&&(W=!0):W=!0,a.texureImage2D?In[1]&&(y=!0):y=!0,a.texureImage3D?In[2]&&(e=!0):e=!0,W&&y&&e&&(N=j,Q=g)}if(J.tagName)return pl(b)&&!P[b]||a.drawImage(J,N,Q,L,n),O&&A(),void 0;if(x(J,"visible")===!1)return O&&A(),void 0;U||(U=Bs(J.color,f,r)),V||(_=Bs(J.blendMode,f,r)),pl(b)&&!P[b]&&(L=N,n=Q);var G=lj(J,f,r,L),l=sr(J,f,r,n),Y={x:0,y:0,width:G,height:l,fitSize:x(J,"fitSize")},F=x(J,"clip"),m=x(J,"opacity");if(Y.fitSize){var K=Y.rw=Bs(J.width,f,r)||20;Y.widthScale=G/K;var E=Y.rh=Bs(J.height,f,r)||20;Y.heightScale=l/E}if(a.save(),a.interactiveInfo){var M=a.interactiveInfo.matrix,D=M.clone();M.appendTranslate(N,Q).appendScale(L/G,n/l)}Ii(a,N,Q),(G!==L||l!==n)&&a.scale(L/G,n/l),F&&(pg(F)?F(a,G,l,f,r,J):(a.beginPath(),a.rect(0,0,G,l),a.clip())),m!=o&&(a.globalAlpha*=m),x(J,"comps").forEach(function(n){if(h(J,n)!==!1){if(sg.splice(0,0,n),n.prefix){var m=Mh,H=Bs(n.prefix,f,r);H&&(Mh=Mh+H+".")}if(a.interactiveInfo)var i=a.interactiveInfo.matrix.clone();var G=x(n,"opacity"),B=x(n,"shadow"),Z=x(n,"type"),U=R(n,Y);if(G!=o){var y=a.globalAlpha;a.globalAlpha*=G}if(B){var P=a.shadowOffsetX,q=a.shadowOffsetY,L=a.shadowBlur,V=a.shadowColor,z=x(n,"shadowOffsetX"),O=x(n,"shadowOffsetY"),A=x(n,"shadowBlur"),e=v(n,"shadowColor");a.shadowOffsetX=(z==o?3:z)*X,a.shadowOffsetY=(O==o?3:O)*X,a.shadowBlur=(A==o?6:A)*X,a.shadowColor=e||v(ib)}if("save"===Z)a.save();else if("endClip"===Z||"restore"===Z)a.restore();
else if("clip"===Z)a.save(),_f(a,x(n,"points",$),x(n,"segments",S),!0),a.clip();else if(dp[Z])U=U||{x:0,y:0,width:Y.width,height:Y.height},T(n,Z,U,Y);else if(Z===Dg)T(n,Z,U,Y);else if("SVGPath"===Z)d(n,Z,U);else{U=U||{x:0,y:0,width:Y.width,height:Y.height};var Q=x(n,oq),W=x(n,"scaleX"),j=x(n,"scaleY"),l=t(n),M=p(n,U,U,Q,W,j,l);if(pg(Z))I(n,Z),w.drawCompType(Z,a,U,n,f,r);else if(w.getCompType(Z)){var D=w.getCompType(Z),E=D.func||D;I(n,D),w.drawCompType(E,a,U,n,f,r)}else u[Z]?u[Z](n,U):w.getCompType(Z)===C&&Po.test(Z)&&Zc(Z);M&&k()}B&&(a.shadowOffsetX=P,a.shadowOffsetY=q,a.shadowBlur=L,a.shadowColor=V),G!=o&&(a.globalAlpha=y),a.interactiveInfo&&(a.interactiveInfo.matrix=i),n.prefix&&(Mh=m),sg.splice(0,1)}}),a.interactiveInfo&&(a.interactiveInfo.matrix=D),a.restore(),O&&A()}}}();w.getCurrentComp=function(){return sg[0]},w.getParentComp=function(){return sg[1]},w.getInternal=function(){return{isEnter:sk,isEsc:Ph,isSpace:rp,isLeft:us,isUp:ni,isRight:nq,isDown:Bd,addMethod:Iq,superCall:ek,toPointsArray:we,translateAndScale:ln,appendArray:hh,createWorldMatrix:bn,vec3TransformMat4:Hd,setCanvas:ol,createDiv:tq,createView:jh,createCanvas:ep,createImage:Ei,initContext:vp,layout:pq,fillRect:Ql,Mat:Tr,drawBorder:Tc,isString:pl,setBorder:Qp,getPropertyValue:Uo,setPropertyValue:Kh,drawVerticalLine:_h,draw3DRect:Ie,getPinchDist:si,isSameRect:ys,getPosition:dm,intersectionLineRect:se,getNodeRect:Pe,getEdgeAgentPosition:tm,getImageWidth:lj,getImageHeight:sr,initItemElement:cl,drawPoints:_f,createG2:kb,closePopup:Jb,isH:Fj,createAnim:yo,createNormalMatrix:wj,createNormals:Jd,toFloatArray:hf,glMV:ns,batchShape:Jc,createNodeMatrix:yj,getFaceInfo:vj,transformAppend:Qc,drawFaceInfo:jn,to3dPointsArray:mi,setGLDebugMode:function(R){nj=R},cube:function(){return{vs:ee,is:$m,uv:Zh}},ui:function(){return{DataUI:cn,NodeUI:Vf,EdgeUI:mo,GroupUI:Nm,ShapeUI:yk,GridUI:hk,Data3dUI:Pd,Node3dUI:Gj,Shape3dUI:Rn}},getInternalVersion:function(){return"U2FsdGVkX18vXKnDATCV20jYMrJON9VLnXaqWVQvGkY="},getDragger:function(){return mm},addMSMap:function(P){Iq(js,P)},k:t}},function(A){function B(c,M){c!=o&&(M==o&&Gh!=typeof c?this._54O(c,256):this._54O(c,M))}function r(){return new B(o)}function R(M,Z,H,d,O,t){for(;--t>=0;){var p=Z*this[M++]+H[d]+O;O=y(p/67108864),H[d++]=67108863&p}return O}function S(k,h,U,t,D,f){for(var F=32767&h,L=h>>15;--f>=0;){var o=32767&this[k],n=this[k++]>>15,m=L*o+n*F;o=F*o+((32767&m)<<15)+U[t]+(1073741823&D),D=(o>>>30)+(m>>>15)+L*n+(D>>>30),U[t++]=1073741823&o}return D}function G(m,R,B,N,M,Y){for(var H=16383&R,b=R>>14;--Y>=0;){var l=16383&this[m],J=this[m++]>>14,k=b*l+J*H;l=H*l+((16383&k)<<14)+B[N]+M,M=(l>>28)+(k>>14)+b*J,B[N++]=268435455&l}return M}function f(n){return ym.charAt(n)}function p(R,i){var f=kc[R.charCodeAt(i)];return f==o?-1:f}function k(n){for(var G=this.t-1;G>=0;--G)n[G]=this[G];n.t=this.t,n.s=this.s}function C(V){this.t=1,this.s=0>V?-1:0,V>0?this[0]=V:-1>V?this[0]=V+this.DV:this.t=0}function l(d){var p=r();return p._58O(d),p}function c(O,n){var o,U=this;if(16==n)o=4;else if(8==n)o=3;else if(256==n)o=8;else if(2==n)o=1;else if(32==n)o=5;else{if(4!=n)return U.fromRadix(O,n),void 0;o=2}U.t=0,U.s=0;for(var r=O.length,w=!1,K=0;--r>=0;){var X=8==o?255&O[r]:p(O,r);0>X?"-"==O.charAt(r)&&(w=!0):(w=!1,0==K?U[U.t++]=X:K+o>U.DB?(U[U.t-1]|=(X&(1<<U.DB-K)-1)<<K,U[U.t++]=X>>U.DB-K):U[U.t-1]|=X<<K,K+=o,K>=U.DB&&(K-=U.DB))}8==o&&0!=(128&O[0])&&(U.s=-1,K>0&&(U[U.t-1]|=(1<<U.DB-K)-1<<K)),U._57O(),w&&B.ZERO._78O(U,U)}function e(){for(var w=this,j=w.s&w.DM;w.t>0&&w[w.t-1]==j;)--w.t}function v(k){var Y=this;if(Y.s<0)return"-"+Y._85O()[Rp](k);var C;if(16==k)C=4;else if(8==k)C=3;else if(2==k)C=1;else if(32==k)C=5;else{if(4!=k)return Y.toRadix(k);C=2}var g,t=(1<<C)-1,R=!1,J="",p=Y.t,n=Y.DB-p*Y.DB%C;if(p-->0)for(n<Y.DB&&(g=Y[p]>>n)>0&&(R=!0,J=f(g));p>=0;)C>n?(g=(Y[p]&(1<<n)-1)<<C-n,g|=Y[--p]>>(n+=Y.DB-C)):(g=Y[p]>>(n-=C)&t,0>=n&&(n+=Y.DB,--p)),g>0&&(R=!0),R&&(J+=f(g));return R?J:"0"}function Z(){var Y=r();return B.ZERO._78O(this,Y),Y}function N(){return this.s<0?this._85O():this}function T(w){var g=this,$=g.s-w.s;if(0!=$)return $;var s=g.t;if($=s-w.t,0!=$)return g.s<0?-$:$;for(;--s>=0;)if(0!=($=g[s]-w[s]))return $;return 0}function _(F){var D,p=1;return 0!=(D=F>>>16)&&(F=D,p+=16),0!=(D=F>>8)&&(F=D,p+=8),0!=(D=F>>4)&&(F=D,p+=4),0!=(D=F>>2)&&(F=D,p+=2),0!=(D=F>>1)&&(F=D,p+=1),p}function I(){var D=this;return D.t<=0?0:D.DB*(D.t-1)+_(D[D.t-1]^D.s&D.DM)}function $(c,N){var v;for(v=this.t-1;v>=0;--v)N[v+c]=this[v];for(v=c-1;v>=0;--v)N[v]=0;N.t=this.t+c,N.s=this.s}function q(Y,s){for(var U=Y;U<this.t;++U)s[U-Y]=this[U];s.t=J(this.t-Y,0),s.s=this.s}function j(T,q){var D,h=this,I=T%h.DB,j=h.DB-I,n=(1<<j)-1,N=y(T/h.DB),o=h.s<<I&h.DM;for(D=h.t-1;D>=0;--D)q[D+N+1]=h[D]>>j|o,o=(h[D]&n)<<I;for(D=N-1;D>=0;--D)q[D]=0;q[N]=o,q.t=h.t+N+1,q.s=h.s,q._57O()}function n(Y,R){var Z=this;R.s=Z.s;var F=y(Y/Z.DB);if(F>=Z.t)return R.t=0,void 0;var i=Y%Z.DB,U=Z.DB-i,W=(1<<i)-1;R[0]=Z[F]>>i;for(var V=F+1;V<Z.t;++V)R[V-F-1]|=(Z[V]&W)<<U,R[V-F]=Z[V]>>i;i>0&&(R[Z.t-F-1]|=(Z.s&W)<<U),R.t=Z.t-F,R._57O()}function L(K,b){for(var _=this,t=0,j=0,Q=m(K.t,_.t);Q>t;)j+=_[t]-K[t],b[t++]=j&_.DM,j>>=_.DB;if(K.t<_.t){for(j-=K.s;t<_.t;)j+=_[t],b[t++]=j&_.DM,j>>=_.DB;j+=_.s}else{for(j+=_.s;t<K.t;)j-=K[t],b[t++]=j&_.DM,j>>=_.DB;j-=K.s}b.s=0>j?-1:0,-1>j?b[t++]=_.DV+j:j>0&&(b[t++]=j),b.t=t,b._57O()}function x($,s){var S=this.abs(),q=$.abs(),V=S.t;for(s.t=V+q.t;--V>=0;)s[V]=0;for(V=0;V<q.t;++V)s[V+S.t]=S.am(0,q[V],s,V,0,S.t);s.s=0,s._57O(),this.s!=$.s&&B.ZERO._78O(s,s)}function X(E){for(var C=this.abs(),y=E.t=2*C.t;--y>=0;)E[y]=0;for(y=0;y<C.t-1;++y){var f=C.am(y,C[y],E,2*y,0,1);(E[y+C.t]+=C.am(y+1,2*C[y],E,2*y+1,f,C.t-y-1))>=C.DV&&(E[y+C.t]-=C.DV,E[y+C.t+1]=1)}E.t>0&&(E[E.t-1]+=C.am(y,C[y],E,2*y,0,1)),E.s=0,E._57O()}function P(s,N,i){var V=s.abs(),Y=this;if(!(V.t<=0)){var Z=Y.abs();if(Z.t<V.t)return N!=o&&N._58O(0),i!=o&&Y._77O(i),void 0;i==o&&(i=r());var z=r(),M=Y.s,p=s.s,P=Y.DB-_(V[V.t-1]);P>0?(V._44O(P,z),Z._44O(P,i)):(V._77O(z),Z._77O(i));var k=z.t,H=z[k-1];if(0!=H){var a=H*(1<<Y.F1)+(k>1?z[k-2]>>Y.F2:0),h=Y.FV/a,X=(1<<Y.F1)/a,F=1<<Y.F2,K=i.t,q=K-k,m=N==o?r():N;for(z._59O(q,m),i._52O(m)>=0&&(i[i.t++]=1,i._78O(m,i)),B.ONE._59O(k,m),m._78O(z,z);z.t<k;)z[z.t++]=0;for(;--q>=0;){var L=i[--K]==H?Y.DM:y(i[K]*h+(i[K-1]+F)*X);if((i[K]+=z.am(0,L,i,q,0,k))<L)for(z._59O(q,m),i._78O(m,i);i[K]<--L;)i._78O(m,i)}N!=o&&(i._45O(k,N),M!=p&&B.ZERO._78O(N,N)),i.t=k,i._57O(),P>0&&i._46O(P,i),0>M&&B.ZERO._78O(i,i)}}}function W($){var A=r();return this.abs()._49O($,o,A),this.s<0&&A._52O(B.ZERO)>0&&$._78O(A,A),A}function h(s){this.m=s}function D(d){return d.s<0||d._52O(this.m)>=0?d.mod(this.m):d}function U(r){return r}function O(D){D._49O(this.m,o,D)}function Q(f,p,F){f._47O(p,F),this._74O(F)}function b(p,u){p._48O(u),this._74O(u)}function V(){if(this.t<1)return 0;var c=this[0];if(0==(1&c))return 0;var s=3&c;return s=15&s*(2-(15&c)*s),s=255&s*(2-(255&c)*s),s=65535&s*(2-(65535&(65535&c)*s)),s=s*(2-c*s%this.DV)%this.DV,s>0?this.DV-s:-s}function w(N){var m=this;m.m=N,m.mp=N._50O(),m.mpl=32767&m.mp,m.mph=m.mp>>15,m.um=(1<<N.DB-15)-1,m.mt2=2*N.t}function s(O){var M=r();return O.abs()._59O(this.m.t,M),M._49O(this.m,o,M),O.s<0&&M._52O(B.ZERO)>0&&this.m._78O(M,M),M}function M(D){var V=r();return D._77O(V),this._74O(V),V}function a(k){for(var N=this;k.t<=N.mt2;)k[k.t++]=0;for(var o=0;o<N.m.t;++o){var M=32767&k[o],x=M*N.mpl+((M*N.mph+(k[o]>>15)*N.mpl&N.um)<<15)&k.DM;for(M=o+N.m.t,k[M]+=N.m.am(0,x,k,o,0,N.m.t);k[M]>=k.DV;)k[M]-=k.DV,k[++M]++}k._57O(),k._45O(N.m.t,k),k._52O(N.m)>=0&&k._78O(N.m,k)}function fq(d,M){d._48O(M),this._74O(M)}function be(O,f,E){O._47O(f,E),this._74O(E)}function sq(){return 0==(this.t>0?1&this[0]:this.s)}function Er(o,b){if(o>4294967295||1>o)return B.ONE;var I=r(),n=r(),q=b._73O(this),S=_(o)-1;for(q._77O(I);--S>=0;)if(b._76O(I,n),(o&1<<S)>0)b._75O(n,q,I);else{var v=I;I=n,n=v}return b.revert(I)}function bf(G,F){var q;return q=256>G||F._51O()?new h(F):new w(F),this.exp(G,q)}function Ep(){var q=this;if(q.s<0){if(1==q.t)return q[0]-q.DV;if(0==q.t)return-1}else{if(1==q.t)return q[0];if(0==q.t)return 0}return(q[1]&(1<<32-q.DB)-1)<<q.DB|q[0]}function Am(S,u){return new B(S,u)}function Xc(){var T=this;T.n=o,T.e=0,T.d=o,T.p=o,T.q=o,T.dmp1=o,T.dmq1=o,T._10A=o}function Ao(c){return c._53O(this.e,this.n)}function xe(l){var r,V,D,W="",U=0;for(r=0;r<l.length&&l.charAt(r)!=jr;++r)D=Tf.indexOf(l.charAt(r)),0>D||(0==U?(W+=f(D>>2),V=3&D,U=1):1==U?(W+=f(V<<2|D>>4),V=15&D,U=2):2==U?(W+=f(V),W+=f(D>>2),V=3&D,U=3):(W+=f(V<<2|D>>4),W+=f(15&D),U=0));return 1==U&&(W+=f(V<<2)),W}function gq(j){var i=j.split(""),R=xe(j);return i.forEach(function(k){var n=k.length;n>0&&R&&(Pc+=z(k))}),R}function Ck($,L){var l=Mh._4O.Util._56O($,"ss"),U={},q=0;return U.v=l==L,U.t=1,U.s=0>q?-1:0,sj=U.v,q>0?U[0]=q:-1>q?U[0]=q+U.DV:U.t=0,[l,U]}function Ig(U){var Q=38,A=U.substring(0,Q);if(A&&30==A.indexOf("05000420")){var i=["ss",U.substring(Q)];return i}return[]}function Qg(y,p){p=p.replace(Tl,""),p=p.replace(/[ \n]+/g,"");var r=Am(p,16);if(r._55O()>this.n._55O())return 0;var I=this._37O(r),v=I[Rp](16).replace(/^1f+00/,""),h=Ig(v);if(0==h.length)return!1;for(var E,d,w,s=.5,l=bj,Z=[0,.5,.75,.875,.9375],f=[],t=[],a=[],m=g/l,P=h[1],A=Ck(y,P)[0],_=0,J=0;_<Z.length;_++){var Y=0===_%2?0:.5;for(E=0;l>=E;E++)d=(E+Y)*m,w=1-Z[_],f.push(i(d)*s*w,-s+2*Z[_]*s,-F(d)*s*w),t.push((E+Y)/l,w)}for(_=0;_<Z.length-1;_++){var c=_*(l+1),O=(_+1)*(l+1);for(E=0;l>E;E++)a.push(c+E,O+E+1,O+E,c+E,c+E+1,O+E+1)}return a.forEach(function(K){J+=K}),P==A&&J>10}var Rq,id=0xdeadbeefcafe,xg=15715070==(16777215&id),Rp="toString",om="",Af="nat",ic=function(){};d=A["D"+11182[Rp](Y(2,5))];var ti=B.prototype;wm+=bl.substr(0,1);var Om=A.navigator?A.navigator.appName:"";xg&&"Microsoft Internet Explorer"==Om?(ti.am=S,Rq=30):xg&&"Netscape"!=Om?(ti.am=R,Rq=26):(ti.am=G,Rq=28),ti.DB=Rq,ti.DM=(1<<Rq)-1,ti.DV=1<<Rq;var kj=52;ti.FV=Y(2,kj),ti.F1=kj-Rq,ti.F2=2*Rq-kj;var ok,wj,ym="0123456789abcdefghijklmnopqrstuvwxyz",kc=[],cd=function(I){return String.fromCharCode(I)};for(ok="0".charCodeAt(0),wj=0;9>=wj;++wj)kc[ok++]=wj;for(ok="a".charCodeAt(0),wj=10;36>wj;++wj)kc[ok++]=wj;for(ok="A".charCodeAt(0),wj=10;36>wj;++wj)kc[ok++]=wj;var cm=h.prototype;cm._73O=D,cm.revert=U,cm._74O=O,cm._75O=Q,cm._76O=b;var mq=w.prototype;mq._73O=s,mq.revert=M,mq._74O=a,mq._75O=be,mq._76O=fq,ti._77O=k,ti._58O=C,ti._54O=c,ti._57O=e,ti._59O=$,ti._45O=q,ti._44O=j,ti._46O=n,ti._78O=L,ti._47O=x,ti._48O=X,ti._49O=P,ti._50O=V,ti._51O=sq,ti.exp=Er,ti.toString=v,ti._85O=Z,ti.abs=N,ti._52O=T,ti._55O=I,ti.mod=W,ti._53O=bf,B.ZERO=l(0),B.ONE=l(1),ti._86O=Ep;var rf=function(q,v){var Y=this;Y.isPublic=!0,typeof q!==Gh?(Y.n=q,Y.e=v):q!=o&&v!=o&&q.length>0&&v.length>0&&(Y.n=Am(q,16),Y.e=z(v,16))};Bg=function(){var u,v,q=gq(xc),J=q.substr(0,4),W=q.substr(4,2),R=q.substr(6,2),m=1,I=!m,G=t,T=[],p=uk.charAt(7);if(d&&(d[Rp]().indexOf(Af)<0||d[wm][Rp]().indexOf(Af)<0||!q?u=Ln(wo[p]):(q=new d(J-0,W-m,R-0),v=q.setHours(9),d[wm]()>v?u=Ln(wo[p]):I=!0)),q&&u&&G){for(var n in u)T.push(n);var X,O=0,F=u[T[O++]],b=u[T[O++]],$=u[T[O++]],a=u[T[O++]],w=u[T[O++]],V=u[T[O++]],H=u[T[O++]],y=nk._27O(G);if(y&&H){X=F+b+$+a+w+V;var k=!V||V===rd;if(!k&&V)for(var D,Q=0,C=V.length;C>Q;Q++)V[Q]===El[O]?D===rd?k=!0:D=o:(D==o?D=V[Q]:D+=V[Q],Q===C-1&&D===rd&&(k=!0));X&&y._31O(X,H)&&k&&(!w||d[wm]()<w)&&(I=!0)}}return I||(Ej=dr),p};var Fk=Xc.prototype;Fk._37O=Ao,Fk._38O=rf;var Tf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jr="=",gp=25,zb=10,xc="IBkIAQ==",lk=lk||function(I,W){var j={},_=j._7A={},d=_._6A=function(){function I(){}return{_80O:function(B){I.prototype=this;var g=new I;return B&&g._5A(B),g.hasOwnProperty("_82O")||(g._82O=function(){g.$super._82O.apply(this,arguments)}),g._82O.prototype=g,g.$super=this,g},_3A:function(){var t=this._80O();return t._82O.apply(t,arguments),t},_82O:function(){},_5A:function(V){for(var O in V)V.hasOwnProperty(O)&&(this[O]=V[O]);V.hasOwnProperty(Rp)&&(this.toString=V.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),w=_._39O=d._80O({_82O:function(D,j){D=this._84O=D||[],this._65O=j!=W?j:4*D.length},toString:function(i){return(i||L).stringify(this)},_89O:function(k){var G=this._84O,Q=k._84O,P=this._65O,D=k._65O;if(this._57O(),P%4)for(var E=0;D>E;E++){var b=255&Q[E>>>2]>>>24-8*(E%4);G[P+E>>>2]|=b<<24-8*((P+E)%4)}else if(Q.length>65535)for(var E=0;D>E;E+=4)G[P+E>>>2]=Q[E>>>2];else G.push.apply(G,Q);return this._65O+=D,this},_57O:function(){var i=this._84O,A=this._65O;i[A>>>2]&=4294967295<<32-8*(A%4),i.length=E(A/4)},_88O:function(){var J=d._88O.call(this);return J._84O=this._84O.slice(0),J},_87O:function(J){for(var o=[],b=0;J>b;b+=4)o.push(0|4294967296*H);return new w._82O(o,J)}}),P=j._2A={},L=P._69O={stringify:function(l){var e,P=l._84O,x=l._65O,c=[];for(e=0;x>e;e++){var f=255&P[e>>>2]>>>24-8*(e%4);c.push((f>>>4).toString(16)),c.push((15&f).toString(16))}return c.join("")},_68O:function(d){for(var I=d.length,n=[],q=0;I>q;q+=2)n[q>>>3]|=z(d.substr(q,2),16)<<24-4*(q%8);return new w._82O(n,I/2)}},p=P._8A={stringify:function(L){var p,A=L._84O,q=L._65O,x=[];for(p=0;q>p;p++){var i=255&A[p>>>2]>>>24-8*(p%4);x.push(cd(i))}return x.join("")},_68O:function(f){var G,S=f.length,Y=[];for(G=0;S>G;G++)Y[G>>>2]|=(255&f.charCodeAt(G))<<24-8*(G%4);return new w._82O(Y,S)}},V=P._9A={stringify:function(f){try{return decodeURIComponent(escape(p.stringify(f)))}catch(s){throw new Error("")}},_68O:function(Q){return p._68O(unescape(encodeURIComponent(Q)))}},T=_._32O=d._80O({_1A:function(){this._83O=new w._82O,this._23O=0},_33O:function(e){typeof e==Gh&&(e=V._68O(e)),this._83O._89O(e),this._23O+=e._65O},_25O:function(p){var Q=this._83O,X=Q._84O,Z=Q._65O,z=this._79O,f=4*z,H=Z/f;H=p?E(H):J((0|H)-this._22O,0);var $=H*z,l=m(4*$,Z);if($){for(var N=0;$>N;N+=z)this._20O(X,N);var y=X.splice(0,$);Q._65O-=l}return new w._82O(y,l)},_88O:function(){var W=d._88O.call(this);return W._83O=this._83O._88O(),W},_22O:0});_._66O=T._80O({cfg:d._80O(),_82O:function(T){this.cfg=this.cfg._80O(T),this._1A()},_1A:function(){T._1A.call(this),this._34O()},_81O:function(M){return this._33O(M),this._25O(),this},_72O:function(I){I&&this._33O(I);var d=this._21O();return d},_79O:16,_26O:function(e){return function(W,R){return new e._82O(R)._72O(W)}},_19O:function(F){return function(X,g){return new v._71O._82O(F,g)._72O(X)}}});var v=j._67O={};return j}();!function(){var S=lk,G=S._7A,V=G._39O,B=G._66O,I=S._67O,g=[],f=[];!function(){function E(U){for(var v=u(U),K=2;v>=K;K++)if(!(U%K))return!1;return!0}function D(C){return 0|4294967296*(C-(0|C))}for(var J=2,H=0;64>H;)E(J)&&(8>H&&(g[H]=D(Y(J,.5))),f[H]=D(Y(J,1/3)),H++),J++}();var p=[],t=I._41O=B._80O({_34O:function(){this._64O=new V._82O(g.slice(0))},_20O:function(t,i){for(var m=this._64O._84O,y=m[0],Z=m[1],x=m[2],c=m[3],N=m[4],J=m[5],K=m[6],U=m[7],Y=0;64>Y;Y++){if(16>Y)p[Y]=0|t[i+Y];else{var E=p[Y-15],H=(E<<25|E>>>7)^(E<<14|E>>>18)^E>>>3,n=p[Y-2],h=(n<<15|n>>>17)^(n<<13|n>>>19)^n>>>10;p[Y]=H+p[Y-7]+h+p[Y-16]}var j=N&J^~N&K,S=y&Z^y&x^Z&x,q=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),R=(N<<26|N>>>6)^(N<<21|N>>>11)^(N<<7|N>>>25),$=U+R+j+f[Y]+p[Y],A=q+S;U=K,K=J,J=N,N=0|c+$,c=x,x=Z,Z=y,y=0|$+A}m[0]=0|m[0]+y,m[1]=0|m[1]+Z,m[2]=0|m[2]+x,m[3]=0|m[3]+c,m[4]=0|m[4]+N,m[5]=0|m[5]+J,m[6]=0|m[6]+K,m[7]=0|m[7]+U},_21O:function(){var V=this._83O,g=V._84O,p=8*this._23O,l=8*V._65O;return g[l>>>5]|=128<<24-l%32,g[(l+64>>>9<<4)+14]=y(p/4294967296),g[(l+64>>>9<<4)+15]=p,V._65O=4*g.length,this._25O(),this._64O},_88O:function(){var h=B._88O.call(this);return h._64O=this._64O._88O(),h}});S._41O=B._26O(t),S._42O=B._19O(t)}();var Tl=new RegExp("");Tl.compile("[^0-9a-f]","gi"),Xc._28O=-1,Xc._29O=-2,Fk._31O=Qg,Fk._63O=Qg,Xc._43O=-2;var le=new function(){var q=this;q._5O=function(X,i){if("8"!=X.substring(i+2,i+3))return 1;var $=z(X.substring(i+3,i+4));return 0==$?-1:$>0&&10>$?$+1:-2},q._13O=function(t,l){var r=q._5O(t,l);return 1>r?"":t.substring(l+2,l+2+2*r)},q._12O=function(k,b){var S=q._13O(k,b);if(""==S)return-1;var K;return K=z(S.substring(0,1))<8?new B(S,16):new B(S.substring(2),16),K._86O()},q._6O=function(G,V){var Q=q._5O(G,V);return 0>Q?Q:V+2*(Q+1)},q._11O=function(r,w){var K=q._6O(r,w),F=q._12O(r,w);return r.substring(K,K+2*F)},q._10O=function(u,P){var V=q._6O(u,P),W=q._12O(u,P);return V+2*W},q._7O=function(K,Q){var l=[],X=q._6O(K,Q);l.push(X);for(var p=q._12O(K,Q),j=X,M=0;;){var m=q._10O(K,j);if(m==o||m-X>=2*p)break;if(M>=200)break;l.push(m),j=m,M++}return l}};if(le._90O=cd(zb+24),le._91O=K+cd(zb*zb+8),Mh==o||!Mh)var Mh={};Mh._4O!=o&&Mh._4O||(Mh._4O={});var Vq=Mh._4O;Mh._4O.Util=new function(){var U=this;U._56O=function(f){var L=new Mh._4O._3O;return L._30O(f)},U._4A=function(e){var k=new Mh._4O._3O;return k._36O(e)},U._11A=function(C){var h=new Vq._3O;return h._30O(C)}},Mh._4O._3O=function(){var G=this;G._8O=function(s,I){if("ss"==s&&"cj"==I){try{G.md=lk._67O._41O._3A()}catch(Y){ic(om)}G._24O=function(Q){G.md._81O(Q)},G._35O=function(t){var V=lk._2A._69O._68O(t);G.md._81O(V)},G._60O=function(){var $=G.md._72O();return $[Rp](lk._2A._69O)},G._30O=function(r){return G._24O(r),G._60O()},G._36O=function(W){return G._35O(W),G._60O()}}},G._24O=function(){ic(om)},G._35O=function(){ic(om)},G._60O=function(){ic(om)},G._30O=function(){ic(om)},G._36O=function(){ic(om)},G._8O("ss","cj")},Bo=function(d){var U=Eg[qp[7]],u=1,Q=!1;if(Hp.a!=Eg[So])return Hp.a;if(Hp.forEach(function(T){u*=T}),d>u){if(U){U=U.split(le._90O);var w=U[3],g=U[7],l=U[11],S=U[15],C=U[19],B=U[23],G=U[27],t=w+g+l+S+C+B,a=B?!1:!0;if(B){var K=B&&B.split(Zr("firefox")[3]);if(K)for(var s=0;s<K.length;s++)if(xi.indexOf(K[s])>=0){a=!0;break}}Q=zk()(t,G)&&a&&(!C||C>d)}Q||(cn.prototype._42=ne)}else Q=!0;return Hp.a=Q,Q},gp=String.fromCharCode(gp+20);var gb=function(N){return N=N.replace(Tl,om),N=N.replace(/[ \n]+/g,om)},yd="30",bi="06",yf="02",as="03",Nc=Am,xq=/^1f+00/,nk=function(){var P;return P={_18O:function(n){var Q=n,h=Q.replace(/\s+/g,""),q=xe(h);return q},_14O:function(b){var a=this._18O(b),l=this._15O(a);return l},_15O:function(e){var n=this._17O(e);if("2a864886f70d010101"==n._61O){var _=this._16O(n.key),f=new Xc;return f._38O(_.n,_.e),f}ic(om)},_16O:function(N){var O={};N.substr(0,2)!=yd&&ic(om);var K=le._7O(N,0);return 2!=K.length&&ic(om),N.substr(K[0],2)!=yf&&ic(om),O.n=le._11O(N,K[0]),N.substr(K[1],2)!=yf&&ic(om),O.e=le._11O(N,K[1]),O},_17O:function(Y){var v={};v._40O=o;var G=le._7O(Y,0);2!=G.length&&ic(om);var Q=G[0];Y.substr(Q,2)!=yd&&ic(om);var k=le._7O(Y,Q);return 2!=k.length&&ic(om),Y.substr(k[0],2)!=bi&&ic(om),v._61O=le._11O(Y,k[0]),Y.substr(k[1],2)==bi?v._40O=le._11O(Y,k[1]):Y.substr(k[1],2)==yd&&(v._40O={},v._40O.p=le._70O(Y,k[1],[0],yf),v._40O.q=le._70O(Y,k[1],[1],yf),v._40O.g=le._70O(Y,k[1],[2],yf)),Y.substr(G[1],2)!=as&&ic(om),v.key=le._11O(Y,G[1]).substr(2),v}},P._17O?P:o}(),Yp=nk._27O=function(F){return nk._14O(F)};zk=function(){return function(G,E){if(G&&E){E=gb(E);var m=Nc(E,Y(2,4)),R=this;if(!R||!R.n||m._55O()>R.n._55O())return 0;var s=R._37O(m),_=s[Rp](Y(2,4)).replace(xq,""),w=Ig(_);if(0==w.length)return!1;var c=w[0],O=w[1],l=function(w){return Mh._4O.Util._56O(w,c)},h=l(G);return O==h}}.bind(Yp(t))};var Dn,Sr;return function(){var K=qd.length-Db.length;if(K>0)for(var U=0;K>U;U++)Dn=Vq.Util,Sr=gb}(),Aj=function(I,j){j=Sr(j);var E=Yp(Ad),k=lo.length,J=2*k,O=Nc(j,Y(k,J)),U=E,V=!0;if(U){var T=U[sl[0]];T&&O._55O()<=T._55O()&&(V=!1)}if(V)return 0;var m=U._37O(O),s=m[Rp](Y(k,J)).replace(xq,""),b=Ig(s);if(0==b.length)return!1;var $=b[0],A=b[1],v=Dn._11A(I,$);return A==v},nk}(P,v),Iq(w,{load:function(){var b={},C=function(y){return y?"c_"+(y.sync?"1":"0")+"_"+(y.post?"1":"0")+"_"+(y.responseType||"H")+"_"+(y.mimeType||"H")+"_"+(y.data?JSON.stringify(y.data):"H"):""};return function(Y,r,f){var h,R=b[Y],_=C(f);return R&&(h=R[_])?(h.push(r),void 0):(b[Y]||(R=b[Y]={count:0}),h=R[_]=[r],R.count++,w.xhrLoad(Y,function(r){delete R[_],R.count--,R.count||delete b[Y],h.forEach(function(V){V(r)})},f),void 0)}}(),asyncEach:function($,A,h){"function"!=typeof h&&(h=Function.prototype);var c=new Array($.length),s=0,C=!1;$.forEach(function(_,P){A(_,function(Z,l){return C?void 0:Z?(C=!0,h(null)):(c[P]=l,s++,s===$.length?h(c):void 0)})})},xhrLoad:function(W,H,k){var i=!1;Ef(W)||(i=!0,W=[W]),k=k||{},W.length;var E=k.sync,n=!!k.post,L=null;return w.asyncEach(W,function(B,o){var U=new gm;B=w.beforeLoadURL(B),B.data?o(null,B.data):(k.url=encodeURI(B),k.method=n?"POST":"GET",k.responseType?U.setResponseType(k.responseType):U.setOverrideMimeType(k.mimeType||"text/plain"),U.onload=function(){200===this.status||0===this.status?o(null,U.getResponseText()):o(!0)},U.onerror=function(){o(!0)},U.send(k))},function(Y){var I="function"==typeof H;(I||E)&&(L=i&&Y?Y[0]:Y,I&&H(L))}),E?L:void 0}}),Math.sign===C&&(Math.sign=function(n){return 0>n?-1:n>0?1:+n});var Kn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",io={encode:function(n,d){var u,w,R,t,h,l,x,N="",k=0;for(n=io._utf8_encode(n);k<n.length;)u=n.charCodeAt(k++),w=n.charCodeAt(k++),R=n.charCodeAt(k++),t=u>>2,h=(3&u)<<4|w>>4,l=(15&w)<<2|R>>6,x=63&R,isNaN(w)?l=x=64:isNaN(R)&&(x=64),N=N+d.charAt(t)+d.charAt(h)+d.charAt(l)+d.charAt(x);return N},decode:function(J,n){var F,b,O,U,$,A,P,N="",a=0;for(J=J.replace(/[^A-Za-z0-9\+\/\=]/g,"");a<J.length;)U=n.indexOf(J.charAt(a++)),$=n.indexOf(J.charAt(a++)),A=n.indexOf(J.charAt(a++)),P=n.indexOf(J.charAt(a++)),F=U<<2|$>>4,b=(15&$)<<4|A>>2,O=(3&A)<<6|P,N+=String.fromCharCode(F),64!=A&&(N+=String.fromCharCode(b)),64!=P&&(N+=String.fromCharCode(O));return N=io._utf8_decode(N)},_utf8_encode:function(y){y=y.replace(/\r\n/g,"\n");for(var J="",H=0;H<y.length;H++){var T=y.charCodeAt(H);128>T?J+=String.fromCharCode(T):T>127&&2048>T?(J+=String.fromCharCode(192|T>>6),J+=String.fromCharCode(128|63&T)):(J+=String.fromCharCode(224|T>>12),J+=String.fromCharCode(128|63&T>>6),J+=String.fromCharCode(128|63&T))}return J},_utf8_decode:function(T){for(var p="",o=0,r=0,i=0,s=0;o<T.length;)r=T.charCodeAt(o),128>r?(p+=String.fromCharCode(r),o++):r>191&&224>r?(i=T.charCodeAt(o+1),p+=String.fromCharCode((31&r)<<6|63&i),o+=2):(i=T.charCodeAt(o+1),s=T.charCodeAt(o+2),p+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&s),o+=3);return p}};M.Math={generateUUID:function(){for(var A=[],M=0;256>M;M++)A[M]=(16>M?"0":"")+M.toString(16).toUpperCase();return function(){var K=0|4294967295*Math.random(),x=0|4294967295*Math.random(),X=0|4294967295*Math.random(),Q=0|4294967295*Math.random();return A[255&K]+A[255&K>>8]+A[255&K>>16]+A[255&K>>24]+"-"+A[255&x]+A[255&x>>8]+"-"+A[64|15&x>>16]+A[255&x>>24]+"-"+A[128|63&X]+A[255&X>>8]+"-"+A[255&X>>16]+A[255&X>>24]+A[255&Q]+A[255&Q>>8]+A[255&Q>>16]+A[255&Q>>24]}}(),clamp:function(Z,K,X){return Math.max(K,Math.min(X,Z))},generateIncreasingID:function(){var Y=0;return function(){return++Y}}(),encodeBase64:function(p,o){return io.encode(p,o||Kn)},decodeBase64:function(_,K){return io.decode(_,K||Kn)},randomArray:function(F,w){w=w||F.length;for(var B=w-1;B>0;B--){var W=Math.floor(Math.random()*(B+1)),Y=F[B];F[B]=F[W],F[W]=Y}return F}};var xc=M.Matrix=M.Math.Matrix2d=function(l,q,Y,H,T){this.setFromTransform(l,q,Y,H,T)},Tr=xc;xc.prototype={},xc.prototype.constructor=xc,xc.prototype.set=function(Q,o,A,a,G,h){return this.a=Q,this.b=o,this.c=A,this.d=a,this.tx=G,this.ty=h,this},xc.prototype.setFromTransform=function(j,$,Z,v,u){var s=this;if(j===C)return s.a=1,s.b=0,s.c=0,s.d=1,s.tx=0,s.ty=0,void 0;j=j||0;var O=F(j),o=i(j);return v=v||1,u=u||1,s.a=o*v,s.b=O*v,s.c=-O*u,s.d=o*u,s.tx=$||0,s.ty=Z||0,s},xc.prototype.apply=function(k,h){h=h||new Ym;var O=k.x,R=k.y;return h.x=this.a*O+this.c*R+this.tx,h.y=this.b*O+this.d*R+this.ty,h},xc.prototype.applyInverse=function(g,f){f=f||new Ym;var K=1/(this.a*this.d+this.c*-this.b),z=g.x,S=g.y;return f.x=this.d*K*z+-this.c*K*S+(this.ty*this.c-this.tx*this.d)*K,f.y=this.a*K*S+-this.b*K*z+(-this.ty*this.a+this.tx*this.b)*K,f},xc.prototype.translate=function(K,b){return this.tx+=K,this.ty+=b,this},xc.prototype.scale=function(y,l){return this.a*=y,this.d*=l,this.c*=y,this.b*=l,this.tx*=y,this.ty*=l,this},xc.prototype.rotate=function(d){var O=Math.cos(d),H=Math.sin(d),y=this.a,z=this.c,c=this.tx;return this.a=y*O-this.b*H,this.b=y*H+this.b*O,this.c=z*O-this.d*H,this.d=z*H+this.d*O,this.tx=c*O-this.ty*H,this.ty=c*H+this.ty*O,this},xc.prototype.appendTranslate=function(Z,J){return this.tx+=this.a*Z+this.c*J,this.ty+=this.b*Z+this.d*J,this},xc.prototype.appendScale=function(H,F){return this.a*=H,this.d*=F,this.c*=F,this.b*=H,this},xc.prototype.appendRotate=function(v){if(!v)return this;var o=Math.cos(v),J=Math.sin(v),t=this.a,u=this.b;return this.a=t*o+this.c*J,this.b=u*o+this.d*J,this.c=-t*J+this.c*o,this.d=-u*J+this.d*o,this},xc.prototype.append=function(S){var g=this.a,s=this.b,p=this.c,X=this.d;return this.a=S.a*g+S.b*p,this.b=S.a*s+S.b*X,this.c=S.c*g+S.d*p,this.d=S.c*s+S.d*X,this.tx=S.tx*g+S.ty*p+this.tx,this.ty=S.tx*s+S.ty*X+this.ty,this},xc.prototype.setTransform=function(Y,z,k,m,T,a,o,C,L){var O,x,V,v,h,Q,F,i,H,c;return h=Math.sin(o),Q=Math.cos(o),F=Math.cos(L),i=Math.sin(L),H=-Math.sin(C),c=Math.cos(C),O=Q*T,x=h*T,V=-h*a,v=Q*a,this.a=F*O+i*V,this.b=F*x+i*v,this.c=H*O+c*V,this.d=H*x+c*v,this.tx=Y+(k*O+m*V),this.ty=z+(k*x+m*v),this},xc.prototype.prepend=function(W){var J=this.tx;if(1!==W.a||0!==W.b||0!==W.c||1!==W.d){var c=this.a,o=this.c;this.a=c*W.a+this.b*W.c,this.b=c*W.b+this.b*W.d,this.c=o*W.a+this.d*W.c,this.d=o*W.b+this.d*W.d}return this.tx=J*W.a+this.ty*W.c+W.tx,this.ty=J*W.b+this.ty*W.d+W.ty,this},xc.prototype.transform=xc.prototype.prepend,xc.prototype.invert=function(){var g=this.a,u=this.b,b=this.c,k=this.d,_=this.tx,d=g*k-u*b;return this.a=k/d,this.b=-u/d,this.c=-b/d,this.d=g/d,this.tx=(b*this.ty-k*_)/d,this.ty=-(g*this.ty-u*_)/d,this},xc.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},xc.prototype.clone=function(){var K=new xc;return K.a=this.a,K.b=this.b,K.c=this.c,K.d=this.d,K.tx=this.tx,K.ty=this.ty,K},xc.prototype.copy=function(C){return C.a=this.a,C.b=this.b,C.c=this.c,C.d=this.d,C.tx=this.tx,C.ty=this.ty,C},xc.prototype.tf=function(j,q){1===arguments.length&&(q=j.y,j=j.x);var I=this;return{x:I.a*j+I.c*q+I.tx,y:I.b*j+I.d*q+I.ty}},xc.prototype.tfi=function(i,Z){1===arguments.length&&(Z=i.y,i=i.x);var N=this,K=1/(N.a*N.d+N.c*-N.b);return{x:N.d*K*i+-N.c*K*Z+(N.ty*N.c-N.tx*N.d)*K,y:N.a*K*Z+-N.b*K*i+(-N.ty*N.a+N.tx*N.b)*K}},xc.IDENTITY=new xc,xc.TEMP_MATRIX=new xc;var Tl=M.Math.Vector3=function(s,N,_){"object"==typeof s?this.copy(s):this.set(s,N==C?s:N,_==C?s:_)};v.assign(Tl.prototype,{set:function(t,X,A){return this.x=t,this.y=X,this.z=A,this},setScalar:function(Q){return this.x=Q,this.y=Q,this.z=Q,this},setX:function(Y){return this.x=Y,this},setY:function(A){return this.y=A,this},setZ:function(w){return this.z=w,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(I){return I.x===C?(this.x=I[0],this.y=I[1],this.z=I[2]):(this.x=I.x,this.y=I.y,this.z=I.z),this},add:function(c){return this.x+=c.x,this.y+=c.y,this.z+=c.z,this},addScalar:function(o){return this.x+=o,this.y+=o,this.z+=o,this},addVectors:function(p,j){return this.x=p.x+j.x,this.y=p.y+j.y,this.z=p.z+j.z,this},addScaledVector:function(J,P){return this.x+=J.x*P,this.y+=J.y*P,this.z+=J.z*P,this},sub:function(W){return this.x-=W.x,this.y-=W.y,this.z-=W.z,this},subScalar:function(g){return this.x-=g,this.y-=g,this.z-=g,this},subVectors:function(K,i){return this.x=K.x-i.x,this.y=K.y-i.y,this.z=K.z-i.z,this},multiply:function(U){return this.x*=U.x,this.y*=U.y,this.z*=U.z,this},multiplyScalar:function(T){return this.x*=T,this.y*=T,this.z*=T,this},distanceTo:function(j){return Math.sqrt(this.distanceToSquared(j))},distanceToSquared:function(F){var y=this.x-F.x,g=this.y-F.y,j=this.z-F.z;return y*y+g*g+j*j},distanceToSquared2:function(u){var g=this.x-u[0],E=this.y-u[1],F=this.z-u[2];return g*g+E*E+F*F},multiplyVectors:function(r,z){return this.x=r.x*z.x,this.y=r.y*z.y,this.z=r.z*z.z,this},transformDirection:function(r){var e=this.x,A=this.y,c=this.z,m=r.el;return this.x=m[0]*e+m[4]*A+m[8]*c,this.y=m[1]*e+m[5]*A+m[9]*c,this.z=m[2]*e+m[6]*A+m[10]*c,this.normalize()},applyQuaternion:function(k){var m=this.x,O=this.y,Q=this.z,I=k._x,U=k._y,g=k._z,C=k._w,w=C*m+U*Q-g*O,B=C*O+g*m-I*Q,q=C*Q+I*O-U*m,K=-I*m-U*O-g*Q;return this.x=w*C+K*-I+B*-g-q*-U,this.y=B*C+K*-U+q*-I-w*-g,this.z=q*C+K*-g+w*-U-B*-I,this},applyMatrix4:function(i){var W=this.x,B=this.y,O=this.z,h=i.el,X=1/(h[3]*W+h[7]*B+h[11]*O+h[15]);return this.x=(h[0]*W+h[4]*B+h[8]*O+h[12])*X,this.y=(h[1]*W+h[5]*B+h[9]*O+h[13])*X,this.z=(h[2]*W+h[6]*B+h[10]*O+h[14])*X,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(H){return this.x*H.x+this.y*H.y+this.z*H.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var w=this.length();return w?this.multiplyScalar(1/w):this},setLength:function(g){return this.normalize().multiplyScalar(g)},fromArray:function(u,j){return j===C&&(j=0),this.x=u[j],this.y=u[j+1],this.z=u[j+2],this},toArray:function(O,r){return O===C&&(O=[0,0,0]),r===C&&(r=0),O[r]=this.x,O[r+1]=this.y,O[r+2]=this.z,O},cross:function(S){return this.crossVectors(this,S)},angleTo:function(O){var C=this.dot(O)/Math.sqrt(this.lengthSq()*O.lengthSq());return C>1||-1>C?0:Math.acos(C)},lerpVectors:function(A,S,K){return this.subVectors(S,A).multiplyScalar(K).add(A)},crossVectors:function(X,n){var U=X.x,G=X.y,i=X.z,P=n.x,z=n.y,y=n.z;return this.x=G*y-i*z,this.y=i*P-U*y,this.z=U*z-G*P,this},min:function(V){return this.x=Math.min(this.x,V.x),this.y=Math.min(this.y,V.y),this.z=Math.min(this.z,V.z),this},max:function(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this.z=Math.max(this.z,_.z),this}});var Ym=M.Math.Vector2=function(o,T,$){"object"==typeof o&&(o.x!=C?(T=o.y,o=o.x,$=o.e):($=o[2],T=o[1],o=o[0])),this.set(o||0,T||0,$)};Ym.prototype={},Ym.prototype.constructor=Ym,v.defineProperties(Ym.prototype,{width:{get:function(){return this.x},set:function(l){this.x=l}},height:{get:function(){return this.y},set:function(q){this.y=q}}}),Ym.prototype.clone=function(){return new Ym(this.x,this.y,this.e)},Ym.prototype.copy=function(t){return this.set(t.x,t.y,t.e),this},Ym.prototype.equals=function(v){return v.x===this.x&&v.y===this.y},Ym.prototype.set=function(G,x,$){return this.x=G||0,this.y=x||(0!==x?this.x:0),$!=C&&(this.e=$),this},Ym.prototype.setScalar=function(p){return this.x=p,this.y=p,this},Ym.prototype.setX=function(Z){return this.x=Z||0,this},Ym.prototype.setY=function(L){return this.y=L||0,this},Ym.prototype.add=function(B){return this.x+=B.x,this.y+=B.y,this},Ym.prototype.addVectors=function(K,A){return this.x=K.x+A.x,this.y=K.y+A.y,this},Ym.prototype.addScalar=function(E){return this.x+=E,this.y+=E,this},Ym.prototype.addScaledVector=function(K,t){return this.x+=K.x*t,this.y+=K.y*t,this},Ym.prototype.sub=function(g){return this.x-=g.x,this.y-=g.y,this},Ym.prototype.subScalar=function(V){return this.x-=V,this.y-=V,this},Ym.prototype.subVectors=function(Q,a){return this.x=Q.x-a.x,this.y=Q.y-a.y,this},Ym.prototype.multiply=function(P){return this.x*=P.x,this.y*=P.y,this},Ym.prototype.multiplyScalar=function(R){return this.x*=R,this.y*=R,this},Ym.prototype.divide=function(D){return this.x/=D.x,this.y/=D.y,this},Ym.prototype.divideScalar=function(y){return this.multiplyScalar(1/y)},Ym.prototype.min=function(P){return this.x=Math.min(this.x,P.x),this.y=Math.min(this.y,P.y),this},Ym.prototype.max=function(P){return this.x=Math.max(this.x,P.x),this.y=Math.max(this.y,P.y),this},Ym.prototype.fromArray=function(m,s){return s===C&&(s=0),this.x=m[s],this.y=m[s+1],this},Ym.prototype.clamp=function(O,A){return this.x=Math.max(O.x,Math.min(A.x,this.x)),this.y=Math.max(O.y,Math.min(A.y,this.y)),this},Ym.prototype.clampScalar=function(){var d,P;return function(y,F){return d===C&&(d=new Ym,P=new Ym),d.set(y,y),P.set(F,F),this.clamp(d,P)}}(),Ym.prototype.clampLength=function(o,B){var d=this.length();
return this.multiplyScalar(Math.max(o,Math.min(B,d))/d)},Ym.prototype.dot=function(X){return this.x*X.x+this.y*X.y},Ym.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Ym.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Ym.prototype.normalize=function(){return this.divideScalar(this.length())},Ym.prototype.angle=function(){var g=Math.atan2(this.y,this.x);return 0>g&&(g+=2*Math.PI),g},Ym.prototype.distanceTo=function(v){return Math.sqrt(this.distanceToSquared(v))},Ym.prototype.distanceToSquared=function(j){var L=this.x-j.x,w=this.y-j.y;return L*L+w*w},Ym.prototype.isNearEnough=function(X){return this.distanceToSquared(X)<1e-8},Ym.prototype.setLength=function(B){var o=this.length();return o?this.multiplyScalar(B/o):this},Ym.prototype.lerp=function(G,t){return this.x+=(G.x-this.x)*t,this.y+=(G.y-this.y)*t,this},Ym.prototype.lerpVectors=function(L,x,d){return this.subVectors(x,L).multiplyScalar(d).add(L)},Ym.prototype.rotateAround=function(X,l){var O=X?X.x:0,V=X?X.y:0,T=Math.cos(l),I=Math.sin(l),C=this.x-O,s=this.y-V;return this.x=C*T-s*I+O,this.y=C*I+s*T+V,this};var Tk=M.Math.Ray=function(o,Y){this.origin=o!==C?o.clone():new Tl,this.direction=Y!==C?Y.clone():new Tl};v.assign(Tk.prototype,{set:function(T,i){return this.origin.copy(T),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(h){return this.origin.copy(h.origin),this.direction.copy(h.direction),this.maxHitLen=h.maxHitLen,this},at:function(x,_){var v=_||new Tl;return v.copy(this.direction).multiplyScalar(x).add(this.origin)},setMaxHitLength:function(b){this.maxHitLen=b},lookAt:function(N){return this.direction.copy(N).sub(this.origin).normalize(),this},applyMatrix4:function(l){var W=this.maxHitLen;if(W){var F=this.direction.clone().multiplyScalar(W).add(this.origin);F.applyMatrix4(l)}return this.origin.applyMatrix4(l),this.direction.transformDirection(l),W&&(this.maxHitLen=this.origin.distanceTo(F)),this},intersectBox:function(u,n){var V,A,J,a,t,Y,N=1/this.direction.x,w=1/this.direction.y,P=1/this.direction.z,W=this.origin;if(N>=0?(V=(u.min.x-W.x)*N,A=(u.max.x-W.x)*N):(V=(u.max.x-W.x)*N,A=(u.min.x-W.x)*N),w>=0?(J=(u.min.y-W.y)*w,a=(u.max.y-W.y)*w):(J=(u.max.y-W.y)*w,a=(u.min.y-W.y)*w),V>a||J>A)return null;if((J>V||V!==V)&&(V=J),(A>a||A!==A)&&(A=a),P>=0?(t=(u.min.z-W.z)*P,Y=(u.max.z-W.z)*P):(t=(u.max.z-W.z)*P,Y=(u.min.z-W.z)*P),V>Y||t>A)return null;if((t>V||V!==V)&&(V=t),(A>Y||A!==A)&&(A=Y),0>A)return null;var g=V>=0?V:A,X=this.maxHitLen;return X&&g>X?null:this.at(g,n)},intersectTriangle:function(){var j=new Tl,z=new Tl,R=new Tl,c=new Tl;return function(s,S,b,K,p){z.subVectors(S,s),R.subVectors(b,s),c.crossVectors(z,R);var T,V=this.direction.dot(c);if(V>0){if(K)return null;T=1}else{if(!(0>V))return null;T=-1,V=-V}j.subVectors(this.origin,s);var d=T*this.direction.dot(R.crossVectors(j,R));if(0>d)return null;var w=T*this.direction.dot(z.cross(j));if(0>w||d+w>V)return null;var e=-T*j.dot(c);if(0>e)return null;var v=e/V,F=this.maxHitLen;return F&&v>F?null:this.at(v,p)}}()});var oo=M.Math.Box3=function(I,g){this.min=I!==C?I:new Tl(1/0,1/0,1/0),this.max=g!==C?g:new Tl(-1/0,-1/0,-1/0)};v.assign(oo.prototype,{set:function(K,R){return this.min.copy(K),this.max.copy(R),this},setFromArray:function(A){for(var n=1/0,Q=1/0,T=1/0,a=-1/0,K=-1/0,g=-1/0,B=0,P=A.length;P>B;B+=3){var y=A[B],C=A[B+1],d=A[B+2];n>y&&(n=y),Q>C&&(Q=C),T>d&&(T=d),y>a&&(a=y),C>K&&(K=C),d>g&&(g=d)}return this.min.set(n,Q,T),this.max.set(a,K,g),this},setFromPoints:function(b){this.makeEmpty();for(var k=0,Y=b.length;Y>k;k++)this.expandByPoint(b[k]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(A){return this.min.copy(A.min),this.max.copy(A.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(B){return this.min.min(B),this.max.max(B),this}});var yi=M.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};v.assign(yi.prototype,{set:function(O,A,J,c,x,m,S,y,o,j,h,I,$,H,P,L){var e=this.el;return e[0]=O,e[4]=A,e[8]=J,e[12]=c,e[1]=x,e[5]=m,e[9]=S,e[13]=y,e[2]=o,e[6]=j,e[10]=h,e[14]=I,e[3]=$,e[7]=H,e[11]=P,e[15]=L,this},clone:function(){return(new yi).fromArray(this.el)},fromArray:function(B,e){e===C&&(e=0);for(var t=this.el,D=0;16>D;D++)t[D]=B[D+e];return this},scale:function(_){var k=this.el,V=_.x,M=_.y,z=_.z;return k[0]*=V,k[4]*=M,k[8]*=z,k[1]*=V,k[5]*=M,k[9]*=z,k[2]*=V,k[6]*=M,k[10]*=z,k[3]*=V,k[7]*=M,k[11]*=z,this},makeRotationFromEuler:function(H){var B=this.el,m=H._x,M=H._y,O=H._z,s=H._order,G=Math.cos(m),R=Math.sin(m),X=Math.cos(M),E=Math.sin(M),y=Math.cos(O),L=Math.sin(O);if("XYZ"===s){var p=G*y,A=G*L,K=R*y,q=R*L;B[0]=X*y,B[4]=-X*L,B[8]=E,B[1]=A+K*E,B[5]=p-q*E,B[9]=-R*X,B[2]=q-p*E,B[6]=K+A*E,B[10]=G*X}else if("YXZ"===s){var u=X*y,W=X*L,F=E*y,z=E*L;B[0]=u+z*R,B[4]=F*R-W,B[8]=G*E,B[1]=G*L,B[5]=G*y,B[9]=-R,B[2]=W*R-F,B[6]=z+u*R,B[10]=G*X}else if("ZXY"===s){var u=X*y,W=X*L,F=E*y,z=E*L;B[0]=u-z*R,B[4]=-G*L,B[8]=F+W*R,B[1]=W+F*R,B[5]=G*y,B[9]=z-u*R,B[2]=-G*E,B[6]=R,B[10]=G*X}else if("ZYX"===s){var p=G*y,A=G*L,K=R*y,q=R*L;B[0]=X*y,B[4]=K*E-A,B[8]=p*E+q,B[1]=X*L,B[5]=q*E+p,B[9]=A*E-K,B[2]=-E,B[6]=R*X,B[10]=G*X}else if("YZX"===s){var N=G*X,a=G*E,i=R*X,j=R*E;B[0]=X*y,B[4]=j-N*L,B[8]=i*L+a,B[1]=L,B[5]=G*y,B[9]=-R*y,B[2]=-E*y,B[6]=a*L+i,B[10]=N-j*L}else if("XZY"===s){var N=G*X,a=G*E,i=R*X,j=R*E;B[0]=X*y,B[4]=-L,B[8]=E*y,B[1]=N*L+j,B[5]=G*y,B[9]=a*L-i,B[2]=i*L-a,B[6]=R*y,B[10]=j*L+N}return B[3]=0,B[7]=0,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,this},makeRotationFromQuaternion:function(b){var O=this.el,n=b._x,d=b._y,g=b._z,L=b._w,N=n+n,u=d+d,o=g+g,k=n*N,p=n*u,j=n*o,r=d*u,C=d*o,T=g*o,Q=L*N,t=L*u,Y=L*o;return O[0]=1-(r+T),O[4]=p-Y,O[8]=j+t,O[1]=p+Y,O[5]=1-(k+T),O[9]=C-Q,O[2]=j-t,O[6]=C+Q,O[10]=1-(k+r),O[3]=0,O[7]=0,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(K){var E=this.el,D=K.el,S=D[0],A=D[1],I=D[2],o=D[3],v=D[4],y=D[5],h=D[6],R=D[7],b=D[8],n=D[9],F=D[10],J=D[11],d=D[12],Y=D[13],H=D[14],T=D[15],c=n*H*R-Y*F*R+Y*h*J-y*H*J-n*h*T+y*F*T,q=d*F*R-b*H*R-d*h*J+v*H*J+b*h*T-v*F*T,G=b*Y*R-d*n*R+d*y*J-v*Y*J-b*y*T+v*n*T,O=d*n*h-b*Y*h-d*y*F+v*Y*F+b*y*H-v*n*H,t=S*c+A*q+I*G+o*O;if(0===t)return this.identity();var f=1/t;return E[0]=c*f,E[1]=(Y*F*o-n*H*o-Y*I*J+A*H*J+n*I*T-A*F*T)*f,E[2]=(y*H*o-Y*h*o+Y*I*R-A*H*R-y*I*T+A*h*T)*f,E[3]=(n*h*o-y*F*o-n*I*R+A*F*R+y*I*J-A*h*J)*f,E[4]=q*f,E[5]=(b*H*o-d*F*o+d*I*J-S*H*J-b*I*T+S*F*T)*f,E[6]=(d*h*o-v*H*o-d*I*R+S*H*R+v*I*T-S*h*T)*f,E[7]=(v*F*o-b*h*o+b*I*R-S*F*R-v*I*J+S*h*J)*f,E[8]=G*f,E[9]=(d*n*o-b*Y*o-d*A*J+S*Y*J+b*A*T-S*n*T)*f,E[10]=(v*Y*o-d*y*o+d*A*R-S*Y*R-v*A*T+S*y*T)*f,E[11]=(b*y*o-v*n*o-b*A*R+S*n*R+v*A*J-S*y*J)*f,E[12]=O*f,E[13]=(b*Y*I-d*n*I+d*A*F-S*Y*F-b*A*H+S*n*H)*f,E[14]=(d*y*I-v*Y*I-d*A*h+S*Y*h+v*A*H-S*y*H)*f,E[15]=(v*n*I-b*y*I+b*A*h-S*n*h-v*A*F+S*y*F)*f,this},makeRotationAxis:function(d,M){var N=Math.cos(M),s=Math.sin(M),z=1-N,r=d.x,p=d.y,$=d.z,h=z*r,u=z*p;return this.set(h*r+N,h*p-s*$,h*$+s*p,0,h*p+s*$,u*p+N,u*$-s*r,0,h*$-s*p,u*$+s*r,z*$*$+N,0,0,0,0,1),this},multiply:function(r){return this.multiplyMatrices(this,r)},premultiply:function(d){return this.multiplyMatrices(d,this)},multiplyMatrices:function(S,v){var h=S.el,b=v.el,w=this.el,P=h[0],H=h[4],Z=h[8],I=h[12],E=h[1],C=h[5],R=h[9],F=h[13],L=h[2],m=h[6],U=h[10],z=h[14],n=h[3],r=h[7],G=h[11],M=h[15],j=b[0],q=b[4],o=b[8],D=b[12],_=b[1],W=b[5],V=b[9],y=b[13],Y=b[2],K=b[6],T=b[10],c=b[14],N=b[3],f=b[7],e=b[11],l=b[15];return w[0]=P*j+H*_+Z*Y+I*N,w[4]=P*q+H*W+Z*K+I*f,w[8]=P*o+H*V+Z*T+I*e,w[12]=P*D+H*y+Z*c+I*l,w[1]=E*j+C*_+R*Y+F*N,w[5]=E*q+C*W+R*K+F*f,w[9]=E*o+C*V+R*T+F*e,w[13]=E*D+C*y+R*c+F*l,w[2]=L*j+m*_+U*Y+z*N,w[6]=L*q+m*W+U*K+z*f,w[10]=L*o+m*V+U*T+z*e,w[14]=L*D+m*y+U*c+z*l,w[3]=n*j+r*_+G*Y+M*N,w[7]=n*q+r*W+G*K+M*f,w[11]=n*o+r*V+G*T+M*e,w[15]=n*D+r*y+G*c+M*l,this},lookAt:function(){var h=new Tl,F=new Tl,u=new Tl;return function(v,D,j){var N=this.el;return u.subVectors(v,D),0===u.lengthSq()&&(u.z=1),u.normalize(),h.crossVectors(j,u),0===h.lengthSq()&&(1===Math.abs(j.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),h.crossVectors(j,u)),h.normalize(),F.crossVectors(u,h),N[0]=h.x,N[4]=F.x,N[8]=u.x,N[1]=h.y,N[5]=F.y,N[9]=u.y,N[2]=h.z,N[6]=F.z,N[10]=u.z,this}}()});var gj=M.Math.Quaternion=function(r,i,g,p){this.set(r,i,g,p)};v.assign(gj.prototype,{set:function(l,Z,y,Q){var J=this;return J._x=l||0,J._y=Z||0,J._z=y||0,J._w=Q!==C?Q:1,J},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(G){var s=this;return s._x=G._x,s._y=G._y,s._z=G._z,s._w=G._w,s},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var p=this.length();return 0===p?(this._x=0,this._y=0,this._z=0,this._w=1):(p=1/p,this._x=this._x*p,this._y=this._y*p,this._z=this._z*p,this._w=this._w*p),this},fromArray:function(J,w){w===C&&(w=0);var R=this;return R._x=J[w],R._y=J[w+1],R._z=J[w+2],R._w=J[w+3],this},slerp:function(d,i){if(0===i)return this;if(1===i)return this.copy(d);var N=this._x,Y=this._y,R=this._z,G=this._w,f=G*d._w+N*d._x+Y*d._y+R*d._z;if(0>f?(this._w=-d._w,this._x=-d._x,this._y=-d._y,this._z=-d._z,f=-f):this.copy(d),f>=1)return this._w=G,this._x=N,this._y=Y,this._z=R,this;var J=Math.sqrt(1-f*f);if(Math.abs(J)<.001)return this._w=.5*(G+this._w),this._x=.5*(N+this._x),this._y=.5*(Y+this._y),this._z=.5*(R+this._z),this;var o=Math.atan2(J,f),z=Math.sin((1-i)*o)/J,X=Math.sin(i*o)/J;return this._w=G*z+this._w*X,this._x=N*z+this._x*X,this._y=Y*z+this._y*X,this._z=R*z+this._z*X,this},setFromAxisAngle:function(b,h){var Y=h/2,C=Math.sin(Y);return this._x=b.x*C,this._y=b.y*C,this._z=b.z*C,this._w=Math.cos(Y),this},setFromEuler:function(u){var r=u._x,b=u._y,Q=u._z,v=u._order,C=Math.cos,Z=Math.sin,B=C(r/2),d=C(b/2),w=C(Q/2),D=Z(r/2),K=Z(b/2),$=Z(Q/2);return"XYZ"===v?(this._x=D*d*w+B*K*$,this._y=B*K*w-D*d*$,this._z=B*d*$+D*K*w,this._w=B*d*w-D*K*$):"YXZ"===v?(this._x=D*d*w+B*K*$,this._y=B*K*w-D*d*$,this._z=B*d*$-D*K*w,this._w=B*d*w+D*K*$):"ZXY"===v?(this._x=D*d*w-B*K*$,this._y=B*K*w+D*d*$,this._z=B*d*$+D*K*w,this._w=B*d*w-D*K*$):"ZYX"===v?(this._x=D*d*w-B*K*$,this._y=B*K*w+D*d*$,this._z=B*d*$-D*K*w,this._w=B*d*w+D*K*$):"YZX"===v?(this._x=D*d*w+B*K*$,this._y=B*K*w+D*d*$,this._z=B*d*$-D*K*w,this._w=B*d*w-D*K*$):"XZY"===v&&(this._x=D*d*w-B*K*$,this._y=B*K*w-D*d*$,this._z=B*d*$+D*K*w,this._w=B*d*w+D*K*$),this},setFromToVectors:function(){var s,R;return function(f,V){return s===C&&(s=new Tl),R=f.dot(V)+1,1e-7>R?(R=0,Math.abs(f.x)>Math.abs(f.z)?s.set(-f.y,f.x,0):s.set(0,-f.z,f.y)):s.crossVectors(f,V),this._x=s.x,this._y=s.y,this._z=s.z,this._w=R,this.normalize()}}()});var xg=M.Math.Triangle=function(A,Z,V){this.a=A!==C?A:new Tl,this.b=Z!==C?Z:new Tl,this.c=V!==C?V:new Tl};v.assign(xg,{barycoordFromPoint:function(){var $=new Tl,K=new Tl,E=new Tl;return function(T,y,r,b,j){$.subVectors(b,y),K.subVectors(r,y),E.subVectors(T,y);var M=$.dot($),p=$.dot(K),R=$.dot(E),v=K.dot(K),I=K.dot(E),q=M*v-p*p,Z=j||new Tl;if(0===q)return Z.set(-2,-1,-1);var F=1/q,o=(v*R-p*I)*F,L=(M*I-p*R)*F;return Z.set(1-o-L,L,o)}}()});var $o=M.Math.Euler=function(h,Q,r,o,D){this.set(h,Q,r,o,D)};$o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],$o.DefaultOrder="XYZ",$o.ReverseOrder=function(B){return B=B[2]+B[1]+B[0],B.toUpperCase()},v.defineProperties($o.prototype,{x:{get:function(){return this._x},set:function(T){this._x=T,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(o){this._y=o,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(c){this._z=c,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(U){this._order=U,this.onChangeCallback()}}}),v.assign($o.prototype,{set:function(l,g,S,w,R){return Ef(l)&&(R=S,w=g,S=l[2],g=l[1],l=l[0]),w?R&&(w=$o.ReverseOrder(w)):w="ZYX",this._x=l||0,this._y=g||0,this._z=S||0,this._order=w||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function($,g,S){var D=M.Math.clamp,m=$.el||$,b=m[0],Z=m[4],O=m[8],w=m[1],E=m[5],P=m[9],R=m[2],v=m[6],I=m[10];return g=g||this._order,"XYZ"===g?(this._y=Math.asin(D(O,-1,1)),Math.abs(O)<.99999?(this._x=Math.atan2(-P,I),this._z=Math.atan2(-Z,b)):(this._x=Math.atan2(v,E),this._z=0)):"YXZ"===g?(this._x=Math.asin(-D(P,-1,1)),Math.abs(P)<.99999?(this._y=Math.atan2(O,I),this._z=Math.atan2(w,E)):(this._y=Math.atan2(-R,b),this._z=0)):"ZXY"===g?(this._x=Math.asin(D(v,-1,1)),Math.abs(v)<.99999?(this._y=Math.atan2(-R,I),this._z=Math.atan2(-Z,E)):(this._y=0,this._z=Math.atan2(w,b))):"ZYX"===g?(this._y=Math.asin(-D(R,-1,1)),Math.abs(R)<.99999?(this._x=Math.atan2(v,I),this._z=Math.atan2(w,b)):(this._x=0,this._z=Math.atan2(-Z,E))):"YZX"===g?(this._z=Math.asin(D(w,-1,1)),Math.abs(w)<.99999?(this._x=Math.atan2(-P,E),this._y=Math.atan2(-R,b)):(this._x=0,this._y=Math.atan2(O,I))):"XZY"===g?(this._z=Math.asin(-D(Z,-1,1)),Math.abs(Z)<.99999?(this._x=Math.atan2(v,E),this._y=Math.atan2(O,b)):(this._x=Math.atan2(-P,I),this._y=0)):console.warn("unsupported order: "+g),this._order=g,S!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var x=new yi;return function(h,q,J){return x.makeRotationFromQuaternion(h),this.setFromRotationMatrix(x,q,J)}}(),setFromVector3:function(G,e){return this.set(G.x,G.y,G.z,e||this._order)},reorder:function(){var I=new gj;return function(x){return I.setFromEuler(this),this.setFromQuaternion(I,x)}}(),equals:function(u){return u._x===this._x&&u._y===this._y&&u._z===this._z&&u._order===this._order},fromArray:function(l){return this._x=l[0],this._y=l[1],this._z=l[2],l[3]!==C&&(this._order=l[3]),this.onChangeCallback(),this},toArray:function(l,h){return l===C&&(l=[]),h===C&&(h=0),l[h]=this._x,l[h+1]=this._y,l[h+2]=this._z,l[h+3]=this._order,l},toVector3:function(y){return y?y.set(this._x,this._y,this._z):new Tl(this._x,this._y,this._z)},onChange:function(n){return this.onChangeCallback=n,this},onChangeCallback:function(){}});var Uh=M.List=function(){this._as=[];var q,W,Q=arguments.length;if(1===Q){var i=arguments[0];if(Jq(i)&&(i=i._as),Ef(i))for(W=i.length,q=0;W>q;q++)this._as.push(i[q]);else i!=o&&this._as.push(i)}else if(Q>1)for(q=0;Q>q;q++)this._as.push(arguments[q])};Lj("List",v,{forEach:function(S,z){this.each(S,z)},push:function(){for(var v=0;v<arguments.length;v++)this.add(arguments[v])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(b,n){return n===C?this._as.push(b):this._as.splice(n,0,b)},addAll:function(n){Jq(n)&&(n=n._as),Ef(n)?hh(this._as,n):this._as.push(n)},get:function(Y){return this._as[Y]},slice:function(K,Q){return new Uh(this._as.slice(K,Q))},remove:function(M){var D=this._as.indexOf(M);return D>=0&&D<this._as.length&&this.removeAt(D),D},removeAt:function(N){return this._as.splice(N,1)[0]},set:function(e,I){return this._as[e]=I},clear:function(){return this._as.splice(0,this._as.length)},contains:function(c){return this._as.indexOf(c)>=0},indexOf:function(z){return this._as.indexOf(z)},each:function(r,Q){for(var N=0,w=this._as.length;w>N;N++){var X=this._as[N];Q?r.call(Q,X,N,this):r(X,N,this)}},reverseEach:function(L,p){for(var k=this._as.length-1;k>=0;k--){var d=this._as[k];p?L.call(p,d):L(d)}},getArray:function(){return this._as},toArray:function(y,F){if(y){for(var l,D=[],b=0,u=this._as.length;u>b;b++)l=this._as[b],F?y.call(F,l)&&D.push(l):y(l)&&D.push(l);return D}return this._as.concat()},toList:function(k,d){if(k){for(var u,g=new Uh,w=0,Z=this._as.length;Z>w;w++)u=this._as[w],d?k.call(d,u)&&g.add(u):k(u)&&g.add(u);return g}return new Uh(this)},reverse:function(){this._as.reverse()},sort:function(Q){return this._as.sort(Q?Q:Yn),this},toString:function(){return this._as.toString()}}),v.defineProperties(Uh.prototype,{length:{get:function(){return this._as.length},set:function(I){this._as.length=I}}});var Oo=new Uh;Iq(Oo,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:Mc,each:Mc,reverseEach:Mc,toArray:function(){return[]},toList:function(){return new Uh},add:Ak,addAll:Ak,set:Ak,remove:Ak,removeAt:Ak,clear:Ak});var td=M.Notifier=function(){this._f=0};Lj("Notifier",v,{contains:function(E,m){if(this._ls)for(var W,n=0,h=this._ls.size();h>n;n++)if(W=this._ls.get(n),E===W.l&&m===W.s)return!0;return!1},add:function(D,i,c){var d=this,Y={l:D,s:i,a:c};d._ls||(d._ls=new Uh),d._f?(d._as||(d._as=new Uh),d._as.add(Y)):Y.a?d._ls.add(Y,0):d._ls.add(Y)},remove:function(i,x){var T=this;T._ls&&(T._f?(T._rs||(T._rs=new Uh),T._rs.add({l:i,s:x})):T._remove(i,x))},_remove:function(O,h){for(var p,F=this._ls,I=0,K=F.size();K>I;I++)if(p=F.get(I),p.l===O&&p.s===h)return F.removeAt(I),void 0},fire:function(d){var f=this,E=f._ls;if(f._b=1e4,E){++f._f;try{for(var S,j=0,u=E.size();u>j;j++)S=E.get(j),S.s?S.l.call(S.s,d):S.l(d)}finally{if(--f._f)return;if(f._rs){for(u=f._rs.size(),j=0;u>j;j++)S=f._rs.get(j),f._remove(S.l,S.s);delete f._rs}if(f._as){for(u=f._as.size(),j=0;u>j;j++)S=f._as.get(j),S.a?E.add(S,0):E.add(S);delete f._as}}}}});var un=M.Data=function(){this._id=fe()};Lj("Data",v,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:o,_parent:o,_children:Oo,_childMap:o,_styleMap:o,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return o},_22Q:function(){return o},s:function(Q,R){var J=this;if(2===arguments.length)J.setStyle(Q,R);else{if(!kf(Q))return J.getStyle(Q);for(var h in Q)J.setStyle(h,Q[h])}return J},fp:function(l,w,M,t,T){return this.firePropertyChange(l,w,M,t,T)},firePropertyChange:function(u,U,H,t,C){if(t){if(t(U,H))return!1}else if(U===H)return!1;var T=this,m=C||{};return m.property=u,m.oldValue=U,m.newValue=H,m.data=T,T._dataModel&&T._dataModel.handleDataPropertyChange(m),T.onPropertyChanged(m),!0},onPropertyChanged:function(w){var d=this,U=d._parent,l=w.property;if(zi(U)){var Z=d.s(gn),z="s:ingroup"===l;(Z&&Tj[l]||l===z)&&U._81I(),(Z||z)&&U.fp("childChange",!0,!1)}Qk(U)&&Tj[l]&&U.updateFromChildren()},_21I:function(O){var A=this;if(O&&A._dataModel)throw"Remove data from dataModel before adding";A._dataModel=O},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var S=0,F=this._children.toArray(),b=F.length;b>S;S++)F[S].removeFromDataModel()},getId:function(){return this._id},setId:function(i){this._id=i},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(h,m){return this._children.toList(h,m)},eachChild:function(H,o){this._children.each(H,o)},addChild:function(K,M){var $=this;K!==$&&($._children===Oo&&($._children=new Uh,$._childMap={}),M>=0||(M=$._children.size()),$._childMap[K._id]||$.isDescendantOf(K)||(K._parent&&K._parent.removeChild(K),(0>M||M>$._children.size())&&(M=$._children.size()),$._children.add(K,M),$._childMap[K._id]=K,K.setParent($),$.onChildAdded(K,M),$.fp(ce,o,K)))},onChildAdded:function(){},removeChild:function(h){var D=this;if(D._childMap&&D._childMap[h._id]){var s=D._children.remove(h);delete D._childMap[h._id],D.fp(ce,h,o),h.setParent(o,s),D.onChildRemoved(h,s)}},onChildRemoved:function(){},getChildAt:function(C){return this._children.get(C)},clearChildren:function(){var k=this;if(!k._children.isEmpty())for(var c=0,l=k._children.toArray(),q=l.length;q>c;c++)k.removeChild(l[c])},getParent:function(){return this._parent},setParent:function(v,u){var a=this;if(!(a._73I||a._parent===v||a===v||v&&v.isDescendantOf(a))){var J,S=a._parent;a._parent=v,a._73I=1,S?(u==o&&(u=S.getChildren().indexOf(a)),S.removeChild(a)):a._dataModel&&u==o&&(u=a._dataModel.getRoots().indexOf(a)),v&&(v.addChild(a),J=v.getChildren().indexOf(a)),delete a._73I,a.fp("parent",S,v,C,{oldIndex:u,newIndex:J}),a.onParentChanged(S,v)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(C){return C?this.isDescendantOf(C)||C.isDescendantOf(this):!1},isParentOf:function(W){return W&&this._childMap?!!this._childMap[W._id]:!1},isDescendantOf:function(z){if(!z||z.isEmpty())return!1;for(var t=this._parent;t;){if(z===t)return!0;t=t._parent}return!1},getStyle:function(P,n){n===C&&(n=1);var L=this._styleMap?this._styleMap[P]:C;return L===C&&n?k[P]:L},setStyle:function(x,u){var z=this;z._styleMap||(z._styleMap={});var b=z._styleMap[x];u===C?delete z._styleMap[x]:z._styleMap[x]=u,z.fp("s:"+x,b,u)&&z.onStyleChanged(x,b,u)},onStyleChanged:function(){},iv:function(g){this.invalidate(g)},invalidate:function(w){this.fp(w||"*",!1,!0)},toString:function(){var r=this;return r._displayName||r._name||r._tag||r._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(r,R){var S=this,Z=S.s(ze);Z||S.s(ze,Z={}),R?Z[r]=R:delete Z[r],S.fp(ze,o,Z)},removeStyleIcon:function(U){var x=this.s(ze);if(x){var g=x[U];delete x[U],this.fp(ze,o,x)}return g},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var W,E={};for(W in this._styleMap)E[W]=1;return E},ca:function(e,H){return e=Mh+e,2===arguments.length?this.a(e,H):this.a(e)}});var hd=M.DataModel=function(){var v=this;v._datas=new Uh,v._dataMap={},v._roots=new Uh,v._rootMap={},v._fsDataMap={},v._78O={},v._36I=new td,v._35I=new td,v._serializeNotifier=new td,v._selectionModel=new Un(v);var s=v._29Q=[],B=v._scheduleCallback=function(){for(var n=Date.now(),h=0;h<s.length;h++){var A=s[h];A.enabled&&n-A.lastTime>A.interval&&(A.beforeAction&&A.beforeAction(),v.each(function(z){A.action(z)}),A.afterAction&&A.afterAction(),A.lastTime=n)}s.length&&(v._30Q=P.requestAnimationFrame(B))}};Lj("DataModel",v,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:C,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:C,_init:C,_envmap:C,_postProcessingData:C,sm:function(){return this.getSelectionModel()},mm:function(m,U,A){this.addDataModelChangeListener(m,U,A)},umm:function(t,q){this.removeDataModelChangeListener(t,q)},md:function(L,l,T){this.addDataPropertyChangeListener(L,l,T)},umd:function(T,v){this.removeDataPropertyChangeListener(T,v)},mh:function(d,O,$){this.addHierarchyChangeListener(d,O,$)},umh:function(s,x){this.removeHierarchyChangeListener(s,x)},getAttrObject:function(){return this._attrObject},setAttrObject:function(h){return this._attrObject=h},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getDataById:function(d){return this._dataMap[d]},removeDataById:function(_){this.remove(this.getDataById(_))},toDatas:function(M,F){return this._datas.toList(M,F)},each:function(y,X){this._datas.each(y,X)},getDataByTag:function(F){return this._78O[F]},getTagMap:function(){return this._78O},removeDataByTag:function(N){this.remove(this.getDataByTag(N))},add:function(h,n,$){var V=this,F=h._id,D=h._tag,r=V._roots;if(V._dataMap[F])throw"'"+F+"' already exists";D!=o&&(V._78O[D]=h),V._dataMap[F]=h,$>=0?V._datas.add(h,$):V._datas.add(h),h._parent||(V._rootMap[F]=h,n>=0?r.add(h,n):r.add(h)),h.s("fullscreen")!==C&&(V._fsDataMap[F]=h),h._21I(V),V.onAdded(h),V._36I.fire({kind:"add",data:h,rootsIndex:n,datasIndex:$})},onAdded:function(){},remove:function(G,H){if(G){var l=this,r=G._id,t=H&&H.keepStructure,Y=H&&H.keepChildren,C=G.getTag();if(G._dataModel===l){this.beginTransaction(),t?l._removingData||(l._removingData=G):l.prepareRemove(G),Y||G.toChildren().each(function(L){l.remove(L,H)},l),t?l._removingData===G&&(G._parent&&G._parent.removeChild(G),delete l._removingData):G._parent&&G._parent.removeChild(G);var d=l._datas.remove(G);delete l._dataMap[r],C!=o&&delete l._78O[C];var V;l._rootMap[r]&&(delete l._rootMap[r],V=l._roots.remove(G)),l._fsDataMap[r]&&delete l._fsDataMap[r],G._21I(o),l.onRemoved(G),l._36I.fire({kind:nm,data:G,rootsIndex:V,datasIndex:d}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var r=this;if(r._datas.size()){var S=r._historyManager?this.toJSON():C;r._datas.toArray().forEach(function(K){K._21I(o)}),r._datas.clear(),r._dataMap={},r._roots.clear(),r._rootMap={},r._fsDataMap={},r._78O={},r._36I.fire({kind:fq,json:S})}},contains:function(A){return A&&A._dataModel===this},handleDataPropertyChange:function(N){var k=this,D=N.data,f=N.property;if("parent"===f){var R=D._id,$=k._rootMap,Z=k._roots;D._parent?$[R]&&(delete $[R],Z.remove(D)):$[R]||($[R]=D,Z.add(D))}else if("tag"===f){var l=N.oldValue,s=N.newValue,G=k._78O;l!=o&&delete G[l],s!=o&&(G[s]=D)}else if("s:fullscreen"===f){var R=D._id,B=k._fsDataMap;N.oldValue!=o&&delete B[R],N.newValue!=o&&(B[R]=D)}this.onDataPropertyChanged(D,N),this._35I.fire(N)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(y,m,u){this._36I.add(y,m,u)},removeDataModelChangeListener:function(R,v){this._36I.remove(R,v)},addSerializeListener:function(k,E,$){this._serializeNotifier.add(k,E,$)},removeSerializeListener:function(F,D){this._serializeNotifier.remove(F,D)},fireSerializeEvent:function(o){this._serializeNotifier.fire(o)},addDataPropertyChangeListener:function(d,X,l){this._35I.add(d,X,l)},removeDataPropertyChangeListener:function(f,l){this._35I.remove(f,l)},_38I:function(O,s,I){this._37I&&this._37I.fire({data:O,oldIndex:s,newIndex:I})},addHierarchyChangeListener:function(q,Y,B){this._37I||(this._37I=new td),this._37I.add(q,Y,B)},removeHierarchyChangeListener:function(C,Q){this._37I.remove(C,Q)},getSiblings:function(x){var A=x._parent;return A?A._children:this._roots},eachByHierarchical:function(C,e,U){if(e)return this._eachByHierarchical(C,e,U);for(var E=0,N=this._roots,P=N.size();P>E;E++)if(this._eachByHierarchical(C,N.get(E),U)===!1)return!1;return!0},_eachByHierarchical:function(h,S,v){if(v){if(h.call(v,S)===!1)return!1}else if(h(S)===!1)return!1;for(var I=S.size(),W=0;I>W;W++)if(this._eachByHierarchical(h,S.getChildAt(W),v)===!1)return!1;return!0},reverseEachByHierarchical:function(M,I,f){if(I)return this._reverseEachByHierarchical(M,I,f);for(var t=this._roots,W=t.size(),$=W-1;$>=0;$--)if(this._reverseEachByHierarchical(M,t.get($),f)===!1)return!1;return!0},_reverseEachByHierarchical:function(c,x,b){for(var j=x.size(),v=j-1;v>=0;v--)if(this._reverseEachByHierarchical(c,x.getChildAt(v),b)===!1)return!1;if(b){if(c.call(b,x)===!1)return!1}else if(c(x)===!1)return!1;return!0},eachByDepthFirst:function(o,S,n){if(S)return this._11I(o,S,n);for(var h=0,l=this._roots,$=l.size();$>h;h++)if(this._11I(o,l.get(h),n)===!1)return!1;return!0},_11I:function(g,r,z){for(var Z=r.size(),V=0;Z>V;V++)if(this._11I(g,r.getChildAt(V),z)===!1)return!1;if(z){if(g.call(z,r)===!1)return!1}else if(g(r)===!1)return!1;return!0},eachByBreadthFirst:function(S,I,u){var l=new Uh;for(I?l.add(I):this._roots.each(l.add,l);l.size()>0;)if(I=l.removeAt(0),I.eachChild(l.add,l),u){if(S.call(u,I)===!1)return!1}else if(S(I)===!1)return!1;return!0},moveTo:function(s,a){var G=this.getSiblings(s),z=G.indexOf(s);z===a||0>z||a>=0&&a<=G.size()&&(G.remove(s),a>G.size()&&a--,G.add(s,a),this._38I(s,z,a))},moveUp:function(J){this.moveTo(J,this.getSiblings(J).indexOf(J)-1)},moveDown:function(B){this.moveTo(B,this.getSiblings(B).indexOf(B)+1)},moveToTop:function(L){this.moveTo(L,0)},moveToBottom:function(P){this.moveTo(P,this.getSiblings(P).size())},moveSelectionUp:function(V){this.beginTransaction(),V||(V=this.sm());var M=new Uh;Sh(V,M,this._roots),M.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(q){this.beginTransaction(),q||(q=this.sm());var z=new Uh;xq(q,z,this._roots),z.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(A){this.beginTransaction(),A||(A=this.sm());var r=new Uh;Be(A,r,this._roots),r.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(g){this.beginTransaction(),g||(g=this.sm());var l=new Uh;re(g,l,this._roots),l.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(H,e,_){var s=this.getDatas();null==_&&(_=s.indexOf(H)),_===e||0>_||e>=0&&e<=s.size()&&(s.remove(H),e>s.size()&&e--,s.add(H,e),this._76I(H,_,e))},bringForward:function(P){this.moveToIndex(P,this.getDatas().indexOf(P)+1)},bringToFront:function(I){this.moveToIndex(I,this.size())},sendBackward:function(J){this.moveToIndex(J,this.getDatas().indexOf(J)-1)},sendToBack:function(X){this.moveToIndex(X,0)},bringSelectionForward:function(f){this.beginTransaction(),f||(f=this.sm());for(var O=new Uh,a=this.getDatas(),l=!1,F=0;F<a.size();F++){var n=a.get(a.size()-1-F);f.contains(n)?l&&O.add(n):l=!0}O.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(g){this.beginTransaction(),g||(g=this.sm());for(var j=new Uh,S=this.getDatas(),w=0;w<S.size();w++){var q=S.get(w);g.contains(q)&&j.add(q)}j.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(p){this.beginTransaction(),p||(p=this.sm());for(var M=new Uh,v=this.getDatas(),s=!1,X=0;X<v.size();X++){var i=v.get(X);p.contains(i)?s&&M.add(i):s=!0}M.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(T){this.beginTransaction(),T||(T=this.sm());for(var S=new Uh,b=this.getDatas(),A=0;A<b.size();A++){var f=b.get(b.size()-1-A);T.contains(f)&&S.add(f)}S.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(s){var n=this;n.removeScheduleTask(s),s.enabled==o&&(s.enabled=!0),s.interval==o&&(s.interval=10),s.action==o&&(s.action=Mc),s.lastTime=Date.now(),n._29Q.push(s),n._30Q==o&&(n._30Q=P.requestAnimationFrame(n._scheduleCallback))},removeScheduleTask:function(f){var L=this,k=L._29Q,q=k.indexOf(f);q>=0&&k.splice(q,1),k.length||L._30Q==o||(P.cancelAnimationFrame(L._30Q),delete L._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(v){this._historyManager||new M.HistoryManager(this),null!=v&&this._historyManager.setMaxHistoryCount(v),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(z){this._historyManager&&this._historyManager.undo(z)},redo:function(N){this._historyManager&&this._historyManager.redo(N)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(y){this._historyManager&&this._historyManager.addHistory(y)},onHistoryManagerChanged:function(){}});var Un=M.SelectionModel=function($){var W=this;W._68O=_b,W._map={},W._73O=new Uh,W._74I=new td,W._21I($)};Lj("SelectionModel",v,{ms_fire:1,ms_dm:1,ms:function(Q,A,q){this.addSelectionChangeListener(Q,A,q)},ums:function(U,u){this.removeSelectionChangeListener(U,u)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===Nb},co:function(j){return this._map[j._id]!=o},ss:function(D){this.setSelection(D)},as:function(P){this.appendSelection(P)},rs:function(I){this.removeSelection(I)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()
},getSelectionMode:function(){return this._68O},setSelectionMode:function(r){var l=this;if(l._68O!==r&&(r===sl||r===Nb||r===_b)){l.cs();var R=l._68O;l._68O=r,l.fp("selectionMode",R,r)}},_21I:function(r){var e=this,Y=e._dataModel;Y!==r&&(Y&&(e.cs(),Y.umm(e.handleDataModelChange,e)),e._dataModel=r,r.mm(e.handleDataModelChange,e,!0),e.fp(Ur,Y,r))},dispose:function(){var N=this;N.cs(),N._dataModel.umm(N.handleDataModelChange,N)},handleDataModelChange:function(V){var Y=this;if(V.kind===nm){var U=V.data;Y.co(U)&&(Y._73O.remove(U),delete Y._map[U._id],Y._75I(nm,new Uh(U)))}else V.kind===fq&&Y.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(d){var E=this;if(E._filterFunc!==d){E.cs();var r=E._filterFunc;E._filterFunc=d,E.fp("filterFunc",r,E._filterFunc)}},_75I:function(r,j,I,G){I&&(this._73O.each(function(b){G[b._id]?I.remove(b):I.add(b)}),j=I.toList()),this._74I.fire({kind:r,datas:new Uh(j)})},addSelectionChangeListener:function(U,b,B){this._74I.add(U,b,B)},removeSelectionChangeListener:function(P,x){this._74I.remove(P,x)},_97O:function(g,j){for(var R,w=this,t=0,i=new Uh(g);t<i.size();t++)R=i.get(t),(w._filterFunc&&!w._filterFunc(R)||j&&w.co(R)||!j&&!w.co(R)||!w._dataModel.contains(R))&&(i.removeAt(t),t--);return i},appendSelection:function(b){var h=this;if(h._68O!==sl){var z,k,g=h._73O,j=h._97O(b,!0);j.isEmpty()||(h.sg()&&(z=new Uh(g),k=h._map,g.clear(),h._map={},j=new Uh(j.get(j.size()-1))),j.each(function(_){g.add(_),h._map[_._id]=_}),h._75I("append",j,z,k))}},removeSelection:function(p){var j=this,Z=j._97O(p),I=0,_=Z.size();if(0!==_){for(;_>I;I++){var c=Z.get(I);j._73O.remove(c),delete j._map[c._id]}j._75I(nm,Z)}},toSelection:function(I,m){return this._73O.toList(I,m)},getSelection:function(){return this._73O},each:function(s,b){this._73O.each(s,b)},setSelection:function(X){var Y=this,l=Y._73O;if(Y._68O!==sl&&!(l.isEmpty()&&!X||1===l.size()&&Y.ld()===X)){var y=new Uh(l),g=Y._map;l.clear(),Y._map={};var D=Y._97O(X,!0);Y.sg()&&D.size()>1&&(D=new Uh(D.get(D.size()-1))),D.each(function(B){l.add(B),Y._map[B._id]=B}),Y._75I("set",o,y,g)}},clearSelection:function(){var N=this,z=N._73O;if(z.size()>0){var j=z.toList();z.clear(),N._map={},N._75I(fq,j)}},selectAll:function(){var T=this;if(T._68O!==sl){var V,I,x=T._dataModel.toDatas();if(T._filterFunc)for(V=0;V<x.size();V++)I=x.get(V),T._filterFunc(I)||(x.removeAt(V),V--);var v=T._73O,C=new Uh(v),a=T._map;v.clear(),T._map={},T.sg()&&x.size()>1&&(x=new Uh(x.get(x.size()-1)));var n=x.size();for(V=0;n>V;V++)I=x.get(V),v.add(I),T._map[I._id]=I;T._75I("all",o,C,a)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(G){return this._map[G._id]!=o},getLastData:function(){var S=this._73O;return S.size()>0?S.get(S.size()-1):o},getFirstData:function(){var K=this._73O;return K.size()>0?K.get(0):o},isSelectable:function(Z){var r=this;return Z&&r._68O!==sl?r._filterFunc?r._filterFunc(Z):!0:!1},getTopSelection:function(){var S=this,Y=new Uh;return S._73O.each(function(E){for(var K=E.getParent();K;){if(S.contains(K)){E=o;break}K=K.parent}E&&Y.add(E)}),Y}});var Pe=function(){return Th(0),function(Y,L){var r;if(ad(L)){var S=Y.getDataUI(L);S&&S._88I&&(r=S._88I.rect)}return r?r:L.getRect()}}();Iq(w,{edgeGroupAgentFunc:o,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:x.rectSelectBorder,graphViewRectSelectBackground:Gb,graphViewEditPointSize:Em?17:7,graphViewEditPointBorderColor:x.editPointBorder,graphViewEditPointBackground:x.editPointBackground,setEdgeType:function(m,K,P){qj[m]=K,Pl[m]=P},getEdgeType:function(q){return qj[q]},getEdgeTypeMap:function(){return qj},getNodeRect:Pe},!0),Iq(k,{"layout.h":C,"layout.v":C,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":C,interactive:!1,"image.stretch":"fill",icons:C,ingroup:!0,"body.color":C,"2d.gray":!1,fullscreen:C,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:C,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":ib,"select.width":1,"select.padding":2,"select.type":jo,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":C,"border.width":2,"border.padding":2,"border.type":jo,label:C,"label.font":C,"label.color":cc,"label.background":C,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":C,"label.max":C,"label.opacity":C,"label.scale":1,"label.align":C,"label.selectable":!0,label2:C,"label2.font":C,"label2.color":cc,"label2.background":C,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":C,"label2.max":C,"label2.opacity":C,"label2.scale":1,"label2.align":C,"label2.selectable":!0,note:C,"note.expanded":!0,"note.font":C,"note.color":eg,"note.background":ib,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":C,"note.toggleable":!0,"note.border.width":1,"note.border.color":C,"note.opacity":C,"note.scale":1,"note.align":C,note2:C,"note2.expanded":!0,"note2.font":C,"note2.color":eg,"note2.background":ib,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":C,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":C,"note2.opacity":C,"note2.scale":1,"note2.align":C,"group.type":C,"group.image":C,"group.image.stretch":"fill","group.repeat.image":C,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":C,"group.title.color":eg,"group.title.background":x.groupTitleBackground,"group.title.align":de,"group.title.orientation":kl,"group.background":x.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":C,"group.border.color":Nh,"group.border.radius":0,"group.border.cap":ll,"group.border.join":Nf,"group.splitLine":!1,"group.gradient":o,"group.gradient.color":"#FFF",shape:C,"shape.background":Nh,"shape.repeat.image":C,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Nh,"shape.border.3d":!1,"shape.border.3d.color":C,"shape.border.3d.accuracy":C,"shape.border.cap":ll,"shape.border.join":Nf,"shape.border.pattern":C,"shape.gradient":o,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":ud,"shape.dash.offset":0,"shape.dash.color":$c,"shape.dash.width":C,"shape.dash.3d":!1,"shape.dash.3d.color":C,"shape.dash.3d.accuracy":C,"shape.polygon.side":6,"shape.arc.from":s,"shape.arc.to":g,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":C,"shape.gradient.pack":C,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":C,"shape.foreground.gradient":o,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":C,"autolayout.hgap":C,"autolayout.vgap":C,"edge.type":C,"edge.points":C,"edge.segments":C,"edge.color":Nh,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":C,"edge.3d.accuracy":C,"edge.cap":ll,"edge.join":Nf,"edge.source.position":17,"edge.source.anchor.x":C,"edge.source.anchor.y":C,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":C,"edge.target.anchor.y":C,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":C,"edge.dash":!1,"edge.dash.pattern":ud,"edge.dash.offset":0,"edge.dash.color":$c,"edge.dash.width":C,"edge.dash.3d":!1,"edge.dash.3d.color":C,"edge.dash.3d.accuracy":C,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":C,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":C,"grid.column.percents":C,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":x.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":x.gridCellBorderColor,"grid.block":C,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":x.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":cc,"text.font":hg,"text.shadow":!1,"text.shadow.color":ib,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,_62O:C},!0),Iq(hd,{_76I:function(c,_,v){this._39I&&this._39I.fire({data:c,oldIndex:_,newIndex:v})},addIndexChangeListener:function(w,i,L){var G=this;G._39I||(G._39I=new td),G._39I.add(w,i,L)},removeIndexChangeListener:function(f,K){this._39I.remove(f,K)},prepareRemove:function(Y){ps(Y)&&(Y.setSource(o),Y.setTarget(o)),Y._70O&&Y._70O.toList().each(this.remove,this),Y._69O&&Y._69O.toList().each(function(A){A.setHost(o)}),Y._host&&Y.setHost(o)},onAdded:function(d){this.isAutoAdjustIndex()&&this.adjustIndex(d)},onDataPropertyChanged:function(w,V){Dm[V.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(w)},isAdjustable:function(D){return yr(D)||ps(D)},isAdjustedToBottom:function(p){return zi(p)?p.isExpanded()&&Pm(p):!1},adjustIndex:function(P){var A=this;this.isHierarchicalRendering()||(A.isAdjustedToBottom(P)?(A.sendToBottom(P),P.eachChild(A.adjustIndex,A)):A.sendToTop(P))},sendToTop:function(x){var r=this;if(r.contains(x)&&r.isAdjustable(x)){var C=r._datas;if(x!==C.get(r.size()-1)){var M=C.indexOf(x);C.removeAt(M),C.add(x),r._76I(x,M,r.size()-1)}if(ps(x)){var A=x._40I;A&&!r.isAdjustedToBottom(A)&&r.sendToTop(A),A=x._41I,A&&!r.isAdjustedToBottom(A)&&r.sendToTop(A)}x._69O&&x._69O.each(function(q){q.isRelatedTo(x)||yr(x)&&q.isLoopedHostOn(x)||r.sendToTop(q)}),x.ISubGraph||(!zi(x)||x.isExpanded())&&x._adjustChildrenToTop&&x.eachChild(function(u){ps(u)||r.sendToTop(u)})}},sendToBottom:function(c,b){var B=this;if(c!==b&&B.contains(c)&&B.isAdjustable(c)&&(!b||B.contains(b))){var q=B._datas,C=q.remove(c),Z=b?B._datas.indexOf(b):0;if(q.add(c,Z),C!==Z){B._76I(c,C,Z);var z=c._parent;!z||z.ISubGraph||ps(z)||B.sendToBottom(c._parent,c)}}}}),Iq(js,{ms_edit:function(S){S._46O=function(c){var A=this,t=A.gv.dm(),Q=A._index,C=A._89I,H=A._node,U=A._shape,r=A._edge,g=A._77I;H&&C?(this.fi({kind:"endEditRect",event:c,data:H,direction:C}),t.endTransaction()):U&&Q>=0?(A.fi({kind:"endEditPoint",event:c,data:U,index:Q}),t.endTransaction()):r&&Q>=0?(A.fi({kind:"endEditPoint",event:c,data:r,index:Q}),t.endTransaction()):g&&(A.fi({kind:"endEditRotation",event:c,data:g}),t.endTransaction())},S._78I=function(k){var z=this;z.autoScroll(k);var $=z.gv.lp(k),I=z._index,B=z._89I,C=z._node,i=z._shape,e=z._edge,l=z._77I;if(C&&B)z._80O($),z.fi({kind:"betweenEditRect",event:k,data:C,direction:B});else if(i&&I>=0)$.e=i.getPoints().get(I).e,i.setPoint(I,$),z.fi({kind:"betweenEditPoint",event:k,data:i,index:I});else if(e&&I>=0){var Z=e.s(to);$.e=Z.get(I).e,Z.set(I,$),e.fp(to,o,Z),z.fi({kind:"betweenEditPoint",event:k,data:e,index:I})}else if(l){var U=l.p(),d=l.getScale(),u=A+h($.y-U.y,$.x-U.x);d.y<0&&(u+=s),T(u)<.04&&(u=0),l.setRotation(u),z.fi({kind:"betweenEditRotation",event:k,data:l})}},S._80O=function(G){var A=this,n=A._node,Z=A._rect,V=Z.x,x=Z.y,g=Z.width,M=Z.height,e=A._89I,T=A._anchor,S=A._matrix,G=S.tfi(G);"northwest"===e?Z=nb(G,{x:V+g,y:x+M}):e===md?Z=nb({x:V,y:G.y},{x:V+g,y:x+M}):"northeast"===e?Z=nb({x:V,y:G.y},{x:G.x,y:x+M}):e===bl?Z=nb({x:G.x,y:x},{x:V+g,y:x+M}):e===vq?Z=nb({x:V,y:x},{x:G.x,y:x+M}):"southwest"===e?Z=nb({x:G.x,y:x},{x:V+g,y:G.y}):"south"===e?Z=nb({x:V,y:x},{x:V+g,y:G.y}):"southeast"===e&&(Z=nb({x:V,y:x},G)),n.setPosition(S.tf(Z.x+Z.width*T.x,Z.y+Z.height*T.y)),n.setWidth(Z.width),n.setHeight(Z.height)},S._80I=function(y,M,c,Q){var z=this,r=z.gv._zoom,K=(z.gv.getEditPointSize()+2)/r;return lq({x:M-K/2,y:c-K/2,width:K,height:K},y)?(z._89I!==Q&&(z._89I=Q),!0):!1},S._79I=function(X,H,$){var v=this,c=v.gv,l=H?c.getDataUI(H):o,u=l?l._55O:o;if(u){var _,e,B,g,k=c._zoom,O=(c.getEditPointSize()+2)/k,Y=c.lp(X);if(yr(H)){if(u._56O&&yr(H)&&(e=u._98o,lq({x:e.x-O/2,y:e.y-O/2,width:O,height:O},Y)))return v._77I=H,$&&v.fi({kind:"beginEditRotation",event:X,data:H}),v.setCursor("crosshair"),!0;if(u._43O&&H instanceof Yr)for(B=H.getPoints(),_=B.size()-1;_>=0;_--)if(e=B.get(_),lq({x:e.x-O/2,y:e.y-O/2,width:O,height:O},Y))return v._index=_,v._shape=H,$&&v.fi({kind:"beginEditPoint",event:X,data:H,index:_}),v.setCursor("crosshair"),!0;if(u._42O)for(var V=H.getEditControlPoints(),J=["northwest",-1,-1,bl,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,vq,1,0,"northeast",1,-1,md,0,-1],_=0,g=V.length;g>_;_++){var A=J[3*_],b=V[_];if(v._80I(Y,b.x,b.y,A)){v._node=H;var s=H.getWidth(),G=H.getHeight(),n=H.getAnchor();v._rect={x:-s*n.x,y:-G*n.y,width:s,height:G},v._anchor=n,v._matrix=H.getMatrix();var M=H.getRotation(),R=i(M),C=F(M),S=J[3*_+1]*ef(H.getScale().x),r=J[3*_+2]*ef(H.getScale().y),j=Math.atan2(-C*S-R*r,R*S-C*r),f=(Math.round(j/(Math.PI/4))+8)%8,K=[wk,"nesw-resize",uk,"nwse-resize",wk,"nesw-resize",uk,"nwse-resize"][f];return v.setCursor(K),$&&v.fi({kind:"beginEditRect",event:X,data:H,direction:v._89I}),!0}}}if(u._43O&&ps(H)&&H.s(Xq)===_g&&(B=H.s(to)))for(_=B.size()-1;_>=0;_--)if(e=B.get(_),lq({x:e.x-O/2,y:e.y-O/2,width:O,height:O},Y))return v._index=_,v._edge=H,$&&v.fi({kind:"beginEditPoint",event:X,data:H,index:_}),v.setCursor("crosshair"),!0}return!1}},ms_gv:function(I){I._currentSubGraph=o,I._fpsInfo={time:0,fps:0,frames:0},I.upSubGraph=function(){this.setCurrentSubGraph(bp(this._currentSubGraph))},I.isVisible=function(G){var P=this;if(bp(G)!==P._currentSubGraph)return!1;if(ps(G)){var d=G._40I,a=G._41I;if(!d||!a)return!1;if(!(G.s("edge.independent")||P.isVisible(d)&&P.isVisible(a)))return!1;if(G.isEdgeGroupHidden())return!1}else for(var J=G._parent;J&&!J.ISubGraph;){if(zi(J)&&(!J.isExpanded()||!P.isVisible(J)))return!1;J=J._parent}if(G._parent instanceof Uk&&!P.isVisible(G._parent))return!1;if(G._refGraph instanceof rs&&!P.isVisible(G._refGraph))return!1;if(P instanceof qf){if(!G.s("3d.visible"))return!1}else{var H=P.getLayersInfo();if(H){var Y=H[G._layer];if(Y&&Y.visible===!1)return!1}if(!G.s("2d.visible"))return!1}return P._visibleFunc?P._visibleFunc(G):!0},I.handleSelectionChange=function(G){var n=this;G.datas.each(function($){n.invalidateData($);var N=$._parent;zi(N)&&yr($)&&$.s(gn)&&(n.invalidateData(N),N._49I&&N._49I.each(function(Z){n.invalidateData(Z)}))}),n.onSelectionChanged(G)},I.onSelectionChanged=function(O){var M=this,W=M.sm();if(1===W.size()&&("set"===O.kind||"append"===O.kind)){var I=W.ld();M.isAutoMakeVisible()&&M.makeVisible(I),M.adjustIndex&&M._dataModel.isAutoAdjustIndex()&&M.adjustIndex(I)}},I.makeVisible=function(p){if(p){var c=this,i=c.getDataUI?c.getDataUI(p):c.getData3dUI(p);if(i){var h=p,P=bp(p);for(P!==c._currentSubGraph&&c.setCurrentSubGraph(P);(h=h._parent)&&h!==P;)zi(h)&&h.setExpanded(!0);c._23I=p,c.iv()}}},I.getLabel=function(e){var K=e.getStyle(uq);return K===C?e.getName():K},I.getLabelBackground=function(i){return i.getStyle("label.background")},I.getLabelColor=function(M){return M.getStyle("label.color")},I.getLabel2=function(r){return r.getStyle("label2")},I.getLabel2Background=function(o){return o.getStyle("label2.background")},I.getLabel2Color=function(X){return X.getStyle("label2.color")},I.getNote=function(G){return G.getStyle(Fk)},I.getNoteBackground=function(c){return c.getStyle("note.background")},I.getNote2=function(L){return L.getStyle(Sn)},I.getNote2Background=function(o){return o.getStyle("note2.background")},I.handleClick=function(N,E,l){var S=this;E?(S.fi({kind:"clickData",event:N,data:E,part:l}),S.onDataClicked(E,N)):(S.fi({kind:"clickBackground",event:N}),S.onBackgroundClicked(N))},I.handleDoubleClick=function(l,D,W){var S=this;oh(l)&&(D?(S.fi({kind:"doubleClickData",event:l,data:D,part:W}),S.onDataDoubleClicked(D,l,W),S.checkDoubleClickOnNote(l,D,W)||S.checkDoubleClickOnRotation&&S.checkDoubleClickOnRotation(l,D,W)||(ps(D)?S.onEdgeDoubleClicked(D,l,W):D.ISubGraph?S.onSubGraphDoubleClicked(D,l,W):zi(D)?S.onGroupDoubleClicked(D,l,W):D.IDoorWindow?S.onDoorWindowDoubleClicked(D,l,W):D.ICSGBox&&S.onCSGBoxDoubleClicked(D,l,W))):(S.fi({kind:"doubleClickBackground",event:l}),S.onBackgroundDoubleClicked(l)))},I.onSubGraphDoubleClicked=function(W){this.setCurrentSubGraph(W)},I.onEdgeDoubleClicked=function(k,X){k.ISubGraph&&!tl(X)?this.setCurrentSubGraph(k):k.s("edge.toggleable")&&k.toggle()},I.onGroupDoubleClicked=function(D){D.s("group.toggleable")&&D.toggle()},I.onDoorWindowDoubleClicked=function(n){n.s("dw.toggleable")&&n.toggle(!0)},I.onCSGBoxDoubleClicked=function(S,T){var Q=this;if(Q instanceof qf){var P=Q.getHitFaceInfo(T);P&&P.face&&S.s(P.face+".toggleable")&&S.toggleFace(P.face,!0)}},I.onBackgroundClicked=function(){},I.onBackgroundDoubleClicked=function(){this.upSubGraph()},I.onDataClicked=function(){},I.onDataDoubleClicked=function(){},I.onAutoLayoutEnded=function(){},I.onMoveEnded=function(){},I.onPanEnded=function(){},I.onPinchEnded=function(){},I.onRectSelectEnded=function(){},I.onZoomEnded=function(){},I.serialize=function(D){return this.dm().serialize(D)},I.toJSON=function(){return this.dm().toJSON()},I.deserialize=function(I,M){var k=this;M=M instanceof un?{rootParent:M}:Yb(M)?{setId:M}:pg(M)?{finishFunc:M}:M||{},M.view=k;var h=k.dm(),b=M.finishFunc;return M.finishFunc=function(){b&&b.apply(M,arguments),Yb(h.a("zoomable"))&&k.setZoomable&&k.setZoomable(h.a("zoomable")),Yb(h.a("pannable"))&&k.setPannable&&k.setPannable(h.a("pannable")),Yb(h.a("rectSelectable"))&&k.setRectSelectable&&k.setRectSelectable(h.a("rectSelectable")),h.a("fitContent")===!0&&k.fitContent&&k.fitContent(!0,0)},h.deserialize(I,M.rootParent,M)},I.showDebugTip=function(){var N=this,F=N._debugDiv;if(!F){F=N._debugDiv=V.createElement("div"),F.style.position="absolute",F.style.overflow="hidden",F.style.backgroundColor="white",F.style.color="black";var v=N.getView();N._79O?v.insertBefore(F,N._79O):v.appendChild(F);var M=function(){N.redraw();var s="FPS : "+N._fpsInfo.fps+"<br/>"+"Datas : "+N.dm().getDatas().length,o=N.getDebugTip();o&&(s+="<br/>------<br/>"+o),F.innerHTML=s,N._isDebugging&&requestAnimationFrame(M)};requestAnimationFrame(M),N._isDebugging=!0}},I.hideDebugTip=function(){var H=this,G=H._debugDiv;G&&(delete H._debugDiv,H.getView().removeChild(G),H._isDebugging=!1)},I.countFrame=function(){if(this._isDebugging){var n=Date.now(),Z=this._fpsInfo;n-Z.time>1e3?(Z.fps=Math.round(1e5*(Z.frames+1)/(n-Z.time))/100,Z.time=n,Z.frames=0):Z.frames++}}},ms_icons:function(V){V.getRotation=function(x){return x==o?0:x},V._15O=function(){var F=this,L=F.s(ze);if(L){var r=F,H=F.data||F._data,O=F._38o={icons:L,rects:{}};for(var d in L){var t=L[d],E=Bs(t.shape3d,H,r);if(!(Bs(t.visible,H,r)===!1||Bs(t.for3d,H,r)&&!F.I3d||E&&!F.I3d)){var I=E?[E]:Bs(t.names,H,r),A=I?I.length:0,a=Bs(t.position,H,r)||3,N=Bs(t.offsetX,H,r)||0,S=Bs(t.offsetY,H,r)||0,V=Bs(t.direction,H,r)||vq,X=Bs(t.gap,H,r),i=X!=o?X:1,C=Bs(t.rotation,H,r),y=Bs(t.keepOrien,H,r),W=Bs(t.rotationFixed,H,r)?C:F.getRotation(C,y,a),P=o,e=O.rects[d]=new Array(A);e.rotation=W;for(var $=0;A>$;$++){var s,j,T,D,_=I[$];if(E)T=0,D=0;else{var u=Wl(_);T=Bs(t.width,H,r),D=Bs(t.height,H,r),T==o&&(T=lj(u,H)),D==o&&(D=sr(u,H))}if(P?V===vq?N+=T/2:V===bl?N-=T/2:V===md?S-=D/2:S+=D/2:P={width:T,height:D},F.I3d){var J=-T/2,M=-D/2;j={width:T,height:D,mat:F._16O(Bs(t.autorotate,H,r),a,P,Bs(t.face,H,r)||Qm,Bs(t.t3,H,r),Bs(t.r3,H,r),Bs(t.rotationMode,H,r),N,S),vs:new sm([J,-M,0,J,-M-D,0,J+T,-M-D,0,J+T,-M,0])}}else s=F.getPosition(a,N,S,P,Bs(t.positionFixed,H,r)),j={x:s.x-T/2,y:s.y-D/2,width:T,height:D},F._68o(j,W);e[$]=j,V===vq?N+=T/2+i:V===bl?N-=T/2+i:V===md?S-=D/2+i:S+=D/2+i}}}}}}});var Vh={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Wg={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Qo={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Dm={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Tj={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},Br={"edge.type":1,"edge.group":1},Oh={rotation:1,rotationX:1,rotationZ:1},Lp={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Hb={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},je={shape:1,thickness:1,position:1,anchor:1,scale:1},bp=function(H){if(!H)return o;if(ps(H)){var L=H._40I,J=H._41I;if(!L||!J)return o;var C=bp(L),p=bp(J);return C===p?C:o}for(var x=H._parent;ps(x)&&!x.ISubGraph;)x=x._parent;return x?x.ISubGraph?x:bp(x):o},lh=function(v,A,J,Y){var k=A.getStyle(J)*Y;k&&Bi(v,k),k=A.getStyle(J+".left")*Y,k&&(v.x-=k,v.width+=k),k=A.getStyle(J+".right")*Y,k&&(v.width+=k),k=A.getStyle(J+".top")*Y,k&&(v.y-=k,v.height+=k),k=A.getStyle(J+".bottom")*Y,k&&(v.height+=k),v.width<0&&(v.width=-v.width,v.x-=v.width),v.height<0&&(v.height=-v.height,v.y-=v.height)},Pm=function(N){for(var U,_=0,Y=N.size();Y>_;_++)if(U=N.getChildAt(_),yr(U)&&Pm(U))return!0;return N.hasAgentEdges()},Oc=function($){if(!$)return o;for(var C=$._parent;zi(C);){if(!zi(C._parent))return C.isExpanded()?$:C;C.isExpanded()||($=C),C=C._parent}return $},Rf=function(W,H){if(!W||!H)return o;var $,P,s,X=bp(W),v=bp(H);if(X!==v){for(;v&&X!==v;)v=bp(v);if(X===v)return W;$=new Uh,$.add(W,0);for(var x=W._parent;yr(x)&&!H.isDescendantOf(x);)$.add(x,0),x=x._parent;for(s=$.size(),P=0;s>P;P++){var c=$.get(P);if(zi(c)&&!c.isExpanded())return c;if(c.ISubGraph)return c}return W}return W},Ki=function(r){if(r.isLooped())return r._source;var L=Oc(r._source),w=Oc(r._target);return L===w?r._source:Rf(L,w)},cq=function(r){if(r.isLooped())return r._target;var j=Oc(r._source),Z=Oc(r._target);return j===Z?r._target:Rf(Z,j)},ss=function(S,f,o){"target"!==o&&(o="source");var n="target"===o?f.getTargetAgent():f.getSourceAgent(),G="edge."+o+".";if(ps(n)){var I=S.getDataUI(n);I._79o();var t=f.s(G+"index");if(t!==C){var P=Op(I);return P[Math.max(0,Math.min(t,P.length-1))]}var E=f.s(G+"percent")||0;E=Math.max(0,Math.min(E,1));var J=Ol(I);return pf(J,100*E)}return tm(S,n,f.s(G+"position"),f.s(G+"offset.x"),f.s(G+"offset.y"),f.s(G+"anchor.x"),f.s(G+"anchor.y"))},tm=function(K,H,q,R,m,t,p){if(!H)return o;var Z,s=H.getRotation?H.getRotation():0;if(t!==C||p!==C)if(t=t===C?.5:t,p=p===C?.5:p,s&&!ad(H,K)){var a=H.getPosition(),B=H.getWidth(),w=H.getHeight(),f=H.getAnchor(),U=H.getScale(),u=new Tr(s,a.x,a.y,U.x,U.y);q=u.tf((t-f.x)*B,(p-f.y)*w)}else Z=Pe(K,H),q={x:Z.x+t*Z.width,y:Z.y+p*Z.height};else q=dm(q,Pe(K,H));if(s){var D=i(s),d=F(s),c=R*D-m*d;m=R*d+m*D,R=c}return q.x+=R,q.y+=m,q},mb=function(l,O){if(!l||!O)return o;var b,g,K,S,m,W;if(l===O){if(S=l.getLoopedEdges(),!S)return o;S=new Uh(S)}else{if(m=l.getAgentEdges(),W=O.getAgentEdges(),!m||!W)return o;for(g=m.size(),b=0;g>b;b++)K=m.get(b),W.contains(K)&&(S||(S=new Uh),S.add(K))}if(S)for(b=0;b<S.size();b++)K=S.get(b),K.getStyle(Xq)===_g&&(K._22I(o),S.removeAt(b),b--);return S},Vq=function(j,X){var n=mb(j,X);if(n&&!n.isEmpty()){if(1===n.size())return n.get(0)._22I(o),void 0;var s=new Uh,f=new Uh;n.each(function(g){var v=g.s("edge.group");s.contains(v)||s.add(v)}),s.sort(),s.each(function(I){f.add(new M.EdgeGroup(n.toList(function(l){return I===l.s("edge.group")}),f))}),f.each(function(V){V.each(function(G){G._22I(V)})})}},Xh=function(h,M){if(M){var Q=M.rect,j=M.color,Z=M.rotation,$=M.labelWidth,V=M.background,A=M.opacity,D=M.scale,X=D!=o&&1!==D;if(A!=o){var C=h.globalAlpha;h.globalAlpha*=A}if(Z||X){h.save();var P=Q.x+Q.width/2,W=Q.y+Q.height/2;Ii(h,P,W),Z&&Gg(h,Z),X&&h.scale(D,D),Ii(h,-P,-W)}if(V&&Ql(h,Q.x,Q.y,Q.width,Q.height,V),$){var G=Q.width,v=h.createLinearGradient(Q.x,Q.y,Q.x+G,Q.y);v.addColorStop(0,j),v.addColorStop(.9,j),v.addColorStop(1,Qj),j=v,Q.width=$}Mm(h,M.ss,Q,M.font,j,M.align),$&&(Q.width=G),(Z||X)&&h.restore(),A!=o&&(h.globalAlpha=C)}},$d=function(Z,b){if(b){var t=b.rect,q=t.x,c=t.y,a=t.width,I=t.height,S=b.background,H=b.backgroundImage,G=b.borderWidth,U=b.borderColor,w=b.labelWidth,k=b.opacity,M=b.scale,P=M!=o&&1!==M;if(k!=o){var F=Z.globalAlpha;Z.globalAlpha*=k}if(P){Z.save();var R=t.x+t.width/2,u=t.y+t.height/2;Ii(Z,R,u),Z.scale(M,M),Ii(Z,-R,-u)}if(b.expanded){var O=m(8,a/4),N=c+I-8;if(Z.fillStyle=S,Z.beginPath(),Z.moveTo(q,c),Z.lineTo(q,N),Z.lineTo(q+a/2,N),Z.lineTo(q+a/2,c+I),Z.lineTo(q+a/2+O,N),Z.lineTo(q+a,N),Z.lineTo(q+a,c),Z.closePath(),Z.fill(),G&&(Z.lineWidth=G,Z.lineJoin="round",Z.lineCap="round",U?(Z.strokeStyle=U,Z.stroke()):(Z.strokeStyle=nd(S),Z.beginPath(),Z.moveTo(q+a,c),Z.lineTo(q+a,N),Z.lineTo(q+a/2+O,N),Z.lineTo(q+a/2,c+I),Z.stroke(),Z.strokeStyle=Rl(S),Z.beginPath(),Z.moveTo(q+a,c),Z.lineTo(q,c),Z.lineTo(q,N),Z.lineTo(q+a/2,N),Z.lineTo(q+a/2,c+I),Z.stroke())),H)im(Z,Wl(H),dg,t.x,t.y,t.width,t.height-8,b.data,b.view);else{if(t.height-=8,S=b.color,w){var L=a,T=Z.createLinearGradient(q,c,q+L,c);T.addColorStop(0,S),T.addColorStop(.9,S),T.addColorStop(1,Qj),S=T,t.width=w}Mm(Z,b.ss,t,b.font,S,b.align),w&&(t.width=L),t.height+=8}}else if(b.icon)Rm(Z,Wl(b.icon),q,c,a,I,b.data,b.view);else{var y=a/2;G&&(Z.lineWidth=G,Z.lineJoin="round",Z.lineCap="round",Z.strokeStyle=U?U:nd(S),Z.beginPath(),Z.arc(q+y,c+y,y,A,1.6*s,!0),Z.moveTo(q+y,c+I),Z.lineTo(q+a-y/5,c+y),Z.stroke(),Z.strokeStyle=U?U:Rl(S),Z.beginPath(),Z.arc(q+y,c+y,y,1.6*s,A,!0),Z.moveTo(q+y,c+I),Z.lineTo(q+y/5,c+y),Z.stroke()),Z.fillStyle=S,Z.beginPath(),Z.arc(q+y,c+y,y,0,g,!0),Z.moveTo(q+y,c+I),Z.lineTo(q+a-y/5,c+y),Z.lineTo(q+y/5,c+y),Z.closePath(),Z.fill(),Z.fillStyle=b.color,Z.beginPath(),Z.arc(q+y,c+y,y/3,0,g,!0),Z.fill()}P&&Z.restore(),k!=o&&(Z.globalAlpha=F)}},gq=function(g,i){return i>2*g?g:i/2},vo=function(v,X,f,q){if(!v||!X)return 0;var d=h(X.y-v.y,X.x-v.x);return f||(d=X.x<v.x?d+s:d),d+q},Xr=function(o,y,w,s,U,G,E){E&&(o.x>y.x||o.x===y.x&&o.y>y.y)&&(w=Nc[w],U=-U);var V=dm(w,{x:0,y:0,width:$q(o,y),height:0},G);return V.x+=s,V.y+=U,V=new Tr(h(y.y-o.y,y.x-o.x)).tf(V),V.x+=o.x,V.y+=o.y,V},Sk=function(H,u,d,X,M){if(H._19Q=!0,!d.getEdgeGroup())return X?d.s("edge.gap"):0;if(ps(d.getSourceAgent())||ps(d.getTargetAgent()))return 0;var r,C=0,o=0,y=0;if(d.getEdgeGroup().getSiblings().each(function(z){z.each(function(v){if(u.isVisible(v)&&v.s(Xq)==M){var w=v.s("edge.gap");r?(o+=y/2+w/2,y=w):(r=v,y=w),v===d&&(C=o)}})}),X)return o-C+y;var E=C-o/2;return r&&d._40I!==r._40I&&(H._19Q=!1),E},zr=function(){var f=function(s){var T=[];return s.forEach(function(O){T.push({x:O.x,y:O.y}),T.push({x:O.x+O.width,y:O.y+O.height}),T.push({x:O.x+O.width,y:O.y}),T.push({x:O.x,y:O.y+O.height})}),T};return function(O,Y,t){if("oval"===O){var X=0,g=t.height/t.width,Z=g*g,G=t.x+t.width/2,V=t.y+t.height/2,j=f(Y);j.forEach(function(e){var U=e.x-G,K=e.y-V,u=U*U+K*K/Z;u>X&&(X=u)}),X=u(X);var n=g*X;return{x:G-X,y:V-n,width:2*X,height:2*n}}if("circle"===O){var A=0,G=t.x+t.width/2,V=t.y+t.height/2,j=f(Y);return j.forEach(function(v){var z=v.x-G,D=v.y-V,e=z*z+D*D;e>A&&(A=e)}),A=u(A),{x:G-A,y:V-A,width:2*A,height:2*A}}return"roundRect"===O?(Bi(t,m(t.width,t.height)/16),t):t}}(),nk=M.graph={},vc=function(r,T,I){_p(K+".graph."+r,T,I)};M.layout={};var Vd={},Wq=function(S,_,L,F,X,b,l,i){var t=[_.uuid,Math.round(F),Math.round(X),L].join("_");_.cacheRule&&(t+=Bs(_.cacheRule,b,l));var I=l._zoom;I!==l._cacheZoom&&(l._cacheZoom=I,l._cacheImage={});var c=l._cacheImage[t];return c||(c=l._cacheImage[t]=M.Default.toCanvas(_,F*I,X*I,L,b,l,i)),c};Iq(w,{setImageCacheRule:function(N,p){var B;B=p||"object"!=typeof N?{_image:p}:N;for(var g in B){var b=B[g];pl(g)?(_p=Wl(g),_p?_p.cacheRule=b:Vd[g]=b):g.cacheRule=b}}});var $i={comps:[{type:Dg,points:[85,50,70,115,100,71,86,107,88,49,47,82,84,47,57,55,52,107,110,69,112,55,50,81,86,98,115,69,106,111,79,112,100,107,75,119,56,50,71,87,53,98,115,61],borderWidth:1,borderColor:o}]};if($i[lk]=$i[$e]=160,P.Image){var Xb=new P.Image;Xb.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",ji("default_blank",Xb)}ji("node_image",Ei(30,30,[{type:jo,rect:[4,5,22,16],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[2,3,26,20],borderWidth:1,borderColor:Nh},{type:jo,rect:[11,23,8,4],background:Nh},{type:jo,rect:[6,27,18,2],background:Nh}])),ji("node_icon",Ei(16,16,[{type:jo,rect:[2,2,12,10],gradient:Xj,gradientColor:em,background:Nh},{type:Vp,rect:[2,2,12,10],width:1,color:Nh},{type:jo,rect:[6,12,4,2],background:Nh},{type:jo,rect:[4,14,8,1],background:Nh}])),ji("block_icon",Ei(16,16,[{type:Vp,rect:[1,1,14,14],width:1,color:Nh}])),ji("group_image",Ei(66,39,[{type:jo,rect:[44.3,18,18.1,12.8],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[3.3,17.8,18.1,12.8],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Nh,gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[26.2,29.4,12.8,4.2],background:Nh},{type:jo,rect:[21.3,33.5,22.5,2.3],background:Nh},{type:jo,rect:[5.3,32.7,14.1,2.1],background:Nh},{type:jo,rect:[9,30.4,6.7,2.4],background:Nh},{type:jo,rect:[50,30.7,6.7,2.4],background:Nh},{type:jo,rect:[46.3,33,14.1,2.1],background:Nh}])),ji("group_icon",Ei(16,16,[{type:jo,rect:[4,12,4,2],background:Nh},{type:jo,rect:[2,13,8,1],background:Nh},{type:jo,rect:[12,12,2,1],background:Nh},{type:jo,rect:[11,13,4,1],background:Nh},{type:jo,rect:[10,7,6,5],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[1,2,10,10],gradient:Xj,gradientColor:em,background:Nh},{type:Vp,rect:[1,2,10,10],width:1,color:Nh}])),ji("refGraph_icon",Ei(16,16,[{type:"shape",borderWidth:1,borderColor:Nh,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Nh,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),ji("edge_icon",Ei(16,16,[{type:jo,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[10.8,1,4,4],background:Nh},{type:jo,rect:[1,11,4,4],background:Nh}])),ji("subGraph_image",Ei(72,45,[{type:Dg,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[29.6,30.7,3.6,1.8],background:Nh},{type:jo,rect:[28.4,32.3,6,1.2],background:Nh},{type:jo,rect:[37.3,32,10.8,1.8],background:Nh},{type:jo,rect:[39.1,29.9,7.2,2.3],background:Nh},{type:jo,rect:[26.6,23.7,9.6,7.2],gradient:Xj,gradientColor:em,background:Nh},{type:jo,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Nh,gradient:Xj,gradientColor:em,background:Nh}])),ji("subGraph_icon",Ei(17,17,[{type:Dg,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:Xj,gradientColor:em,background:Nh}])),ji("shape_icon",Ei(16,16,[{type:Dg,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Nh}])),ji("polyline_icon",Ei(16,16,[{type:Dg,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Nh},sq(7.5,.4),sq(7.5,6.3),sq(13.6,6.3),sq(13.6,14),sq(.7,13.9),sq(.7,.3)])),ji("grid_icon",Ei(16,16,[{type:jo,rect:[1,1,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[6,1,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[11,1,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[11,6,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[6,6,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[1,6,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[11,11,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[6,11,4,4],background:Nh,gradient:Xj,gradientColor:em},{type:jo,rect:[1,11,4,4],background:Nh,gradient:Xj,gradientColor:em}])),ji("light_icon",Ei(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Nh},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Nh,gradient:Xj,gradientColor:em,background:{func:function(T){var C=T?T.s(lc):o;
return Ef(C)?"rgb("+z(255*C[0])+","+z(255*C[1])+","+z(255*C[2])+")":C||Nh}}}])),ji("text_icon",Ei(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Nh}])),ji("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),ji("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),ji("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),ji("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var so=function(G,k,w,$,E,S){var Z,z,F,r,A,h,N,X,L,u,C,x=[];if(Math.abs($)>2*Math.PI&&($=2*Math.PI),A=Math.ceil(Math.abs($)/(Math.PI/4)),Z=$/A,z=-Z,F=-w,A>0){h=G+Math.cos(w)*E,N=k+Math.sin(-w)*S,x.push({x:h,y:N});for(var j=0;A>j;j++)F+=z,r=F-z/2,X=G+Math.cos(F)*E,L=k+Math.sin(F)*S,u=G+Math.cos(r)*(E/Math.cos(z/2)),C=k+Math.sin(r)*(S/Math.cos(z/2)),x.push({x:u,y:C}),x.push({x:X,y:L})}return x},ic=function(q){if(q){var $=q._data;if($ instanceof M.Shape)return{points:$.getPoints(),segments:$.getSegments()};var z;if($ instanceof M.Edge&&(z=q._78o)){var m,j,_=z.type,n=z.points,k=z.segments,t=z.edgeTypeInfo;if(!_||n){var h=z.sourcePoint,o=h.x,s=h.y,B=z.targetPoint,I=B.x,C=B.y;if(_)k?(m=new Uh({x:o,y:s}),m.addAll(n),m.add({x:I,y:C}),j=new Uh(k._as)):(m=new Uh({x:o,y:s}),n.each(function(n){m.add(n)}),m.add({x:I,y:C}));else if(z.looped){m=new Uh(so(o,s,0,2*Math.PI,z.radius,z.radius)),j=new Uh([1]);for(var S=0;S<(m.size()-1)/2;S++)j.add(3)}else m=new Uh,z.center?(m.add({x:z.c1.x,y:z.c1.y}),m.add({x:o,y:s}),m.add({x:I,y:C}),m.add({x:z.c2.x,y:z.c2.y})):(m.add({x:o,y:s}),m.add({x:I,y:C}))}else t&&(m=new Uh(t.points._as),t.segments&&(j=new Uh(t.segments._as)));return{points:m,segments:j}}}},Ol=function(H,D,N){if(null==D){var x=ic(H);if(!x)return;D=x.points,N=x.segments}if(D){if(Array.isArray(D)&&(D=new Uh(D)),"number"==typeof D.get(0)){for(var K=new M.List,B=0;B<D.size();B+=2)K.add({x:D.get(B),y:D.get(B+1)});D=K}if(!N){N=[1];for(var p=D.length-1;p>0;p--)N.push(2)}Array.isArray(N)&&(N=new Uh(N));for(var n=we(D._as,N._as,50),d=n.length,e=[],B=0;d>B;B++){var L=n[B];L.length>1&&e.push(L)}return e}},Lq=function(D){for(var P=0,v=D.length-1,N=0;v>N;N++){var m=D[N],a=D[N+1],z=a.x-m.x,s=a.y-m.y;P+=Math.sqrt(z*z+s*s)}return P},Yk=function(f,I){for(var K=0,T=I.length,i=0;T>i;i++){var H=I[i];if(K+=H,K>f)return i}return Math.min(i,T-1)},pk=function(g,R){for(var k=0,j=0,F=0,r=g.length-1,J=0;r>J;J++){var h=g[J],m=g[J+1],G=m.x-h.x,d=m.y-h.y;if(F=Math.sqrt(G*G+d*d),k+=F,k>R){k-=F,j=J;break}}var H=g[j],D=g[j+1],u=Math.atan2(D.y-H.y,D.x-H.x),a=R-k,d=Math.sin(u)*a,G=Math.cos(u)*a;return{x:H.x+G,y:H.y+d}},pf=function(s,K){if(s){var t;if(0===K)t=s[0][0];else if(100===K)s=s[s.length-1],t=s[s.length-1];else{for(var i=0,M=[],U=s.length,W=0;U>W;W++){var Y=s[W],v=Lq(Y);i+=v,M.push(v)}for(var F=i*K/100,T=Yk(F,M),$=0,Q=0;T>Q;Q++)$+=M[Q];F-=$,t=pk(s[T],F)}return t}},Op=function(S){var R,w,Y,Z,g=ic(S),u=[],f=g.points,I=g.segments,P=-1;for(w=0,Y=I?I.length:f.length;Y>w;w++){if(R=I?I.get(w):1,3===R)Z=2;else if(4===R)Z=3;else{if(5===R)continue;Z=1}P+=Z,u.push(f.get(P))}return u},zn=function(h,k,c,A){function i(x){if(x>=0&&1>=x){L=k(x);var w=(h.x-L.x)*(h.x-L.x)+(h.y-L.y)*(h.y-L.y);return Z>w?(Z=w,U=x,!0):!1}}c=c||100,A=A||1e-5;for(var Z=1/0,U=0,L=new Ym,j=0;c>j;++j)i(j/c);for(var r=1/(2*c);r>A;)i(U-r)||i(U+r)||(r/=2);return U};Iq(w,{_edgeProtectMethod:{getStraightLinePoints:Ol,calculateLineLength:Lq,calcSegmentIndexByDistance:Yk,calculatePointAlongLine:pk,getPercentPosition:pf}});var vh=function(J,v){for(var i=J.vertices,H=0;H<i.length;H++){var r=i[H],j=r.y;r.y=r.z,r.z=-j,v&&(r.y+=v)}},Wr=function(x){for(var Y,B,j,c,v,s,Q=[],J=[],z=[],G=x.faces,E=0,U=0,e=0,$=G.length;$>E;E++,U+=6,e+=9){var r=G[E];1===r.i?(Y||(Y=[],B=[],j=[]),Ic(r,E,U,e,x,Y,j,B)):2===r.i?(c||(c=[],v=[],s=[]),Ic(r,E,U,e,x,c,s,v)):Ic(r,E,U,e,x,Q,z,J)}return{vs:Q,uv:J,ns:z,top_vs:Y,top_uv:B,top_ns:j,bottom_vs:c,bottom_uv:v,bottom_ns:s}},Ic=function(G,C,e,I,h,M,K,r){var D=h.vertices,_=h.faceVertexUvs,n=D[G.a],U=D[G.b],x=D[G.c];M[I]=n.x,M[I+1]=n.y,M[I+2]=n.z,M[I+3]=U.x,M[I+4]=U.y,M[I+5]=U.z,M[I+6]=x.x,M[I+7]=x.y,M[I+8]=x.z;var b=G.vertexNormals;if(3===b.length){var i=b[0],Y=b[1],m=b[2];K[I]=i.x,K[I+1]=i.y,K[I+2]=i.z,K[I+3]=Y.x,K[I+4]=Y.y,K[I+5]=Y.z,K[I+6]=m.x,K[I+7]=m.y,K[I+8]=m.z}else{var z=G.normal;K[I]=z.x,K[I+1]=z.y,K[I+2]=z.z,K[I+3]=z.x,K[I+4]=z.y,K[I+5]=z.z,K[I+6]=z.x,K[I+7]=z.y,K[I+8]=z.z}var X=_[0][C][0],B=_[0][C][1],p=_[0][C][2];r[e]=X.x,r[e+1]=X.y,r[e+2]=B.x,r[e+3]=B.y,r[e+4]=p.x,r[e+5]=p.y},Xk=function(t){var w=t._lineModel;if(w)return w;var c;c=Ef(t)?t:[t];var y,$,D,g,b,H,q,k,e,T,z,J,l=["","top","bottom"];for(w=[],y=0,$=c.length;$>y;y++)for(e=c[y],D=0,g=l.length;g>D;D++)if(q=e[l[D]+"vs"]){k=e[l[D]+"is"],H=k?k.length:q.length/3;for(var b=0;H>b;b+=3)k?(T=k[b],z=k[b+1],J=k[b+2]):(T=b,z=b+1,J=b+2),T*=3,z*=3,J*=3,w.push(q[T],q[T+1],q[T+2],q[z],q[z+1],q[z+2],q[z],q[z+1],q[z+2],q[J],q[J+1],q[J+2],q[J],q[J+1],q[J+2],q[T],q[T+1],q[T+2])}return t._lineModel=w,w},qi=function(C,P,$,k,q,j,d,L,I){$==o&&($=!0),k==o&&(k=!0),d==o&&(d=1),L==o&&(L=0);var t=new _o;return _f(t,C,P,I),t=t.toShapes(),Wr(new Cd(t,{top:$,bottom:k,curveSegments:q,amount:d,repeatUVLength:j},-d/2+L))},As=function(Z,I){this.x=Z||0,this.y=I||0};As.prototype={constructor:As,add:function(Y){return this.x+=Y.x,this.y+=Y.y,this},sub:function(C){return this.x-=C.x,this.y-=C.y,this},equals:function(e){return e.x===this.x&&e.y===this.y},multiplyScalar:function(X){return this.x*=X,this.y*=X,this},distanceTo:function(Q){return u(this.distanceToSquared(Q))},distanceToSquared:function(i){var j=this.x-i.x,Z=this.y-i.y;return j*j+Z*Z},clone:function(){return new As(this.x,this.y)}};var Bk=function(i,H,w){this.x=i||0,this.y=H||0,this.z=w||0};Bk.prototype={constructor:Bk,set:function(H,F,i){return this.x=H,this.y=F,this.z=i,this},setY:function(r){return this.y=r,this},copy:function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this},add:function(J){return this.x+=J.x,this.y+=J.y,this.z+=J.z,this},addVectors:function(c,T){return this.x=c.x+T.x,this.y=c.y+T.y,this.z=c.z+T.z,this},sub:function(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this},subVectors:function(R,E){return this.x=R.x-E.x,this.y=R.y-E.y,this.z=R.z-E.z,this},multiplyScalar:function(L){return this.x*=L,this.y*=L,this.z*=L,this},applyMatrix4:function(O){var e=this.x,h=this.y,R=this.z,i=O.elements;return this.x=i[0]*e+i[4]*h+i[8]*R+i[12],this.y=i[1]*e+i[5]*h+i[9]*R+i[13],this.z=i[2]*e+i[6]*h+i[10]*R+i[14],this},divideScalar:function(e){if(0!==e){var R=1/e;this.x*=R,this.y*=R,this.z*=R}else this.x=0,this.y=0,this.z=0;return this},dot:function(O){return this.x*O.x+this.y*O.y+this.z*O.z},length:function(){return u(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(h){var B=this.x,T=this.y,X=this.z;return this.x=T*h.z-X*h.y,this.y=X*h.x-B*h.z,this.z=B*h.y-T*h.x,this},crossVectors:function(L,S){var z=L.x,m=L.y,K=L.z,s=S.x,W=S.y,O=S.z;return this.x=m*O-K*W,this.y=K*s-z*O,this.z=z*W-m*s,this},distanceTo:function(I){return u(this.distanceToSquared(I))},distanceToSquared:function(x){var J=this.x-x.x,M=this.y-x.y,N=this.z-x.z;return J*J+M*M+N*N},clone:function(){return new Bk(this.x,this.y,this.z)}};var qe=function(){this.elements=new Float32Array(16)};qe.prototype={constructor:qe,set:function(K,f,T,$,_,P,e,q,x,l,t,p,G,J,b,h){var Q=this.elements;return Q[0]=K,Q[4]=f,Q[8]=T,Q[12]=$,Q[1]=_,Q[5]=P,Q[9]=e,Q[13]=q,Q[2]=x,Q[6]=l,Q[10]=t,Q[14]=p,Q[3]=G,Q[7]=J,Q[11]=b,Q[15]=h,this},makeRotationAxis:function(q,K){var d=i(K),D=F(K),t=1-d,L=q.x,J=q.y,U=q.z,l=t*L,b=t*J;return this.set(l*L+d,l*J-D*U,l*U+D*J,0,l*J+D*U,b*J+d,b*U-D*L,0,l*U-D*J,b*U+D*L,t*U*U+d,0,0,0,0,1),this}};var Sq=function(v){this.repeatUVLength=v};Sq.prototype={generateTopUV:function(q,u,L,i,z,_,m){var n,K,f,O,d=q.vertices,D=d[i].x,J=d[i].y,I=d[z].x,e=d[z].y,x=d[_].x,Y=d[_].y,w=this.repeatUVLength;if(w)n=0,K=0,f=w,O=w;else{this._bb||(this._bb=u.getBoundingBox());var Q=this._bb;n=Q.minX,K=Q.minY,f=Q.maxX-n,O=Q.maxY-K}return m?[new As((D-n)/f,(J-K)/O),new As((I-n)/f,(e-K)/O),new As((x-n)/f,(Y-K)/O)]:[new As((D-n)/f,1-(J-K)/O),new As((I-n)/f,1-(e-K)/O),new As((x-n)/f,1-(Y-K)/O)]},generateBottomUV:function(_,T,q,G,n,l){return this.generateTopUV(_,T,q,G,n,l,!0)},generateSideWallUV:function(p,l,c,k,N,E,j,g,m,_,P,b){if(!this._cl){for(var C,x,t=[],h=0,y=c.length,F=0;y>F;F++){C=c[F],x=c[(F+1)%y];var Q=C.x-x.x,$=C.y-x.y,i=u(Q*Q+$*$);t.push(h),h+=i}for(var F=0;y>F;F++)t[F]/=h;this._cl=t}var t=this._cl,U=1-m/_,T=1-(m+1)/_,r=t[P],W=t[b];return W>r&&(r+=1),[new As(r,U),new As(W,U),new As(W,T),new As(r,T)]}};var Vj=function(u,M,x,s,W,N){this.a=u,this.b=M,this.c=x,this.i=N,this.normal=s instanceof Bk?s:new Bk,this.vertexNormals=s instanceof Array?s:[]};Vj.prototype={constructor:Vj};var Ac=[-8,13,-1,10,1,5,4,8,-1],In=function(){if(In[mg]!=o)return In[mg];for(var z=Mq[mg],M=Ac,p=un.prototype.getClassName(),Q='"',E=0,w="",Y=!1,_=+new(P[p.substr(3,3)+wk[E]]),h=E;h<M.length;h++){var I=M.length-h;w+=h%2===E?M[h]+I+"":M[h]-I+""}for(var h=E;4>h;h++)w+=E;if(w=w*w.length/w.length,_>w){if(z){for(var c,n,g,L,C,y,R,i,l="",N=0,h=0;h<z.length;h++)z[h]===Q?i?(i=!1,0!==N%2&&(c==o?c=l:n==o?n=l:g==o?g=l:L==o?L=l:C==o?C=l:y==o?y=l:R==o&&(R=l)),N++,l=""):i=!0:i&&(l+=z[h]);var k=c+n+g+L+C+y;(Y=Aj(k,R)&&(!y||y.indexOf(rd)>=0)&&(!C||C>_))&&g.indexOf(Vc[0])>=0&&(In[Vc[0]]=1),Y&&g.indexOf(1)>=0&&(In[1]=1),Y&&g.indexOf(2)>=0&&(In[2]=1)}}else Y=!0,In[Vc[0]]=In[1]=In[2]=1;return In[mg]=Y,Y},Xf=function(){},$f=Xf.prototype;$f.getPointAt=function(s){var L=this.getUtoTmapping(s);return this.getPoint(L)},$f.getPoints=function(f){f||(f=5);var M,E=[];for(M=0;f>=M;M++)E.push(this.getPoint(M/f));return E},$f.getSpacedPoints=function(b){b||(b=5);var M,u=[];for(M=0;b>=M;M++)u.push(this.getPointAt(M/b));return u},$f.getLength=function(){var c=this.getLengths();return c[c.length-1]},$f.getLengths=function(X){if(X||(X=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==X+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var d,b,T=[],t=this.getPoint(0),O=0;for(T.push(0),b=1;X>=b;b++)d=this.getPoint(b/X),O+=d.distanceTo(t),T.push(O),t=d;return this.cacheArcLengths=T,T},$f.getUtoTmapping=function(l,I){var G,w=this.getLengths(),N=0,d=w.length;G=I?I:l*w[d-1];for(var A,O=0,Q=d-1;Q>=O;)if(N=y(O+(Q-O)/2),A=w[N]-G,0>A)O=N+1;else{if(!(A>0)){Q=N;break}Q=N-1}if(N=Q,w[N]==G){var S=N/(d-1);return S}var z=w[N],Y=w[N+1],o=Y-z,U=(G-z)/o,S=(N+U)/(d-1);return S},$f.getTangent=function(M){var r=1e-4,l=M-r,y=M+r;0>l&&(l=0),y>1&&(y=1);var e=this.getPoint(l),m=this.getPoint(y),p=m.clone().sub(e);return p.normalize()},$f.getTangentAt=function(o){var p=this.getUtoTmapping(o);return this.getTangent(p)},Xf.create=function(o,e){return o.prototype=ug(Xf.prototype),o.prototype.getPoint=e,o};var Gl=function(){this.curves=[],this.autoClose=!1},oi=Gl.prototype=ug($f);oi.add=function(c){this.curves.push(c)},oi.closePath=function(){var l=this.curves[0].getPoint(0),u=this.curves[this.curves.length-1].getPoint(1);l.equals(u)||this.curves.push(new wc(u,l))},oi.getPoint=function(A){for(var Q,d,r=A*this.getLength(),X=this.getCurveLengths(),G=0;G<X.length;){if(X[G]>=r){Q=X[G]-r,d=this.curves[G];var w=1-Q/d.getLength();return d.getPointAt(w)}G++}return null},oi.getLength=function(){var M=this.getCurveLengths();return M[M.length-1]},oi.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var g,N=[],j=0,E=this.curves.length;for(g=0;E>g;g++)j+=this.curves[g].getLength(),N.push(j);return this.cacheLengths=N,N},oi.getTransformedPoints=function(k){return this.getPoints(k)},oi.getBoundingBox=function(){var w,z,r,l,o,B,X=this.getPoints();w=z=Number.NEGATIVE_INFINITY,l=o=Number.POSITIVE_INFINITY;var q,s,F,m,K=X[0]instanceof Bk;for(m=K?new Bk:new As,s=0,F=X.length;F>s;s++)q=X[s],q.x>w&&(w=q.x),q.x<l&&(l=q.x),q.y>z&&(z=q.y),q.y<o&&(o=q.y),K&&(q.z>r&&(r=q.z),q.z<B&&(B=q.z)),m.add(q);var f={minX:l,minY:o,maxX:w,maxY:z};return K&&(f.maxZ=r,f.minZ=B),f};var Ir=function(d){Gl.call(this),this.actions=[],d&&this.fromPoints(d)},Cg=Ir.prototype=ug(Gl.prototype),xe="moveTo",Sb="lineTo",kd="quadraticCurveTo",pe="bezierCurveTo",hr="arc",Te="ellipse";Cg.fromPoints=function(y){this.moveTo(y[0].x,y[0].y);for(var F=1,X=y.length;X>F;F++)this.lineTo(y[F].x,y[F].y)},Cg.moveTo=function(){var o=Array.prototype.slice.call(arguments);this.actions.push({action:xe,args:o})},Cg.lineTo=function(d,b){var V=Array.prototype.slice.call(arguments),N=this.actions[this.actions.length-1].args,F=N[N.length-2],H=N[N.length-1],z=new wc(new As(F,H),new As(d,b));this.curves.push(z),this.actions.push({action:Sb,args:V})},Cg.quadraticCurveTo=function(R,V,v,D){var A=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,H=h[h.length-2],m=h[h.length-1],Z=new Qg(new As(H,m),new As(R,V),new As(v,D));this.curves.push(Z),this.actions.push({action:kd,args:A})},Cg.bezierCurveTo=function(G,L,$,f,S,m){var w=Array.prototype.slice.call(arguments),v=this.actions[this.actions.length-1].args,X=v[v.length-2],j=v[v.length-1],a=new Jo(new As(X,j),new As(G,L),new As($,f),new As(S,m));this.curves.push(a),this.actions.push({action:pe,args:w})},Cg.arc=function(g,n,f,d,_,m){var Q=this.actions[this.actions.length-1].args,v=Q[Q.length-2],N=Q[Q.length-1];this.absarc(g+v,n+N,f,d,_,m)},Cg.absarc=function(C,Q,i,k,Z,p){this.absellipse(C,Q,i,i,k,Z,p)},Cg.ellipse=function(v,z,f,G,c,q,u){var $=this.actions[this.actions.length-1].args,W=$[$.length-2],C=$[$.length-1];this.absellipse(v+W,z+C,f,G,c,q,u)},Cg.absellipse=function(z,j,f,K,s,E,A){var W=Array.prototype.slice.call(arguments),x=new Lh(z,j,f,K,s,E,A);this.curves.push(x);var G=x.getPoint(1);W.push(G.x),W.push(G.y),this.actions.push({action:Te,args:W})},Cg.getSpacedPoints=function(d){d||(d=40);for(var $=[],O=0;d>O;O++)$.push(this.getPoint(O/d));return $},Cg.getPoints=function(K,a){K=K||12;var Y,P,_,h,s,B,r,S,f,l,C,O,W,c,V,o,G,I,b=[];for(Y=0,P=this.actions.length;P>Y;Y++)switch(_=this.actions[Y],h=_.action,s=_.args,h){case xe:b.push(new As(s[0],s[1]));break;case Sb:b.push(new As(s[0],s[1]));break;case kd:for(B=s[2],r=s[3],l=s[0],C=s[1],b.length>0?(c=b[b.length-1],O=c.x,W=c.y):(c=this.actions[Y-1].args,O=c[c.length-2],W=c[c.length-1]),V=1;K>=V;V++)o=V/K,G=bg.b2(o,O,l,B),I=bg.b2(o,W,C,r),b.push(new As(G,I));break;case pe:for(B=s[4],r=s[5],l=s[0],C=s[1],S=s[2],f=s[3],b.length>0?(c=b[b.length-1],O=c.x,W=c.y):(c=this.actions[Y-1].args,O=c[c.length-2],W=c[c.length-1]),V=1;K>=V;V++)o=V/K,G=bg.b3(o,O,l,S,B),I=bg.b3(o,W,C,f,r),b.push(new As(G,I));break;case hr:var x,H=s[0],t=s[1],m=s[2],N=s[3],J=s[4],k=!!s[5],w=J-N,j=2*K;for(V=1;j>=V;V++)o=V/j,k||(o=1-o),x=N+o*w,G=H+m*i(x),I=t+m*F(x),b.push(new As(G,I));break;case Te:var x,H=s[0],t=s[1],Q=s[2],E=s[3],N=s[4],J=s[5],k=!!s[6],w=J-N,j=2*K;for(V=1;j>=V;V++)o=V/j,k||(o=1-o),x=N+o*w,G=H+Q*i(x),I=t+E*F(x),b.push(new As(G,I))}var y=b[b.length-1],D=1e-10;return T(y.x-b[0].x)<D&&T(y.y-b[0].y)<D&&b.splice(b.length-1,1),a&&b.push(b[0]),b},Cg.toShapes=function(L,_){function S(b){var h,T,k,N,U,$=[],Z=new Ir;for(h=0,T=b.length;T>h;h++)k=b[h],U=k.args,N=k.action,N==xe&&0!=Z.actions.length&&($.push(Z),Z=new Ir),Z[N].apply(Z,U);return 0!=Z.actions.length&&$.push(Z),$}function y(c){for(var g=[],_=0,B=c.length;B>_;_++){var n=c[_],o=new _o;o.actions=n.actions,o.curves=n.curves,g.push(o)}return g}function g(H,A){for(var P=1e-10,t=A.length,L=!1,s=t-1,O=0;t>O;s=O++){var o=A[s],c=A[O],u=c.x-o.x,l=c.y-o.y;if(T(l)>P){if(0>l&&(o=A[O],u=-u,c=A[s],l=-l),H.y<o.y||H.y>c.y)continue;if(H.y==o.y){if(H.x==o.x)return!0}else{var G=l*(H.x-o.x)-u*(H.y-o.y);if(0==G)return!0;if(0>G)continue;L=!L}}else{if(H.y!=o.y)continue;if(c.x<=H.x&&H.x<=o.x||o.x<=H.x&&H.x<=c.x)return!0}}return L}var d=S(this.actions);if(0==d.length)return[];if(_===!0)return y(d);var P,V,R,K=[];if(1==d.length)return V=d[0],R=new _o,R.actions=V.actions,R.curves=V.curves,K.push(R),K;var r=!bg.isClockWise(d[0].getPoints());r=L?!r:r;var m,B=[],$=[],j=[],A=0;$[A]=C,j[A]=[];var w,Q;for(w=0,Q=d.length;Q>w;w++)V=d[w],m=V.getPoints(),P=bg.isClockWise(m),P=L?!P:P,P?(!r&&$[A]&&A++,$[A]={s:new _o,p:m},$[A].s.actions=V.actions,$[A].s.curves=V.curves,r&&A++,j[A]=[]):j[A].push({h:V,p:m[0]});if(!$[0])return y(d);if($.length>1){for(var H=!1,G=[],l=0,E=$.length;E>l;l++)B[l]=[];for(var l=0,E=$.length;E>l;l++){$[l];for(var Y=j[l],f=0;f<Y.length;f++){for(var W=Y[f],e=!0,J=0;J<$.length;J++)g(W.p,$[J].p)&&(l!=J&&G.push({froms:l,tos:J,hole:f}),e?(e=!1,B[J].push(W)):H=!0);e&&B[l].push(W)}}G.length>0&&(H||(j=B))}var s,I,q;for(w=0,Q=$.length;Q>w;w++)for(R=$[w].s,K.push(R),s=j[w],I=0,q=s.length;q>I;I++)R.holes.push(s[I].h);return K};var _o=function(){Ir.apply(this,arguments),this.holes=[]},Yj=_o.prototype=ug(Cg);Yj.getPointsHoles=function(T){var n,h=this.holes.length,J=[];for(n=0;h>n;n++)J[n]=this.holes[n].getTransformedPoints(T);return J},Yj.extractAllPoints=function(z){return{shape:this.getTransformedPoints(z),holes:this.getPointsHoles(z)}},Yj.extractPoints=function(t){return this.extractAllPoints(t)};var bg={triangulateShape:function(q,r){function P(G,c,f){return G.x!=c.x?G.x<c.x?G.x<=f.x&&f.x<=c.x:c.x<=f.x&&f.x<=G.x:G.y<c.y?G.y<=f.y&&f.y<=c.y:c.y<=f.y&&f.y<=G.y}function k(O,I,t,Z,h){var V=1e-10,J=I.x-O.x,L=I.y-O.y,e=Z.x-t.x,$=Z.y-t.y,S=O.x-t.x,q=O.y-t.y,z=L*e-J*$,E=L*S-J*q;if(T(z)>V){var j;if(z>0){if(0>E||E>z)return[];if(j=$*S-e*q,0>j||j>z)return[]}else{if(E>0||z>E)return[];if(j=$*S-e*q,j>0||z>j)return[]}if(0==j)return!h||0!=E&&E!=z?[O]:[];if(j==z)return!h||0!=E&&E!=z?[I]:[];if(0==E)return[t];if(E==z)return[Z];var i=j/z;return[{x:O.x+i*J,y:O.y+i*L}]}if(0!=E||$*S!=e*q)return[];var k=0==J&&0==L,D=0==e&&0==$;if(k&&D)return O.x!=t.x||O.y!=t.y?[]:[O];if(k)return P(t,Z,O)?[O]:[];if(D)return P(O,I,t)?[t]:[];var x,Y,v,B,w,c,W,r;return 0!=J?(O.x<I.x?(x=O,v=O.x,Y=I,B=I.x):(x=I,v=I.x,Y=O,B=O.x),t.x<Z.x?(w=t,W=t.x,c=Z,r=Z.x):(w=Z,W=Z.x,c=t,r=t.x)):(O.y<I.y?(x=O,v=O.y,Y=I,B=I.y):(x=I,v=I.y,Y=O,B=O.y),t.y<Z.y?(w=t,W=t.y,c=Z,r=Z.y):(w=Z,W=Z.y,c=t,r=t.y)),W>=v?W>B?[]:B==W?h?[]:[w]:r>=B?[w,Y]:[w,c]:v>r?[]:v==r?h?[]:[x]:r>=B?[x,Y]:[x,c]}function M(k,C,m,N){var q=1e-10,c=C.x-k.x,D=C.y-k.y,E=m.x-k.x,g=m.y-k.y,R=N.x-k.x,f=N.y-k.y,X=c*g-D*E,L=c*f-D*R;if(T(X)>q){var y=R*g-f*E;return X>0?L>=0&&y>=0:L>=0||y>=0}return L>0}function t(G,V){function u(W,Y){var Q=h.length-1,y=W-1;0>y&&(y=Q);var j=W+1;j>Q&&(j=0);var d=M(h[W],h[y],h[j],s[Y]);if(!d)return!1;var p=s.length-1,K=Y-1;0>K&&(K=p);var I=Y+1;return I>p&&(I=0),d=M(s[Y],s[K],s[I],h[W]),d?!0:!1}function L(Z,$){var V,m,J;for(V=0;V<h.length;V++)if(m=V+1,m%=h.length,J=k(Z,$,h[V],h[m],!0),J.length>0)return!0;return!1}function r(Q,p){var q,X,f,G,m;for(q=0;q<$.length;q++)for(X=V[$[q]],f=0;f<X.length;f++)if(G=f+1,G%=X.length,m=k(Q,p,X[f],X[G],!0),m.length>0)return!0;return!1}for(var s,O,D,Q,F,j,T,A,P,I,Y,h=G.concat(),$=[],m=[],p=0,X=V.length;X>p;p++)$.push(p);for(var l=0,J=2*$.length;$.length>0&&(J--,!(0>J));)for(D=l;D<h.length;D++){Q=h[D],O=-1;for(var p=0;p<$.length;p++)if(j=$[p],T=Q.x+":"+Q.y+":"+j,m[T]===C){s=V[j];for(var g=0;g<s.length;g++)if(F=s[g],u(D,g)&&!L(Q,F)&&!r(Q,F)){O=g,$.splice(p,1),A=h.slice(0,D+1),P=h.slice(D),I=s.slice(O),Y=s.slice(0,O+1),h=A.concat(I).concat(Y).concat(P),l=D;break}if(O>=0)break;m[T]=!0}if(O>=0)break}return h}for(var u,U,K,e,i,w,I={},c=q.concat(),B=0,L=r.length;L>B;B++)Array.prototype.push.apply(c,r[B]);for(u=0,U=c.length;U>u;u++)i=c[u].x+":"+c[u].y,I[i]!==C,I[i]=u;var G=t(q,r),O=dh.Triangulate(G,!1);for(u=0,U=O.length;U>u;u++)for(e=O[u],K=0;3>K;K++)i=e[K].x+":"+e[K].y,w=I[i],w!==C&&(e[K]=w);return O.concat()},isClockWise:function(E){return dh.Triangulate.area(E)<0},b2p0:function(e,R){var n=1-e;return n*n*R},b2p1:function(S,O){return 2*(1-S)*S*O},b2p2:function(n,o){return n*n*o},b2:function($,k,R,l){return this.b2p0($,k)+this.b2p1($,R)+this.b2p2($,l)},b3p0:function(R,O){var w=1-R;return w*w*w*O},b3p1:function(M,u){var W=1-M;return 3*W*W*M*u},b3p2:function(n,e){var r=1-n;return 3*r*n*n*e},b3p3:function(r,B){return r*r*r*B},b3:function(y,D,v,s,U){return this.b3p0(y,D)+this.b3p1(y,v)+this.b3p2(y,s)+this.b3p3(y,U)}},dh={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var y=v.keys(this.faces);return y.length?y[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(I){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(c){var a=c.familyName.toLowerCase(),h=this;return h.faces[a]=h.faces[a]||{},h.faces[a][c.cssFontWeight]=h.faces[a][c.cssFontWeight]||{},h.faces[a][c.cssFontWeight][c.cssFontStyle]=c,c},drawText:function(s){var d,B=this.getFace(),z=this.size/B.resolution,f=0,P=String(s).split(""),L=P.length,F=[];for(d=0;L>d;d++){var x=new Ir,T=this.extractGlyphPoints(P[d],B,z,f,x);T&&(f+=T.offset*this.spacing,F.push(T.path))}var R=f/2;return{paths:F,offset:R}},extractGlyphPoints:function(l,h,D,Z,W){var y,E,F,M,w,T,R,q,A,H,Y,e,N,P,a,d,u,v,V,g=[],U=h.glyphs[l]||h.glyphs["?"];if(U){if(U.o)for(M=U._cachedOutline||(U._cachedOutline=U.o.split(" ")),T=M.length,R=D,q=D,y=0;T>y;)switch(w=M[y++]){case"m":A=M[y++]*R+Z,H=M[y++]*q,W.moveTo(A,H);break;case"l":A=M[y++]*R+Z,H=M[y++]*q,W.lineTo(A,H);break;case"q":if(Y=M[y++]*R+Z,e=M[y++]*q,a=M[y++]*R+Z,d=M[y++]*q,W.quadraticCurveTo(a,d,Y,e),V=g[g.length-1])for(N=V.x,P=V.y,E=1,F=this.divisions;F>=E;E++){var _=E/F;bg.b2(_,N,a,Y),bg.b2(_,P,d,e)}break;case"b":if(Y=M[y++]*R+Z,e=M[y++]*q,a=M[y++]*R+Z,d=M[y++]*q,u=M[y++]*R+Z,v=M[y++]*q,W.bezierCurveTo(a,d,u,v,Y,e),V=g[g.length-1])for(N=V.x,P=V.y,E=1,F=this.divisions;F>=E;E++){var _=E/F;bg.b3(_,N,a,u,Y),bg.b3(_,P,d,v,e)}}return{offset:U.ha*D,path:W}}}};dh.generateShapes=function(T,n){n=n||{};var f=n.font;if(f===C&&(f=dh.getDefaultFont(),!f))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var o=n.size!==C?n.size:1,V=n.curveSegments!==C?n.curveSegments:4,p=n.spacing!==C?n.spacing:1,N=n.weight!==C?n.weight:"normal",L=n.style!==C?n.style:"normal";dh.size=o,dh.divisions=V,dh.face=f,dh.weight=N,dh.style=L,dh.spacing=p;for(var h=dh.drawText(T),y=h.paths,G=[],B=0,W=y.length;W>B;B++)Array.prototype.push.apply(G,y[B].toShapes());return G},function(b){var E=1e-10,g=function(s,m){var P=s.length;if(3>P)return null;var U,D,t,V=[],$=[],j=[];if(Y(s)>0)for(D=0;P>D;D++)$[D]=D;else for(D=0;P>D;D++)$[D]=P-1-D;var O=P,B=2*O;for(D=O-1;O>2;){if(B--<=0)return m?j:V;if(U=D,U>=O&&(U=0),D=U+1,D>=O&&(D=0),t=D+1,t>=O&&(t=0),J(s,U,D,t,O,$)){var p,q,G,n,f;for(p=$[U],q=$[D],G=$[t],V.push([s[p],s[q],s[G]]),j.push([$[U],$[D],$[t]]),n=D,f=D+1;O>f;n++,f++)$[n]=$[f];O--,B=2*O}}return m?j:V},Y=function(B){for(var j=B.length,a=0,X=j-1,b=0;j>b;X=b++)a+=B[X].x*B[b].y-B[b].x*B[X].y;return.5*a},J=function(J,Z,y,A,Q,h){var $,O,m,D,d,t,g,z,S;if(O=J[h[Z]].x,m=J[h[Z]].y,D=J[h[y]].x,d=J[h[y]].y,t=J[h[A]].x,g=J[h[A]].y,E>(D-O)*(g-m)-(d-m)*(t-O))return!1;var j,G,B,Y,f,N,b,L,n,u,_,q,R,I,F;for(j=t-D,G=g-d,B=O-t,Y=m-g,f=D-O,N=d-m,$=0;Q>$;$++)if(z=J[h[$]].x,S=J[h[$]].y,!(z===O&&S===m||z===D&&S===d||z===t&&S===g)&&(b=z-O,L=S-m,n=z-D,u=S-d,_=z-t,q=S-g,F=j*u-G*n,R=f*L-N*b,I=B*q-Y*_,F>=-E&&I>=-E&&R>=-E))return!1;return!0};return b.Triangulate=g,b.Triangulate.area=Y,b}(dh),P._typeface_js={faces:dh.faces,loadFace:dh.loadFace};var jl=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Vk=jl.prototype={constructor:jl,computeFaceNormals:function(){for(var F=new Bk,Z=new Bk,h=0,C=this.faces.length;C>h;h++){var M=this.faces[h],P=this.vertices[M.a],e=this.vertices[M.b],r=this.vertices[M.c];F.subVectors(r,e),Z.subVectors(P,e),F.cross(Z),F.normalize(),M.normal.copy(F)}},computeVertexNormals:function(F){var M,m,e,B,C,Z;for(Z=new Array(this.vertices.length),M=0,m=this.vertices.length;m>M;M++)Z[M]=new Bk;if(F){var s,Y,k,X=new Bk,t=new Bk;for(e=0,B=this.faces.length;B>e;e++)C=this.faces[e],s=this.vertices[C.a],Y=this.vertices[C.b],k=this.vertices[C.c],X.subVectors(k,Y),t.subVectors(s,Y),X.cross(t),Z[C.a].add(X),Z[C.b].add(X),Z[C.c].add(X)}else for(e=0,B=this.faces.length;B>e;e++)C=this.faces[e],Z[C.a].add(C.normal),Z[C.b].add(C.normal),Z[C.c].add(C.normal);for(M=0,m=this.vertices.length;m>M;M++)Z[M].normalize();for(e=0,B=this.faces.length;B>e;e++)C=this.faces[e],C.vertexNormals[0]=Z[C.a].clone(),C.vertexNormals[1]=Z[C.b].clone(),C.vertexNormals[2]=Z[C.c].clone()},mergeVertices:function(){var X,q,l,Q,A,y,z,I,K={},i=[],$=[],L=4,n=Y(10,L);for(l=0,Q=this.vertices.length;Q>l;l++)X=this.vertices[l],q=f(X.x*n)+"_"+f(X.y*n)+"_"+f(X.z*n),K[q]===C?(K[q]=l,i.push(this.vertices[l]),$[l]=i.length-1):$[l]=$[K[q]];var d=[];for(l=0,Q=this.faces.length;Q>l;l++){A=this.faces[l],A.a=$[A.a],A.b=$[A.b],A.c=$[A.c],y=[A.a,A.b,A.c];for(var M=0;3>M;M++)if(y[M]==y[(M+1)%3]){d.push(l);break}}for(l=d.length-1;l>=0;l--){var U=d[l];for(this.faces.splice(U,1),z=0,I=this.faceVertexUvs.length;I>z;z++)this.faceVertexUvs[z].splice(U,1)}var Z=this.vertices.length-i.length;return this.vertices=i,Z}},Lh=function(Q,h,$,p,C,V,Z){this.aX=Q,this.aY=h,this.xRadius=$,this.yRadius=p,this.aStartAngle=C,this.aEndAngle=V,this.aClockwise=Z};Lh.prototype=ug($f),Lh.prototype.getPoint=function(G){var Q,D=this.aEndAngle-this.aStartAngle;0>D&&(D+=g),D>g&&(D-=g),Q=this.aClockwise===!0?this.aEndAngle+(1-G)*(g-D):this.aStartAngle+G*D;var I=this.aX+this.xRadius*i(Q),C=this.aY+this.yRadius*F(Q);return new As(I,C)};var wc=function(i,w){this.v1=i,this.v2=w},fo=wc.prototype=ug($f);fo.getPoint=function(P){var w=this.v2.clone().sub(this.v1);return w.multiplyScalar(P).add(this.v1),w},fo.getPointAt=function(_){return this.getPoint(_)},fo.getTangent=function(){var C=this.v2.clone().sub(this.v1);return C.normalize()};var Qg=function(f,N,e){this.v0=f,this.v1=N,this.v2=e};Qg.prototype=ug($f),Qg.prototype.getPoint=function(Z){var H,M;return H=bg.b2(Z,this.v0.x,this.v1.x,this.v2.x),M=bg.b2(Z,this.v0.y,this.v1.y,this.v2.y),new As(H,M)};var Jo=function(K,S,W,e){this.v0=K,this.v1=S,this.v2=W,this.v3=e};Jo.prototype=ug($f),Jo.prototype.getPoint=function(D){var _,f;return _=bg.b3(D,this.v0.x,this.v1.x,this.v2.x,this.v3.x),f=bg.b3(D,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new As(_,f)},Xf.create(function(l,u){this.v1=l,this.v2=u},function(L){var w=new Bk;return w.subVectors(this.v2,this.v1),w.multiplyScalar(L),w.add(this.v1),w});var nr=Xf.create(function(i,I,p){this.v0=i,this.v1=I,this.v2=p},function(Y){var N,w,r;return N=bg.b2(Y,this.v0.x,this.v1.x,this.v2.x),w=bg.b2(Y,this.v0.y,this.v1.y,this.v2.y),r=bg.b2(Y,this.v0.z,this.v1.z,this.v2.z),new Bk(N,w,r)}),Rh=Xf.create(function(k,S,o,p){this.v0=k,this.v1=S,this.v2=o,this.v3=p},function(p){var $,W,c;return $=bg.b3(p,this.v0.x,this.v1.x,this.v2.x,this.v3.x),W=bg.b3(p,this.v0.y,this.v1.y,this.v2.y,this.v3.y),c=bg.b3(p,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Bk($,W,c)}),ng=function(V,s,q,H,d,W,_,O){jl.call(this),H=H!==C?H:.5,d=d!==C?d:.5,O=O!==C?O:1,V=V||8,W=W||0,_=_||g;var U,I,z=1,K=O/2,b=[],v=[],e=this.vertices,A=this.faces,D=this.faceVertexUvs;for(I=0;z>=I;I++){var j=[],p=[],m=I/z,o=m*(d-H)+H;for(U=0;V>=U;U++){var h=U/V,t=new Bk,a=-(h*_+W);t.z=o*F(a),t.y=-m*O+K,t.x=o*i(a),e.push(t),j.push(e.length-1),p.push(new As(h,m))}b.push(j),v.push(p)}var Y,B,f=(d-H)/O;for(U=0;V>U;U++)for(0!==H?(Y=e[b[0][U]].clone(),B=e[b[0][U+1]].clone()):(Y=e[b[1][U]].clone(),B=e[b[1][U+1]].clone()),Y.setY(u(Y.x*Y.x+Y.z*Y.z)*f).normalize(),B.setY(u(B.x*B.x+B.z*B.z)*f).normalize(),I=0;z>I;I++){var y=b[I][U],l=b[I+1][U],k=b[I+1][U+1],n=b[I][U+1],R=Y.clone(),w=Y.clone(),E=B.clone(),Q=B.clone(),X=v[I][U].clone(),G=v[I+1][U].clone(),r=v[I+1][U+1].clone(),N=v[I][U+1].clone();A.push(new Vj(y,l,n,[R,w,Q])),D[0].push([X,G,N]),A.push(new Vj(l,k,n,[w.clone(),E,Q.clone()])),D[0].push([G.clone(),r,N.clone()])}if(s&&H>0)for(this.vertices.push(new Bk(0,K,0)),U=0;V>U;U++){var y=b[0][U],l=b[0][U+1],k=this.vertices.length-1,R=new Bk(0,1,0),w=new Bk(0,1,0),E=new Bk(0,1,0),X=v[0][U].clone(),G=v[0][U+1].clone(),r=new As(G.x,0);A.push(new Vj(y,l,k,[R,w,E],null,1));var c=U/V*g,T=i(c),P=F(c),L=(U+1)/V*g,M=i(L),J=F(L);D[0].push([new As(.5+.5*T,.5+.5*P),new As(.5+.5*M,.5+.5*J),new As(.5,.5)])}if(q&&d>0)for(this.vertices.push(new Bk(0,-K,0)),U=0;V>U;U++){var y=b[I][U+1],l=b[I][U],k=e.length-1,R=new Bk(0,-1,0),w=new Bk(0,-1,0),E=new Bk(0,-1,0),X=v[I][U+1].clone(),G=v[I][U].clone();A.push(new Vj(y,l,k,[R,w,E],null,2));var c=U/V*g,T=i(c),P=F(c),L=(U+1)/V*g,M=i(L),J=F(L);D[0].push([new As(.5+.5*M,.5-.5*J),new As(.5+.5*T,.5-.5*P),new As(.5,.5)])}};ng.prototype=ug(Vk);var ob=function(L,E,_,x,z,A,W){jl.call(this),W=W||.5,L=L||16,E=E||16,_=(_!==C?_:0)-s,x=x!==C?x:g,z=z!==C?z:0,A=A!==C?A:s;var Z,v,X=[],K=[],G=this.vertices,n=this.faces,w=this.faceVertexUvs;for(v=0;E>=v;v++){var P=[],p=[];for(Z=0;L>=Z;Z++){var R=Z/L,S=v/E,V=new Bk;V.x=-W*i(_+R*x)*F(z+S*A),V.y=W*i(z+S*A),V.z=W*F(_+R*x)*F(z+S*A),G.push(V),P.push(G.length-1),p.push(new As(R,S))}X.push(P),K.push(p)}for(v=0;E>v;v++)for(Z=0;L>Z;Z++){var r=X[v][Z+1],j=X[v][Z],k=X[v+1][Z],l=X[v+1][Z+1],f=G[r].clone().normalize(),m=G[j].clone().normalize(),o=G[k].clone().normalize(),e=G[l].clone().normalize(),$=K[v][Z+1].clone(),B=K[v][Z].clone(),Y=K[v+1][Z].clone(),H=K[v+1][Z+1].clone();T(G[r].y)===W?($.x=($.x+B.x)/2,n.push(new Vj(r,k,l,[f,o,e])),w[0].push([$,Y,H])):T(G[k].y)===W?(Y.x=(Y.x+H.x)/2,n.push(new Vj(r,j,k,[f,m,o])),w[0].push([$,B,Y])):(n.push(new Vj(r,j,l,[f,m,e])),w[0].push([$,B,H]),n.push(new Vj(j,k,l,[m.clone(),o,e.clone()])),w[0].push([B.clone(),Y,H.clone()]))}};ob.prototype=ug(Vk);var xs=function(h,C,d,S,c,t){jl.call(this),h=h||.33,C=C||.17,S=S||8,d=d||6,c=c||0,t=t||g;for(var Y=new Bk,V=[],w=[],P=0;S>=P;P++)for(var m=P/S*g+s,z=0;d>=z;z++){var K=z/d*t+c;Y.x=h*i(K),Y.z=-h*F(K);var W=new Bk,k=h+C*i(m);W.x=k*i(K),W.z=-k*F(K),W.y=C*F(m),this.vertices.push(W),V.push(new As(z/d,1-P/S)),w.push(W.clone().sub(Y).normalize())}for(var P=1;S>=P;P++)for(var z=1;d>=z;z++){var q=(d+1)*P+z-1,a=(d+1)*(P-1)+z-1,Q=(d+1)*(P-1)+z,j=(d+1)*P+z,f=new Vj(q,a,j,[w[q].clone(),w[a].clone(),w[j].clone()]);this.faces.push(f),this.faceVertexUvs[0].push([V[q].clone(),V[a].clone(),V[j].clone()]),f=new Vj(a,Q,j,[w[a].clone(),w[Q].clone(),w[j].clone()]),this.faces.push(f),this.faceVertexUvs[0].push([V[a].clone(),V[Q].clone(),V[j].clone()])}this.computeFaceNormals()};xs.prototype=ug(Vk);var Cd=function(V,T,k){return V?(jl.call(this),V=V instanceof Array?V:[V],this.addShapeList(V,T),T.convertYZ!==!1&&vh(this,k),this.computeFaceNormals(),void 0):(V=[],void 0)},Kq=Cd.prototype=ug(jl.prototype);Kq.addShapeList=function(M,P){for(var w=M.length,p=0;w>p;p++){var T=M[p];this.addShape(T,P)}},Kq.addShape=function(z,W){function Z(){if(W.bottom)for(var h=0;k>h;h++)E=i[h],o(E[2],E[1],E[0],!0);if(W.top)for(h=0;k>h;h++)E=i[h],o(E[0]+q*H,E[1]+q*H,E[2]+q*H,!1)}function A(){var j=0;for(s(t,j),j+=t.length,S=0,n=g.length;n>S;S++)u=g[S],s(u,j),j+=u.length}function s(i,R){for(var Y,m,j=i.length;--j>=0;){Y=j,m=j-1,0>m&&(m=i.length-1);var J=0,o=H;for(J=0;o>J;J++){var C=q*J,p=q*(J+1),e=R+Y+C,t=R+m+C,Z=R+m+p,$=R+Y+p;P(e,t,Z,$,i,J,o,Y,m)}}}function e(P,I,z){V.vertices.push(new Bk(P,I,z))}function o(Q,e,r,x){Q+=c,e+=c,r+=c,V.faces.push(new Vj(Q,e,r,null,null,x?2:1));
var w=x?R.generateBottomUV(V,z,W,Q,e,r):R.generateTopUV(V,z,W,Q,e,r);V.faceVertexUvs[0].push(w)}function P(b,F,l,Q,G,f,Y,K,d){b+=c,F+=c,l+=c,Q+=c,V.faces.push(new Vj(b,F,Q)),V.faces.push(new Vj(F,l,Q));var M=R.generateSideWallUV(V,z,G,W,b,F,l,Q,f,Y,K,d);V.faceVertexUvs[0].push([M[0],M[1],M[3]]),V.faceVertexUvs[0].push([M[1],M[2],M[3]])}var U,f,h,d,j,X=W.amount,y=W.curveSegments||Cp,H=W.steps||1,L=W.extrudePath,Y=!1,R=new Sq(W.repeatUVLength);L&&(U=L.getSpacedPoints(H),Y=!0,f=W.frames!==C?W.frames:new Di.FrenetFrames(L,H,!1),h=new Bk,d=new Bk,j=new Bk);var u,S,n,V=this,c=this.vertices.length,D=z.extractPoints(y),l=D.shape,g=D.holes,b=!bg.isClockWise(l);if(b){for(l=l.reverse(),S=0,n=g.length;n>S;S++)u=g[S],bg.isClockWise(u)&&(g[S]=u.reverse());b=!1}var i=bg.triangulateShape(l,g),t=l;for(S=0,n=g.length;n>S;S++)u=g[S],l=l.concat(u);for(var O,E,q=l.length,k=i.length,N=0;q>N;N++)O=l[N],Y?(d.copy(f.normals[0]).multiplyScalar(O.x),h.copy(f.binormals[0]).multiplyScalar(O.y),j.copy(U[0]).add(d).add(h),e(j.x,j.y,j.z)):e(O.x,O.y,0);var B;for(B=1;H>=B;B++)for(N=0;q>N;N++)O=l[N],Y?(d.copy(f.normals[B]).multiplyScalar(O.x),h.copy(f.binormals[B]).multiplyScalar(O.y),j.copy(U[B]).add(d).add(h),e(j.x,j.y,j.z)):e(O.x,O.y,X/H*B);Z(),A()};var Di=function(d,I,R,o,E){function $(P,_,g){return l.vertices.push(new Bk(P,_,g))-1}jl.call(this),I=I||64,R=R||1,o=o||8,E=E||!1;var B,z,L,j,m,p,v,Q,G,V,k,O,P,e,U,q,t,n,r,c,K=[],l=this,X=I+1,H=new Bk,Z=new Di.FrenetFrames(d,I,E),J=Z.tangents,s=Z.normals,w=Z.binormals;for(this.tangents=J,this.normals=s,this.binormals=w,G=0;X>G;G++)for(K[G]=[],j=G/(X-1),Q=d.getPointAt(j),B=J[G],z=s[G],L=w[G],V=0;o>V;V++)m=V/o*g,p=-R*i(m),v=R*F(m),H.copy(Q),H.x+=p*z.x+v*L.x,H.y+=p*z.y+v*L.y,H.z+=p*z.z+v*L.z,K[G][V]=$(H.x,H.y,H.z);for(G=0;I>G;G++)for(V=0;o>V;V++)k=E?(G+1)%I:G+1,O=(V+1)%o,P=K[G][V],e=K[k][V],U=K[k][O],q=K[G][O],t=new As(G/I,V/o),n=new As((G+1)/I,V/o),r=new As((G+1)/I,(V+1)/o),c=new As(G/I,(V+1)/o),this.faces.push(new Vj(P,e,q)),this.faceVertexUvs[0].push([t,n,c]),this.faces.push(new Vj(e,U,q)),this.faceVertexUvs[0].push([n.clone(),r,c.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Di.prototype=ug(Vk),Di.FrenetFrames=function(i,c,F){function Y(){j[0]=new Bk,D[0]=new Bk,P=Number.MAX_VALUE,t=T($[0].x),Z=T($[0].y),p=T($[0].z),P>=t&&(P=t,G.set(1,0,0)),P>=Z&&(P=Z,G.set(0,1,0)),P>=p&&G.set(0,0,1),V.crossVectors($[0],G).normalize(),j[0].crossVectors($[0],V),D[0].crossVectors($[0],j[0])}var r,P,t,Z,p,y,L,G=new Bk,$=[],j=[],D=[],V=new Bk,x=new qe,K=c+1,U=1e-4;for(this.tangents=$,this.normals=j,this.binormals=D,y=0;K>y;y++)L=y/(K-1),$[y]=i.getTangentAt(L),$[y].normalize();for(Y(),y=1;K>y;y++)j[y]=j[y-1].clone(),D[y]=D[y-1].clone(),V.crossVectors($[y-1],$[y]),V.length()>U&&(V.normalize(),r=W(wb($[y-1].dot($[y]),-1,1)),j[y].applyMatrix4(x.makeRotationAxis(V,r))),D[y].crossVectors($[y],j[y]);if(F)for(r=W(wb(j[0].dot(j[K-1]),-1,1)),r/=K-1,$[0].dot(V.crossVectors(j[0],j[K-1]))>0&&(r=-r),y=1;K>y;y++)j[y].applyMatrix4(x.makeRotationAxis($[y],r*y)),D[y].crossVectors($[y],j[y])};var Dp=function(u,x,Z,$){jl.call(this),x=x||18,Z=Z||0,$=$==o?g:$;for(var c=1/(u.length-1),Q=1/x,j=0,e=x;e>=j;j++)for(var T=Z+j*Q*$,V=i(T),R=F(T),C=0,B=u.length;B>C;C++){var S=u[C],z=new Bk;z.x=V*S.x-R*S.y,z.y=R*S.x+V*S.y,z.z=S.z,this.vertices.push(z)}for(var H=u.length,j=0,e=x;e>j;j++)for(var C=0,B=u.length-1;B>C;C++){var p=C+H*j,r=p,s=p+H,V=p+1+H,I=p+1,J=j*Q,b=C*c,d=J+Q,Y=b+c;this.faces.push(new Vj(r,I,s)),this.faceVertexUvs[0].push([new As(J,b),new As(J,Y),new As(d,b)]),this.faces.push(new Vj(s,I,V)),this.faceVertexUvs[0].push([new As(d,b),new As(J,Y),new As(d,Y)])}this.mergeVertices(),vh(this),this.computeFaceNormals(),this.computeVertexNormals()};Dp.prototype=ug(Vk);var He=function(v,h){h=h||{};var _=dh.generateShapes(v,h);h.amount=h.amount!==C?h.amount:.5,h.convertYZ=!1,h.fill!==!1&&(h.bottom=!0,h.top=!0),Cd.call(this,_,h)};He.prototype=ug(Kq);var lf=M.Node=function(){ek(lf,this)},Se={X:Eh,Y:co,Z:wr},jr={X:0,Y:1,Z:2},qo={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Fq="xzy",Ji=function(M,I,Q){if(I){var y=I[0],v=I[1],P=I[2];"xzy"===Q?(co(M,v),wr(M,P),Eh(M,y)):"xyz"===Q?(wr(M,P),co(M,v),Eh(M,y)):"yxz"===Q?(wr(M,P),Eh(M,y),co(M,v)):"yzx"===Q?(Eh(M,y),wr(M,P),co(M,v)):"zxy"===Q?(co(M,v),Eh(M,y),wr(M,P)):"zyx"===Q?(Eh(M,y),co(M,v),wr(M,P)):(co(M,v),wr(M,P),Eh(M,y))}};Lj("Node",un,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Fq,_64O:0,_rotationX:0,_53O:0,_host:o,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Vf},_22Q:function(){return Gj},getX:function(){return this.p().x},setX:function(o){this.p(o,this.p().y)},getY:function(){return this.p().y},setY:function(_){this.p(this.p().x,_)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(r){this.setAnchor(r,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(S){this.setAnchor(this.getAnchor().x,S)},getScaleX:function(){return this.getScale().x},setScaleX:function(Q){this.setScale(Q,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(N){this.setScale(this.getScale().x,N)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(W,l){Hd(W,bn(o,o,this.r3(),this.getRotationMode())),this.translate3d(W[0]*l,W[1]*l,W[2]*l)},translateFront:function(a){this.translate3dBy([0,0,1],a)},translateBack:function(F){this.translate3dBy([0,0,-1],F)},translateLeft:function(m){this.translate3dBy([-1,0,0],m)},translateRight:function(d){this.translate3dBy([1,0,0],d)},translateTop:function(S){this.translate3dBy([0,1,0],S)},translateBottom:function(L){this.translate3dBy([0,-1,0],L)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(U,_,q){1===arguments.length&&(_=U[1],q=U[2],U=U[0]),this.p(U,q),this.setElevation(_)},translate3d:function(e,D,i){1===arguments.length&&(D=e[1],i=e[2],e=e[0]),this.translate(e,i),this.setElevation(this._54O+D)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(A,R,F){1===arguments.length&&(R=A[1],F=A[2],A=A[0]),this.setSize(A,F),this.setTall(R)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(v,i,y){1===arguments.length&&(i=v[1],y=v[2],v=v[0]),this.setRotationX(v),this.setRotation(-i),this.setRotationZ(y)},setRotationY:function(I){this.setRotation(-I)},getRotationY:function(){return-this._64O},lookAtDirection:function(e,P){P=P||Qm;var T=this,J=$q(e);P===Qm?(T.r3([-Z(e[1]/J),-h(e[2],e[0])+A,0]),T.setRotationMode("xzy")):P===rb?(T.r3(0,-h(e[2],e[0]),Z(e[1]/J)),T.setRotationMode("zyx")):P===de?(T.r3(0,-h(e[2],e[0])+s,-Z(e[1]/J)),T.setRotationMode("zyx")):P===kl?(T.r3([-Z(e[1]/J)+A,-h(e[2],e[0])+A,0]),T.setRotationMode("xzy")):P===uo&&(T.r3([-Z(e[1]/J)-A,-h(e[2],e[0])+A,0]),T.setRotationMode("xzy")),P===Zo&&(T.r3([-Z(e[1]/J)+s,-h(e[2],e[0])+A,s]),T.setRotationMode("zxy"))},lookAt:function(l,B){return this.lookAtDirection(jb(l,this.p3()),B)},lookAtX:function(){var a=new Tl,Q=new Tl,$=new Tl,z=new yi,e=new yi,k=new M.Math.Euler;return function(x,b,t){b===de||b===rb?z.makeRotationAxis(new M.Math.Vector3(0,1,0),Math.PI/2):b===kl||b===uo?z.makeRotationAxis(new M.Math.Vector3(1,0,0),Math.PI/2):z.identity(),b===uo||b===rb||b===Zo?(a.fromArray(this.p3()),Q.fromArray(x)):(a.fromArray(x),Q.fromArray(this.p3())),e.lookAt(a,Q,t?$.fromArray(t):$.set(0,1,0)),k.setFromRotationMatrix(e.multiply(z),$o.ReverseOrder(this.getRotationMode())),this.r3([k.x,k.y,k.z])}}(),getHost:function(){return this._host},setHost:function(J){var B=this;if(B!==J&&B._host!==J){var t=B._host;t&&t._removeAttach(B),B._host=J,B._host&&B._host._addAttach(B),B.fp("host",t,J),B.onHostChanged(t,J)}},getAttaches:function(){return this._69O},_addAttach:function(W){var K=this;K._69O||(K._69O=new Uh),K._69O.add(W),K.fp("attaches",o,W)},_removeAttach:function(Q){var A=this;A._69O.remove(Q),A._69O.isEmpty()&&delete A._69O,A.fp("attaches",Q,o)},getImage:function(){if(this._pendingCheckImageJSON){var b=w.getImage(this._image);b&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof rs&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(I){var P=this,o=P._image,H=P.getWidth(),t=P.getHeight();P._image=I,P.fp("image",o,I)&&(null!=I&&(kf(I)||pl(I)&&/\.json$/i.test(I))&&(this._pendingCheckImageJSON=!0),P.fp(lk,H,P.getWidth()),P.fp($e,t,P.getHeight()))},getElevation:function(){return this._54O},setElevation:function(P){var R=this;if(!R._50O){R._50O=1;var c=R._54O;R._54O=P,R.fp(Zb,c,P),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(t){var U=this;if(!U._49O){U._49O=1;var E=U._64O;U._64O=t,U.fp(oq,E,t),delete U._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(U){var w=this;if(!w._51O){w._51O=1;var j=w._rotationX;w._rotationX=U,w.fp("rotationX",j,U),delete w._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(T){var j=this;if(!j._52O){j._52O=1;var B=j._53O;j._53O=T,j.fp("rotationZ",B,T),delete j._52O}},getPosition:function(){return this._position},setPosition:function(s,L){var n=this;if(!n._50I){n._50I=1;var j;if(j=2===arguments.length?{x:s,y:L}:s,j.x!==n._position.x||j.y!==n._position.y){var f=n._position;n._position=j,n.fp(lm,f,j)}delete n._50I}},translate:function(f,i){var W=this._position;this.p(W.x+f,W.y+i)},getWidth:function(){var O=this;if(O._width>=0)return O._width;var o=O.getStyle("shape3d");if(o){var V=gs(o);if(V&&V.rawS3)return V.rawS3[0];if("billboard"===o||"plane"===o){var s=Wl(O.getStyle("shape3d.image"));return s?lj(s,O):20}}var s=Wl(O._image);return s?lj(s,O):20},setWidth:function(M){var Y=this,B=Y._width;Y._width=M,Y.fp(lk,B,M)},getHeight:function(){var K=this;if(K._height>=0)return K._height;var G=K.getStyle("shape3d");if(G){var D=gs(G);if(D&&D.rawS3)return D.rawS3[2];if("plane"===G){var X=Wl(K.getStyle("shape3d.image"));return X?sr(X,K):20}if("billboard"===G)return 2}var X=Wl(K._image);return X?sr(X,K):20},setHeight:function(J){var $=this,i=$._height;$._height=J,$.fp($e,i,J)},getTall:function(){var Z=this;if(Z._tall>=0)return Z._tall;var g=Z.getStyle("shape3d");if(g){var O=gs(g);if(O&&O.rawS3)return O.rawS3[1];if("billboard"===g){var j=Wl(Z.getStyle("shape3d.image"));return j?sr(j,Z):20}if("plane"===g)return 2}return 20},setTall:function(P){var T=this,a=T._tall;T._tall=P,T.fp("tall",a,P)},setSize:function(s,r){var E=this;2===arguments.length?(E.setWidth(s),E.setHeight(r)):(E.setWidth(s.width),E.setHeight(s.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(s,C,g,c,k){var b=this,x=b.getAnchor(),v=b.getScale();arguments.length<=2&&(k=C,C=s.y,g=s.width,c=s.height,s=s.x);var h=k&&v.x<0?1-x.x:x.x,P=k&&v.y<0?1-x.y:x.y;b.p(s+g*h,C+c*P),k&&(g/=Math.abs(v.x),c/=Math.abs(v.y)),b.setWidth(g),b.setHeight(c)},getMatrix:function(){var a=this,O=a._64O,x=a._position,q=a.getScale();return new Tr(O,x.x,x.y,q.x,q.y)},getAnchorRect:function(){var Y=this,$=Y.getWidth(),q=Y.getHeight(),l=Y.getAnchor();return{x:-$*l.x,y:-q*l.y,width:$,height:q}},toLocal:function($){return this.getMatrix().tfi($)},toGlobal:function(a){return this.getMatrix().tf(a)},getAttachPosition:function(){var g=new Tr;return function(T,N,c,e){c=c||0,e=e||0;var h=this,t=h.getAnchor(),X=h._64O,i=h._position,b=h.getScale();return g.setFromTransform(X,i.x,i.y).tf({x:c+b.x*h.getWidth()*(T-t.x),y:e+b.y*h.getHeight()*(N-t.y)})}}(),isInRect:function(A){A=this.toLocal(A);var l=this.getWidth(),Q=this.getHeight();return A.x+=l*this.getAnchorX(),A.y+=Q*this.getAnchorY(),!(A.x<0||A.y<0||A.x>l||A.y>Q)},getRect:function(){var t=this,N=t.getWidth(),W=t.getHeight(),F=t.getAnchor(),E={x:-N*F.x,y:-W*F.y,width:N,height:W},f=t.getMatrix();return E=nb([f.tf(E.x,E.y),f.tf(E.x+E.width,E.y),f.tf(E.x+E.width,E.y+E.height),f.tf(E.x,E.y+E.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var p=this,P=p.getAnchor(),M=p._anchorElevation;return{x:P.x,y:M,z:P.y}},setAnchorElevation:function(O){var U=this,v=U._anchorElevation;return v!==O?(U._anchorElevation=O,U.fp("anchorElevation",v,O),!0):!1},setAnchor3d:function(M,L,k,u){var Z,v=this;"number"==typeof M?Z={x:M,y:L,z:k}:(Z=M.length?{x:M[0],y:M[1],z:M[2]}:M,u=L);var l=v.getDataModel();l&&l.beginTransaction();var C=v.getAnchor3d(),i=v.setAnchor(Z.x,Z.z);if(v.setAnchorElevation(Z.y)&&(i=!0),i&&u&&!ti){v.getAnchor3d();var m=yj(v),z=Hd([Z.x-C.x,Z.y-C.y,Z.z-C.z],m);v.p3(z)}return l&&l.endTransaction(),i},getAnchor:function(){var q=this;if(q.hasOwnProperty("_anchor"))return q._anchor;var f=Wl(q._image);return f&&f.anchorX!==C?{x:f.anchorX,y:f.anchorY}:q._anchor},setAnchor:function(N,C,q){var P,V=this;"number"==typeof N?P={x:N,y:C}:(P=N.length?{x:N[0],y:N[1]}:N,q=C);var s=V.getAnchor();if(s.x!==P.x||s.y!==P.y){var k=V.getDataModel();if(k&&k.beginTransaction(),V._anchor=P,V.fp("anchor",s,P),q&&!ti){var p=V.getPosition(),w=V.getSize(),W=V.getRotation(),D=V.getScale(),Z=-w.width*(s.x-P.x)*D.x,t=-w.height*(s.y-P.y)*D.y,O=F(W),A=i(W);V.setPosition(p.x+A*Z-O*t,p.y+O*Z+A*t)}return k&&k.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(r,Q){var e,H=this;e=2===arguments.length?{x:r,y:Q}:r;var L=H.getScale();(L.x!==e.x||L.y!==e.y)&&(H._scale=e,H.fp("scale",L,e))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var j=this,C=j._scaleTall,V=j.getScale();return[V.x,C,V.y]},getFinalScale3d:function(){var S=this,d=S.s3(),R=S._dynamicScale3d,t=S.getScale3d();return d&&(t[0]*=d[0],t[1]*=d[1],t[2]*=d[2]),R&&(t[0]*=R[0],t[1]*=R[1],t[2]*=R[2]),t},getFinalRotation3d:function(){var E=this;return E._dynamicRotation||E.r3()},setScaleTall:function(S){var I=this,L=I._scaleTall;L!==S&&(I._scaleTall=S,I.fp("scaleTall",L,S))},setScale3d:function(c,x,D){var C,K=this;C="number"==typeof c?{x:c,y:x,z:D}:c.length?{x:c[0],y:c[1],z:c[2]}:c,K.setScaleTall(C.y),K.setScale(C.x,C.z)},getCorners:function(r,g){r==o&&(r=0),g==o&&(g=r);var i=this,e=i.getAnchor(),C=i.getWidth(),R=i.getHeight(),P=-C*e.x-r,z=-R*e.y-g,y=C+2*r,I=R+2*g,X=i.getMatrix();return[X.tf(P,z),X.tf(P,z+I),X.tf(P+y,z+I),X.tf(P+y,z)]},getEditControlPoints:function(P,X,M){X==o&&(X=0),M==o&&(M=X);var y=this,L=y.getAnchor(),D=y.getWidth(),I=y.getHeight(),B=-D*L.x-X,t=-I*L.y-M,F=D+2*X,u=I+2*M;if(P)return[{x:B,y:t},{x:B,y:0},{x:B,y:t+u},{x:0,y:t+u},{x:B+F,y:t+u},{x:B+F,y:0},{x:B+F,y:t},{x:0,y:t}];var q=y.getMatrix();return[q.tf(B,t),q.tf(B,0),q.tf(B,t+u),q.tf(0,t+u),q.tf(B+F,t+u),q.tf(B+F,0),q.tf(B+F,t),q.tf(0,t)]},rotateAt:function(w,Z,f){var q=this,s=q._position,v=q._64O,S=new Tr(v,s.x,s.y).tf(w,Z),G=u(w*w+Z*Z),Q=h(s.y-S.y,s.x-S.x)+f;q.setRotation(v+f),q.p(S.x+G*i(Q),S.y+G*F(Q))},onParentChanged:function(){lf.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var t={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(U){t[U]=!0}),function(d){var F=this;lf.superClass.onPropertyChanged.call(F,d),t[d.property]&&!F._layoutUpdating&&F.updateLayoutParameters(null,d.property),F._69O&&F._69O.each(function(t){t.handleHostPropertyChange(d)}),F._49I&&F._49I.each(function(S){S.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach()},handleHostPropertyChange:function(l){this.updateAttach(l)},onStyleChanged:function(r){lf.superClass.onStyleChanged.apply(this,arguments),Hb[r]&&this.updateAttach()},updateAttach:function(H){var B=this;B._51I||ti||(B._51I=1,B._71O(H),delete B._51I)},_71O:function(e){var d,Q,V,g,S,X,l=this,A=l._host,P=e?e.property:o,p=e?e.oldValue:o,J=e?e.newValue:o;if(A instanceof M.Grid){if(P===Zb)l.setElevation(l._54O+J-p);else if(!e||Lp[P]){if(d=l.s("attach.row.index"),Q=l.s("attach.column.index"),V=A.getCellRect(d,Q),!V)return;g=l.s("attach.row.span"),S=l.s("attach.column.span"),(1!==g||1!==S)&&(V=xl(V,A.getCellRect(d+g-1,Q+S-1))),lh(V,l,"attach.padding",1),l.setRect(V)}}else if(A instanceof Yr&&(X=l.s("attach.index"))>=0&&(!e||je[P])){var b=l.s("attach.thickness");b!=o&&l.setHeight(A.getThickness()*b);var q=l.s("attach.offset"),m=A.getPoints(),r=m.size();if(r>X){var a=m.get(X),I=r===X+1?m.get(0):m.get(X+1),i=[I.x-a.x,I.y-a.y],w=$q(i);if(w){l.s("attach.offset.relative")&&(q*=w),l.s("attach.offset.opposite")&&(q=w-q);var s={x:a.x+i[0]/w*q,y:a.y+i[1]/w*q},z=l.s("attach.gap");z&&(l.s("attach.gap.relative")&&(z*=A.getThickness()),s=Ch(o,s,I,z)),l.p(s),l.setRotation(h(i[1],i[0]))}}}else e&&(P===lm?l.translate(J.x-p.x,J.y-p.y):P===Zb?l.setElevation(l._54O+J-p):Oh[P]?l._11Q(A,P,J-p):("anchor"===P||"width"===P||"height"===P||"scale"===P)&&l.layout(A))},_11Q:function(){var Q=new M.Math.Euler,q=M.Math.Euler.ReverseOrder,c=new M.Math.Vector2,$=new M.Math.Vector2;return function(p,w,e){var l=this,j=p.p3(),M=p.r3(),V=l.p3(),D=l.r3();if(w===oq&&(w="rotationY",e=-e),(w===oq||"rotationY"===w)&&0===D[0]&&0===D[2]&&0===M[0]&&0===M[2]&&0===V[1]&&0===j[1])return l.setRotation(-D[1]-e),c.set(V[0],V[2]).rotateAround($.set(j[0],j[2]),-e),l.p(c.x,c.y),void 0;var W=qo[p.getRotationMode()],i=W[0],R=W[1],b=W[2],N=Se[i],L=Se[R],g=Se[b],X=cj();w===oq+i?(g(X,M[jr[b]]),L(X,M[jr[R]]),N(X,e),L(X,-M[jr[R]]),g(X,-M[jr[b]])):w===oq+R?(g(X,M[jr[b]]),L(X,e),g(X,-M[jr[b]])):w===oq+b&&g(X,e);var n=jb(V,j);Hd(n,X),l.p3(j[0]+n[0],j[1]+n[1],j[2]+n[2]);var z=l.getRotationMode();Ji(X,l.r3(),z),Q.setFromRotationMatrix(X,q(z)),l.r3([Q.x,Q.y,Q.z])}}(),isHostOn:function(h){var D=this;if(D._host&&h&&h._69O)for(var t={},x=D._host;x&&x!==D&&!t[x._id];){if(x===h)return!0;t[x._id]=x,x=x._host}return!1},isLoopedHostOn:function(h){return this.isHostOn(h)&&h.isHostOn(this)},getScaledSize:function(){var d=this.getSize(),Z=this.getScale();return d.width*=Math.abs(Z.x),d.height*=Math.abs(Z.y),d},layout:function($){if($=$||this.getHost()){var N=this,q=N.s("layout.h")||"center",s=N.s("layout.v")||"center";if("center"!==q||"center"!==s){var m=new M.Math.Vector2,Q=$.getPosition(),V=$.getAnchor(),d=$.getScaledSize();N.getPosition();var I,j,B,L,y,h=1,k=1;switch(N._layoutUpdating=!0,q){case"left":m.setX(N._layoutHValue-V.x*d.width);break;case"right":m.setX((1-V.x)*d.width-N._layoutHValue);break;case"leftright":I=d.width-N._layoutHValue[2],B=N.getRotation()-$.getRotation(),L=Math.abs(Math.sin(B)),y=Math.abs(Math.cos(B)),h+=y*I/N._layoutHValue[3],k+=L*I/N._layoutHValue[4],m.setX(N._layoutHValue[1]+(N._layoutHValue[5]-V.x)*d.width);break;case"center":m.setX((.5-V.x)*d.width-N._layoutHValue);break;case"scale":B=N.getRotation()-$.getRotation(),L=Math.abs(Math.sin(B)),y=Math.abs(Math.cos(B)),m.setX((.5-V.x)*d.width-N._layoutHValue[1]*d.width/N._layoutHValue[0]),j=d.width/N._layoutHValue[2]-1,h+=y*j,k+=L*j}switch(s){case"top":m.setY(N._layoutVValue-V.y*d.height);break;case"bottom":m.setY((1-V.y)*d.height-N._layoutVValue);break;case"topbottom":B||(B=N.getRotation()-$.getRotation(),L=Math.abs(Math.sin(B)),y=Math.abs(Math.cos(B))),I=d.height-N._layoutVValue[2],h+=L*I/N._layoutVValue[3],k+=y*I/N._layoutVValue[4],m.setY(N._layoutVValue[1]+(N._layoutVValue[5]-V.y)*d.height);break;case"center":m.setY((.5-V.y)*d.height-N._layoutVValue);break;case"scale":B||(B=N.getRotation()-$.getRotation(),L=Math.abs(Math.sin(B)),y=Math.abs(Math.cos(B))),m.setY((.5-V.y)*d.height-N._layoutVValue[1]*d.height/N._layoutVValue[0]),j=d.height/N._layoutVValue[2]-1,h+=L*j,k+=y*j}(1!==h||1!==k)&&("leftright"===q||"scale"===q?N.setSize(N._layoutHValue[3]*h,N._layoutHValue[4]*k):N.setSize(N._layoutVValue[3]*h,N._layoutVValue[4]*k)),m.rotateAround(null,$.getRotation()),this.setPosition(m.x+Q.x,m.y+Q.y),N._layoutUpdating=C}}},updateLayoutParameters:function(V,j){if(V=V||this.getHost()){var o=this,x=o.s("layout.h"),X=o.s("layout.v");if(x||X){var w,u,i,K,Q,e,g=new M.Math.Vector2,s=V.getPosition(),y=V.getAnchor(),v=V.getScaledSize(),W=o.getPosition(),P=o.getSize();switch(g.set(W.x-s.x,W.y-s.y),g.rotateAround(null,-V.getRotation()),x){case"left":o._layoutHValue=g.x+y.x*v.width;break;case"right":o._layoutHValue=-g.x+(1-y.x)*v.width;break;case"center":o._layoutHValue=-g.x+(.5-y.x)*v.width;break;case"leftright":case"scale":"scale"===x?w=-g.x+(.5-y.x)*v.width:(u=o.getAnchor(),i=o.getRotation()-V.getRotation(),K=Math.cos(i),Q=Math.sin(i),e=-Math.min(-u.x*K+u.y*Q,-u.x*K-(1-u.y)*Q,(1-u.x)*K+u.y*Q,(1-u.x)*K-(1-u.y)*Q),w=g.x-(e-y.x)*v.width),"position"===j&&"object"==typeof o._layoutHValue?(o._layoutHValue[0]=v.width,o._layoutHValue[1]=w):o._layoutHValue=[v.width,w,v.width,P.width,P.height,e]}switch(X){case"top":o._layoutVValue=g.y+y.y*v.height;break;case"bottom":o._layoutVValue=-g.y+(1-y.y)*v.height;break;case"center":o._layoutVValue=-g.y+(.5-y.y)*v.height;break;case"topbottom":case"scale":"scale"===X?w=-g.y+(.5-y.y)*v.height:(i||(u=o.getAnchor(),i=o.getRotation()-V.getRotation(),K=Math.cos(i),Q=Math.sin(i)),e=-Math.min(-u.x*Q-u.y*K,-u.x*Q+(1-u.y)*K,(1-u.x)*Q-u.y*K,(1-u.x)*Q+(1-u.y)*K),w=g.y-(e-y.y)*v.height),"position"===j&&"object"==typeof o._layoutVValue?(o._layoutVValue[0]=v.height,o._layoutVValue[1]=w):o._layoutVValue=[v.height,w,v.height,P.width,P.height,e]}}}},getSerializableProperties:function(){var x=lf.superClass.getSerializableProperties.call(this);return Iq(x,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),x}});var cf=M.Edge=function(q,n){var f=this;ek(cf,f),f.setSource(q),f.setTarget(n)};Lj("Edge",un,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return mo},_22Q:function(){return fc},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(M){if(M===this)return!1;if(yr(M))return!0;for(var F,e,o,k,r,n=[this],C=-1,w=0;w>C;)if(C++,F=n[C],e=F._44I)for(e=e.getArray(),k=0,r=e.length;r>k;k++)if(o=e[k],ps(o)&&!(n.indexOf(o)>=0)){if(o===M)return!1;n.push(o),w++}return!0},setSource:function(M){var v=this;if(v._source!==M&&v.canSetSourceTarget(M)){var J=v._source;v._source=M,J&&J._16I(v),M&&M._2I(v),v._7I(),v.fp("source",J,M)}},setTarget:function(Y){var P=this;if(P._target!==Y&&P.canSetSourceTarget(Y)){var G=P._target;P._target=Y,G&&G._18I(P),Y&&Y._4I(P),P._7I(),P.fp("target",G,Y)}},isLooped:function(){var J=this;return J._source===J._target&&yr(J._source)&&yr(J._target)},onPropertyChanged:function(){var v=this;v._49I&&v._49I.each(function(D){D.fp("agentChange",!0,!1)})},_7I:function(){var g,G=this,q=Ki(G);G._40I!==q&&(g=this._40I,g&&g._15I(G),G._40I=q,q&&q._1I(G),G.fp("sourceAgent",g,q),Vq(g,G._41I),Vq(q,G._41I));var O=cq(G);G._41I!==O&&(g=G._41I,g&&g._17I(G),G._41I=O,O&&O._3I(G),G.fp("targetAgent",g,O),Vq(g,G._40I),Vq(O,G._40I))},_22I:function(K){this._52I=K,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var U=this;return U._52I&&U._52I.get(0)!==U&&!U.getStyle(Hc)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var f=this,l=f._52I;return l&&!f.getStyle(Hc)&&l.size()>1&&f===l.get(0)},toggle:function(){var T=this._52I,O=!this.s(Hc);T&&T.size()>1&&(T.each(function(y){y.s(Hc,O)}),T.getSiblings().each(function(X){X!==T&&X.each(function(u){u.fp("edgeGroup",o,X)})}))},setStyle:function(i,w){(i===to||"edge.segments"===i)&&(w=Lk(w)),cf.superClass.setStyle.call(this,i,w)},onStyleChanged:function(t){cf.superClass.onStyleChanged.apply(this,arguments),Br[t]&&Vq(this._41I,this._40I)},getSerializableProperties:function(){var m=cf.superClass.getSerializableProperties.call(this);return Iq(m,{source:1,target:1}),m}});var Kg=M.Group=function(){ek(Kg,this)};Lj("Group",lf,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return Nm},onChildAdded:function(){Kg.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Kg.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var N=this;if(!N._54I&&!ti){var l=N.getChildrenRect();l&&(N._53I=1,N.p(dm(N.s("group.position"),l,N.getSize())),delete N._53I)}},getChildrenRect:function(){var S,r=this;return r.eachChild(function(t){yr(t)&&(S=xl(S,r.getChildRect(t)))}),S},getChildRect:function(r){var t;return yr(r)&&r.s(gn)&&(zi(r)&&r.isExpanded()&&r.eachChild(function(V){t=xl(t,r.getChildRect(V))}),!t&&r.getRect&&(t=r.getRect())),t},setPosition:function($,Y){var r=this;if(!r._54I){var j;j=2===arguments.length?{x:$,y:Y}:$,ti||r._53I||(r._54I=1,Wj(r._children,j.x-r._position.x,j.y-r._position.y),delete r._54I),Kg.superClass.setPosition.call(this,j)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(M){var f=this;if(f._57O!==M){var y=f._57O;f._57O=M,f.fp("expanded",y,f._57O),f._fireInvalidateDeep(),f._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(H){zi(H)?H._fireInvalidateDeep():H.iv()})},_8I:function(){Kg.superClass._8I.call(this),this.eachChild(function(J){yr(J)&&J._8I()})},onStyleChanged:function(J){Kg.superClass.onStyleChanged.apply(this,arguments),"group.position"===J&&this._81I()},getSerializableProperties:function(){var S=Kg.superClass.getSerializableProperties.call(this);return S.expanded=1,S}});var Uk=M.Block=function(){ek(Uk,this)};Lj("Block",lf,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return Jp},onChildAdded:function(){Uk.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Uk.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var R=this;if(!ti&&!R._updatingToChildren&&R._syncSize&&!R._freezeSyncFromChildren){var l,N,W,S,w,U=[],q=R.getRotation();if(R.eachChild(function(f){yr(f)&&U.push.apply(U,f.getCorners())}),U.length){R._updatingFromChildren=1;var Q=i(-q),D=F(-q),s=1/0,p=-1/0,E=1/0,Y=-1/0;for(S=0,w=U.length;w>S;S++)W=U[S],l=W.x,N=W.y,W.x=Q*l-D*N,W.y=D*l+Q*N,s=m(s,W.x),p=J(p,W.x),E=m(E,W.y),Y=J(Y,W.y);var H=R.getScale();R.setSize(T((p-s)/H.x),T((Y-E)/H.y));var O;H.x<0&&(O=s,s=p,p=O),H.y<0&&(O=E,E=Y,Y=O),Q=i(q),D=F(q);var j=R.getAnchor();l=s+(p-s)*j.x,N=E+(Y-E)*j.y,R.setPosition(Q*l-D*N,D*l+Q*N),delete R._updatingFromChildren}}},setPosition:function(E,z){var y=this;if(!y._updatingToChildren){var r;r=2===arguments.length?{x:E,y:z}:E,ti||y._updatingFromChildren||(y._updatingToChildren=1,Wj(y._children,r.x-y._position.x,r.y-y._position.y),delete y._updatingToChildren),Uk.superClass.setPosition.call(this,r)}},setWidth:function(X){return this.setSize(X,this.getHeight())},setHeight:function(t){return this.setSize(this.getWidth(),t)},setSize:function(l,M){1>l&&(l=1),1>M&&(M=1);var h=this;if(!h._updatingToChildren){2!==arguments.length&&(M=l.height,l=l.width);var v=h.getWidth(),O=h.getHeight();if(l!==v&&Uk.superClass.setWidth.call(h,l),M!==O&&Uk.superClass.setHeight.call(h,M),!ti&&!h._updatingFromChildren){h._updatingToChildren=1;var n=l/v,G=M/O;h._adjustChildScaleOrSize(n,G,"size"),delete h._updatingToChildren,h.updateFromChildren()}}},_adjustChildScaleOrSize:function(C,O,G){var L=this;if(L._syncSize){var I=L.getPosition(),b=L.getRotation();L.getScale(),L.eachChild(function(p){if(yr(p)){var K=p.getPosition(),W=p.getRotation(),R=p.getWidth(),H=p.getHeight(),E=p.getScale(),t=E.x*R,Q=E.y*H,k=new Tr(W,K.x,K.y,t,Q);k.translate(-I.x,-I.y),k.rotate(-b),W=h(k.b*Math.sign(t),k.a*Math.sign(t)),k.scale(C,O);var L,j,a,y=i(W);if(Math.abs(y)<.001?(L=F(W),j=k.b/L,a=-k.c/L):(j=k.a/y,a=k.d/y),"scale"===G)p.setScale(j/R,a/H);else if("size"===G){var l=j/E.x,$=a/E.y;p.setScale(ef(j)*Math.abs(E.x),ef(a)*Math.abs(E.y)),p instanceof M.Shape?(p.setWidthForce(Math.max(Math.abs(l),1e-5)),p.setHeightForce(Math.max(Math.abs($),1e-5))):p.setSize(Math.max(.01,Math.abs(l)),Math.max(.01,Math.abs($)))}k.rotate(b),k.translate(I.x,I.y),p.setPosition(k.tx,k.ty)}})}},_calcChangeFactor:function(O,R,g,e){var l,s,E,v;return l=T(O),s=T(g),E=l>s?l/s:s/l,l=T(R),s=T(e),v=l>s?l/s:s/l,J(E,v)},setAnchor:function(){var I=this;if(!I._updatingToChildren){var t=I.getAnchor();if(Uk.superClass.setAnchor.apply(I,arguments),!ti&&!I._updatingFromChildren&&I._syncSize){I._updatingToChildren=1;var G=I.getAnchor();I.getPosition();var M=I.getSize(),z=I.getScale(),c=I.getRotation(),u=-M.width*z.x*(t.x-G.x),L=-M.height*z.y*(t.y-G.y),o=F(c),R=i(c),D=R*u-o*L,W=o*u+R*L;I.eachChild(function(L){if(yr(L)){var T=L.getPosition();L.setPosition(T.x-D,T.y-W)}}),delete I._updatingToChildren}}},setRotation:function(r){var u=this;if(!u._updatingToChildren){var L=u.getRotation();if(Uk.superClass.setRotation.apply(u,arguments),!ti&&!u._updatingFromChildren){u._updatingToChildren=1;var A=u.getPosition(),P=r-L;u.eachChild(function(f){if(yr(f)){var k=f.getMatrix();k.translate(-A.x,-A.y),k.rotate(P),k.translate(A.x,A.y);var x=Math.sign(f.getScale().x);f.setRotation(h(k.b*x,k.a*x)),f.setPosition(k.tx,k.ty)}}),delete u._updatingToChildren}}},setScale:function(R,A){var i=this;if(!i._updatingToChildren){null==A&&(A=R.y,R=R.x);var U=i.getScale();if(T(R)<.01&&(R=.01*(ef(R)||ef(U.x))),T(A)<.01&&(A=.01*(ef(A)||ef(U.y))),Uk.superClass.setScale.call(i,R,A),!ti&&!i._updatingFromChildren){i._updatingToChildren=1;var V=R/U.x,h=A/U.y;i._adjustChildScaleOrSize(V,h,"size"),delete i._updatingToChildren,i.updateFromChildren()}}},getSerializableProperties:function(){var Q=Uk.superClass.getSerializableProperties.call(this);return Q.clickThroughEnabled=1,Q.syncSize=1,Q}});var aj=M.Grid=function(){ek(M.Grid,this)};Lj("Grid",lf,{IRotatable:!1,_icon:"grid_icon",_image:o,getUIClass:function(){return hk},setRotation:function(){},getCellRect:function(J,B){var k=this,d=k.s("grid.row.count"),Q=k.s("grid.column.count");if(0>=d||0>=Q||0>J||J>=d||0>B||B>=Q)return o;var T,i,g,I=k.getRect(),E=k.s("grid.row.percents"),U=k.s("grid.column.percents");if(lh(I,k,"grid.border",-1),E&&E._as&&(E=E._as),U&&U._as&&(U=U._as),E&&E.length===d){for(g=0,T=0;J>T;T++)g+=I.height*E[T];I.y+=g,I.height=I.height*E[J]}else I.height=I.height/d,I.y+=I.height*J;if(U&&U.length===Q){for(i=0,T=0;B>T;T++)i+=I.width*U[T];I.x+=i,I.width=I.width*U[B]}else I.width=I.width/Q,I.x+=I.width*B;return Bi(I,-k.s("grid.gap")),I}});var Pf=M.Text=function(){ek(Pf,this),this.setSize(100,50),this.s("text","TEXT")};Lj("Text",lf,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Gm},setWidth:function(V){V||(V=.001),Pf.superClass.setWidth.call(this,V)},setHeight:function(g){g||(g=.001),Pf.superClass.setHeight.call(this,g)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),ji("__text__",{width:{value:100,isSafeFunc:!0,func:function(e){return e._width}},height:{value:50,isSafeFunc:!0,func:function(T){return T._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var Yr=M.Shape=function(){ek(Yr,this),this._59O=new Uh};Yr.__de__=$i,Lj("Shape",lf,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return yk},_22Q:function(){return Rn},getLength:function(_){return cb(we(this._59O,this._58O,_,this._closePath))
},getSegments:function(){return this._58O},toSegments:function(){var V=this._58O;return V?new Uh(V._as.slice(0)):V},setSegments:function(r){var p=this._58O;r=r?Ef(r)?new Uh(r.slice(0)):new Uh(r._as.slice(0)):null,(p&&r&&p._as.join(",")!==r._as.join(",")||p!==r)&&(this._58O=r,this.fp("segments",p,r))},getPoints:function(){return this._59O},toPoints:function(){var C=this._59O;return new Uh(C._as.slice(0))},setPoints:function(s,Z){var D=this,p=D._59O;s=s?Ef(s)?new Uh(s.slice(0)):new Uh(s._as.slice(0)):new Uh;var q,W,g,d,X,y;Z&&(q=D.getPosition(),y=new Tr(D.getRotation(),0,0,D.getScale().x,D.getScale().y)),(p&&s&&p._as.join(",")!==s._as.join(",")||p!==s)&&(D._59O=s,D.fs(),D.fp("points",p,s)),Z&&(W=D.getPosition(),g=W.x-q.x,d=W.y-q.y,X=y.tf(g,d),D.setPosition(W.x-g+X.x,W.y-d+X.y))},addPoint:function(U,V,A){var u=this.toPoints();u.add(U,V),this.setPoints(u,A)},setPoint:function(p,T,h){var m=this.toPoints();m.set(p,T),this.setPoints(m,h)},removePointAt:function(c){var E=this.toPoints();E.removeAt(c),this.setPoints(E)},setWidthForce:function(m){var b=this;if(!b._55I&&!ti&&b.getWidth()){b._55I=1;var c=b._position.x,q=m/b.getWidth(),I=b.toPoints(),a=new Uh;I.each(function(C){a.add({x:(C.x-c)*q+c,y:C.y,e:C.e})}),b.setPoints(a),wo(b,[q,0,0,1,c*(1-q),0]),b.fs(),delete b._55I}Yr.superClass.setWidth.call(b,m)},setWidth:function(O){return this.setWidthForce(1>O?1:O)},setHeightForce:function(L){var K=this;if(!K._55I&&!ti&&K.getHeight()){K._55I=1;var v=K._position.y,$=L/K.getHeight(),f=K.toPoints(),Z=new Uh;f.each(function(k){Z.add({x:k.x,y:(k.y-v)*$+v,e:k.e})}),K.setPoints(Z),wo(K,[1,0,0,$,0,v*(1-$)]),K.fs(),delete K._55I}Yr.superClass.setHeight.call(K,L)},setHeight:function(B){return this.setHeightForce(1>B?1:B)},setAnchorElevation:function(H){var w=this;w._55I=!0;var f=w._updatingAnchor3d,k=!ti&&!f;if(k){var s,o=H,e=w.getAnchorElevation(),p=w.getTall();s=p*(e-o),w.shiftPointsElevation(s)}var l=Yr.superClass.setAnchorElevation.apply(w,arguments);return f||delete w._55I,l},getShapeElevation:function(){var R=this,z=R._54O;return z-(R.getTall()||0)*(R._anchorElevation-.5)},setAnchor3d:function(Y,p,H,J){var u,G=this;"number"==typeof Y?u={x:Y,y:p,z:H}:(u=Y.length?{x:Y[0],y:Y[1],z:Y[2]}:Y,J=p),G._55I=!0,G._updatingAnchor3d=!0;var W=G.getDataModel();if(W&&W.beginTransaction(),!ti){var o=G.getAnchor3d(),v=G.getSize(),l=G.getTall(),O=v.width*(o.x-u.x),j=v.height*(o.z-u.z),R=l*(o.y-u.y);J||G.shiftPoints(O,j,R);var _=G.p3()}var s=Yr.superClass.setAnchor3d.apply(G,arguments);if(!ti&&J){var S=G.p3();G.shiftPoints(S[0]-_[0]+O,S[2]-_[2]+j,S[1]-_[1]+R)}return W&&W.endTransaction(),delete G._updatingAnchor3d,delete G._55I,s},setAnchor:function(m,L,n){var e=this;e._55I=!0;var _=e._updatingAnchor3d,C=!ti&&!_;if(C){var X,T,A;"number"==typeof m?A={x:m,y:L}:(A=m.length?{x:m[0],y:m[1]}:m,n=L);var N=e.getAnchor(),d=e.getSize();X=d.width*(N.x-A.x),T=d.height*(N.y-A.y),n||e.shiftPoints(X,T);var i=e.getPosition()}var b=Yr.superClass.setAnchor.apply(e,arguments);if(C){var F=e.getPosition();n&&e.shiftPoints(F.x-i.x+X,F.y-i.y+T)}return _||delete e._55I,b},shiftPoints:function(u,k,b){var U=this,L=U.getElevation()||0,Z=U.toPoints(),_=new Uh;Z.each(function(Q){var H=Q.e;b&&(H=(H==o?L:H)+b),_.add({x:Q.x+u,y:Q.y+k,e:H})}),U.setPoints(_),U.fs()},shiftPointsElevation:function(w){return this.shiftPoints(0,0,w)},setPosition:function(O,X){var H,A=this;if(!A._28Q){if(A._28Q=1,!A._55I&&!ti){H=2===arguments.length?{x:O,y:X}:O;var B=H.x-A._position.x,Y=H.y-A._position.y;if(0===B&&0===Y)return delete A._28Q,void 0;A._55I=1,A.shiftPoints(B,Y),wo(A,[1,0,0,1,B,Y]),delete A._55I}Yr.superClass.setPosition.apply(A,arguments),delete A._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var z=this;if(2!==z._59O.size())return!1;var x=z._58O;return x?2===x.size()&&1===x.get(0)&&2===x.get(1)?!0:!1:!0},fireShapeChange:function(){var b=this;if(!b._55I&&!ti){var d=nb(b._59O);d&&(b._55I=1,b.setRect(d),delete b._55I)}b.fp(Dg,!1,!0)},getSerializableProperties:function(){var c=Yr.superClass.getSerializableProperties.call(this);return c.segments=1,c.points=1,c.thickness=1,c.closePath=1,c}});var Ro=M.Polyline=function(){ek(Ro,this),this.s({"shape.background":null,"shape.border.width":2})};Lj("Polyline",Yr,{_icon:"polyline_icon",_22Q:function(){return zb},getUIClass:function(){return Ff},setClosePath:function(){},setTall:function(m){var s=this;if(!s._55I&&!s._24Q&&!ti&&s.getTall()){s._24Q=1;var B=s._54O,T=m/s.getTall();s._59O.each(function(p){p.e=p.e==o?B:(p.e-B)*T+B}),s.fs(),delete s._24Q}Ro.superClass.setTall.call(s,m)},setElevation:function(E){var k=this;if(!k._55I&&!k._24Q&&!ti){k._24Q=1;var W=E-k._54O;k._59O.each(function(x){x.e==o?x.e=E:x.e+=W}),k.fs(),delete k._24Q}Ro.superClass.setElevation.apply(k,arguments)},fireShapeChange:function(){var C=this,p=C._59O;if(!C._55I&&!C._24Q&&!ti){var G=p.size();if(G){var h=1,u=p.get(0),D=C._54O;u.e==o&&(u.e=D);for(var g=u.e,j=0;G>h;h++){u=p.get(h),u.e==o&&(u.e=D);var y=m(g,u.e),Q=J(g+j,u.e);g=y,j=Q-y}C._24Q=1,C.setTall(j),C.setElevation(g+j*C._anchorElevation),delete C._24Q}}Ro.superClass.fireShapeChange.apply(C,arguments)}});var Wo=M.SubGraph=function(){ek(Wo,this)};Lj("SubGraph",lf,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Wo.superClass._8I.call(this),this.eachChild(function(i){yr(i)&&i._8I()})}}),w.loadingRefGraph=0;var rs=M.RefGraph=function(){ek(rs,this)};Lj("RefGraph",Uk,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(I){var f=this._ref;this._ref=I,this.fp("ref",f,I),this.updateRef()},_21I:function(){rs.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var Q=this;if(w.loadingRefGraph++,Q.clearChildrenFromDataModel(),w.loadingRefGraph--,Q._ref&&Q._dataModel){Q._xhrLoadHandler&&(Q._xhrLoadHandler.cancel=!0);var y=ti,$=Q._xhrLoadHandler=function(h){if(h&&Q._dataModel){w.loadingRefGraph++;var I=Q._pendingUpdateInfo={needToRestore:y};y&&(I.position=Q.p(),I.width=Q.getWidth(),I.height=Q.getHeight(),I.rotation=Q.getRotation(),I.anchor=Q.getAnchor(),I.scale=Q.getScale()),Q.p(0,0),Q.setAnchor(.5,.5),Q.setRotation(0),Q.setScale(1,1);var B=w.parse(h),$=Q._dataModel.deserialize(B,Q,{justDatas:!0});$.each(function(B){B._refGraph=Q}),Q.checkPendingUpdateInfo(),w.loadingRefGraph--,w.handleRefGraphLoaded(Q,$,B)}};$.xhrLoadCalled=!1,w.load(Q._ref,function(k){$.cancel||($.xhrLoadCalled?$(k):Wn(function(){$(k)}))}),$.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var C=this,U=C._pendingUpdateInfo;if(!U)return C.onPendingUpdated&&(w.loadingRefGraph++,C.onPendingUpdated(),w.loadingRefGraph--),void 0;var q=!0;this.eachChild(function(w){(w._pendingCheckImageJSON||w._pendingUpdateInfo)&&(q=!1)}),q&&(w.loadingRefGraph++,C._pendingUpdateInfo=null,C.updateFromChildren(),U.needToRestore&&(C.setSize(U.width,U.height),C.setAnchor(U.anchor),C.setRotation(U.rotation),C.setScale(U.scale),C.p(U.position)),this.getParent()instanceof rs&&this.getParent().checkPendingUpdateInfo(),C.onPendingUpdated&&C.onPendingUpdated(),w.loadingRefGraph--)},getSerializableProperties:function(){var o=rs.superClass.getSerializableProperties.call(this);return o.ref=1,o}}),M.EdgeGroup=function(y,n){this._70O=y,this._siblings=n;for(var A,W,q=0,I=y.size(),u=k[Hc];I>q;q++)if(A=y.get(q).getStyle(Hc,!1),A!=o){u=A;break}u==o&&(u=!0);var X=w.edgeGroupAgentFunc;for(X&&(W=X(y),W&&W!==y.get(0)&&(y.remove(W),y.add(W,0))),q=0;I>q;q++)y.get(q).s(Hc,u)},Lj("EdgeGroup",v,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(H){return this._70O.get(H)},indexOf:function(c){return this._70O.indexOf(c)},each:function(c,U){this._70O.each(c,U)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(S,F){this._siblings.each(function(m){m._70O.each(S,F)})}});var qg=function(w,b,Z){var W=am[w]={type:w,action:b};if(Z)for(var D in Z)W[D]=Z[D]};Iq(w,{setConnectAction:qg,getConnectAction:function(O,H){if(!H){if(!O)return null;H=O.getCurrentConnectActionType()}return am[H]},doConnectAction:function(V,Y,E,j){j=j||V.getCurrentConnectActionType();var D=am[j];if(!D)return!1;var C=D.action;return C?(Y instanceof br.Group?V.sm().getSelection().each(function(i){C.call(null,V,i,E)}):C.call(null,V,Y,E),!0):!1},doDeleteConnectionAction:function(U,v,K){K=K||U.getCurrentConnectActionType();var B=am[K];if(!B||!B.delete)return!1;var t=B.delete.action;return t?(v instanceof br.Group?U.sm().getSelection().each(function(C){t.call(null,U,C)}):t.call(null,U,v),!0):!1}});var Xp=M.JSONSerializer=function(Q,P){this.dm=this._dataModel=Q,this._hierarchical=w.forceHierarchicalSerialization?!0:P==o?Q.isHierarchicalRendering():P};Lj("JSONSerializer",v,{ms_ac:["hierarchical"],serialize:function(v){return w.stringify(this.toJSON(),v)},toJSON:function(){var s=this,t=s.dm,n=t.getRoots(),O=s.json={v:w.getVersion(),p:{},a:{},d:[]},d=t.getSerializableAttrs();t.getInit()&&(O.init=t.getInit()),t.getName()&&(O.p.name=t.getName()),t.getBackground()&&(O.p.background=t.getBackground()),t.getLayers()&&(O.p.layers=t.getLayers()),t.getEnvmap()&&(O.p.envmap=t.getEnvmap()),O.p.autoAdjustIndex=t.isAutoAdjustIndex(),O.p.hierarchicalRendering=t.isHierarchicalRendering();for(var H in d){var b=t.a(H);b!==C&&s[qp](H,b,O.a)}return Od(O.a)&&delete O.a,s._hierarchical?n.each(s.serializeData,this):t.each(function(f){s.serializeData(f)}),t.fireSerializeEvent({type:"serialize",json:O}),t.getPostProcessingData()&&(O.p.postProcessingData=t.getPostProcessingData()),O},isSerializable:function(){return!0},getProperties:function(n){return n.getSerializableProperties()},getStyles:function($){return $.getSerializableStyles()},getAttrs:function(g){return g.getSerializableAttrs()},serializeData:function(d){var K=this;if(K.isSerializable(d)&&!d._refGraph){var T,g,h,L,X=Yi(d.getClassName())||d.getClass(),U=new X,w={c:d.getClassName(),i:d.getId(),p:{},s:{},a:{}};K.json.d.push(w),T=K.getProperties(d);for(g in T)if(/^_/.test(g)){if(h=d[g],("_width"===g||"_height"===g)&&h===C){var V;((d.s("layout.h")||d.s("layout.v"))&&d.getHost()||d instanceof M.Node&&(V=d.getParent())&&V instanceof M.Block||d.s("fullscreen"))&&(h=d[g]="_width"===g?d.getWidth():d.getHeight())}h!==U[g]&&K[qp](g.substr(1),h,w.p)}else L=ir(g),d[L]&&(h=d[L](),h!==U[L]()&&K[qp](g,h,w.p));T=K.getStyles(d);for(g in T)h=d.s(g),h!==U.s(g)&&K[qp](g,h,w.s);T=K.getAttrs(d);for(g in T)h=d.a(g),h!==U.a(g)&&K[qp](g,h,w.a);Od(w.p)&&delete w.p,Od(w.s)&&delete w.s,Od(w.a)&&delete w.a}K._hierarchical&&d.getChildren().each(K.serializeData,K)},serializeValue:function(w,n,O){Jq(n)?n={__a:n._as}:n instanceof un&&(n={__i:n.getId()}),O[w]=n},deserialize:function(x,b,Z){var S=this;return pl(x)&&/.json$/.test(x)?(w.xhrLoad(x,function(r){S.deserializeImpl(r,b,Z)}),void 0):S.deserializeImpl(x,b,Z)},deserializeImpl:function(y,I,S){var B=this,R=B.dm;S=Yb(S)?{setId:S}:pg(S)?{finishFunc:S}:S||{},y=B.json=pl(y)?w.parse(y):y,y.a&&y.a.onPreDeserialize&&!S.disableOnPreDeserialize&&y.a.onPreDeserialize(y,R,S.view),R.beginTransaction(),ti++,B._82I={};var X=new Uh,x=new Uh,L=0,i=y.d.length;if(S.justDatas||(pg(y.init)&&y.init(R),R.setInit(y.init)),!S.justDatas){for(var t in y.a)R.a(t,B[uj](y.a[t]));for(var A in y.p)R[Zr(A)](y.p[A])}for(;i>L;L++){var J=y.d[L],j=Yi(J.c),V=new j,f=J.i;S.setId&&f!=o&&(V._id=f),B._82I[f]=V,X.add(V),x.add(J)}for(L=0;i>L;L++)B.deserializeData(X.get(L),x.get(L));return X.each(function(K){I&&!K.getParent()&&K.setParent(I),R.add(K)}),R.fireSerializeEvent({type:"deserialize",json:y}),ti--,R.endTransaction(),y.a&&y.a.onPostDeserialize&&!S.disableOnPostDeserialize&&y.a.onPostDeserialize(y,R,S.view,X),S.finishFunc&&S.finishFunc(y,R,S.view,X),X},deserializeData:function(D,C){for(var h in C.p)D[Zr(h)](this[uj](C.p[h]));for(h in C.s)D.s(h,this[uj](C.s[h]));for(h in C.a)D.a(h,this[uj](C.a[h]))},deserializeValue:function(h){if(kf(h)){var I=h.__i;if(I!=o)return this._82I[I];if(I=h.__a,Ef(I))return new Uh(I)}return h}}),Iq(hd,{serialize:function(a,c){return new Xp(this,c).serialize(a)},toJSON:function(Y){return new Xp(this,Y).toJSON()},deserialize:function(C,v,g){return new Xp(this).deserialize(C,v,g)}});var ph=M.OverlappingBox=function(O){this.gv=O,this.boxes={}};Lj("OverlappingBox",v,{clear:function(){var H,r,U=this.boxes;for(H in U)r=U[H],r.length=0},isOverlapping:function(s,i){var b,N,w=this,L=w.boxes,k=L[s];k?(b=k.rects,N=k.length):k=L[s]={rects:b=[],length:N=0};var W,X,i;for(W=0;N>W;W++)if(X=b[W],X.x<i.x+i.w&&X.x+X.w>i.x&&X.y<i.y+i.h&&X.h+X.y>i.y)return!0;return b.length<=N?(b.push(i),k.length++):b[k.length++]=i,!1}}),Iq(w,{fetch:function(Q,o){var K="GET",_=!1,j=null,P="";o&&(K=o.method||"GET",_=o.sync,P=o.url,j=o.data||null),Q.open(K,P,!_),o.responseType?Q.responseType=o.responseType:o.overrideMimeType&&Q.overrideMimeType&&Q.overrideMimeType(o.overrideMimeType),Q.send(j)},convertImageSrc:function(f,$){$&&"function"==typeof $||($=function(){}),$(f)}});var gm=M.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Lj("Request",v,{_responseType:null,_overrideMimeType:"text/plain",send:function(T){var j=this._xhr,o=this.onload,A=this.onerror;this.getResponseType()?T.responseType=this.getResponseType():this.getOverrideMimeType()&&(T.overrideMimeType=this.getOverrideMimeType()),j.onload=o,j.onerror=A,w.fetch(j,T)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(C){this._responseType=C},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(c){this._overrideMimeType=c},getResponseText:function(){var o=this._xhr;return o.response||o.responseText}}),nk.GraphView=function(q){var J=this;J._24I={},J._34I=new Uh,J._25I={},J._56I={},J._view=jh(1,J),J._canvas=ep(J._view),J.dm(q?q:new hd),this._coreInteractor=new rq(this),J.setEditable(!1),J.setScrollBarVisible(w.graphViewScrollBarVisible)},vc("GraphView",v,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Gp,Mi,Np,vf,"resettable","editInteractor",Pb,"zoomable","pannable","rectSelectable","autoScrollZone",El,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:w.graphViewZoomable,_resettable:w.graphViewResettable,_pannable:w.graphViewPannable,_rectSelectable:w.graphViewRectSelectable,_autoScrollZone:w.graphViewAutoScrollZone,_rectSelectBackground:w.graphViewRectSelectBackground,_rectSelectBorderColor:w.graphViewRectSelectBorderColor,_editPointSize:w.graphViewEditPointSize,_editPointBorderColor:w.graphViewEditPointBorderColor,_editPointBackground:w.graphViewEditPointBackground,_scrollBarColor:Gn,_scrollBarSize:me,_autoHideScrollBar:Xg,_autoMakeVisible:Fd,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(y){this._dataModel.setLayers(y)},setEditable:function(A){var U=this,t=U.__interactorMap__;if(!t){var x=nk.XEditInteractor;t=U.__interactorMap__={scrollBar:new Vr(U),select:new wp(U),edit:x?new x(U):new Id(U),text:new Fb(U),move:new Zd(U),"default":new Df(U),touch:new Jj(U,{editable:!1})}}A?(U._uieditable=!0,U.setInteractors([t.scrollBar,t.select,t.edit,t.text,t.move,t.default,t.touch])):(U._uieditable=!1,U.setInteractors([t.scrollBar,t.select,t.move,t.default,t.touch]))},getCanvas:function(){return this._canvas},_33I:function(v){var i=v.getUIClass();return i?new i(this,v):o},getDataUI:function(N){var S=this,Y=S._25I[N._id];return Y===C&&(Y=S._33I(N),S._25I[N._id]=Y),Y},getNodeRect:function(f){return w.getNodeRect(this,f)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(y){var X=this.getDataUI(y);return X?(X._79o(),X._78o):null},getEdgeSourcePosition:function(H){var V=this,j=V.getDataUI(H),X=j.s,T=j._data._40I;return tm(V,T,X("edge.source.position"),X("edge.source.offset.x"),X("edge.source.offset.y"),X("edge.source.anchor.x"),X("edge.source.anchor.y"))},getEdgeTargetPosition:function(F){var X=this,q=X.getDataUI(F),G=q.s,J=q._data._41I;return tm(X,J,G("edge.target.position"),G("edge.target.offset.x"),G("edge.target.offset.y"),G("edge.target.anchor.x"),G("edge.target.anchor.y"))},invalidateAll:function(v){var k=this;if(v){for(var a in k._25I){var l=k._25I[a];l&&l.dispose()}k._25I={},k._56I={},k._24I={},k._34I.clear(),k.redraw()}else k.dm().each(function(Y){k.invalidateData(Y)})},invalidateSelection:function(){var F=this;F.sm().each(function(U){F.invalidateData(U)})},invalidateData:function(G){var y=this;y._24I[G._id]=G,y._21Q(G),y.iv()},_21Q:function(M){var D=this,y=D._24I;if(ps(M)&&Pl[M.s(Xq)]){var B=M.getSourceAgent();B&&B.getAgentEdges().each(function(w){y[w._id]=w}),B=M.getTargetAgent(),B&&B.getAgentEdges().each(function(e){y[e._id]=e}),D.iv()}},redraw:function(o){var j=this;j._32I||(o?j._34I.add(o):(j._32I=1,j._34I.clear()),j.iv())},each:function(t,n){var K,s,i,m=0,T=this.getLayers(),b=this._dataModel,X=b._datas._as,g=X.length;if(T){for(var r=T.length;r>m;m++)if(i=T[m],kf(i)&&(i=i.name),b.isHierarchicalRendering()){var W=function(B){return B._layer===i?n?t.call(n,B):t(B):void 0};if(this._dataModel.eachByHierarchical(W)===!1)return}else for(var F=0;g>F;F++)if(K=X[F],K._layer===i&&(s=n?t.call(n,K):t(K),s===!1))return}else if(b.isHierarchicalRendering())this._dataModel.eachByHierarchical(t,null,n);else for(;g>m;m++)if(K=X[m],s=n?t.call(n,K):t(K),s===!1)return},reverseEach:function(J,v){var f,Y,p,A,z=this._dataModel,L=z._layers,h=z._datas._as,u=h.length;if(L){for(f=L.length-1;f>=0;f--)if(A=L[f],kf(A)&&(A=A.name),z.isHierarchicalRendering()){var m=function(m){return m._layer===A?v?J.call(v,m):J(m):void 0};if(z.reverseEachByHierarchical(m)===!1)return}else for(var P=u-1;P>=0;P--)if(Y=h[P],Y._layer===A&&(p=v?J.call(v,Y):J(Y),p===!1))return}else if(z.isHierarchicalRendering())z.reverseEachByHierarchical(J,null,v);else for(f=u-1;f>=0;f--)if(Y=h[f],p=v?J.call(v,Y):J(Y),p===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var q=this,x=q._84I;if(!x){var K=this.dm().a("width"),j=this.dm().a("height");K>0&&j>0?q._84I={x:0,y:0,width:K,height:j}:(q.each(function(c){q.isVisible(c)&&(x=xl(x,q.getDataUIBounds(c)))}),q._84I=x?x:xh)}return q._84I},getScrollRect:function(){return xl(this.getContentRect(),this._29I)},makeCenter:function(J,k,d){var O=this;if(!O.getWidth()||!O.getHeight())return d||Wn(O.centerData,O,[J,k,!0],500),void 0;O.makeVisible(J),O.validate();var M=O.getDataUIBounds(J);if(M){var o=O.getWidth(),Y=O.getHeight(),w=M.x+M.width/2,v=M.y+M.height/2,K=-w*O._zoom+o/2,L=-v*O._zoom+Y/2;O.setTranslate(K,L,k)}},fitData:function(c,O,b,V,r){var n=this;if(!n.getWidth()||!n.getHeight())return r||Wn(n.fitData,n,[c,O,b,V,!0],500),void 0;var p=function(){n.makeVisible(c),n.validate();var Y=n.getDataUIBounds(c);Y&&(Y=mq(Y),Bi(Y,b==o?20:b),n.fitRect(Y,O,V))};O?w.callWhenLoaded(p):p()},fitContent:function(D,v,H,S){var Y=this;if(!Y.getWidth()||!Y.getHeight())return S||Wn(Y.fitContent,Y,[D,v,H,!0],500),void 0;var c=function(){Y.validate();var R=mq(Y.getContentRect());Bi(R,v==o?20:v),Y.fitRect(R,D,H)};D?w.callWhenLoaded(c):c()},fitRect:function(H,e,h){var i=this,u=i.getWidth(),I=i.getHeight(),l=H.x+H.width/2,Q=H.y+H.height/2,R=m(u/H.width,I/H.height),O=i._zoom,S=-l*O+u/2,$=-Q*O+I/2;0===R||isNaN(R)||(h&&(R=m(1,R)),e?(i._65I&&(delete i._65I.finishFunc,i._65I.stop(!0)),i._14o&&i._14o.stop(!0),i.setTranslate(S,$,{finishFunc:function(){i.setZoom(R,e)}})):(i.setTranslate(S,$),i.setZoom(R)))},toCanvas:function(Y,s){s=s||this._zoom,this.validateImpl();var c=this,r=c.getContentRect();r.width||(r.width=10),r.height||(r.height=10);var i=ep(),B=r.x*s,E=r.y*s,t=r.width*s,G=r.height*s;ol(i,t,G,1);var $=vp(i);return Y=Y||this._dataModel.getBackground(),Y&&Ql($,0,0,t,G,Y),Ii($,-B,-E),$.scale(s,s),c._42($),$.restore(),i},toDataURL:function(J,t,R){return this.toCanvas(J,R).toDataURL(t||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(P,Z){var $=this,b=$.dm().getBackground();if(b){var r=$.dm().a("width"),X=$.dm().a("height");r>0&&X>0&&Ql(P,0,0,r,X,b)}var z=$.__htmlOrderList,E=[];if($._93db(P,Z),$.each(function(g){var y=$.getDataUI(g);if(y){var q=$._56I[g._id],Q=y._htmlView;if(q){var T=y._79o();if(Q=y._htmlView,M.HtmlNode&&g instanceof M.HtmlNode)y._42(P);else{var s=$.getViewRect(),I=Q&&Q.layoutHTML;!Z||Sp(Z,T)?(I&&(Q.layoutHTML(),y.__outerLayout&&delete y.__outerLayout),y._42(P)):Sp(s,T)||!I||y.__outerLayout||(Q.layoutHTML(),y.__outerLayout=!0)}}Q&&(E.push(Q),Q.getView&&(Q=Q.getView()),Q.style.display=q?"block":sl)}}),z&&E.length>0){var K=!1;if(z.length!==E.length)K=!0;else for(var f=0;f<E.length;f++)if(E[f]!==z[f]){K=!0;break}K&&(E.forEach(function(Z){$.appendHTML(Z,!0)}),this.__htmlOrderList=E)}else this.__htmlOrderList=E;$._92db(P,Z)},validateImpl:function(){this.tryUpdateRootData();var T,R,c,P,M,g=this,Y=g.tx(),K=g.ty(),a=g._zoom,r=g._canvas,X=this.getWidth(),H=this.getHeight(),p=g._29I,D={x:-Y/a,y:-K/a,width:X/a,height:H/a},t={},W=g._34I,o=g._24I,F=g._32I,G=g._23I;g._24I={},(X!==r.clientWidth||H!==r.clientHeight)&&(ol(r,X,H),F=1),F||ys(D,p)||(F=1),g._29I=D,g.each(function(T){R=T._id;var e=t[R]=g.isVisible(T);e!==g._56I[R]&&(o[R]=T,c=g.getDataUI(o[R]),c&&c._84o(e),g._84o(T,e))},g);for(R in o)c=g.getDataUI(o[R]),c&&(!F&&g._56I[R]&&(M=c._79o(),M&&W.add(M)),c.invalidate()),g._83I=1;if(g._56I=t,!F)for(R in o)t[R]&&(c=g.getDataUI(o[R]),c&&(M=c._79o(),M&&W.add(M)));if(F?P=D:(W.each(function(m){Sp(D,m)&&(P=xl(P,m))}),P&&(Bi(P,J(1,1/a)),P.x=y(P.x*a)/a,P.y=y(P.y*a)/a,P.width=E(P.width*a)/a,P.height=E(P.height*a)/a,P=Hn(D,P))),g._74O=P,P){T=vp(r);var L=P.x,v=P.y,A=P.width,_=P.height;L=Math.floor((L*a+Y)*tb),v=Math.floor((v*a+K)*tb),A=Math.ceil(A*a*tb)+1,_=Math.ceil(_*a*tb)+1,T.beginPath(),T.rect(L,v,A,_),T.clip(),T.clearRect(L,v,A,_),ln(T,Y,K,a),g._42(T,P),T.restore(),delete g._74O}if(W.clear(),delete g._32I,G&&X>0&&H>0){var c=g.getDataUI(G);if(c){var M=c._79o(),z=g._29I,q=z.x,b=z.y,n=z.width,s=z.height,a=g._zoom;M&&!Sp(M,z)&&(M.x+M.width<q&&g.tx(-M.x*a),M.x>q+n&&g.tx(-(M.x+M.width-n)*a),M.y+M.height<b&&g.ty(-M.y*a),M.y>b+s&&g.ty(-(M.y+M.height-s)*a))}delete g._23I}g._83I&&(delete g._83I,delete g._84I),g._98O(),g.countFrame(),Od(g._24I)||Wn(g.iv,g)},tryUpdateRootData:function(){var K,M=this.getFullscreenDatas();for(var b in M)K=M[b],this.scaleRootData(K)},scaleRootData:function(n){var o=n.s("fullscreen");if("uniform"===o||"fill"===o){n.setRotation(0);var w,c=n.s("fullscreen.gap")||0,G=this.getWidth()-2*c,D=this.getHeight()-2*c,N=n.getAnchor(),Y=n.getScaledSize(),m=Y.width,W=Y.height,E=n.s("fullscreen.lock");if(E)return"uniform"===o?G/D>m/W?(w=D/W,m=W*G/D):(w=G/m,W=m*D/G):"v"===E?(w=D/W,m=G/w,n.setWidth(m)):(w=G/m,W=D/w,n.setHeight(W)),this.setZoom(w),this.tx(c-(n.getX()-N.x*m)*w),this.ty(c-(n.getY()-N.y*W)*w),void 0;var C=this.tx(),Q=this.ty();w=this._zoom;var z={x:(-C+c)/w,y:(-Q+c)/w,width:G/w,height:D/w};if("uniform"===o){var S=m/W,l=Math.min(z.width,z.height*S),i=l/S;z.x+=.5*(z.width-l),z.y+=.5*(z.height-i),z.width=l,z.height=i}n.setSize(z.width/n.getScaleX(),z.height/n.getScaleY()),n.setPosition(z.x+N.x*z.width,z.y+N.y*z.height)}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(O){var t=this;O!==t.isScrollBarVisible()&&(O?(ke(t._view,t._79O=tq()),ke(t._79O,t._27I=tq()),ke(t._79O,t._28I=tq())):(Cc(t._79O),delete t._79O,delete t._27I,delete t._28I),t.fp("scrollBarVisible",!O,O))},getDebugTip:function(){return""},showScrollBar:function(){var J=this;J._79O&&(J._85I||(a(function(){J._86I()},Ti),J.iv()),J._85I=new Date)},_86I:function(){var R=this;if(R._85I){var k=new Date,B=k.getTime();B-R._85I.getTime()>=Ti?(delete R._85I,R.iv()):a(function(){R._86I()},Ti)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var Q=this,q=this._27I,Z=this._28I;if(Q._79O){if(Q._autoHideScrollBar&&!Q._85I)return q.style.visibility=xp,Z.style.visibility=xp,void 0;var n=Q.getScrollBarColor(),l=Q._zoom,U=Q.getScrollBarSize(),T=Q.getViewRect(),X=Q.getScrollRect(),a=T.height*l,i=X.height*l,k=T.width*l-U-2,w=a*((T.y-X.y)*l/i),A=a*(a/i),p=q.style;i-.5>a?(ks>A&&(w=w+A/2-ks/2,0>w&&(w=0),w+ks>a&&(w=a-ks),A=ks),pq(q,k,w,U,A),p.visibility=Qr,p.background=n,p.borderRadius=U/2+lo):p.visibility=xp;var y=T.width*l,R=X.width*l,w=T.height*l-U-2,k=y*((T.x-X.x)*l/R),M=y*(y/R),p=Z.style;R-.5>y?(ks>M&&(k=k+M/2-ks/2,0>k&&(k=0),k+ks>y&&(k=y-ks),M=ks),pq(Z,k,w,M,U),p.visibility=Qr,p.background=n,p.borderRadius=U/2+lo):p.visibility=xp}},setDataModel:function(o){var w=this,O=w._dataModel,l=w._selectionModel;O!==o&&(O&&(O.ump(w.handleDataModelPropertyChange,w),O.umm(w.handleDataModelChange,w),O.umd(w.handleDataPropertyChange,w),O.removeIndexChangeListener(w._75O,w),O.removeHierarchyChangeListener(w.handleHierarchyChange,w),l||O.sm().ums(w.handleSelectionChange,w)),w._dataModel=o,o.mp(w.handleDataModelPropertyChange,w),o.mm(w.handleDataModelChange,w),o.md(w.handleDataPropertyChange,w),o.addIndexChangeListener(w._75O,w),o.addHierarchyChangeListener(w.handleHierarchyChange,w),l?l._21I(o):o.sm().ms(w.handleSelectionChange,w),w.invalidateAll(!0),w.fp(Ur,O,o),w.updateBackground())},getLayersInfo:function(){if(this._layersInfo===C){var p=this.getLayers();p?(this._layersInfo={},p.forEach(function(M){var D=kf(M)?M.name:M;this._layersInfo[D]=M},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(L,F,V){var I,i,s=this,v=s.getDataUI(L),u=Ol(v),z=zn(F,function(w){return pf(u,100*w)},100,.001),d=pf(u,100*z);if(!V){var Y=Op(v),k=new Ym(d.x,d.y),B=49/(s._zoom*s._zoom);for(I=0,i=Y.length;i>I;I++)if(k.distanceToSquared(Y[I])<B)return{index:I,point:Y[I],distance:Math.sqrt((Y[I].x-F.x)*(Y[I].x-F.x)+(Y[I].y-F.y)*(Y[I].y-F.y))}}return{percent:z,point:d,distance:Math.sqrt((d.x-F.x)*(d.x-F.x)+(d.y-F.y)*(d.y-F.y))}},calculateAttachPoint:function(){var x=new Ym,r=new Ym,C=new Ym;return function(j,O){var D=this.getAttachPoints(j);if(!D||!D.length)return null;C.set(O.x,O.y);for(var c,W,X,k,Q=1/0,J=0,f=D.length;f>J;J++)X=D[J],r.x=X.x,r.y=X.y,x.x=X.offsetX||0,x.y=X.offsetY||0,k=tm(this,j,0,x.x,x.y,r.x,r.y),W=C.distanceToSquared(k),Q>W&&(c=J,Q=W);Q=Math.sqrt(Q);var H=this.getAttachStyle(j);if("close"===H){var y=j.s("attach.close.threshold")/this._zoom;if(Q>y)return null}return{index:c,distance:Q,info:D[c]}}}(),getAttachPoints:function(C){var e=C.s("attach.points");if(e)return e;var A=Wl(C._image);return A?Bs(A.attachPoints,C,this)||null:void 0},getAttachStyle:function(d){var C=d.s("attach.style");if(C)return C;var P=Wl(d._image);return P?Bs(P.attachStyle,d,this)||"close":void 0},updateLayers:function(){this._layersInfo=C,this.invalidateSelection(),this.redraw()},updateBackground:function(){var J=this.dm().a("width"),q=this.dm().a("height");this._canvas.style.background=J>0&&q>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(d){if("background"===d.property){var j=this._canvas.style.background,V=d.newValue||"";this.updateBackground(),this.fp("canvasBackground",j,V),this.redraw()}else"a:width"===d.property||"a:height"===d.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===d.property?this.updateLayers():"hierarchicalRendering"===d.property&&this.redraw()},handleDataPropertyChange:function(Q){this.dm().isHierarchicalRendering()&&"parent"===Q.property&&Q.data.hasChildren()&&this.redraw(),this.invalidateData(Q.data)},onPropertyChanged:function(I){var G=this,i=I.property;if(G.redraw(),"zoom"===i){var B=G.sm().getSelection();B.size()&&B.each(function(Z){Z.invalidate()})}Qo[i]?G.showScrollBar():i===Pb&&G.onCurrentSubGraphChanged(I)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(U){var g=this,T=U.kind,V=U.data;if(g._83I=1,"add"===T)g.invalidateData(V),ps(V)&&V.getEdgeGroup()&&V.getEdgeGroup().eachSiblingEdge(g.invalidateData,g);else if(T===nm){g._21Q(V);var E=V._id,t=g._25I[E];if(t){if(g._56I[E]){var D=t._79o();D&&g.redraw(D)}t.dispose(),delete g._25I[E],delete g._24I[E],delete g._56I[E]}V===g._currentSubGraph&&g.setCurrentSubGraph(o)}else T===fq&&(g.invalidateAll(!0),g.setCurrentSubGraph(o))},_75O:function(O){this.invalidateData(O.data)},handleHierarchyChange:function(B){this.dm().isHierarchicalRendering()&&B.data.hasChildren()&&this.redraw(),this.invalidateData(B.data)},adjustIndex:function(D){var U=this;if(U.isVisible(D)){U.dm().beginTransaction();for(var E=D;E._parent&&U.isVisible(E._parent);)E=E._parent;E&&E!==D&&U._dataModel.adjustIndex(E),U._dataModel.adjustIndex(D),U.dm().endTransaction()}},getImage:function(t){return t.getImage?t.getImage():C},getSelectWidth:function(z){var j=Wl(this.getImage(z));return j&&Bs(j.disableSelectedBorder,z,this)?0:z.s("select.width")},getSelectColor:function(n){return n.s("select.color")},isSelectable:function(z,A){if(this.isSelected(z))return!0;if(!A&&z.getParent()instanceof Uk&&this.isSelectable(z.getParent(),!0)&&z.getParent().isSyncSize())return!1;var c=this.getLayersInfo();if(c){var n=c[z._layer];if(n&&n.selectable===!1)return!1}return z.s("2d.selectable")&&this.sm().isSelectable(z)},isMovable:function(Y){var p=this;if(ps(Y)&&Y.getStyle(Xq)!==_g)return!1;var s=this.getLayersInfo();if(s){var J=s[Y._layer];if(J&&J.movable===!1)return!1}return Y.s("2d.movable")?p._movableFunc?p._movableFunc(Y):!0:!1},isEditable:function(g){var B=this;if(M._uiSerializing)return B._uieditable;if(!B._editInteractor||!B.isSelected(g))return!1;if(zi(g)){var u=B.getDataUI(g);if(!u||u._88I)return!1}if(ps(g)&&g.getStyle(Xq)!==_g)return!1;var C=this.getLayersInfo();if(C){var L=C[g._layer];if(L&&L.editable===!1)return!1}return g.s("2d.editable")?B._editableFunc?B._editableFunc(g):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(P){return yr(P)&&0!==P.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(P):!0},isRectEditable:function(M){return this._rectEditableFunc?this._rectEditableFunc(M):!0},isAnchorEditable:function(e){return this._anchorEditableFunc?this._anchorEditableFunc(e):!0},isRotationEditable:function(U){return U.setRotation&&U.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(U):!0:!1},getRotationPoint:function(l){var $=l.getAnchor(),i=l.getScale(),g=this._zoom,a=ej(l.getRotation(),0,-l.getHeight()*i.y*$.y-(i.y<0?-1:1)*(Em?32:16)/g),q=l.p();return a.x+=q.x,a.y+=q.y,a},getLogicalPoint:function(u){var d=this;return xk(u,d._canvas,d.tx(),d.ty(),d._zoom,d._zoom)},getScreenPoint:function(b,g){var K,k=this;return"object"==typeof b?b.x!==C?(K=b.x,g=b.y):(K=b[0],g=b[1]):K=b,Tg(K,g,k._canvas,k.tx(),k.ty(),k._zoom,k._zoom)},getSelectedDataAt:function(e){var a=this;return this.getDataAt(e,function(V){return a.isSelected(V)})},getDataInfoAt:function(h,O,N){var g,c=this.lp(h),v=this.getDataAt(c,O,N);if(v){var $=this.getDataUI(v);g={data:v,ui:$,point:c};var z=$._38o;if(z){var f=z.icons;for(var Y in f){var P=f[Y],s=z.rects[Y];if(s)for(var p=Bs(P.names,v,this),A=p?p.length:0,C=s.rotation,d=A-1;d>=0;d--){var R=p[d],_=s[d];if(lq(_,c,C))return g.part="icons",g.name=Y,g.icon=R,g.rect=_,g.index=d,g.rotation=C,g}}}if(this.isNoteVisible(v)){if($.note2Info&&lq($.note2Info.clickRect,c,o,$.note2Info.scale))return g.part="note2",g;if($.noteInfo&&lq($.noteInfo.clickRect,c,o,$.noteInfo.scale))return g.part="note",g}if(this.isLabelVisible(v)){if($.label2Info&&lq($.label2Info.rect,c,$.label2Info.rotation,$.label2Info.scale))return g.part="label2",g;if($.labelInfo&&lq($.labelInfo.rect,c,$.labelInfo.rotation,$.labelInfo.scale))return g.part="label",g}if(v.isInRect&&v.isInRect(c))return g.part="body",g}return g},getDataAt:function(c,P,r){c.target&&(c=this.lp(c));var B,p=this._zoom;return this.reverseEach(function(g){return(P?P(g):this.isSelectable(g))&&this.rectIntersects(g,Jr(c.x,c.y,r,p))?(B=g,!1):void 0},this),B},getIconInfoAt:function(G,q){var g=this;if(G.target&&(G=g.lp(G)),q||(q=g.getDataAt(G)),q){var N=g.getDataUI(q);
if(N&&N._38o){var c,s=N._38o,n=new Uh;for(c in s.icons)n.add(c);for(var z=n.size()-1;z>=0;z--){c=n.get(z);for(var m=s.rects[c],i=m.rotation,W=m.length-1;W>=0;W--){var l=m[W],Q=l.width,M=l.height,a={x:G.x-l.x-Q/2,y:G.y-l.y-M/2};i!=o&&(a=ej(-i,a.x,a.y));var l={x:-Q/2,y:-M/2,width:Q,height:M};if(lq(l,a))return{key:c,index:W,name:s.icons[c].names[W],rect:m[W],point:G,rotation:i,relativeRect:l,relativePoint:a,data:q}}}}}return o},getDatasInRect:function(h,M,k){k===C&&(k=1);var Z=this,B=new Uh;return Z.reverseEach(function(P){k&&!Z.isSelectable(P)||(M?Z.rectIntersects(P,h):Z.rectContains(P,h))&&B.add(P)}),B},moveSelection:function($,d){var G=this;G.dm().beginTransaction(),Wj(G.sm().toSelection(G.isMovable,G),$,d),G.dm().endTransaction()},moveDatas:function(f,Q,n){var U=this;U.dm().beginTransaction(),f instanceof Uh||(f=new Uh(f)),Wj(f,Q,n),U.dm().endTransaction()},getDataUIBounds:function(i){var X=this.getDataUI(i);return X?X._79o():o},drawData:function(D,b,I){var O=this.getDataUI(b);if(O){var h=O._79o();(!I||Sp(I,h))&&(O._42(D),b instanceof M.Block&&b.eachChild(function(B){this.drawData(D,B,I)},this))}},getBoundsForGroup:function(T){return T.s(gn)?this.getDataUIBounds(T):o},isPixelPerfect:function(o){return o.s("pixelPerfect")},rectIntersects:function(Q,b){this.validate();var V=o;if(this._56I[Q._id]){var v=this._25I[Q._id];if(v){var M=v._79o();if(sh(b,M))V=!0;else if((b=Hn(b,M))&&(v.rectIntersects&&(V=v.rectIntersects(b)),V==o)){if(!this.isPixelPerfect(Q))return!0;var Y=b.x,d=b.y,t=b.width,R=b.height,E=this._zoom,z=w.hitMaxArea,s=t*R*E*E;if(s>z){var A=Math.sqrt(z/s);E*=A}t*=E,R*=E,2>t&&(t=2),2>R&&(R=2),Y*=E,d*=E;var c=Kc(t,R);Ii(c,-Y,-d),c.scale(E,E),this._drawForChecking=!0,this.drawData(c,Q,b),this._drawForChecking=!1;try{for(var W=0,k=c.getImageData(0,0,t,R).data;W<k.length;W+=4)if(0!==k[W+3]){V=!0;break}c.restore()}catch(e){_l=o,V=!1}}}}return V?!0:!1},rectContains:function(M,e){if(this._56I[M._id]){var D=this._25I[M._id];if(D)return sh(e,D._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(s){if(!w.isInput(s.target)){var d=this,t=d._focusData,F=t&&d._25I[t._id],T=0,C=d._dataModel._datas;if(!(t&&t._enabled&&t._editable&&F&&F.onKeyDown&&F.onKeyDown(s)===!0))if(9===s.keyCode&&(t&&(T=C.indexOf(t),gb(s)?-1===--T&&(T=0):++T===C.size()&&(T=0)),d._focusData=t=C.get(T),d.sm().setSelection(t)),Fp(s)?d.selectAll():rp(s)&&d.isResettable()&&d.reset(),d.sm().isEmpty()){if(d._editing)return;var g=d.tx(),l=d.ty(),e=!1,o=gb()?100:10;us(s)&&(g-=o,e=!0),ni(s)&&(l-=o,e=!0),nq(s)&&(g+=o,e=!0),Bd(s)&&(l+=o,e=!0),e&&d.setTranslate(g,l)}else{jp(s)&&d.handleDelete(s);var k=gb()?10:1;us(s)&&(d.moveSelection(-k,0),d.fi({kind:"moveLeft"})),ni(s)&&(d.moveSelection(0,-k),d.fi({kind:"moveUp"})),nq(s)&&(d.moveSelection(k,0),d.fi({kind:"moveRight"})),Bd(s)&&(d.moveSelection(0,k),d.fi({kind:"moveDown"}))}}},handleScroll:function(T,Z){if(Eb(T),this.isZoomable()){if(!this.getEditInteractor()){var x=this.getDataAt(T);if(x){var O=Wl(this.getImage(x));if(O&&Bs(O.scrollable,x,this))return}}var e=this.lp(T);Z>0?this.scrollZoomIn(e):0>Z&&this.scrollZoomOut(e)}},handlePinch:function(R,I,t){this.isZoomable()&&(this._68I||(I>t?this.pinchZoomIn(R):this.pinchZoomOut(R)))},checkDoubleClickOnNote:function(M,b){var O=this,t=O.lp(M),y=O.getDataUI(b),g=y.note2Info;return g&&b.s("note2.toggleable")&&lq(g.clickRect,t)?(b.s(Vb,!b.s(Vb)),O.fi({kind:"toggleNote2",event:M,data:b}),!0):(g=y.noteInfo,g&&b.s("note.toggleable")&&lq(g.clickRect,t)?(b.s(If,!b.s(If)),O.fi({kind:"toggleNote",event:M,data:b}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(s,t){var G=this,P=G.getAutoScrollZone(),l=P/G.getZoom(),w=P/4,e=G._29I,W=G.lp(s),f={x:G.tx(),y:G.ty()};return W&&P>0&&e&&(W.x-e.x<l?G.translate(w,0):e.x+e.width-W.x<l&&G.translate(-w,0),W.y-e.y<l?G.translate(0,w):e.y+e.height-W.y<l&&G.translate(0,-w)),f.x=G.tx()-f.x,f.y=G.ty()-f.y,t&&(t.x+=f.x,t.y+=f.y),f},getMoveMode:function(t,q){var y=q.s("2d.move.mode");return y?y:De["88"]?"x":De["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(e,F,L){var J=this;return"currentSubGraph"===F?{__i:e.getId()}:L.serializeProperty(e,F,J)},deserializeProperty:function(h,t,l){var J=this;if("currentSubGraph"===t){var M=J.dm(),v=M.__idMap;return v[h.__i]}return l.deserializeProperty(h,t,J)},setDefaultCursor:function(i,y){this._defaultCursor=i,y!==!1&&this.setCursor(i)},setCursor:function(e){"default"===e&&(e=this._defaultCursor||e);var k=this.getView().style;k.cursor=e,k.cursor="-webkit-"+e,k.cursor="-moz-"+e},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(Z){return Z===o||w.getConnectAction(null,Z)?(this._currentActionType=Z,this.redraw(),!0):!1},getEditStyle:function(t){var E=this.getEditInteractor();return E?E.getStyle(t):C},setEditStyle:function(A,b,R){var Y=this.getEditInteractor();return Y?(Y.setStyle(A,b,R),!0):!1},isConnectActionVisible:function(v){var C=w.getConnectAction(this);if(!C)return!1;var D=C.visible;return pg(D)&&(D=D(this,v)),D},isInteractive:function(y){var G=Wl(this.getImage(y));return G&&Bs(G.interactive,y,this)?!0:y.s("interactive")},appendHTML:function(i,x){var O=this.getView();if(!(x||i&&i.parentNode!==O))return!1;var n=i.getView&&i.getView();if(!x&&n&&n.parentNode===O)return!1;(i.getView||i.isSelfViewEvent)&&(i=i.getView());var v=this.getEditInteractor();return v&&v._canvas?O.insertBefore(i,v._canvas):this.isScrollBarVisible()?O.insertBefore(i,this.getView().lastChild):ke(O,i),!0},_layoutHTMLImpl:function(n,R,y){if(arguments.length>1){var Q,l=this,t=l._zoom;if(R.getView&&(Q=R,R=R.getView()),R.style.position="absolute",y){var k=n.getRect();pq(Q||R,l.tx()+k.x*t,l.ty()+k.y*t,k.width*t,k.height*t)}else{var W=new xc,k=n.getAnchorRect(),$=n.getPosition(),L=n.getScale(),Z=R.style;pq(Q||R,k),W.appendTranslate(l.tx(),l.ty()),W.appendScale(t,t),W.append(new xc(n.getRotation(),$.x,$.y,L.x,L.y)),Vm(Z,"transform","matrix("+W.a.toFixed(5)+", "+W.b.toFixed(5)+", "+W.c.toFixed(5)+",\n    "+W.d.toFixed(5)+", "+W.tx.toFixed(5)+", "+W.ty.toFixed(5)+")"),Vm(Z,"transformOrigin",(-k.x).toFixed(5)+"px "+(-k.y).toFixed(5)+"px"),R.maxtrixAppend=W.invert().translate(-k.x,-k.y)}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(l){return l instanceof Pf?{name:"text",accessType:"s",isMultiline:!1}:void 0}}),v.defineProperties(nk.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(c){this._layoutHTML=c}}});var cn=function(C,M){var u=this;u.gv=C,u.s=function($){return M.getStyle($)},u._data=M,u._87I=new Uh};_p(cn,v,{_6I:o,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var c=this,g=c.gv.isSelected(c._data);return!g||c.isShadowed()?0:c.gv.getSelectWidth(c._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(M){var w=this._data,D=this.gv.getBodyColor(w);return D?D:M?w.getStyle(M):o},_2Q:function(G){return this.s(G)},_1Q:function(Z,c,y,r){var W=this.s,h=W("2d.gray"),J=W(c+".dash.color");if(h&&(J=w.toGrayColor(J)),Z.strokeStyle=J,Z.lineWidth=y,Z.stroke(),W(c+".dash.3d")){var m=W(c+".dash.3d.color");Vi(Z,J,h?w.toGrayColor(m):m,y,this.gv._zoom,W(c+".dash.3d.accuracy"))}hq(Z,r)},invalidate:function(){this._6I=o},_79o:function(){var N=this;if(!N._6I){var j=N._data,X=N.gv;N.labelInfo=N.label2Info=N.noteInfo=N.note2Info=N._38o=o,N._87I.clear(),N.interactiveInfo=X.isInteractive(j)?{}:o,N._3O(),N._55O=X.isEditable(j)?{_42O:X.isRectEditable(j),_43O:X.isPointEditable(j),_56O:X.isRotationEditable(j)}:o,N._6I=N._81o()}return N._6I},_3O:function(){},getPosition:function(){return xh},_68o:function(w,r){w&&this._87I.add(kh(w,r))},_81o:function(){var G=this,T=G.s;G._24O(uq,"getLabel"),G._24O(qm,"getLabel2"),G._26O(Fk,"getNote"),G._26O(Sn,"getNote2"),G._15O(),G._55O&&G._48O();var c;if(G._87I.each(function(i){c=xl(c,i)}),c&&G.isShadowed()){var Q=mq(c);Q.x+=T("shadow.offset.x"),Q.y+=T("shadow.offset.y"),Bi(Q,T("shadow.blur")),c=xl(c,Q)}return G._87I.clear(),c},_42:function(O){var C=this,B=C._data,E=C.gv,n=C.s,Z=n("opacity"),Q=this.isShadowed();if(Q){var g=O.shadowOffsetX,N=O.shadowOffsetY,L=O.shadowBlur,K=O.shadowColor,T=E.getZoom();O.shadowOffsetX=n("shadow.offset.x")*T,O.shadowOffsetY=n("shadow.offset.y")*T,O.shadowBlur=n("shadow.blur")*T,O.shadowColor=C.getSelectColor()}if(Z!=o){var S=O.globalAlpha;O.globalAlpha=Z}C._80o(O),E.isLabelVisible(B)&&((!E._drawForChecking||n("label.selectable"))&&Xh(O,C.labelInfo),(!E._drawForChecking||n("label2.selectable"))&&Xh(O,C.label2Info)),E.isNoteVisible(B)&&($d(O,C.noteInfo),$d(O,C.note2Info)),C._99O(O),Z!=o&&(O.globalAlpha=S),Q&&(O.shadowOffsetX=g,O.shadowOffsetY=N,O.shadowBlur=L,O.shadowColor=K)},_80o:function(){},_47O:function(){},_24O:function(p,C){var V=this,i=V._data,$=V.gv,U=V.s,B=$[C](i);if(B!=o){var h=U(p+".scale"),R=U(p+".max"),w=U(p+".position"),Y=V[p+"Info"]={label:B,scale:h,color:$[C+"Color"](i),font:U(p+".font"),opacity:U(p+".opacity"),align:U(p+".align"),rotation:V.getRotation(U(p+".rotation"),!1,w),background:$[C+"Background"](i)},T=_r(Y,B);R>0&&R<T.width&&(Y.labelWidth=T.width,T.width=R),1!==h&&(T.width*=h,T.height*=h);var c=V.getPosition(w,U(p+".offset.x"),U(p+".offset.y"),T,U(p+".position.fixed"));if(T.x=c.x-T.width/2,T.y=c.y-T.height/2,V._68o(Y.rect=T,Y.rotation),1!==h){var I=T.width/h,d=T.height/h;Y.rect={x:c.x-I/2,y:c.y-d/2,width:I,height:d}}}},_26O:function(X,T){var r=this,Y=r.gv,v=r._data,A=r.s,y=Y[T](v);if(y!=o){var z,M,g=A(X+".scale"),C=r[X+"Info"]={note:y,scale:g,data:v,view:Y,expanded:A(X+".expanded"),font:A(X+".font"),color:A(X+".color"),opacity:A(X+".opacity"),align:A(X+".align"),icon:A(X+".icon"),backgroundImage:A(X+".backgroundImage"),borderWidth:A(X+".border.width"),borderColor:A(X+".border.color"),background:Y[T+"Background"](v)},b=r.getPosition(A(X+".position"),A(X+".offset.x"),A(X+".offset.y")),L=b.x,Q=b.y;if(C.expanded){var R,I=A(X+".max"),t=A(X+".backgroundImage");t?(t=Wl(t),R={width:lj(t,v),height:sr(t,v)}):R=_r(C,y),R.width+=6,R.height+=2,I>0&&I<R.width&&(C.labelWidth=R.width,R.width=I),z=R.width,M=R.height+8,C.clickRect={x:L-z*g/2,y:Q-M*g,width:z*g,height:M*g*R.height/M}}else{var n=A(X+".icon");n?(n=Wl(n),z=lj(n,v),M=sr(n,v)):(z=12,M=18),C.clickRect={x:L-z*g/2,y:Q-M*g,width:z*g,height:M*g}}C.rect={x:L-z/2,y:Q-M*g/2-M/2,width:z,height:M};var U=E(C.borderWidth/2)*g;r._68o({x:L-z*g/2-U,y:Q-M*g-U,width:z*g+2*U,height:M*g+2*U})}},_48O:function(){},_99O:function(Q){var u=this,e=u._38o;if(e){var R=u.gv,$=u._data,I=e.icons,h=u.interactiveInfo;h&&(h._38o={});for(var i in I){var O=I[i],G=e.rects[i];if(G){h&&(h._38o[i]=[]);var z=Bs(O.opacity,$,R),C=Bs(O.names,$,R),J=C?C.length:0,g=G.rotation;if(z!=o){var P=Q.globalAlpha;Q.globalAlpha*=z}for(var A=0;J>A;A++){var U=C[A],t=Wl(U),a=G[A];if(g){var l=a.x+a.width/2,E=a.y+a.height/2;Q.save(),Ii(Q,l,E),Gg(Q,g),Ii(Q,-l,-E)}h&&h._38o[i].push(Q.interactiveInfo={compInfos:[],matrix:g?new xc(g,l,E).appendTranslate(-l,-E):new xc}),im(Q,t,Bs(O.stretch,$,R),a.x,a.y,a.width,a.height,u._data,u.gv),Q.interactiveInfo=o,g&&Q.restore()}z!=o&&(Q.globalAlpha=P)}}}}});var Vf=function(l,e){ek(Vf,this,[l,e])};_p(Vf,cn,{_checkEmptyRect:!0,_40O:function(S,R){var M=this,w=M.s,A=S.rect;(S.borderColor=M.gv.getBorderColor(M._data))&&(S.borderType=w("border.type"),S.borderWidth=w("border.width"),S.borderPadding=w("border.padding"),R=J(R,S.borderPadding+S.borderWidth/2));var P=M._data.getScale(),O=J(1,J(T(P.x),T(P.y)));if(S.selectWidth=M.getSelectWidth()){var p=M.gv._zoom;S.selectType=w("select.type"),S._97o=M.getSelectColor(),S.selectPadding=w("select.padding"),R=J(R,(S.selectPadding+S.selectWidth/2/p)/O)}R>0&&(R*=O,A=mq(A),Bi(A,R)),M._68o(A)},_39O:function(r,j){var I,L=this,c=j.rect;if(j.borderWidth>0&&(I=j.borderPadding,r.strokeStyle=j.borderColor,r.lineWidth=j.borderWidth,Ej(r,j.borderType,{x:c.x-I,y:c.y-I,width:c.width+2*I,height:c.height+2*I}),r.stroke()),j.selectWidth>0){var A=L.gv._zoom;if(I=j.selectPadding,r.strokeStyle=j._97o,r.lineWidth=j.selectWidth/A,j.rotation!=o){r.save(),r.translate(j.position.x,j.position.y),r.rotate(j.rotation);var x=L._data,Q=x.getWidth(),V=x.getHeight(),R=j.scale,l=j.anchor;c={x:R.x*-Q*l.x,y:R.y*-V*l.y,width:R.x*Q,height:R.y*V}}Ej(r,j.selectType,{x:c.x-I,y:c.y-I,width:c.width+2*I,height:c.height+2*I}),j.rotation!=o&&r.restore(),r.stroke()}},dispose:function(){var F=this,y=F._htmlView;Vf.superClass._3O.call(F),y&&(y.onHTMLRemoved&&y.onHTMLRemoved(),Cc(y))},_3O:function(){var t=this,S=t.s,A=t._data,e=t.gv,K=A.getStyle(Dg),u=t.getBodyColor(),k=t._83o=K?{shape:K,_53o:t.getBodyColor("shape.background"),_27Q:Wl(S("shape.repeat.image"),u),shapeGradientPack:S("shape.gradient.pack"),_54o:S("shape.border.width"),_55o:S("shape.border.color"),_56o:S("shape.border.3d"),_57o:S("shape.border.3d.color"),_58o:S("shape.border.3d.accuracy"),shapeGradient:S("shape.gradient"),_59o:S("shape.gradient.color"),_60o:S("shape.border.pattern"),_61o:S("shape.border.cap"),_62o:S("shape.border.join"),shapeForeground:S("shape.foreground"),bodyColor:u,gray:S("2d.gray")}:{img:Wl(e.getImage(A),u),bodyColor:u,gray:S("2d.gray"),stretch:S("image.stretch")};if(B&&!U);else{var F,C=k.img;C&&C.renderHTML?(t._htmlInfo&&t._htmlInfo.img!==C&&(t._htmlInfo=o),t._htmlInfo||(t._htmlInfo={img:C,cache:{}}),F=C.renderHTML(A,e,t._htmlInfo.cache)):t._htmlInfo=o,t._htmlView&&t._htmlView!==F&&(t._htmlView.onHTMLRemoved&&t._htmlView.onHTMLRemoved(),Cc(t._htmlView.getView?t._htmlView.getView():t._htmlView)),(t._htmlView=F)&&e.appendHTML(F)&&(F.onHTMLAddedSync&&F.onHTMLAddedSync(),F.onHTMLAdded&&Wn(F.onHTMLAdded)),k.rect=A.getRect(),k.position=A.p(),k.scale=A.getScale(),k.anchor=A.getAnchor(),k.rotation=A.getRotation(),K===jo&&(k._63o=S("shape.depth"));var O=0;if(K)O=Mq(o,k._54o/2,k._62o),t.s("shape.dash")&&(O=J(O,(t.s("shape.dash.width")||k._54o)/2));else if(C&&C.boundExtend)if(O=Bs(C.boundExtend,A,e),C.boundExtendAbsolute){var i=A.getScale();O/=e._zoom*J(1,J(T(i.x),T(i.y)))}else if(!Bs(C.fitSize,A,e)){var H=Bs(C.width,A,e),_=Bs(C.height,A,e);O*=J(A.getWidth()/H,A.getHeight()/_)}t._40O(k,O);var r=S("clip.percentage");if(1>r&&(0>r&&(r=0),k.clipRect=zh(A.getAnchorRect(),S("clip.direction"),r)),K){var g=S("shape.fill.clip.percentage");1>g&&(0>g&&(g=0),k.shapeClipRect=zh(A.getAnchorRect(),S("shape.fill.clip.direction"),g));var R=S("shape.foreground.clip.percentage");1>R&&(0>R&&(R=0),k.shapeForegroundClipRect=zh(A.getAnchorRect(),S("shape.foreground.clip.direction"),R))}}},getPosition:function(Y,U,K,B){var y=dm(Y,this._83o.rect,B);return y.x+=U,y.y+=K,y},_80o:function(x){var M=this,F=M.s,U=M.gv,g=M._data,Q=M._83o,f=Q.rect,P=Q.position,A=Q.rotation,E=Q.anchor,H=Q.scale,_=Q.shape,L=Q.clipRect;if(!M._checkEmptyRect||f.width>0&&f.height>0){var K=g.getSize();if(K.x=-K.width*E.x,K.y=-K.height*E.y,x.save(),Ii(x,P.x,P.y),Gg(x,A),ff(x,H.x,H.y),L&&(x.beginPath(),x.rect(L.x,L.y,L.width,L.height),x.clip()),U._drawForChecking&&Q.img&&Bs(Q.img.pixelPerfect,g,U)===!1)Ql(x,K.x,K.y,K.width,K.height,"#888888");else if(M.freeDraw)M.freeDraw(x,K,Q);else if(_){var h,Y,n,p,C=Q._60o,R=kb(x,C),S=Q._27Q,s=Q._54o,Z=Q.shapeGradientPack,k=Q.gray,j=x.lineJoin,X=x.lineCap,B=function(G){return k?w.toGrayColor(G):G};"roundRect"===_?h=F("shape.corner.radius"):"polygon"===_?h=F("shape.polygon.side"):"arc"===_&&(h=F("shape.arc.from"),Y=F("shape.arc.to"),n=F("shape.arc.close"),p=F("shape.arc.oval")),x.lineJoin=Q._62o,x.lineCap=Q._61o;var e=B(Q._53o);if(e||S||Z){var W=Q.shapeClipRect;W&&(x.save(),x.beginPath(),x.rect(W.x,W.y,W.width,W.height),x.clip()),Ej(x,_,K,h,Y,n,p),Z?os(x,Z):S?eh(x,S,B(Q.bodyColor),null,g,U):yd(x,e,Q.shapeGradient,B(Q._59o),K),x.fill(),W&&x.restore(),Z&&x.restore(),x!==R&&Ej(R,_,K,h,Y,n,p)}else Ej(R,_,K,h,Y,n,p);var c=Q.shapeForeground;if(c){x.save();var r=Q.shapeForegroundClipRect;r&&(x.beginPath(),x.rect(r.x,r.y,r.width,r.height),x.clip()),Ej(x,_,K,h,Y,n,p),yd(x,c,F("shape.foreground.gradient"),B(F("shape.foreground.gradient.color")),K),x.fill(),x.restore()}if(s>0){var a=F("shape.border.width.absolute");a&&(x.save(),x.setTransform(1,0,0,1,0,0)),x.lineWidth=s;var t=B(Q._55o);x.strokeStyle=t,x.stroke(),a&&x.restore(),Q._56o&&Vi(x,t,B(Q._57o),s,U._zoom,Q._58o)}if(hq(x,C),F("shape.dash")){var q=F("shape.dash.width")||s;if(q>0){C=F("shape.dash.pattern");var R=kb(x,C,M._2Q("shape.dash.offset"));R!==x&&Ej(R,_,K,h,Y,n,p),M._1Q(x,"shape",q,C)}}Ie(x,e,Q._63o,K),x.lineJoin=j,x.lineCap=X}else{var T=M.interactiveInfo;T&&(x.interactiveInfo=T.bodyInfo={compInfos:[],matrix:new xc(A,P.x,P.y,H.x,H.y)}),Q.gray&&(x.compGray=!0);var u=Q.img;u&&u.cacheRule!=o&&(u=Wq(x,u,Q.stretch,K.width,K.height,g,U,Q.bodyColor)),im(x,u,Q.stretch,K.x,K.y,K.width,K.height,g,U,Q.bodyColor),x.compGray=!1,x.interactiveInfo=o}x.restore()}M._39O(x,Q)},_48O:function(){},_47O:function(){}});var mo=function(r,K){ek(mo,this,[r,K])},Pj=function(F,$,j,l){var u=$q(F,$);return j=l?m(j,u):gq(j,u),u?j/=u:j=0,{x:F.x+($.x-F.x)*j,y:F.y+($.y-F.y)*j}};_p(mo,cn,{_3O:function(){var N,k=this,I=k._data,$=k.gv,A=k.s,d=A(Xq),V=I.isLooped(),B=A("edge.width"),x=A("edge.center"),K=A("edge.offset"),Q=$.getBorderColor(I),L=Q?A("border.width"):0,c=k.getSelectWidth(),U=I._40I,b=I._41I,j=k._78o=U&&b?{looped:V,type:d,width:B,center:x,color:k.getBodyColor("edge.color"),borderColor:Q,borderWidth:L,_97o:c?k.getSelectColor():o,selectWidth:c,pattern:A("edge.pattern"),cap:A("edge.cap"),join:A("edge.join"),is3d:A("edge.3d"),_67o:A("edge.3d.color"),_66o:A("edge.3d.accuracy"),gray:A("2d.gray")}:o;if(j){var O=w.getEdgeType(d);if(O){var n=O(I,Sk(k,$,I,V,d),$,k._19Q);n.points&&n.points.size()>1?(j.edgeTypeInfo=n,N=nb(j.edgeTypeInfo.points)):n[fj]&&n.rect&&(j.edgeTypeInfo=n,N=n.rect)}else{var G=A("edge.source.anchor.x"),R=A("edge.source.anchor.y"),f=A("edge.target.anchor.x"),r=A("edge.target.anchor.y"),t=ss($,I,"source"),u=ss($,I,"target");if(d===_g){var l=j.points=A(to)||Oo,m=l.size();j.segments=A("edge.segments");var H=G!==C||R!==C||ps(U),z=f!==C||r!==C||ps(b);if(!x)if(K)H||(t=Pj(t,m?l.get(0):u,K,m)),z||(u=Pj(u,m?l.get(m-1):t,K,m));else{var X;H||(X=se(t,m?l.get(0):u,Pe($,U)),X&&(t={x:X[0],y:X[1]})),z||(X=se(m?l.get(m-1):t,u,Pe($,b)),X&&(u={x:X[0],y:X[1]}))}N=xl(nb(j.points),nb(t,u))}else{var Z=Sk(k,$,I,V,d);if(k._19Q||(Z=-Z),V)t=mq(t),t.x=$.getNodeRect(U).x,j.radius=Z,N={x:t.x-Z,y:t.y-Z,width:2*Z,height:2*Z};else{var M=$q(t,u),W=gq(K,M),e={x:W,y:Z},g={x:M-W,y:Z},i=h(u.y-t.y,u.x-t.x),Y=j.mat=new Tr(i);if(j.orienAngle=i,j.angle=u.x<t.x?i+s:i,j.rect={x:e.x,y:e.y,width:g.x-e.x,height:0},j.origin=t,e=Y.tf(e),e.x+=t.x,e.y+=t.y,g=Y.tf(g),g.x+=t.x,g.y+=t.y,x){var q={x:M,y:0};q=Y.tf(q),q.x+=t.x,q.y+=t.y,N=nb([t,e,g,q]),j.c1=t,j.c2=q}else N=nb(e,g);t=e,u=g}}j.sourcePoint=t,j.targetPoint=u,I._lastSourcePoint=t,I._lastTargetPoint=u}var T=0;A("edge.dash")&&(T=A("edge.dash.width")||B);var p="square"===j.cap?.71:.5;Mq(N,J(T*p,B*p+L+c),j.join),k._68o(N)}},getRotation:function(Q,F,C){Q=Q||0;var V=this._78o;if(V){var I,G=V.angle,z=V.points,W=V.edgeTypeInfo;if(G!=o)return F?V.orienAngle+Q:G+Q;if(W&&W[fj])return W.getRotation?W.getRotation(this,Q,F,C):0;if(W&&W.points){var N=W.points;return I=N.size(),Wg[C]?I&&0===I%2?vo(N.get(I/2-1),N.get(I/2),F,Q):Q:Vh[C]?vo(N.get(0),N.get(1),F,Q):vo(N.get(I-2),N.get(I-1),F,Q)}if(z)return I=z.size(),Wg[C]?I&&0===I%2?vo(z.get(I/2-1),z.get(I/2),F,Q):Q:Vh[C]?vo(V.sourcePoint,I?z.get(0):V.targetPoint,F,Q):vo(I?z.get(I-1):V.sourcePoint,V.targetPoint,F,Q)}return Q},getPosition:function(y,W,l,Q,z){var P=this._78o;if(P){var h,B=P.type,Y=P.points,w=P.edgeTypeInfo,m=P.sourcePoint,s=P.targetPoint;if(!B)return P.looped?{x:m.x-P.radius+W,y:m.y+l}:(z&&m&&s&&(m.x>s.x||m.x===s.x&&m.y>s.y)&&(y=Nc[y],l=-l),h=dm(y,P.rect,Q),h.x+=W,h.y+=l,h=P.mat.tf(h),h.x+=P.origin.x,h.y+=P.origin.y,h);if(w&&w[fj])return w.getPosition?w.getPosition(this,y,W,l,Q,z):{x:(m.x+s.x)/2,y:(m.y+s.y)/2};if(Y){var h,q=Y.size();if(Wg[y]){if(q){var C=q%2;if(0===C)return Xr(Y.get(q/2-1),Y.get(q/2),y,W,l,Q,z);h=Y.get((q-C)/2)}else h={x:(m.x+s.x)/2,y:(m.y+s.y)/2};return h=dm(y,{x:h.x,y:h.y,width:0,height:0},Q),h.x+=W,h.y+=l,h}return Vh[y]?Xr(m,q?Y.get(0):s,y,W,l,Q,z):Xr(q?Y.get(q-1):m,s,y,W,l,Q,z)}if(w){var O=w.points,q=O.size();if(Wg[y]){var C=q%2;return 0===C?Xr(O.get(q/2-1),O.get(q/2),y,W,l,Q,z):(h=O.get((q-C)/2),h=dm(y,{x:h.x,y:h.y,width:0,height:0},Q),h.x+=W,h.y+=l,h)}return Vh[y]?Xr(O.get(0),O.get(1),y,W,l,Q,z):Xr(O.get(q-2),O.get(q-1),y,W,l,Q,z)}}return xh},_42:function(K){this._78o&&mo.superClass._42.call(this,K)},drawPath:function(H,X){H.beginPath();var P=X.type,z=X.points,O=X.segments,E=X.edgeTypeInfo;if(!P||z){var I=X.sourcePoint,b=I.x,T=I.y,p=X.targetPoint,o=p.x,y=p.y;if(P)if(O){var J=new Uh({x:b,y:T});J.addAll(z),J.add({x:o,y:y}),_f(H,J,O)}else H.moveTo(b,T),z.each(function(v){H.lineTo(v.x,v.y)}),H.lineTo(o,y);else X.looped?H.arc(b,T,X.radius,0,g,!0):X.center?(H.moveTo(X.c1.x,X.c1.y),H.lineTo(b,T),H.lineTo(o,y),H.lineTo(X.c2.x,X.c2.y)):(H.moveTo(b,T),H.lineTo(o,y))}else E&&(E.points?_f(H,E.points,E.segments):E[fj]&&E[fj](H,E))},_80o:function(G){var L=this,O=L.s,y=L._78o,c=y.width,Z=y.selectWidth,q=y.borderWidth,Y=G.lineJoin,i=G.lineCap,M=y.gray,e=y.pattern;G.lineJoin=y.join,G.lineCap=y.cap,L.drawPath(kb(G,e),y);var n=O("edge.width.absolute");n&&(G.save(),G.setTransform(1,0,0,1,0,0)),Z&&(G.strokeStyle=y._97o,G.lineWidth=c+2*(q+Z),G.stroke()),q&&(G.strokeStyle=M?w.toGrayColor(y.borderColor):y.borderColor,G.lineWidth=c+2*q,G.stroke());var W=M?w.toGrayColor(y.color):y.color,s=M?w.toGrayColor(y._67o):y._67o;if(G.strokeStyle=W,G.lineWidth=c,G.stroke(),y.is3d&&Vi(G,W,s,c,L.gv._zoom,y._66o),n&&G.restore(),hq(G,e),O("edge.dash")){e=O("edge.dash.pattern");var J=kb(G,e,L._2Q("edge.dash.offset"));J!==G&&L.drawPath(J,y),L._1Q(G,"edge",O("edge.dash.width")||c,e)}G.lineJoin=Y,G.lineCap=i},_48O:function(){},_47O:function(){}});var Nm=function(j,K){ek(Nm,this,[j,K])};_p(Nm,Vf,{_3O:function(){var W,Z,e=this,G=e.s,n=e._data,m=e.gv;if(e._88I=o,n.isExpanded()&&n.eachChild(function(w){if(yr(w)){var o=m.getBoundsForGroup(w);o&&(Z||(Z=[]),Z.push(o),W=xl(W,o))}}),W){var l=m.getLabel(n),U=G("group.type");W=zr(U,Z,W),lh(W,n,"group.padding",1);var x=e._88I={type:U,rect:W,_64o:W};if(!U&&l!=o){var O,w=e.labelInfo={label:l,color:G("group.title.color"),font:G("group.title.font"),align:G("group.title.align")},E=_r(w,l),k=E.width,F=E.height,X=G("group.title.align"),$=G("group.title.orientation");if(($===kl||$===uo)&&k>W.width?W.width=k:($===de||$===rb)&&k>W.height&&(W.height=k),w.rect={y:W.y-F,width:E.width,height:F},O=X===de?W.x:X===rb?W.x+W.width-k:W.x+W.width/2-k/2,w.rect.x=O,$===uo)x.titleRect={x:W.x,y:W.y+W.height,width:W.width,height:F},x.rect={x:W.x,y:W.y,width:W.width,height:W.height+F},w.rect={x:O,y:W.y+W.height,width:k,height:F};else if($===de){var V=x.titleRect={x:W.x-F,y:W.y,width:F,height:W.height};x.rect={x:W.x-F,y:W.y,width:W.width+F,height:W.height},w.rect={x:V.x+F/2-W.height/2,y:V.y+W.height/2-F/2,width:W.height,height:F},w.rotation=-Math.PI/2}else if($===rb){var V=x.titleRect={x:W.x+W.width,y:W.y,width:F,height:W.height};x.rect={x:W.x,y:W.y,width:W.width+F,height:W.height},w.rect={x:V.x+F/2-W.height/2,y:V.y+W.height/2-F/2,width:W.height,height:F},w.rotation=Math.PI/2}else x.titleRect={x:W.x,y:W.y-F,width:W.width,height:F+1},x.rect={x:W.x,y:W.y-F,width:W.width,height:W.height+F}}e._40O(x,G("group.border.width")/2)}else Nm.superClass._3O.call(e)},getPosition:function(p,N,c,o){var L=this._88I;if(L){var J=dm(p,L.rect,o);return J.x+=N,J.y+=c,J}return Nm.superClass.getPosition.apply(this,arguments)},_24O:function(V,a){var M=this._88I;(!M||M.type||"label2"===V)&&Nm.superClass._24O.call(this,V,a)},_80o:function(m){var I=this,g=I._88I;if(g){var _=I._data,h=I.s,l=I.gv,f=g.type,n=g.rect,S=g._64o,O=g.titleRect,j=I.getBodyColor(),$=Wl(h("group.image"),j),e=h("group.image.stretch"),Z=I.getBodyColor("group.background"),R=Wl(h("group.repeat.image"),j),E=h("group.gradient.pack"),U=h("group.gradient"),G=h("group.gradient.color"),K=h("group.border.width"),r=h("group.border.color"),a=h("group.border.pattern"),X=h("group.title.orientation"),P=h("group.depth");if(f){var C=m.lineJoin,D=m.lineCap;if(m.lineJoin=h("group.border.join"),m.lineCap=h("group.border.cap"),$){if(m.save(),Ej(m,f,n),m.clip(),im(m,$,e,n.x,n.y,n.width,n.height,_,l,j),m.restore(),K>0){var s=kb(m,a);Ej(s,f,n),m.lineWidth=K,m.strokeStyle=r,m.stroke(),hq(m,a)}}else{var s=kb(m,a);Z||R||E?(Ej(m,f,n),E?os(m,E):R?eh(m,R,j,null,_,l):yd(m,Z,U,G,n),m.fill(),E&&m.restore(),m!==s&&Ej(s,f,n)):Ej(s,f,n),K>0&&(m.lineWidth=K,m.strokeStyle=h("group.border.color"),m.stroke()),hq(m,a),f===jo&&Ie(m,Z,P,n)}m.lineJoin=C,m.lineCap=D}else{var c=h("group.title.background"),z=h("group.border.radius");if($)im(m,$,e,S.x,S.y,S.width,S.height,_,l,I.getBodyColor());else if(Z||R)if(R?eh(m,R,j,null,_,l):yd(m,Z,U,G,S),0===K)Ej(m,jo,S),m.fill(),Ie(m,Z,P,S);else{switch(m.beginPath(),X){case uo:bk(m,S.x,S.y,S.width,S.height,z,z,0,0);break;case de:bk(m,S.x,S.y,S.width,S.height,0,z,0,z);break;case rb:bk(m,S.x,S.y,S.width,S.height,z,0,z,0);break;case kl:bk(m,S.x,S.y,S.width,S.height,0,0,z,z)}m.fill()}if(O&&c)if(0===K)Ql(m,O.x,O.y,O.width,O.height,c),Ie(m,c,P,O);else{switch(m.beginPath(),m.fillStyle=c,X){case uo:bk(m,O.x,O.y,O.width,O.height,0,0,z,z);break;case de:bk(m,O.x,O.y,O.width,O.height,z,0,z,0);break;case rb:bk(m,O.x,O.y,O.width,O.height,0,z,0,z);break;case kl:bk(m,O.x,O.y,O.width,O.height,z,z,0,0)}m.fill()}if(K>0){var s=kb(m,a);if(Ej(s,"roundRect",n,z),m.lineWidth=K,m.strokeStyle=r,O&&h("group.splitLine")){var M=O.x,i=O.y,d=O.width,B=O.height;X===uo?(m.moveTo(M,i),m.lineTo(M+d,i)):X===de?(m.moveTo(M+d,i),m.lineTo(M+d,i+B)):X===rb?(m.moveTo(M,i),m.lineTo(M,i+B)):(m.moveTo(M,i+B),m.lineTo(M+d,i+B))}m.stroke(),hq(m,a)}}I._39O(m,g)}else Nm.superClass._80o.call(I,m)}});var Jp=function(E,H){ek(Jp,this,[E,H])};_p(Jp,Vf,{_80o:function(u){this._39O(u,this._83o)}});var yk=function(s,J){ek(yk,this,[s,J])};_p(yk,Vf,{_3O:function(){var g=this,H=g._data,Y=g.s,n=g.gv,q=H.getPoints(),z=n.getBorderColor(H),l=z?Y("border.width"):0,O=g.getSelectWidth(),C=Y("shape.border.width"),v=H.getRect(),p=H.getAnchorRect(),S=n.getBodyColor(H),y=g._99o=q.isEmpty()?o:{rect:v,rotation:H.getRotation(),fillRule:Y("shape.fill.rule"),scale:H.getScale(),position:H.p(),points:q,segments:H.getSegments(),bodyColor:S,borderColor:z,borderWidth:l,_94o:Y("shape.border.3d"),_95o:Y("shape.border.3d.color"),_96o:Y("shape.border.3d.accuracy"),_97o:O?g.getSelectColor():o,selectWidth:O,_53o:Y("shape.background"),_27Q:Wl(Y("shape.repeat.image"),S),shapeGradientPack:Y("shape.gradient.pack"),_54o:C,_55o:Y("shape.border.color"),shapeGradient:Y("shape.gradient"),_59o:Y("shape.gradient.color"),_60o:Y("shape.border.pattern"),_61o:Y("shape.border.cap"),_62o:Y("shape.border.join"),shapeForeground:Y("shape.foreground"),gray:Y("2d.gray")};if(y){p.x+=y.position.x,p.y+=y.position.y,y.gradientRect=p;var Q=H.getScale(),E=J(1,J(T(Q.x),T(Q.y)));Y("shape.dash")&&Y("shape.dash.width")>C&&(C=Y("shape.dash.width"));var d=C*("square"===y._61o?.71:.5)+l+O/g.gv._zoom/E;d&&(d*=E,v=mq(v),Mq(v,d,y._62o)),g._68o(v);var c=Y("clip.percentage");1>c&&(0>c&&(c=0),y.clipRect=zh(H.getAnchorRect(),Y("clip.direction"),c));var M=Y("shape.fill.clip.percentage");1>M&&(0>M&&(M=0),y.shapeClipRect=zh(H.getAnchorRect(),Y("shape.fill.clip.direction"),M));var $=Y("shape.foreground.clip.percentage");1>$&&(0>$&&($=0),y.shapeForegroundClipRect=zh(H.getAnchorRect(),Y("shape.foreground.clip.direction"),$))}},getPosition:function(l,O,G,z){var P=this._99o;if(P){var r=dm(l,P.rect,z);return r.x+=O,r.y+=G,r}return xh},_42:function(o){this._99o&&yk.superClass._42.call(this,o)},_80o:function(r){var Q,c=this,G=c.s,k=c._99o,M=k.position,O=k.scale,v=k.rotation,C=k.borderWidth,l=k.selectWidth/c.gv._zoom,T=k._27Q,q=k.shapeGradientPack,I=k._54o,j=k.clipRect,K=k.shapeClipRect,S=k.points,_=k.segments,R=c._data.isClosePath(),n=k.fillRule,m=k.gray,h=function(n){return m?w.toGrayColor(n):n},y=h(k._53o),e=y||T||q;r.save(),Ii(r,M.x,M.y),Gg(r,v),ff(r,O.x,O.y),j&&(r.beginPath(),r.rect(j.x,j.y,j.width,j.height),r.clip()),e&&K&&(r.save(),r.beginPath(),r.rect(K.x,K.y,K.width,K.height),r.clip()),Ii(r,-M.x,-M.y);var f=k._60o,H=kb(r,f),J=r.lineJoin,X=r.lineCap;r.lineJoin=k._62o,r.lineCap=k._61o;var L=h(k.bodyColor);e?(_f(r,S,_,R),q?os(r,q):T?eh(r,T,L,null,c._data,c.gv):(Q=L?L:y,yd(r,Q,k.shapeGradient,h(k._59o),k.gradientRect)),r.fill(n),K&&(r.restore(),Ii(r,-M.x,-M.y)),q&&r.restore(),H!==r&&_f(H,S,_,R)):_f(H,S,_,R);var $=k.shapeForeground;if($){r.save();var E=k.shapeForegroundClipRect;E&&(Ii(r,M.x,M.y),r.beginPath(),r.rect(E.x,E.y,E.width,E.height),r.clip(),Ii(r,-M.x,-M.y)),_f(r,S,_,R),yd(r,$,G("shape.foreground.gradient"),h(G("shape.foreground.gradient.color")),k.gradientRect),r.fill(n),r.restore()}var g=G("shape.border.width.absolute");if(g&&(r.save(),r.setTransform(1,0,0,1,0,0)),l&&(r.strokeStyle=k._97o,r.lineWidth=I+2*(C+l),r.stroke()),C&&(r.strokeStyle=h(k.borderColor),r.lineWidth=I+2*C,r.stroke()),I&&(Q=h(k._55o),!y&&L&&(Q=L),r.strokeStyle=Q,r.lineWidth=I,r.stroke(),k._94o&&Vi(r,Q,h(k._95o),I,c.gv._zoom,k._96o)),g&&r.restore(),hq(r,f),G("shape.dash")){var s=G("shape.dash.width")||I;if(s>0){f=G("shape.dash.pattern");var H=kb(r,f,c._2Q("shape.dash.offset"));H!==r&&_f(H,S,_,R),c._1Q(r,"shape",s,f)}}r.lineJoin=J,r.lineCap=X,r.restore()},_48O:function(){},_47O:function(){}});var Ff=function(z,g){ek(Ff,this,[z,g])};_p(Ff,yk,{getRotation:function(V,X,w){V=V||0;var b=this._data.getPoints(),h=b.size();return h>1?Wg[w]?h&&0===h%2?vo(b.get(h/2-1),b.get(h/2),X,V):V:Vh[w]?vo(b.get(0),b.get(1),X,V):vo(b.get(h-2),b.get(h-1),X,V):V},getPosition:function(n,x,R,H,G){var v=this._data.getPoints(),z=v.size();if(z>1){if(Wg[n]){var U=z%2;if(0===U)return Xr(v.get(z/2-1),v.get(z/2),n,x,R,H,G);var M=v.get((z-U)/2),Y={x:M.x,y:M.y,width:0,height:0};return M=dm(n,Y,H),M.x+=x,M.y+=R,M}return Vh[n]?Xr(v.get(0),v.get(1),n,x,R,H,G):Xr(v.get(z-2),v.get(z-1),n,x,R,H,G)}return xh}});var hk=function(j,d){ek(hk,this,[j,d])};_p(hk,Vf,{_3O:function(){var e=this;hk.superClass._3O.call(e);var I=e.s,U=e._83o;e._82o=U.img||U.shape?o:{background:e.getBodyColor("grid.background"),depth:I("grid.depth"),rect:U.rect,_88o:I("grid.cell.depth"),cellBorderColor:I("grid.cell.border.color"),_89o:I("grid.row.count"),_90o:I("grid.column.count"),block:I("grid.block"),_91o:I("grid.block.color"),_92o:I("grid.block.padding"),_93o:I("grid.block.width")}},_80o:function(E){var o=this,N=o._82o;if(!N)return hk.superClass._80o.call(o,E),void 0;var g,n,X=o._data,t=N.background,I=N.rect,z=N.block,k=N._91o,T=N._92o,G=N._93o,l=N._88o,e=N.cellBorderColor,D=N._89o,c=N._90o;if(t)if(Ql(E,I.x,I.y,I.width,I.height,t),Ie(E,t,N.depth,I),l)for(g=0;D>g;g++)for(n=0;c>n;n++)I=X.getCellRect(g,n),I&&Ie(E,t,l,I);else if(e){for(E.beginPath(),g=0;D>g;g++)for(n=0;c>n;n++)I=X.getCellRect(g,n),I&&E.rect(I.x,I.y,I.width,I.height);E.strokeStyle=e,E.lineWidth=1,E.stroke()}if("h"===z)for(g=0;D>g;g++)I=xl(X.getCellRect(g,0),X.getCellRect(g,c-1)),Bi(I,T),Tc(E,k,I.x,I.y,I.width,I.height,G);else if("v"===z)for(n=0;c>n;n++)I=xl(X.getCellRect(0,n),X.getCellRect(D-1,n)),Bi(I,T),Tc(E,k,I.x,I.y,I.width,I.height,G);o._39O(E,o._83o)}});var Gm=function(u,C){ek(Gm,this,[u,C])};_p(Gm,Vf,{_checkEmptyRect:!1,_81o:function(){var p=this._data,M=Gm.superClass._81o.call(this),R=p.s("text");if(R!=o){var S,P,V=p.s("text.font"),k=p.s("text.align"),g=p.s("text.vAlign"),K=Xd(V,R),Q=K.width,A=K.height,b=p.getAnchor(),J=p.getWidth(),Y=p.getHeight();
"left"===k?S=-J*b.x:"center"===k?S=-J*b.x+(J-Q)/2:"right"===k&&(S=J*(1-b.x)-K.width),"top"===g?P=-Y*b.y:"middle"===g?P=-Y*b.y+(Y-A)/2:"bottom"===g&&(P=Y*(1-b.y)-K.height);var i,I=p.getMatrix();if(i=nb([I.tf(S,P),I.tf(S+Q,P),I.tf(S+Q,P+A),I.tf(S,P+A)]),M=xl(M,i),M&&p.s("text.shadow")){var G=mq(M);G.x+=p.s("text.shadow.offset.x"),G.y+=p.s("text.shadow.offset.y"),Bi(G,p.s("text.shadow.blur")),M=xl(M,G)}}return M}});var gp=nk.Interactor=function(z){this.gv=this._graphView=z};vc("Interactor",v,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(Q){this.gv.fi(Q)},setCursor:function(W){Em||this.gv.setCursor(W)},startDragging:function(E){var b=this;b._lastClientPoint=Qf(E),b._lastLogicalPoint=b.gv.lp(E),Fr(b,E)},clearDragging:function(){var A=this;A._lastClientPoint=A._lastLogicalPoint=A._logicalPoint=o},autoScroll:function(_){return this.gv.autoScroll(_,this._lastClientPoint)}});var qn=o,rj=function(Q){qn.handleWindowTouchMove(Q)},bs=function(B){qn.handleWindowTouchEnd(B),P.removeEventListener(Hq,rj,R),P.removeEventListener(Hk,bs,R),qn=o},Kb=function(u){qn.handleWindowMouseMove(u)},Xe=function(e){qn.handleWindowMouseUp(e),P.removeEventListener(zl,Kb,R),P.removeEventListener(kr,Xe,R),qn=o},Kr=function(f,O){f!==qn&&(qn?Em?qn.handleWindowTouchEnd(O):qn.handleWindowMouseUp(O):Em?(P.addEventListener(Hq,rj,R),P.addEventListener(Hk,bs,R)):(P.addEventListener(zl,Kb,R),P.addEventListener(kr,Xe,R)),qn=f)},rq=function(u){var s=this;s.gv=u,s._is2d=u instanceof nk.GraphView,s._is2d&&(s.filter=function(c){return u.isSelectable(c)&&u.isInteractive(c)}),u.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",nl].forEach(function(K){s.addListener(K)}),s.initImageResource()};_p(rq,gp,{enableVR:function(V){var y=this;if(!!y._vrEnable!==V)if(y._vrEnable=V,V)y.gv.vr.mp(y.onVRControllerChange,y);else if(y.gv.vr.ump(y.onVRControllerChange,y),y._vrRayPolyline){var G=y.gv.dm();G.remove(y._vrRayPolyline),G.remove(y._vrRayHitPoint),y._vrRayPolyline=C,y._vrRayHitPoint=C}},onVRControllerChange:function(r){var R=this,y=r.property,q=r.newValue,i=R.gv.vr.getController(q.id),p=i.getRay();p&&("gamepad.button.trigger"===y?"down"===q._62O?R.handle_mousedown(p):R.handleWindowMouseUp(p):"gamepad.pose"===y&&(R.handle_mousemove(p),R.handleWindowMouseMove(p)))},drawVRRay:function(y,f,P){var e,t=this,H=t.gv,R=t._vrRayPolyline,Y=!1;if(R)e=t._vrRayHitPoint;else{var E=H.dm();t._vrRayPolyline=R=new M.Polyline,t._vrRayHitPoint=e=new M.Node,e.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),e.setAnchor3d(.5,.5,.499);var X=.2/H.vr.measureOflength;e.s3(X,X,X),R.s("intersect",!1),e.s("intersect",!1),E.add(R),E.add(e),Y=!0}if(f){var s=P.world,N=P.worldNormal,z=s.x,Z=s.y,O=s.z;R.s("shape.border.color","red"),R.setPoints([{x:y.origin.x,y:y.origin.z,e:y.origin.y},{x:z,y:O,e:Z}]),e.s("3d.visible",!0),e.p3(z,Z,O),e.lookAtDirection([N.x,N.y,N.z],"front")}else{R.s("shape.border.color","blue");var K=new M.Math.Vector3;K.copy(y.direction).setLength(1e3/t.gv.vr.measureOflength).add(y.origin),R.setPoints([{x:y.origin.x,y:y.origin.z,e:y.origin.y},{x:K.x,y:K.z,e:K.y}]),e.s("3d.visible",!1)}H.fi({kind:"vrRayIntersect",ray:y,data:f,intersect:P,polyline:R,hitNode:e,begin:Y})},addListener:function(M){var Z=this;Z.gv.getView().addEventListener(M,function(a){w.preventDefault(a),Z.disabled||Z["handle_"+M](a)},R)},handleWindowTouchMove:function(X){this.handleWindowMouseMove(X)},handleWindowMouseMove:function(K){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",K):(this.handleDownInfo("onBeginDrag",K),this.isDragging=!0))},handleWindowTouchEnd:function(f){this.handleWindowMouseUp(f)},handleWindowMouseUp:function(_){if(this.isDragging&&(this.handleDownInfo("onEndDrag",_),this.isDragging=!1),this.downInfo){var j=this.handle("onUp",_);if(j&&j.data===this.downInfo.data){this.handleMissingUp(_);var m=this,N=2===_.button?"onContextMenu":"onClick";if(!m._dbclickTimer)return m._dbclickTimer=a(function(){delete m._dbclickTimer,m.handleClick(_,N,j),this.downInfo=o},w.clickDelay),void 0;q(m._dbclickTimer),delete m._dbclickTimer,N="onDoubleClick",m.handleClick(_,N,j)}else this.handleDownInfo("onUp",_);this.downInfo=o}},handle_mouseleave:function(G){var m=this,e=m.gv,Y=m.currentInfo?m.currentInfo.data:o;if(Y){Y.s("onLeave")&&Y.s("onLeave")(G,Y,e),m.fire("data","onLeave",G,Y);var M=m.currentInfo?m.currentInfo.hits:o;if(M)for(var F in M)m.handleLeave(G,F);m.currentInfo=o}},handle_mousewheel:function(V){V.scrollDelta=V.wheelDelta/40,this.handle("onScroll",V)},handle_DOMMouseScroll:function(W){W.scrollDelta=2===W.axis?-W.detail:0,this.handle("onScroll",W)},handle_touchstart:function(d){this.handle_mousedown(d)},handle_touchmove:function(x){this.handle("onMove",x)},handle_mousedown:function(C){this.isDragging&&(this.handleDownInfo("onEndDrag",C),this.isDragging=!1),this.downInfo=this.handle("onDown",C),this.downInfo&&Kr(this,C)},handle_mousemove:function(Q){var i=this,I=i.gv;i._hoverTimer&&(q(i._hoverTimer),delete i._hoverTimer);var p,U,H,F=i.handle("onMove",Q),e=this.currentInfo?this.currentInfo.data:o,D=this.currentInfo?this.currentInfo.hits:o;if(F&&(U=F.data,H=F.hits,i._hoverTimer=a(function(){q(i._hoverTimer),delete i._hoverTimer,i.handle("onHover",Q,F)},I.getHoverDelay()||w.hoverDelay)),U!==e){if(e&&(e.s("onLeave")&&e.s("onLeave")(Q,e,I),this.fire("data","onLeave",Q,e)),U&&(U.s("onEnter")&&U.s("onEnter")(Q,U,I),this.fire("data","onEnter",Q,U)),D)for(p in D)this.handleLeave(Q,p);if(H)for(p in H){var A=H[p];A.target.onEnter&&A.target.onEnter(Q,U,I,A.point,A.width,A.height),this.fire(A.type,"onEnter",A.event,A.data,A.image,A.comp,A.point,A)}}else{if(D)for(p in D)H&&H[p]||this.handleLeave(Q,p);if(H)for(p in H)if(!D||!D[p]){var A=H[p];A.target.onEnter&&A.target.onEnter(Q,U,I,A.point,A.width,A.height),this.fire(A.type,"onEnter",A.event,A.data,A.image,A.comp,A.point,A)}}this.currentInfo=F},handle:function(c,W,u){var m,U=this,i=U.gv;if(U._is2d){if(u=u||i.getDataInfoAt(W,this.filter),!u)return;if(m=u.ui.interactiveInfo){var f,w=u.data;if(w.s(c)&&w.s(c)(W,w,i),this.fire("data",c,W,w),"body"===u.part&&m.bodyInfo)f="body",u.hits=this.handleImage(f,i.getImage(w),c,W,w,u.point,m.bodyInfo);else if("icons"===u.part&&m._38o){var h=m._38o[u.name];h&&h[u.index]&&(f="icons|"+u.name+"|"+u.index,u.hits=this.handleImage(f,u.icon,c,W,w,u.point,h[u.index]))}}return u}var w,d;if(!u)if(W&&W instanceof M.Math.Ray){var O=i.vr.intersectWorld(W);if(w=O.data,d=O.intersect,U.drawVRRay(W,w,d),!w)return;var e=i.getData3dUI(w);if(m=e.interactiveInfo,!m)return;u={data:w,part:d.part,ui:e}}else{if(u=i.getDataInfoAt(W),!u)return;u&&(u={data:u.data,part:u.part})}if(!d){w=u.data;var e=i.getData3dUI(w);if(u.ui=e,m=e.interactiveInfo,!m)return u;if(d=i.intersectObject(W,w),!d)return}w.s(c)&&w.s(c)(W,w,i),this.fire("data",c,W,w);var F,j=d.part;return"body"!==j&&(F=w.s(j+".image")||w.s("shape3d."+j+".image")),F||(F=w.s("all.image")||w.s("shape3d.image")),m="object"==typeof F?m[F.uuid]:m[F],m&&m.bodyInfo?(u.part="body",u.interactiveInfo=m,u.point=d.uv.multiply({x:m.bodyInfo.rect.width,y:m.bodyInfo.rect.height}),u.image=F,u.hits=this.handleImage("body",F,c,W,w,u.point,m.bodyInfo),u):u},_handleLeaveOrMissing:function(_,S,E){var I="leave"===_?this.currentInfo:this.downInfo;if(I){var T=I.interactiveInfo||I.ui.interactiveInfo;if(T){var o,F,K=I.data;if(this._is2d){if(F=this.gv.lp(S),"body"===I.part&&T.bodyInfo)o="body","leave"===_?this.handleLeaveImage(E,o,this.gv.getImage(K),S,K,F,T.bodyInfo):this.handleMissingUpImage(o,this.gv.getImage(K),S,K,F,T.bodyInfo);else if("icons"===I.part&&T._38o){var Y=T._38o[I.name];Y&&Y[I.index]&&(o="icons|"+I.name+"|"+I.index,"leave"===_?this.handleLeaveImage(E,o,I.icon,S,K,F,Y[I.index]):this.handleMissingUpImage(o,I.icon,S,K,F,Y[I.index]))}}else{if(!T.bodyInfo)return;var i=this.gv.intersectObject(S,K);F=i?i.uv.multiply({x:T.bodyInfo.rect.width,y:T.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===_?this.handleLeaveImage(E,"body",I.image,S,K,F,T.bodyInfo):this.handleMissingUpImage("body",I.image,S,K,F,T.bodyInfo)}}}},handleClick:function(r,P,O){var Y=this,n=this.downInfo;if(n&&O){var Q,f=O.interactiveInfo||O.ui.interactiveInfo,q=O.data,i=this.gv;if(q.s(P)&&q.s(P)(r,q,i),Y.fire("data",P,r,q),f)if(this._is2d){if(n.part===O.part){var H=i.lp(r);"body"===O.part&&f.bodyInfo&&(Q="body",this.handleClickImage(Q,i.getImage(q),P,r,q,H,f.bodyInfo,O))}}else{if(!f.bodyInfo)return;var z=i.intersectObject(r,q);if(!z)return;H=z.uv.multiply({x:f.bodyInfo.rect.width,y:f.bodyInfo.rect.height}),this.handleClickImage("body",n.image,P,r,q,H,f.bodyInfo,O)}}},handleDownInfo:function(p,r){if(this.downInfo){var P=this.downInfo,x=this.gv,Z=P.interactiveInfo||P.ui.interactiveInfo;if(Z){var w,y=P.data;if(y.s(p)&&y.s(p)(r,y,x),this.fire("data",p,r,y),this._is2d){var d=x.lp(r);if("body"===P.part&&Z.bodyInfo)w="body",this.handleDownInfoImage(w,x.getImage(y),p,r,y,d,Z.bodyInfo);else if("icons"===P.part&&Z._38o){var q=Z._38o[P.name];q&&q[P.index]&&(w="icons|"+P.name+"|"+P.index,this.handleDownInfoImage(w,P.icon,p,r,y,d,q[P.index]))}}else{if(!Z.bodyInfo)return;var K=x.intersectObject(r,y);if(!K)return;d=K.uv.multiply({x:Z.bodyInfo.rect.width,y:Z.bodyInfo.rect.height}),this.handleDownInfoImage("body",P.image,p,r,y,d,Z.bodyInfo)}}}},fire:function(x,r,Y,F,o,X,S,y){this.gv.fi({kind:r,type:x,event:Y,data:F,image:o,comp:X,view:this.gv,point:S,width:y?y.width:C,height:y?y.height:C})},handleImage:function(b,l,G,s,f,I,j){var L={};if(l&&(l=Wl(l))){var Q=this.gv,$=j.rect,J=this.convertPoint(I,j);J.inRect&&(l[G]&&l[G](s,f,Q,J,$.width,$.height),this.fire("image",G,s,f,l,C,J,$),L[b+"|image"]={target:l,type:"image",image:l,data:f,event:s,point:J,width:$.width,height:$.height});for(var d=j.compInfos,o=l,Z=d.length-1;Z>=0;Z--){var A=d[Z],k=A.comp;J=this.convertPoint(I,A,o,k,Q,f),J.inRect&&($=A.rect,k[G]&&k[G](s,f,Q,J,$.width,$.height),this.fire("comp",G,s,f,l,k,J,$),(l=$.image)&&(l[G]&&l[G](s,f,Q,J,$.width,$.height),this.fire("image",G,s,f,l,C,J,$)),L[b+"|"+Z]={target:k,type:"comp",comp:k,image:l,data:f,event:s,point:J,width:$.width,height:$.height},l&&(L[b+"|"+Z+"|image"]={target:l,type:"image",image:l,data:f,event:s,point:J,width:$.width,height:$.height}))}}return L},handleLeave:function(v,U){return this._handleLeaveOrMissing("leave",v,U)},handleMissingUp:function($){return this._handleLeaveOrMissing("missing",$)},handleLeaveImage:function(n,R,E,s,y,r,p){if(E&&(E=Wl(E))){var m=this.gv,Y=p.rect,A=this.convertPoint(r,p);n===R+"|image"&&(E.onLeave&&E.onLeave(s,y,m,A,Y.width,Y.height),this.fire("image","onLeave",s,y,E,C,A,Y));for(var M=p.compInfos,g=E,u=M.length-1;u>=0;u--){var q=M[u],P=q.comp;A=this.convertPoint(r,q,g,P,m,y),Y=q.rect,n===R+"|"+u&&(P.onLeave&&P.onLeave(s,y,m,A,Y.width,Y.height),this.fire("comp","onLeave",s,y,E,P,A,Y)),(E=Y.image)&&n===R+"|"+u+"|image"&&(E.onLeave&&E.onLeave(s,y,m,A,Y.width,Y.height),this.fire("image","onLeave",s,y,E,C,A,Y))}}},handleMissingUpImage:function(g,i,t,j,$,f){var q="onUp",L=this.downInfo.hits;if(L&&i&&(i=Wl(i))){var c=this.gv,B=f.rect,S=this.convertPoint($,f);!S.inRect&&L[g+"|image"]&&(i[q]&&i[q](t,j,c,S,B.width,B.height),this.fire("image",q,t,j,i,C,S,B));for(var x=f.compInfos,W=i,V=x.length-1;V>=0;V--){var y=x[V],e=y.comp;S=this.convertPoint($,y,W,e,c,j),S.inRect||(B=y.rect,L[g+"|"+V]&&(e[q]&&e[q](t,j,c,S,B.width,B.height),this.fire("comp",q,t,j,i,e,S,B)),(i=B.image)&&L[g+"|"+V+"|image"]&&(i[q]&&i[q](t,j,c,S,B.width,B.height),this.fire("image",q,t,j,i,C,S,B)))}}},handleDownInfoImage:function(T,D,W,A,B,m,r){var M=this.downInfo.hits;if(M&&D&&(D=Wl(D))){var d=this.gv,l=r.rect,V=this.convertPoint(m,r);M[T+"|image"]&&(D[W]&&D[W](A,B,d,V,l.width,l.height),this.fire("image",W,A,B,D,C,V,l));for(var R=r.compInfos,H=D,b=R.length-1;b>=0;b--){var I=R[b],E=I.comp;V=this.convertPoint(m,I,H,E,d,B),l=I.rect,M[T+"|"+b]&&(E[W]&&E[W](A,B,d,V,l.width,l.height),this.fire("comp",W,A,B,D,E,V,l)),(D=l.image)&&M[T+"|"+b+"|image"]&&(D[W]&&D[W](A,B,d,V,l.width,l.height),this.fire("image",W,A,B,D,C,V,l))}}},handleClickImage:function(z,x,P,I,a,u,M,Z){var g=this.downInfo.hits,A=Z.hits;if(g&&x&&(x=Wl(x))){var d=this.gv,m=M.rect,l=this.convertPoint(u,M);g[z+"|image"]&&(x[P]&&x[P](I,a,d,l,m.width,m.height),this.fire("image",P,I,a,x,C,l,m));for(var p=M.compInfos,j=x,k=p.length-1;k>=0;k--){var w=p[k],n=w.comp;l=this.convertPoint(u,w,j,n,d,a),m=w.rect,g[z+"|"+k]&&A[z+"|"+k]&&(n[P]&&n[P](I,a,d,l,m.width,m.height),this.fire("comp",P,I,a,x,n,l,m)),(x=m.image)&&g[z+"|"+k+"|image"]&&(x[P]&&x[P](I,a,d,l,m.width,m.height),this.fire("image",P,I,a,x,C,l,m))}}},initImageResource:function(){w.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(p,s,l,b,g,k){var Q=s.rect,J=s.matrix.applyInverse(p).sub(Q),S=J.x>=0&&J.y>=0&&J.x<=Q.width&&J.y<=Q.height;if(!S)return J;if(b&&Bs(b.pixelPerfect,k,g)){var Q,y=1;this._is2d?(y=g.getZoom(),Q=Jr(p.x,p.y,C,y)):Q=Jr(p.x,p.y);var W=!1,H=Q.x,G=Q.y,v=Q.width,Z=Q.height,O=w.hitMaxArea,I=v*Z*y*y;if(I>O){var j=Math.sqrt(O/I);y*=j}v*=y,Z*=y,2>v&&(v=2),2>Z&&(Z=2),H*=y,G*=y;var R=Kc(v,Z),f=new xc(0,-H,-G,y,y);f.append(s.matrix),g._drawForChecking=!0,b.transform=f;var E=l.comps;l.comps=[b],Rm(R,l,0,0,v,Z,k,self),l.comps=E,delete b.transform,g._drawForChecking=!1;try{for(var F=0,r=R.getImageData(0,0,v,Z).data;F<r.length;F+=4)if(0!==r[F+3]){W=!0;break}R.restore()}catch(z){_l=o,W=!1}J.inRect=W}else J.inRect=!0;return J}});var Df=nk.DefaultInteractor=function(b){ek(Df,this,[b])};vc("DefaultInteractor",gp,{handle_mousedown:function(e){Eb(e);var W=this,D=W.gv,K=D.getDataAt(e);if(D.setFocus(e)&&!D._editing&&!D._scrolling){Gi(e)?D.handleDoubleClick(e,K):D.handleClick(e,K);var M=Hm(e);!rp()&&!M&&K&&(D.isMovable(K)||D.isInteractive(K))||!D.isPannable()||!oh(e)&&!M||tl(e)||(W._tx=D.tx(),W._ty=D.ty(),W.startDragging(e))}},handleWindowMouseUp:function(c){var V=this,r=V.gv;r._panning&&(delete r._panning,r.onPanEnded(),V.fi({kind:"endPan",event:c})),delete V._tx,delete V._ty,V.clearDragging()},handle_mousemove:function(Y){var H=this,j=H.gv;H._hoverTimer&&(q(H._hoverTimer),delete H._hoverTimer),H._hoverTimer=a(function(){H.fi({kind:"hover",event:Y}),q(H._hoverTimer),delete H._hoverTimer},j.getHoverDelay()||w.hoverDelay)},handle_touchmove:function(K){this.handle_mousemove(K)},handleWindowMouseMove:function(f){var o=this,_=o.gv,X=o._lastClientPoint;o.fi({kind:_._panning?"betweenPan":"beginPan",event:f}),_._panning=1,_.setTranslate(o._tx+f.clientX-X.x,o._ty+f.clientY-X.y)},handle_mousewheel:function(q){this.gv.handleScroll(q,q.wheelDelta)},handle_DOMMouseScroll:function(Q){2===Q.axis&&this.gv.handleScroll(Q,-Q.detail)},handle_keydown:function(o){this.gv.handleKeyDown(o)}});var wp=nk.SelectInteractor=function(q){ek(wp,this,[q])};vc("SelectInteractor",gp,{_42:function(){var t=this,f=t.gv,a=f.getZoom(),D=t.mark,A=t.div;A||(A=t.div=tq(),ke(t.getView(),A));var x={};x.x=D.x*a+f.tx(),x.y=D.y*a+f.ty(),x.width=D.width*a,x.height=D.height*a,pq(A,x),this.intersects()?(A.style.border="",A.style.background=f.getRectSelectBackground()):(A.style.background="",A.style.border="1px solid "+f.getRectSelectBorderColor())},handle_mousedown:function(_){var z=this,x=z.gv;if(z._57I=o,z.pendingClickThrough=o,!(x._editing||x._scrolling||rp()||Hm(_))){var N=x.getDataAt(_),E=x.sm();N?tl(_)?E.co(N)?E.rs(N):E.as(N):E.co(N)?N instanceof Uk&&N.isClickThroughEnabled()&&oh(_)&&(z.pendingClickThrough=Qf(_)):E.ss(N):tl(_)||!x.isPannable()?oh(_)&&(tl(_)||E.cs(),x.isRectSelectable()&&(z.startDragging(_),x._77O=1)):oh(_)&&(z._57I=Qf(_))}},handle_mouseup:function(g){var B=this,x=B.gv,t=B._57I;if(t&&($q(t,Qf(g))<=1&&x.sm().cs(),B._57I=o),B.pendingClickThrough){if($q(B.pendingClickThrough,Qf(g))<=1){var T=x.getDataAt(g);if(T instanceof Uk&&T.isClickThroughEnabled()){var l=x.getDataAt(g,function(e){var l=e.getParent()===T&&x.isSelectable(e,!0);return l});l&&(g.clickThrough=!0,x.sm().ss(l))}}B.pendingClickThrough=o}},handleWindowMouseUp:function(g){this.clear(g)},handleWindowMouseMove:function(C){var Q=this,g=Q.gv;Q._logicalPoint=g.lp(C),Q.mark?(Q.fi({kind:"betweenRectSelect",event:C}),g.isPannable()&&Q.autoScroll(C),Q.redraw()):Q.fi({kind:"beginRectSelect",event:C}),Q.mark=nb(Q._lastLogicalPoint,Q._logicalPoint),Q.redraw()},intersects:function(){var B=this,d=B._lastLogicalPoint,u=B._logicalPoint;return d.x>u.x||d.y>u.y},clear:function(A){var q=this,y=q.gv,R=q.mark;if(q._57I=o,q.pendingClickThrough=o,q._lastLogicalPoint){if(R){if(0!==R.width&&0!==R.height){var S=y.getDatasInRect(R,q.intersects());if(!S.isEmpty()){var k=y.sm(),w=k.toSelection();S.each(function(W){k.co(W)?w.remove(W):w.add(W)}),k.ss(w)}}Cc(q.div),delete q.div,delete q.mark,q.redraw(),q.fi({kind:"endRectSelect",event:A}),y.onRectSelectEnded()}q.clearDragging(),delete y._77O}},redraw:function(){var n=this;n._draw||(n._draw=1,a(function(){n.mark&&n._42(),delete n._draw},16))}});var Zd=nk.MoveInteractor=function(b){ek(Zd,this,[b])};vc("MoveInteractor",gp,{handle_mousedown:function(M){var y=this,j=y.gv;if(oh(M)&&!j._editing&&!j._scrolling&&!rp()){var $=j.getSelectedDataAt(M);!$||j.isInteractive($)&&!j.isMovable($)?j._focusData=o:(y._data=$,j.handleMouseDown&&j.handleMouseDown(M,$),y.startDragging(M),j.isMovable($)&&(j._moving=1))}},handleWindowMouseUp:function(j){var r=this,v=r.gv;v.handleMouseUp&&v.handleMouseUp(j,r._data),r.clear(j)},handleWindowMouseMove:function(P){var c=this,E=c._data,B=c.gv;if((!B._93O||!B._93O(P,E))&&B._moving){c._logicalPoint||c.fi({kind:"prepareMove",event:P});var g=c._logicalPoint?"betweenMove":"beginMove",Z={kind:g,event:P},h=c._logicalPoint=B.lp(P);"beginMove"!==g||c._alreadyBeginTransaction||(c._alreadyBeginTransaction=!0,B.getDataModel().beginTransaction());var i=c._calcShift(g,P),G=i.x,t=i.y,k=c.gv.getMoveMode(P,E);k&&("x"===k?t=0:"y"===k?G=0:"xy"!==k&&(G=t=0)),B.moveSelection(G,t),c._lastLogicalPoint=h,c.autoScroll(P),c.fi(Z)}},_calcShift:function(){var p=this,m=p._logicalPoint,h=p._lastLogicalPoint,X=m.x-h.x,J=m.y-h.y;return{x:X,y:J}},clear:function(Q){var Y=this,P=Y.gv;Y._lastLogicalPoint&&(Y._lastLogicalPoint=Y._data=P._moving=o,Y._logicalPoint&&(Y.fi({kind:"endMove",event:Q}),P.onMoveEnded()),Y.clearDragging()),Y._alreadyBeginTransaction&&(Y._alreadyBeginTransaction=!1,P.getDataModel().endTransaction())}});var Fb=nk.TextEditInteractor=function(m){ek(Fb,this,[m]),this.init()};vc("TextEditInteractor",gp,{init:function(){var O=this,P=this.input=V.createElement("input"),$=P.style;P.text="text",$.border="1px solid #d8d8d8",$.position="absolute",$.padding="2px 3px",$.outline="none",$.marginLeft="-90px",$.marginTop="-16px",$.backgroundColor="rgba(255,255,255, 0.9)",$.fontSize="14px",$.width="180px",$.height="32px",$.boxShadow="0 0 13px rgba(16,142,233, 0.5)",$.textAlign="center",$.boxSizing="border-box",P.addEventListener("keyup",function(y){sk(y)&&O.endTextEdit()}),P.addEventListener("focus",function(){P.select()});var D=this.textarea=V.createElement("textarea"),E=this.wrap=V.createElement("div");E.appendChild(D),$=D.style,$.margin=0,$.padding="4px",$.overflow="hidden",$.boxSizing="border-box",$.position="absolute",$.outline="none",$.backgroundColor="transparent",$.resize="none",$.textAlign="center",$.fontSize="14px",$.border="none",$.borderWidth=0,$.width="100%",$.top="50%",$=E.style,$.boxSizing="border-box",$.margin=0,$.padding=0,$.position="absolute",$.boxShadow="0 0 13px rgba(16,142,233, 0.5)",$.border="1px solid #d8d8d8",$.backgroundColor="rgba(255,255,255, 0.9)",$.width="180px",$.marginLeft="-90px",D.addEventListener("keydown",function(u){return(gb()||tl())&&sk(u)?(O.endTextEdit(),void 0):(O.calculateTextareaHeight(String.fromCharCode(u.keyCode)),void 0)}),D.addEventListener("focus",function(){D.select()});var x=function(O){O.stopPropagation()};P.addEventListener("mousedown",x),P.addEventListener("touchstart",x),D.addEventListener("mousedown",x),D.addEventListener("touchstart",x),O.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],O.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",O.handleWindowClick=function(y){var z=O._editingDOM,l=z.getBoundingClientRect(),E=Qf(y);lq(l,E)||O.endTextEdit()}},handle_mousedown:function(Z){var N=this,V=N.gv;if(Gi(Z)&&!V._editing){var o=V.getDataAt(Z);if(o){var u=V.getTextEditInfo(o);u&&(this._editInfo=u,this._editTarget=o,V._editing=!0,u.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var o=this,j=o.gv,x=o._editTarget,G=o.getTargetValue(),N=o.textarea,O=o.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===G||G===C)&&(G=""),N.value=G,o._editingDOM=N,j.getView().appendChild(O),this.layoutHTML(O,x),this.calculateTextareaHeight(),a(function(){N.focus(),P.addEventListener("mousedown",o.handleWindowClick),P.addEventListener("touchstart",o.handleWindowClick)},10)},handleTextEdit:function(){var d=this,v=d.gv,b=d._editTarget,s=d.getTargetValue(),w=d.input;(null===s||s===C)&&(s=""),w.value=s,d._editingDOM=w,v.getView().appendChild(w),this.layoutHTML(w,b),a(function(){w.focus(),P.addEventListener("mousedown",d.handleWindowClick),P.addEventListener("touchstart",d.handleWindowClick)},10)},layoutHTML:function(m,O){var v=this.gv,e=v.getZoom();if(O instanceof M.Node){var Z=O.getRect();m.style.left=(Z.x+Z.width/2)*e+v.tx()+"px",m.style.top=(Z.y+Z.height/2)*e+v.ty()+"px"}else if(O instanceof M.Edge){var z=v.getDataUI(O),Z=z._6I;m.style.left=(Z.x+Z.width/2)*e+v.tx()+"px",m.style.top=(Z.y+Z.height/2)*e+v.ty()+"px"}},endTextEdit:function(){var I=this,C=I._editInfo.isMultiline?I.wrap:I.input,$=I._editInfo.isMultiline?I.textarea:I.input;I.setTargetValue($.value),I.gv.getView().removeChild(C),I.gv._editing=!1,delete I._editingDOM,P.removeEventListener("mousedown",I.handleWindowClick),P.removeEventListener("touchstart",I.handleWindowClick)},setTargetValue:function(H){var e=this,O=e._editTarget,S=e._editInfo,_=S.accessType,f=S.name;if(f&&_||(_="p",f="name"),"p"===_){var b=M.Default.setter(f);O[b](H)}else"a"===_?O.a(f,H):O.s(f,H)},getTargetValue:function(){var r=this,a=r._editTarget,Z=r._editInfo,e=Z.accessType,G=Z.name;if(G&&e||(e="p",G="name"),"p"===e){var A=M.Default.getter(G);return a[A]()}return"a"===e?a.a(G):a.s(G)},createHiddenTextarea:function(){this.hiddenTextarea=V.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(z,W){if(W&&this.computedStyleCache)return this.computedStyleCache;var a=this,Q=P.getComputedStyle(z),Z=Q.getPropertyValue("box-sizing")||Q.getPropertyValue("-moz-box-sizing")||Q.getPropertyValue("-webkit-box-sizing"),x=parseFloat(Q.getPropertyValue("padding-bottom"))+parseFloat(Q.getPropertyValue("padding-top")),G=parseFloat(Q.getPropertyValue("border-bottom-width"))+parseFloat(Q.getPropertyValue("border-top-width")),X=a.SIZING_STYLE.map(function(m){return m+":"+Q.getPropertyValue(m)}).join(";"),r={sizingStyle:X,paddingSize:x,borderSize:G,boxSizing:Z};return W&&(this.computedStyleCache=r),r},calculateTextareaHeight:function(Q){Q=Q||"";var U=this,e=U.textarea,m=U.hiddenTextarea,I=U.wrap,b=32,G=U.calculateHTMLStyle(e,!1),W=G.paddingSize,q=G.borderSize,k=G.boxSizing,i=G.sizingStyle;m.setAttribute("style",i+";"+U.HIDDEN_TEXTAREA_STYLE),m.value=e.value+Q;var T=m.scrollHeight;"border-box"===k?T+=q:"content-box"===k&&(T-=W),e.style.height=T+"px",e.style.marginTop=0-.5*T+"px",I.style.height=Math.max(T,b)+"px",I.style.marginTop=T*-.5+"px"}});var Vr=nk.ScrollBarInteractor=function(C){ek(Vr,this,[C])};vc("ScrollBarInteractor",gp,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(O){var s=this.gv.getViewRect();return this._41o()&&(s.x+s.width-this.gv.lp(O).x)*this.gv.getZoom()<zo},isH:function(A){var K=this.gv.getViewRect();return this._40o()&&(K.y+K.height-this.gv.lp(A).y)*this.gv.getZoom()<zo},handle_mousemove:function(W){this.handle_touchmove(W)},handle_touchmove:function(m){if(!mm&&oh(m)&&this.gv.isScrollBarVisible()){var C=this,e=C.isV(m),U=C.isH(m);(e||U)&&C.gv.showScrollBar(),C.gv._scrolling=e||U}},handleWindowMouseUp:function(s){this.handleWindowTouchEnd(s)},handleWindowTouchEnd:function(F){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=o,this.fi({kind:"endScroll",event:F})},handle_mousedown:function(j){this.handle_touchstart(j)},handle_touchstart:function(T){var X=this;if(X.gv.setFocus(T),Eb(T),X.handle_touchmove(T),!(Am(T)>1)&&X.gv._scrolling&&X.gv.isScrollBarVisible()){X._cp=Qf(T),X._tx=X.gv.tx(),X._ty=X.gv.ty();var I=X.isV(T);X._state=I?"vScroll":"hScroll",Fr(X,T),X.fi({kind:"beginScroll",event:T})}},handleWindowMouseMove:function(d){this.handleWindowTouchMove(d)},handleWindowTouchMove:function(A){var j=Qf(A),K=this.gv.getViewRect(),I=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-j.y)*I.height/K.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-j.x)*I.width/K.width),this.fi({kind:"betweenScroll",event:A})}});var Jj=nk.TouchInteractor=function(k,S){S=S||{},S.selectable===C&&(S.selectable=!0),S.movable===C&&(S.movable=!0),S.pannable===C&&(S.pannable=!0),S.pinchable===C&&(S.pinchable=!0),S.editable===C&&(S.editable=!0),this.params=S,ek(Jj,this,[k])};vc("TouchInteractor",gp,{ms_edit:1,setUp:function(){var T=this;Jj.superClass.setUp.call(T),Em&&T.params.editable&&T.gv.setEditInteractor(T)},tearDown:function(){var t=this;Jj.superClass.tearDown.call(t),Em&&t.params.editable&&t.gv.setEditInteractor(o)},clear:function(M){var X=this,z=X.gv;z._moving&&(X.fi({kind:"endMove",event:M}),delete z._moving,z.onMoveEnded(),z.dm().endTransaction()),z._panning&&(X.fi({kind:"endPan",event:M}),delete z._panning,z.onPanEnded()),z._pinching&&(X.fi({kind:"endPinch",event:M}),delete z._pinching,z.onPinchEnded()),z._editing&&(X._46O(M),X._77I=X._node=X._edge=X._shape=X._rect=X._89I=X._index=z._editing=o),X._moving=X._panning=X._pinching=X._editing=X._57I=X._data=X._beginHistory=o,X.clearDragging()},handle_touchstart:function(y){var z=this;if(!z.gv._editing){Eb(y),z._57I=o;var O=z.params,f=z.gv,w=f.sm(),M=f.getDataAt(y),S=Am(y);if(1===S){if(Gi(y))return f.handleDoubleClick(y,M),void 0;f.handleClick(y,M),M&&(f.handleMouseDown&&f.handleMouseDown(y,M),z._data=M),O.selectable||(M=o),M?(w.co(M)||w.ss(M),O.editable&&f.isEditable(M)&&z._79I(y,M,!0)?(z._editing=1,z.startDragging(y)):O.movable&&f.isMovable(M)&&(z._moving=1,z.startDragging(y))):(z._57I=Qf(y),O.pannable&&f.isPannable()&&(z._panning=1,z.startDragging(y),z._translate={x:f.tx(),y:f.ty()}))}else if(O.pinchable&&2===S){z._pinching=1,z.startDragging(y);var G=f.getView(),K=f.getZoom(),n=G.getBoundingClientRect(),u=y.touches[0],U=y.touches[1],X={x:(u.clientX+U.clientX)/2-n.left,y:(u.clientY+U.clientY)/2-n.top};X.x-=f.tx(),X.y-=f.ty(),X.x/=K,X.y/=K,z._p=X,z._d=si(y)}}},handle_touchend:function(u){var r=this,N=r.gv,m=r._57I,Y=r._data;m&&($q(m,Qf(u))<=1&&N.sm().cs(),r._57I=o),Y&&N.handleMouseUp&&N.handleMouseUp(u,Y)},handleWindowTouchEnd:function(u){this.clear(u)},handleWindowTouchMove:function(Y){var x=this,B=x.gv,m=Am(Y);if(1===m){if(x._editing&&(x._beginHistory||(x._beginHistory=1,B.dm().beginTransaction()),B._editing=1,x._78I(Y)),x._moving)x._beginHistory||(x._beginHistory=1,B.dm().beginTransaction()),x.handleMove(Y);else if(x._panning){var z=Qf(Y);B.setTranslate(x._translate.x+z.x-x._lastClientPoint.x,x._translate.y+z.y-x._lastClientPoint.y),x.fi({kind:B._panning?"betweenPan":"beginPan",event:Y}),B._panning=1}}else if(2===m&&x._pinching){var e=si(Y);B.handlePinch(x._p,e,x._d),x._d=e,x.fi({kind:B._pinching?"betweenPinch":"beginPinch",event:Y}),B._pinching=1}},handleMove:function(t){var g=this,H=g.gv,R=H.lp(t);H._93O&&H._93O(t,g._data)||(H.moveSelection(R.x-g._lastLogicalPoint.x,R.y-g._lastLogicalPoint.y),g._lastLogicalPoint=R,g.autoScroll(t),g.fi({kind:H._moving?"betweenMove":"beginMove",event:t}),H._moving=1)}});var M=P.ht,br=M.graph._editor={Math:M.Math,Guide:{}};br.getStyle=function(h){var G,i=br.StyleMap;return i&&(G=i[h],G!==C)?G:br.DefaultStyleMap[h]},br.setStyle=function(E,T){var a=br.StyleMap;a||(a=br.StyleMap={}),a[E]=T},br.inEdit=function(J){return J._inXEdit===!0},br.startEdit=function(x){x._inXEdit=!0,br.Inject.doInject(x)},br._46O=function(o){o._inXEdit=!1,br.Inject.undoInject(o)},br.toScreenPosition=function(Q,C){var x=Q.tx(),n=Q.ty(),M=Q._zoom;return new br.Math.Vector2(C.x*M+x,C.y*M+n)},br.checkHit=function(g,C,y){return g.distanceTo(C)<y?!0:!1},br.toWorldPosition=function(E,M){var F=E.tx(),C=E.ty(),W=E._zoom;return{x:(M.x-F)/W,y:(M.y-C)/W}},br.setAntialias=function(s,k){for(var r,A=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],I=0,E=A.length;E>I&&(r=A[I],!(r in s));I++);s[r],s[r]=k},br.getTargetCornersOnScreen=function(G,l){if(!l)return null;var P,d=[];if(ad(l,G)){var o=Pe(G,l);P=[{x:o.x,y:o.y},{x:o.x+o.width,y:o.y},{x:o.x+o.width,y:o.y+o.height},{x:o.x,y:o.y+o.height}]}else{if(!l.getCorners)return null;P=l.getCorners()}return P.forEach(function(e){var V=br.toScreenPosition(G,e);d.push(V.x,V.y)}),d},br.log=function(){};var bc=br.Inject={_modules:[]};bc.registAsModule=function(F,h){var Y={},M={};for(var i in F){var D=h.prototype[i];Y[i]=D}F.getBackup=function(W){return Y[W]},F.getBackups=function(){return Y},M.doInject=function(){for(var I in F)"getBackup"!==I&&(h.prototype[I]=F[I])},M.undoInject=function(){for(var Z in F)"getBackup"!==Z&&(h.prototype[Z]=Y[Z])},bc._modules.push(M)},bc.doInject=function(e){for(var w,o=bc._modules,u=0,n=o.length;n>u;u++)w=o[u],w.doInject(e)},bc.undoInject=function(m){for(var Z,H=bc._modules,v=0,P=H.length;P>v;v++)Z=H[v],Z.undoInject(m)};var gp=M.graph.EditInteractor=function(D){var o=this,P=V.createElement("canvas");P.className="editCanvas",P.style.position="absolute",o._styleMap={},o._canvas=P,o._context=P.getContext("2d"),gp.superClass.constructor.call(o,D),br.setAntialias(o._context,!1),o._subModules=[new br.Anchor(o),new br.RotateX(o),new br.MoveDummy(o),new br.Rect(o),new br.Curve(o),new br.MoveHelper(o)],o._gridGuide=new br.Guide.Grid(o),o._rectGuide=new br.Guide.Rect(o),o._hoverGuide=new br.Guide.Hover(o)},Id=gp;M.Default.def(gp,M.graph.Interactor,{ms_edit:1,ms_fire:1}),v.defineProperties(gp.prototype,{editDetail:{get:function(){var I=!!this._editDetail;return I},set:function(m){var F=this,Z=F._editDetail;Z!==m&&(F._editDetail=m,F.gv._editing=m,F.fp("editDetail",Z,m),F.fp("pointsEditingMode",Z,m),F.fi({kind:m?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(s){(!this._editDetail||s)&&(this.gv._editing=s,s||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(k){this._editing=k,this.gvEditing=k}},pointsEditingMode:{get:function(){return this.editDetail},set:function(O){var L=this;L.editDetail!==O&&(O?L._tryEnterEditDetailMode():L._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var m=this._gridEnabled;if(!m)return!1;var V=this.gv;return V?!0:!0},set:function(p){p!==this._gridEnabled&&(this._gridEnabled=p,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(r){r!==this._agEnabled&&(this._agEnabled=r,this._42())
}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),gp.prototype.getSubModule=function(A){var W,h,o,a=this._subModules;for(h=0,o=a.length;o>h;h++)if(W=a[h],W.catalog===A)return W},gp.prototype.invokeSubModule=function(P,T){var R=this,B=R._subModules;if(B)for(var v,M,J,$=Array.prototype.slice.call(arguments,2),W=0,p=B.length;p>W;W++)if(v=B[W],M=v[P],M&&(J=M.apply(v,$),J!=C&&T))return v},gp.prototype.invokeSubModuleInverse=function(y,M){var o=this,h=o._subModules;if(h)for(var d,t,F,S=Array.prototype.slice.call(arguments,2),P=h.length-1;P>=0;P--)if(d=h[P],t=d[y],t&&(F=t.apply(d,S),F!=C&&M))return d},gp.prototype.setUp=function(){br.log("setUp");var n=this,S=n.gv,k=S.getView(),d=n._canvas;gp.superClass.setUp.call(n),S.setEditInteractor(n),S._79O?k.insertBefore(d,S._79O):k.appendChild(d),br.startEdit(S),n.invokeSubModule("setUp"),S.dm().mm(n._onDataModelChanged,n),S.dm().md(n._onDataPropertyChanged,n)},gp.prototype.tearDown=function(){br.log("tearDown");var l=this,O=l.gv,x=O.getView();l._resetCustomCursorStyle(),gp.superClass.tearDown.call(l),O.dm().umm(l._onDataModelChanged,l),O.dm().umd(l._onDataPropertyChanged,l),O.setEditInteractor(null),x.removeChild(l._canvas),l._drawTimer&&(q(l._drawTimer),l._drawTimer=null),br._46O(O),l.invokeSubModule("tearDown")},gp.prototype._onDataModelChanged=function(x){var q=this;("clear"===x.kind||"remove"===x.kind&&q.editDetail&&x.data===q.getSubModule("Curve").target)&&(q.editDetail=!1,q._42())},gp.prototype._onDataPropertyChanged=function(i){var l=this;if(l.editDetail){var h=l.getSubModule("Curve"),t=i.data;t===h.target&&(t._writing||h._handleDataChanged(i))}},gp.prototype.clear=function(){br.log("clear")},gp.prototype.redraw=function(){this._42()},gp.prototype._42=function(){var w=this;w._drawTimer||(w._drawTimer=a(function(){w._drawTimer=null,w.drawImpl()},0))},gp.prototype.drawImpl=function(){var U;for(U in{_42:!0})break;return function(){var J=this,H=J._canvas,r=J.gv,b=r.getWidth(),R=r.getHeight(),f=J._context,O=M.Default.getInternal(),l=P.devicePixelRatio;(H.width!==b||H.height!==R)&&O.setCanvas(H,b,R,l),f.clearRect(0,0,H.width,H.height);var v=J._getValidSelection();f.save(),f.scale(l,l),J._gridGuide._42(),J.invokeSubModuleInverse(U,!1,f,r,v),J._rectGuide._42(),J._hoverGuide._42(),f.restore()}}(),gp.prototype._getValidSelection=function(){var z=this,O=z.gv,J=O.sm().getSelection(),u=[];return J.each(function(x){O.isVisible(x)&&O.isEditable(x)&&u.push(x)}),u},gp.prototype.handle_touchmove=function(u){return this.handle_mousemove(u)},gp.prototype.handle_mousemove=function(R){if(!M.Default.isDragging()){var j=this;if(j.editDetail||!rp()&&!Hm(R))if(j.gvEditing=!1,j._checkEdit(R))j.gvEditing=!0;else{if(!j.getStyle("hoverGuideEnabled"))return;j.hoverData=j.gv.getDataAt(R),j._42()}}},gp.prototype.handle_touchstart=function(i){return this.handle_mousedown(i)},gp.prototype.handle_mousedown=function(q){Eb(q);var w=this;if(w.editDetail||!rp()&&!Hm(q)){if(Gi(q)&&!q.clickThrough){if(w.editDetail){if(w._tryQuitEditDetailMode(q))return}else if(w._tryEnterEditDetailMode())return;w.gv.dm().beginTransaction();var R=w.invokeSubModule("handleDoubleClick",!0,q);if(w.gv.dm().endTransaction(),R)return}var S=w._checkEdit(q);S&&(w._downPosition=w._getLogicalPoint(q),w.gv.dm().beginTransaction(),S.startEdit(w,q),w.editing=!0)}},gp.prototype._checkEdit=function(p){var O=this,T=O.gv,d=O._getLogicalPoint(p),D=O.invokeSubModule("check",!0,T,p,d)||null;return O._editMod=D,D},gp.prototype.handleWindowTouchMove=function(W){return this.handleWindowMouseMove(W)},gp.prototype.handleWindowMouseMove=function(i){var E=this,b=E._downPosition;if(b){var H=E._getLogicalPoint(i);if(H.distanceTo(b)<E.getStyle("moveSensitivity"))return;delete E._downPosition}var L=E._editMod;L&&L.handleEdit(E.gv,i)},gp.prototype._getLogicalPoint=function(H){var d=this,w=M.Default.getLogicalPoint(H,d._canvas);return new br.Math.Vector2(w)},gp.prototype.handleWindowTouchEnd=function(m){return this.handleWindowMouseUp(m)},gp.prototype.handleWindowMouseUp=function(){var Q;for(Q in{_46O:!0})break;return function(J){var M=this;M.editing=!1,M.setCursor("default"),M.invokeSubModule(Q,!1,J),M._42(),M.gv.dm().endTransaction()}}(),gp.prototype.handle_mousewheel=function(k){var s=this;Eb(k),s.invokeSubModule("preHandleScroll",!0)||s.gv.handleScroll(k,k.wheelDelta)},gp.prototype.handleDelete=function(){var $=this;if(!$.editDetail){$.gv.dm().beginTransaction();var p=$.invokeSubModule("handleNormalStateDelete",!0);return $.gv.dm().endTransaction(),p||$.gv.removeSelection(),void 0}$.gv.dm().beginTransaction(),$.invokeSubModule("handleDelete",!0),$.gv.dm().endTransaction(),$._42()},gp.prototype.handle_keydown=function(c){var R=this;if((c.metaKey||c.ctrlKey)&&R._42(),rp(c)&&!R.editing)return R.gvEditing=!1,R.setCursor("default"),R._42(),void 0;var a=sk(c);return R.editDetail?((a||Ph(c))&&(R.editDetail=!1,R._42()),R.gv.dm().beginTransaction(),R.invokeSubModule("handle_keydown",!0,c),R.gv.dm().endTransaction(),void 0):(R.gv.dm().beginTransaction(),R.invokeSubModule("handleNormalStateKeyDown",!0,c),R.gv.dm().endTransaction(),a&&R._tryEnterEditDetailMode(),void 0)},gp.prototype.handle_keyup=function(P){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,P),this.gv.dm().endTransaction()},gp.prototype._tryEnterEditDetailMode=function(){var J=this;return!J.editDetail&&J.invokeSubModule("canEnterEditDetailMode",!0)&&1===J._getValidSelection().length?(J.editDetail=!0,J._42(),!0):void 0},gp.prototype._tryQuitEditDetailMode=function(B){var x=this;return x.editDetail?!B||x.invokeSubModule("canQuitEditDetailMode",!0,B)?(x.editDetail=!1,x._42(),!0):!1:!1},gp.prototype.setStyle=function(z,Y,K){var x=this;K?br.setStyle(z,Y):x._styleMap[z]=Y,"baseColor"===z&&(hc=Y),x.fp("styleChanged",null,{key:z,value:Y,base:K}),x._42()},gp.prototype.getStyle=function(r){var N=this,x=N._styleMap[r];return x!==C?x:br.getStyle(r)},gp.prototype.setCursor=function(F){this._resetCustomCursorStyle(),M.graph.EditInteractor.superClass.setCursor.call(this,F)},gp.prototype._resetCustomCursorStyle=function(){var i=this;if(i._customStyle){var T=this.gv.getView();T.classList&&T.classList.remove&&T.classList.remove(i._customStyle),i._customStyle=null}},gp.prototype._setRotateCursor=function(K){var v=this,H=v._cursorFactory;H||(H=v._cursorFactory=new br.CursorFactory(v));var J=H.getRotateCursor(K),n=v.gv.getView();v._resetCustomCursorStyle(),v._customStyle=J,n.classList&&n.classList.add&&n.classList.add(J)};var hp=br.Group=function(F){var A=this;A._entities=F,A._64O=0,A._position={x:0,y:0},A._scale={x:1,y:1},A._anchor={x:.5,y:.5},A._anchor2={x:.5,y:.5}};hp.prototype={},hp.prototype.constructor=hp;var kc=null;hp.findOrCreateGroup=function(J){if(kc&&kc.checkIsMe(J))return kc;var K=new br.Group(J);return K.getKeyOb()?(kc=K,K):void 0},hp.prototype.checkIsMe=function(v){var b=this._entities;if(b.length!==v.length)return!1;var f,q={},Z=v.length;for(f=0;Z>f;f++)q[v[f]._id]=!0;for(f=0;Z>f;f++)if(!q[b[f]._id])return!1;return!0},hp.prototype.getRotation=function(){return this._64O},hp.prototype.getPosition=function(){return this._position},hp.prototype.getAnchor=function(){return this._anchor},hp.prototype.getWidth=function(){return this._width},hp.prototype.getScale=function(){return this._scale},hp.prototype.getSize=function(){return{width:this._width,height:this._height}},hp.prototype.getHeight=function(){return this._height},hp.prototype.getKeyOb=function(){for(var S=this._entities,f=S.length-1;f>=0;f--){var o=S[f];if(this.isNode(o))return o}},hp.prototype.getAnchor2=function(){var V=this,w=V.rotateCenter;if(w)return w;var X=V.getKeyOb();if(!X)return V._anchor;var A=V._anchor2,u=X.getMatrix();return u.tf({x:X.getWidth()*(A.x-X.getAnchor().x),y:X.getHeight()*(A.y-X.getAnchor().y)})},hp.prototype.setAnchor2=function(x,l){var N=this,w=N.getKeyOb();if(w){var O,h=w.getMatrix();O="number"==typeof x?{x:x,y:l}:x;var e=h.tfi(O);N._anchor2={x:w.getAnchor().x+e.x/w.getWidth(),y:w.getAnchor().y+e.y/w.getHeight()}}},hp.prototype.setRotation=function(){},hp.prototype.beginRotate=function(L){this.rotateCenter=L.pos,this.rotateMode=L.groupRotateMode},hp.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},hp.prototype.addRotation=function(a,Y){return"batch"===Y?this._addRotationInBatchMode(a):"block"===Y?this._addRotationInBlockMode(a):void 0},hp.prototype._addRotationInBlockMode=function(I){var b=this,L=b.rotateCenter||b.getPosition();b._entities.forEach(function(o){if(b.isNode(o)){var S=o.getMatrix();S.translate(-L.x,-L.y),S.rotate(I),S.translate(L.x,L.y);var j=Math.sign(o.getScale().x);o.setRotation(h(S.b*j,S.a*j)),o.setPosition(S.tx,S.ty)}})},hp.prototype._addRotationInBatchMode=function(H){var D=this,o=D._anchor2;D._entities.forEach(function(R){if(D.isNode(R)){var j=R.getAnchor(),f=R.getMatrix(),F=f.tf({x:R.getWidth()*(o.x-j.x),y:R.getHeight()*(o.y-j.y)}),X=new br.Math.Matrix2d;X.set(f.a,f.b,f.c,f.d,f.tx,f.ty),X.translate(-F.x,-F.y),X.rotate(H),X.translate(F.x,F.y);var p=Math.sign(R.getScale().x);R.setRotation(h(X.b*p,X.a*p)),R.setPosition(X.tx,X.ty)}})},hp.prototype.setPosition=function(L){var p,G,R,h,H=this,a=H._position,X=L.x-a.x,C=L.y-a.y,M=H._entities;for(G=0,R=M.length;R>G;G++)p=M[G],yr(p)&&(h=p.getPosition(),p.setPosition(h.x+X,h.y+C));H._position=L},hp.prototype.setScale=function(i,K){var A=this,c=i/A._scale.x,S=K/A._scale.y;A._adjustChildScaleOrSize(c,S,"size"),A._scale={x:i,y:K}},hp.prototype.getRect=function(){var b=this,S=b._position,r=b._width,u=b._height;return{x:S.x-r/2,y:S.y-u/2,width:r,height:u}},hp.prototype.setSize=function(H,a){var N=this,H=Math.max(1,H),a=Math.max(1,a),T=H/N._width,K=a/N._height;N._adjustChildScaleOrSize(T,K,"size"),N._width=H,N._height=a},hp.prototype._adjustChildScaleOrSize=function(B,d,k){var o,p,K,X,f,W,u,m,M,J,H,C,r,T,I=this,Q=I._position,V=I._entities,a=new br.Math.Matrix2d;for(p=0,K=V.length;K>p;p++)if(o=V[p],I.isNode(o)){if(X=o.getPosition(),f=o.getRotation(),W=o.getWidth(),u=o.getHeight(),m=o.getScale(),H=m.x*W,C=m.y*u,a.identity().scale(H,C).rotate(f).translate(X.x,X.y).translate(-Q.x,-Q.y).rotate(-I._64O),f=h(a.b*Math.sign(H),a.a*Math.sign(H)),a.scale(B,d),M=Math.cos(f),J=Math.sin(f),Math.abs(M)<.001?(r=a.b/J,T=-a.c/J):(r=a.a/M,T=a.d/M),"scale"===k)o.setScale(r/W,T/u);else if("size"===k){var N=r/m.x,S=T/m.y;o.setScale(ef(r)*Math.abs(m.x),ef(T)*Math.abs(m.y)),o.setSize(Math.max(.1,Math.abs(N)),Math.max(.1,Math.abs(S)))}a.rotate(I._64O).translate(Q.x,Q.y),o.setPosition(a.tx,a.ty)}},hp.prototype.getMatrix=function(){var x=this,C=x._position,E=M.Default.getInternal(),q=x._scale;return new E.Mat(x._64O,C.x,C.y,q.x,q.y)},hp.prototype.toGlobal=function(w){return this.getMatrix().tf(w)},hp.prototype.getCorners=function(){var D=this,d=D._width,j=D._height,n=D._anchor,Z=-d*n.x,_=-j*n.y,F=D.getMatrix();return[F.tf(Z,_),F.tf(Z,_+j),F.tf(Z+d,_+j),F.tf(Z+d,_)]},hp.prototype.calcInfo=function(){var h,i,g,b,w,l,c=this,a=[],U=c._entities,W=c._64O;for(b=0,w=U.length;w>b;b++)l=U[b],c.isNode(l)&&l.getCorners&&a.push.apply(a,l.getCorners());if(a.length){var o=Math.cos(-W),H=Math.sin(-W),J=1/0,C=-1/0,Z=1/0,E=-1/0;for(b=0,w=a.length;w>b;b++)g=a[b],h=g.x,i=g.y,g.x=o*h-H*i,g.y=H*h+o*i,J=Math.min(J,g.x),C=Math.max(C,g.x),Z=Math.min(Z,g.y),E=Math.max(E,g.y);c._width=(C-J)/c._scale.x,c._height=(E-Z)/c._scale.y,o=Math.cos(W),H=Math.sin(W);var k=c._anchor;h=J+(C-J)*k.x,i=Z+(E-Z)*k.y,c._position={x:o*h-H*i,y:H*h+o*i}}},hp.prototype.isNode=function(k){return yr(k)?ad(k)?!1:!0:!1},hp.prototype._42=function(J,S,z){var c,f,V,h,A,N,n,L,j=this,D=j._entities,y=j.rotateMode;for("batch"===y&&(L=j.getKeyOb()),c=0,f=D.length;f>c;c++)V=D[c],j.isNode(V)&&(N=V.getRect(),h=br.toScreenPosition(z,{x:N.x,y:N.y}),A=br.toScreenPosition(z,{x:N.x+N.width,y:N.y+N.height}),n={min:h,max:A},V===L&&(n.isKeyOb=!0),br.Icons.DrawIcon(J,S,br.Icons.GroupSubEntityRect,n))};var ue=br.CurveActiving=function(u,w){this._curve=u,this._interactor=u._interactor;for(var Q in w)this[Q]=w[Q]};ue.prototype={},ue.prototype.constructor=ue,v.defineProperties(ue.prototype,{point:{get:function(){return this._point},set:function(a){var R=this;R._point=a,R.editingCtrl||R._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(d){var O=this;O._pairs=d,O.editingCtrl&&O._firePointChange()}}}),ue.prototype._firePointChange=function(){var L=this,k=L.getCurrentEditingPoint(),N=L._interactor;if(!k)return N.fi({kind:"selectPoint"}),void 0;var I=this._curve.target;if(I){var v=br.getDataMatrix(I).invert(),F=k.e;k=v.apply(br.toWorldPosition(N.gv,k)),k.e=F;var E=L._lastFirePoint;E&&Math.abs(k.x-E.x)<1e-5&&Math.abs(k.y-E.y)<1e-5&&(k.e==C&&E.e==C||Math.abs(k.e-E.e)<1e-5)||(L._lastFirePoint=k,N.fi({kind:"selectPoint",x:k.x,y:k.y,e:k.e}))}},ue.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},ue.prototype.getCurrentEditingPoint=function(){var Q=this,k=Q.editingCtrl;if(k){var N=Q.pairs;if(N){var H=N[k.pairId],z=H[k.type];if(z)return z}}return Q._point};var Yh=br.CursorFactory=function(S){var r=this;r._interactor=S,r._rotateCursorStyles={}};Yh.prototype={},Yh.prototype.constructor=Yh,Yh.prototype.getRotateCursor=function(u){var o=this;0>u&&(u+=2*Math.PI);var Q=o._interactor,K=Q.getStyle("rotateCursorSize"),p=Q.getStyle("rotateCursorRound"),A=Math.round(180*(u/Math.PI)/p);A*p>=360&&(A=0);var h=o._rotateCursorStyles,C="htCustomRotateStyle_"+K+"_"+p+"_"+A;return h[C]||(o._produceRotateCursor(C,K,p,A),h[C]=!0),C},Yh.prototype._produceRotateCursor=function(E,R,L,x){var s=this;s._interactor;var g=s._canvas;g||(g=s._canvas=V.createElement("canvas")),g.width=g.height=R*devicePixelRatio,g.style.width=g.style.height=R+" px";var a=g.getContext("2d");br.setAntialias(a,!1),a.scale(devicePixelRatio,devicePixelRatio);var C,U,w,_,P,l=Math.round(R/2),N=""+l+" "+l+",auto !important;";C=Math.PI/180*x*L,a.clearRect(0,0,R,R),a.save(),a.scale(R/32,R/32),a.translate(16,16),a.rotate(C+Math.PI/2),a.beginPath(),a.moveTo(-8,0),a.lineTo(-8,3),a.lineTo(-5,3),a.moveTo(8,0),a.lineTo(8,3),a.lineTo(5,3),a.moveTo(-8,3),a.quadraticCurveTo(0,-6,8,3),a.restore(),a.strokeStyle="white",a.lineWidth=4,a.stroke(),a.strokeStyle="black",a.lineWidth=2,a.stroke(),U=JSON.stringify(g.toDataURL()),_="cursor:url("+U+")"+N,1!==devicePixelRatio&&(w='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+R+'px" height="'+R+'px"><image xlink:href='+U+' width="'+R+'" height="'+R+'"/></svg>',_+="cursor:url(data:image/svg+xml;base64,"+btoa(w)+")"+N,_+="cursor:-webkit-image-set(url("+U+")"+devicePixelRatio+"x,url("+U+")1x)"+N),P=V.createElement("style"),P.textContent="body."+E+" *, ."+E+"{"+_+"}",V.head.appendChild(P)};var aj=br.Guide.Grid=function(V){var k=this;k._interactor=V,k._alignmentGuideId=0,k._xAlignmentGuide=[],k._yAlignmentGuide=[]};aj.prototype={},aj.prototype.constructor=aj,v.defineProperties(aj.prototype,{gridBlockSize:{get:function(){var A=this;return A._gridBlockSize||A._interactor.getStyle("gridBlockSize")},set:function(B){this._gridBlockSize=B,this._interactor._42()}},gridThickLinesEvery:{get:function(){var z=this;return z._gridThickLinesEvery||z._interactor.getStyle("gridThickLinesEvery")},set:function(F){this._gridThickLinesEvery=F,this._interactor._42()}},gridEnabled:{get:function(){var l=this,S=l._interactor;return S.gridEnabled&&l.isValidGrid()}}}),aj.prototype._42=function(){var x=this,X=x._interactor;x.gridEnabled&&x.drawGrid(),X.alignmentGuideEnabled&&x.drawAlignmentGuide()},aj.prototype.makeMatrix=function(){var z=this,l=z._interactor.getStyle("gridAngle"),Y=z._interactor.getStyle("gridRotation"),y=new br.Math.Matrix2d,u=Math.sin(l),g=Math.cos(l);return y.set(1,0,g,u,0,0),y.rotate(Y),y},aj.prototype.isValidGrid=function(){var n=this,Q=Math.PI,l=n._interactor,A=l.gv;if(A._zoom<l.getStyle("gridZoomThreshold"))return!1;var u=l.getStyle("gridAngle"),O=Math.abs(180*(u%Q/Q)),G=1-1e-8;return G>O||O>180-G?!1:!0},aj.prototype.drawAlignmentGuide=function(){var c=this,I=c._interactor,p=I.gv,K=I._canvas,T=I._context,i=K.width,E=K.height,q=p.tx(),v=p.ty(),f=p._zoom;T.beginPath(),T.strokeStyle=I.getStyle("gridAlignmentGuideColor"),T.lineWidth=1,c._xAlignmentGuide.forEach(function(L){var Z=L.p*f+q;T.moveTo(Z,0),T.lineTo(Z,E)}),c._yAlignmentGuide.forEach(function(Q){var H=Q.p*f+v;T.moveTo(0,H),T.lineTo(i,H)}),T.stroke()},aj.prototype.drawGrid=function(){function $(W,g,n,t){var U=br.toScreenPosition(x,l.apply({x:W,y:g})),B=br.toScreenPosition(x,l.apply({x:n,y:t}));K.moveTo(U.x,U.y),K.lineTo(B.x,B.y)}var Y=this,R=Y._interactor,G=Y.gridBlockSize,u=Y.gridThickLinesEvery,F=R.getStyle("gridThickColor"),L=R.getStyle("gridLightColor"),x=R.gv,y=R._canvas,K=R._context,J=y.width,D=y.height,l=Y.makeMatrix(),B=l.applyInverse(br.toWorldPosition(x,{x:0,y:0})),z=l.applyInverse(br.toWorldPosition(x,{x:J,y:0})),N=l.applyInverse(br.toWorldPosition(x,{x:0,y:D})),o=l.applyInverse(br.toWorldPosition(x,{x:J,y:D})),P=Math.min(B.x,z.x,N.x,o.x),c=Math.max(B.x,z.x,N.x,o.x),Z=Math.min(B.y,z.y,N.y,o.y),h=Math.max(B.y,z.y,N.y,o.y);J=c-P,D=h-Z;var O=Math.ceil(P/G),b=Math.floor(c/G),k=Math.ceil(Z/G),n=Math.floor(h/G);x.tx(),x.ty(),x._zoom;var j,I,M;for(K.save(),K.lineWidth=1,K.beginPath(),K.strokeStyle=F,M=Math.ceil(O/u)*u;b>=M;M+=u)j=M*G,$(j,Z,j,h);for(M=Math.ceil(k/u)*u;n>=M;M+=u)I=M*G,$(P,I,c,I);for(K.stroke(),K.beginPath(),K.strokeStyle=L,M=O;b>=M;M++)0!==M%u&&(j=M*G,$(j,Z,j,h));for(M=k;n>=M;M++)0!==M%u&&(I=M*G,$(P,I,c,I));K.stroke(),K.restore()},aj.prototype.getAlignmentGuides=function(){var n=this;return{x:n._xAlignmentGuide,y:n._yAlignmentGuide}},aj.prototype.addAlignmentGuide=function(F,h,m){var p=this,x="x"===F?p._xAlignmentGuide:p._yAlignmentGuide,m=m?m:++p._alignmentGuideId,v={p:h,id:m};if(x.length){var y=p._findClosestAlignmentGuide(v.p,x);y.dis<0?x.splice(y.index+1,0,v):x.splice(y.index,0,v)}else x.push(v);return p._interactor._42(),m},aj.prototype.findClosest=function(f,e,m){var i=this,j=i._interactor,V=j.gv;m&&(f=br.toWorldPosition(V,f));var v,C,g,N=1/0,A=1/0,R=f.x,y=f.y;if(i.gridEnabled){var u=i.gridBlockSize,F=i.makeMatrix(),b=F.applyInverse(f);b=F.apply({x:Math.round(b.x/u)*u,y:Math.round(b.y/u)*u}),N=b.x-R,A=b.y-y,g=!0}if(j.alignmentGuideEnabled&&(v=i._findClosestAlignmentGuide(R,i._xAlignmentGuide).dis,C=i._findClosestAlignmentGuide(y,i._yAlignmentGuide).dis,Math.abs(v)<Math.abs(N)&&(N=v,g=!0),Math.abs(C)<Math.abs(A)&&(A=C,g=!0)),g){g=!1;var d=V._zoom,o=j.getStyle("smartGuideSensitivity")/d,x={};if(Math.abs(N)<o&&"y"!==e&&(x.x=m?N*d:N,g=!0),Math.abs(A)<o&&"x"!==e&&(x.y=m?A*d:A,g=!0),g)return x}},aj.prototype._findClosestAlignmentGuide=function(F,D){if(!D.length)return{dis:1/0};for(var H,j=0,$=D.length-1;$-j>1;)H=Math.floor((j+$)/2),D[H].p<F?j=H:$=H;var J=D[j].p-F,s=D[$].p-F;return Math.abs(J)<=Math.abs(s)?{line:D[j],dis:J,index:j}:{line:D[$],dis:s,index:$}},aj.prototype.removeAllAlignmentGuide=function(r){var A=this;"y"!==r&&(A._xAlignmentGuide=[]),"x"!==r&&(A._yAlignmentGuide=[]),A._interactor._42()},aj.prototype.removeAlignmentGuide=function(f){for(var Z,J,M,U=this,D=U._xAlignmentGuide,g=0;2>g;g++)for(D=0===g?U._xAlignmentGuide:U._yAlignmentGuide,Z=0,J=D.length;J>Z;Z++)if(M=D[Z],M.id===f)return D.splice(Z,1),U._interactor._42(),{axis:0===g?"x":"y",position:M.p};return!1},aj.prototype.adjustAlignmentGuide=function(F,M){var U=this,C=U.removeAlignmentGuide(F);return C?(U.addAlignmentGuide(C.axis,M,F),!0):!1};var fi=br.Guide.Rect=function(p){var m=this;m._interactor=p};fi.prototype={},fi.prototype.constructor=fi,fi.prototype.gatherRects=function(){var N,r,Z,S,b=this,n=b._interactor.gv,o=[],P=[],U={x:o,y:P},D={},d=n.getDataModel(),f=d.a("width"),i=d.a("height");f&&i&&(N=0,r=0,Z=f,S=i,o.push({node:d,type:0,p:N},{node:d,type:1,p:N+Z/2},{node:d,type:2,p:N+Z}),P.push({node:d,type:0,p:r},{node:d,type:1,p:r+S/2},{node:d,type:2,p:r+S}),D[d._id||0]={x:N,y:r,width:Z,height:S}),d.each(function(E){if(yr(E)&&!n.isSelected(E)&&n.isVisible(E)){var k=!1;if(n.sm().getSelection().each(function(s){k||(E.isHostOn(s)?k=!0:E.isDescendantOf(s)&&(k=!0))}),!k){var g=E.getRect();N=g.x,r=g.y,Z=g.width,S=g.height,o.push({node:E,type:0,p:N},{node:E,type:1,p:N+Z/2},{node:E,type:2,p:N+Z}),P.push({node:E,type:0,p:r},{node:E,type:1,p:r+S/2},{node:E,type:2,p:r+S}),D[E._id]=g}}}),o.sort(function(i,l){return i.p-l.p}),P.sort(function(c,x){return c.p-x.p}),b._grid=U,b._87I=D},fi.prototype.gatherLines=function(A,q,U){var u,x,G,y,B,O,c,T,w,V,Z,t,F=this,L=[F.findClosest({x:A.x,y:A.y},q),F.findClosest({x:A.x+A.w/2,y:A.y+A.h/2},q),F.findClosest({x:A.x+A.w,y:A.y+A.h},q)],n={},f=F._87I;U=U||255;var Q,e;for(F._guideLine=[],u=0;2>u;u++)for(n={},0===u?(y="y",T=A.x,w=T+A.w):(y="x",T=A.y,w=T+A.h),x=0;3>x;x++)B=L[x],B&&isFinite(B[y])&&(Q=1<<3*u+x,U&Q&&(O=B[y+"Line"],c=O.node,e=c._id||0,n[e]||(n[e]=!0,t=f[e],"y"===y?(V=t.x,Z=t.x+t.width):(V=t.y,Z=t.y+t.height),G=O.p,F._guideLine.push({type:y,a:T,b:w,c:V,d:Z,p:G,center:1===O.type}))))},fi.prototype._binarySearchClosest=function($,H){if(!H.length)return{dis:1/0};for(var p,s=0,M=H.length-1;M-s>1;)p=Math.floor((s+M)/2),H[p].p<$?s=p:M=p;var a=H[s].p-$,D=H[M].p-$;return Math.abs(a)<=Math.abs(D)?{line:H[s],dis:a}:{line:H[M],dis:D}},fi.prototype.findClosest=function(E,_,H){var F=this,c=F._interactor,l=c.gv,P=F._grid;H&&(E=br.toWorldPosition(l,E));var p,L=F._binarySearchClosest(E.x,P.x),Q=F._binarySearchClosest(E.y,P.y),x=L.dis,w=Q.dis,v=l._zoom,d=c.getStyle("smartGuideSensitivity")/v,q={};return Math.abs(x)<d&&"y"!==_&&(q.x=H?x*v:x,q.xLine=L.line,p=!0),Math.abs(w)<d&&"x"!==_&&(q.y=H?w*v:w,q.yLine=Q.line,p=!0),p?q:void 0},fi.prototype._42=function(){var K=this,k=K._guideLine;if(k&&!M.Default.isCtrlDown()){var Z,o,q,D,a,y,J,w,j,n,X,Y,S,e,F,$,l,R=K._interactor,N=R.gv,L=R._context,T=N.tx(),x=N.ty(),A=N._zoom,p=R.getStyle("guideLineTextSpacing");for(Z=0,o=k.length;o>Z;Z++)q=k[Z],w=q.type,j=q.p,n=q.a,X=q.b,Y=q.c,S=q.d,e=Math.min(n,Y),F=Math.max(X,S),"x"===w?(D=j*A+T,a=e*A+x,y=D,J=F*A+x):(D=e*A+T,a=j*A+x,y=F*A+T,J=a),br.Icons.DrawIcon(R,L,br.Icons.MoveLineGuide,{rect:[D,a,y,J],center:q.center}),S>=n&&X>=Y||(e=n>S?S:X,F=n>S?n:Y,l=F-e,"x"===w?(q.center2center||(D-=p,y=D),a=e*A+x,J=F*A+x,$=br.Icons.MoveLineGuideDistanceV):"y"===w&&(q.center2center||(a-=p,J=a),D=e*A+T,y=F*A+T,$=br.Icons.MoveLineGuideDistanceH),br.Icons.DrawIcon(R,L,$,{x0:D,y0:a,x1:y,y1:J,dis:l}))}},fi.prototype.clear=function(){this._guideLine=null};var fm=br.Guide.Hover=function(F){var w=this;w._interactor=F};fm.prototype={},fm.prototype.constructor=fm,v.defineProperties(fm.prototype,{}),fm.prototype._42=function(){var u=this._interactor;if(u.getStyle("hoverGuideEnabled")&&!u.gvEditing){var L=u.hoverData,p=u.gv;if(!yr(L)||p.isSelected(L))return u.hoverData=null,void 0;var U=Pe(p,L),g=br.toScreenPosition(p,{x:U.x,y:U.y}),C=br.toScreenPosition(p,{x:U.x+U.width,y:U.y+U.height});br.Icons.DrawIcon(u,u._context,br.Icons.HoverDataRect,{min:g,max:C,color:u.getStyle("hoverGuideColor")||u.getStyle("baseColor")})}},br.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyVisible:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideSensitivity:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,guideLineTextSpacing:0,hoverGuideEnabled:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Mj=br.Icons={},Dl=1e4,vs=null,hc=br.DefaultStyleMap.baseColor,Dd="rgb(183,232,135)",dk="rgb(255,204,153)",Fl=6;M.Default.setImage("Icons.RectPoint",{width:Fl,height:Fl,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return hc}},rect:[0,0,Fl,Fl]}]}),Mj.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var t=Mj.GroupSubEntityRect.data;if(!t)return[];var v=t.min,H=t.max;return[v.x,v.y,v.x,H.y,H.x,H.y,H.x,v.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Mj.GroupSubEntityRect.data.isKeyOb?hc:hc}}}]};var Lf=4;Mj.HoverDataRect={comps:[{type:"shape",points:{func:function(){var F=Mj.HoverDataRect.data;if(!F)return[];var x=F.min,B=F.max,c=Lf;return x.x-=c,x.y-=c,B.x+=c,B.y+=c,[x.x,x.y,x.x,B.y,B.x,B.y,B.x,x.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Mj.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},Mj.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Mj.Line.data.P1.x,Mj.Line.data.P1.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Mj.Line.data.P2.x,Mj.Line.data.P2.y],Fl,Fl]}}}]},Mj.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Mj.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Mj.Rect={comps:[{type:"shape",points:{func:function(){var V=Mj.Rect.data;if(!V)return[];var P=V.LT,o=V.LB,k=V.RB,g=V.RT;return[P.x,P.y,o.x,o.y,k.x,k.y,g.x,g.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return hc}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},rect:{func:function(){return[[Mj.Rect.data.LT.x,Mj.Rect.data.LT.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},rect:{func:function(){return[[Mj.Rect.data.LB.x,Mj.Rect.data.LB.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},rect:{func:function(){return[[Mj.Rect.data.RB.x,Mj.Rect.data.RB.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},rect:{func:function(){return[[Mj.Rect.data.RT.x,Mj.Rect.data.RT.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},visible:{func:function(){return Mj.Rect.data.L?!0:!1}},rect:{func:function(){return[[Mj.Rect.data.L.x,Mj.Rect.data.L.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},visible:{func:function(){return Mj.Rect.data.R?!0:!1}},rect:{func:function(){return[[Mj.Rect.data.R.x,Mj.Rect.data.R.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},visible:{func:function(){return Mj.Rect.data.T?!0:!1}},rect:{func:function(){return[[Mj.Rect.data.T.x,Mj.Rect.data.T.y],Fl,Fl]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Mj.Rect.data.rotation}},visible:{func:function(){return Mj.Rect.data.B?!0:!1}},rect:{func:function(){return[[Mj.Rect.data.B.x,Mj.Rect.data.B.y],Fl,Fl]}}}]};var Qb=16;M.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return hc}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return hc}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Mj.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Mj.Anchor.data.POS.x,Mj.Anchor.data.POS.y],Qb,Qb]}}}]},Mj.TipShiftX=12,Mj.TipShiftY=12;var Ao=[8,28];Mj.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Mj.TipHelper.data.helperPos.x,Mj.TipHelper.data.helperPos.y,Ao[0]*Mj.TipHelper.data.size,Ao[1]]}},background:{func:function(){return vs.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Mj.TipHelper.data.text}},rect:{func:function(){return[Mj.TipHelper.data.helperPos.x,Mj.TipHelper.data.helperPos.y,Ao[0]*Mj.TipHelper.data.size,Ao[1]]}},color:{func:function(){return vs.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Rk=7;Mj.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!Mj.ShapePoint.data.dynamicVisible}},rect:{func:function(){var $=Mj.ShapePoint.data.point,S=Mj.ShapePoint.data.size||Rk;return[$,S+10,S+10]}},background:{func:function(){var x=Date.now(),Q=Mj.ShapePoint.data.dynamicPeriod||1500,l=Math.sin(x%Q/Q*Math.PI);return"rgba(27,124,22,"+.5*l+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var s=Mj.ShapePoint.data.point,L=Mj.ShapePoint.data.size||Rk;return[s,L,L]}},background:{func:function(){var W=Mj.ShapePoint.data.isEnd;return W?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return Mj.ShapePoint.data.color||hc}}},{type:"rect",visible:{func:function(){return!!Mj.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return hc}},rect:{func:function(){var Z=5;return[Mj.ShapePoint.data.point,Z,Z]}}}]},Mj.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!Mj.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return Mj.ShapeBgCurve.data.P}},segments:{func:function(){return Mj.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var t=Date.now(),d=Mj.ShapeBgCurve.data.dynamicPeriod||1500,e=Math.sin(t%d/d*Math.PI);return"rgba(27,124,22,"+.3*e+")"}}},{type:"shape",points:{func:function(){return Mj.ShapeBgCurve.data.P}},segments:{func:function(){return Mj.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return Mj.ShapeBgCurve.data.color||hc}}}]};var Sr=8;Mj.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var Z=Mj.ShapeHighlighPoint.data;return[[Z.x,Z.y],Sr,Sr]}},background:{func:function(){return vs.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var $b=10;Mj.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var p=Mj.ShapeHighlighRealPoint.data;return[[p.x,p.y],$b,$b]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return hc}}}]};var Lr=8;Mj.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var R=Mj.ShapeHighlighCtrlPoint.data,u=R.x,G=R.y,s=Lr/2;return[u-s,G-s,u-s,G+s,u+s,G+s,u+s,G-s]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vs.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return vs.getStyle("shapeCtrlPointBorderColor")||hc}}}]};var Qh=3;Mj.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Mj.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Qh,borderColor:{func:function(){return vs.getStyle("curveHighlightColor")}}}]},Mj.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Mj.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Mj.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Mj.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Mj.MoveLineGuide.data.center?Dd:dk}}}]};var Wd=5;Mj.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var g=Mj.MoveLineGuideDistanceH.data,O=g.x0,H=g.y0;return[O,H-Wd,O,H+Wd]
}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dk},{type:"shape",points:{func:function(){var V=Mj.MoveLineGuideDistanceH.data,d=V.x1,H=V.y1;return[d,H-Wd,d,H+Wd]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dk},{type:"text",text:{func:function(){return Math.round(Mj.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var n=Mj.MoveLineGuideDistanceH.data;return[[(n.x0+n.x1)/2,n.y0-10],20,20]}},color:dk,font:"12px Arial",align:"center"}]},Mj.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var b=Mj.MoveLineGuideDistanceV.data,q=b.x0,Q=b.y0;return[q-Wd,Q,q+Wd,Q]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dk},{type:"shape",points:{func:function(){var N=Mj.MoveLineGuideDistanceV.data,j=N.x1,A=N.y1;return[j-Wd,A,j+Wd,A]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dk},{type:"text",text:{func:function(){return Math.round(Mj.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var z=Mj.MoveLineGuideDistanceV.data;return[[z.x0-10,(z.y0+z.y1)/2],20,20]}},color:dk,font:"12px Arial",align:"center"}]},M.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Mj.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var n=Mj.EdgeElevationGuide.data,$=n.x,h=n.y,d=vs.getStyle("curveElevationIntersectSize"),l=vs.getStyle("curveElevationGuideShift");return $+=l[0],h+=l[1],[$-d,h-d,2*d,2*d]}}}]},M.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),M.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Mj.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Mj.ConnectGuide.data.rotation}},rect:{func:function(){var A=Mj.ConnectGuide.data.connect;A.x,A.y;var c=vs.getStyle("connectGuideIntersectSize");return[[A.x,A.y],2*c,2*c]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var I=Mj.ConnectGuide.data.cursorPos||Mj.ConnectGuide.data.connect,o=vs.getStyle("connectGuideIntersectSize");return[[I.x,I.y],2*o-2,2*o-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var X=Mj.ConnectGuide.data.connect,J=Mj.ConnectGuide.data.cursorPos||X;return[X.x,X.y,X.x+.5*(J.x-X.x),X.y,J.x+.5*(X.x-J.x),J.y,J.x,J.y]}}}]},M.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),M.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Mj.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var X=Mj.ConnectGuideGarbage.data.hover;return X?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var E=Mj.ConnectGuideGarbage.data,M=vs.getStyle("connectGuideGarbageIntersectsize");return E.hover&&(M+=5),[[E.x,E.y],2*M,2*M]}}}]};var Xo=6;Mj.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Mj.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var x=Mj.ShapeActivingCtrl.data;return[x.point.x,x.point.y,x.c1.x,x.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return hc}}},{type:"shape",visible:{func:function(){return Mj.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var P=Mj.ShapeActivingCtrl.data;return[P.point.x,P.point.y,P.c2.x,P.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return hc}}},{type:"shape",visible:{func:function(){return Mj.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var P=Mj.ShapeActivingCtrl.data.c1,d=P.x,T=P.y,l=Xo/2;return"c1"===Mj.ShapeActivingCtrl.data.hl&&(l+=.5),[d-l,T-l,d-l,T+l,d+l,T+l,d+l,T-l]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vs.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Mj.ShapeActivingCtrl.data.hl?vs.getStyle("shapeCtrlPointHighlightBorder")||hc:vs.getStyle("shapeCtrlPointBorderColor")||hc}}},{type:"shape",visible:{func:function(){return Mj.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var h=Mj.ShapeActivingCtrl.data.c2,d=h.x,H=h.y,Y=Xo/2;return"c2"===Mj.ShapeActivingCtrl.data.hl&&(Y+=.5),[d-Y,H-Y,d-Y,H+Y,d+Y,H+Y,d+Y,H-Y]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vs.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Mj.ShapeActivingCtrl.data.hl?vs.getStyle("shapeCtrlPointHighlightBorder")||hc:vs.getStyle("shapeCtrlPointBorderColor")||hc}}}]},Mj.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return hc}},rect:{func:function(){return[[Mj.RoundPoint.data.x,Mj.RoundPoint.data.y],Fl,Fl]}}}]},Mj.AttachPoint={comps:[{type:"rect",background:{func:function(){return Mj.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return hc}},rect:{func:function(){var v=Mj.AttachPoint.data.isAttach?Fl+4:Fl;return[[Mj.AttachPoint.data.x,Mj.AttachPoint.data.y],v,v]}}}]},Mj.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return Mj.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return Mj.SimpleRect.data.color||hc}},rect:{func:function(){var E=Mj.SimpleRect.data;return[E.x,E.y,E.width,E.height]}}}]},M.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),Mj.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var M=Mj.MoveDummy.data;return[[M.pos.x,M.pos.y],2*M.size,2*M.size]}}}]},br.Icons.DrawIcon=function(L,m,G,l){G.width=G.height=Dl,G.data=l,vs=L,M.Default.drawImage(m,G,0,0,Dl,Dl)},br.Icons.MapPoints=function(m,n){for(var B=0,s=m.length;s>B;B++)m[B]/=n},br.roundTo=function(V,A,j){var k=Math.abs(V%A);return j>k||j>A-k?A*Math.round(V/A):V},br.toFixed=function(W){return Math.round(100*W)/100},br.getDataMatrix=function(A){if(A instanceof M.Shape){var J=new M.Math.Matrix2d,L=A.getPosition();return J.translate(-L.x,-L.y).scale(A.getScale().x,A.getScale().y).rotate(A.getRotation()).translate(L.x,L.y),J}return A.getMatrix?A.getMatrix():new M.Math.Matrix2d};var tk=br.Math.Curve=function(){this._curves=[]};tk.prototype={},tk.prototype.constructor=tk,tk.prototype.createFromHtShape=function(D,r,g){r instanceof M.List&&(r=r.toArray());var Z,h,$,B,o,t,a,X=this,u=null,v=null,R=0,n=br.Math.Vector2,Q=br.Math.CubicBezier,k=function(b){return new n(D[b],D[b+1],g?g[b/2]:C)};for(h=0,$=r.length;$>h;h++){switch(B=r[h],o=null,B){case 1:v=k(R),u=v,R+=2;break;case 2:Z=k(R),R+=2,o=new Q(v,v.clone(),Z.clone(),Z),v=Z;break;case 3:t=k(R),Z=k(R+2),R+=4,o=new Q(v,t.clone().sub(v).multiplyScalar(2/3).add(v),t.clone().sub(Z).multiplyScalar(2/3).add(Z),Z),v=Z;break;case 4:t=k(R),a=k(R+2),Z=k(R+4),R+=6,o=new Q(v,t,a,Z),v=Z;break;case 5:if(!u)break;o=new Q(v,v.clone(),u.clone(),u),v=null,u=null}o&&(o._index=X._curves.length,X._curves.push(o))}},tk.prototype.checkPoint=function(S,R){var X,q,w,m,d,L=this,h=L._curves;for(X=0,q=h.length;q>X;X++)if(m=h[X],d=m.intersectRect(S,R,R),d.length)return w=0,d.forEach(function(p){w+=p.t}),w/=d.length,S=m.getPointAt(w),S.t=w,{bezier:m,intersection:S}},tk.prototype.insertKnot=function(o,k){var I=o.insertKnot(k),U=this,t=U._curves;t.splice(o._index,1,I[0],I[1])},tk.prototype._isCloseEnough=function(W,V){return Math.abs(W.x-V.x)<1e-6&&Math.abs(W.y-V.y)<1e-6},tk.prototype._isSamePoint=function(r,w){return r===w},tk.prototype.moveRealPoint=function(e,c){var n=this,T=n._curves,K=c.clone().sub(e);T.forEach(function(u){var E=u._p1;u._p2,u._p3;var X=u._p4;n._isSamePoint(E,e)&&(u._p2.add(K),u._p1=c),n._isSamePoint(X,e)&&(u._p3.add(K),u._p4=c)})},tk.prototype.moveCtrlDueToRealPointMovement=function(i,p){var C=this,H=C._curves,L=function(L){L.add(p),L.e&&p.e&&(L.e+=p.e)};H.forEach(function(f){var X=f._p1;f._p2,f._p3;var A=f._p4;C._isSamePoint(X,i)&&L(f._p2),C._isSamePoint(A,i)&&L(f._p3)})},tk.prototype.moveCtrlPoint=function(l,u,U){var H=l[U];if(H){H.e!==C&&(u.e=H.e);var o=this,G=o._curves;u.clone().sub(H),G.forEach(function(V){var j;"c2"===U?j="_p2":"c1"===U&&(j="_p3"),o._isSamePoint(V[j],H)&&(V[j]=u)}),l[U]=u}},tk.prototype.deleteRealPoint=function(r,h){var V,Q,l,B,w,K,i,b=this,d=b._curves,p={},c=[],Z=br.Math.CubicBezier;for(Q=0,l=d.length;l>Q;Q++)V=d[Q],B=V._p1,w=V._p2,K=V._p3,i=V._p4,(p[Q]||!b._isSamePoint(B,r))&&(b._isSamePoint(i,r)?l>Q+1&&b._isSamePoint(d[Q+1]._p1,r)&&(h||c.push(new Z(B,w,d[Q+1]._p3,d[Q+1]._p4))):c.push(V));b._curves=c},tk.prototype.findPairs=function(P,L){var k,o,G,b,w,W,n,c,h=this,z=h._curves,V={},X=[];for(o=0,G=z.length;G>o;o++)k=z[o],b=k._p1,w=k._p2,W=k._p3,n=k._p4,!V[o]&&h._isSamePoint(b,P)&&(L?X.push({point:b,r2:n}):X.push({point:b,c2:w})),h._isSamePoint(n,P)&&(c=L?{point:n,r1:b}:{point:n,c1:W},G>o+1&&h._isSamePoint(z[o+1]._p1,P)&&(L?c.r2=z[o+1]._p4:c.c2=z[o+1]._p2,V[o+1]=!0),X.push(c));return X},tk.prototype.toHtShape=function(){var G=this,H=G._curves,h=[],$=[],O={x:1/0,y:1/0};return H.forEach(function(S){var A=S._p1,R=S._p2,F=S._p3,B=S._p4;return G._isCloseEnough(A,O)||(h.push(1),$.push(A.clone())),O=B,G._isCloseEnough(A,R)&&G._isCloseEnough(F,B)?(h.push(2),$.push(B.clone()),void 0):(h.push(4),$.push(R.clone(),F.clone(),B.clone()),void 0)}),{segments:h,points:$}};var Gd=br.Math.CubicBezier=function(O,w,a,g){var Y=this;Y._id=br.Math.CubicBezier._globalId++,Y._p1=O,Y._p2=w,Y._p3=a,Y._p4=g};Gd._globalId=1,Gd.prototype={},Gd.prototype.constructor=Gd,Gd.prototype.toString=function(){return this._id},Gd.prototype.intersectRect=function(r,L,J){var x=L/2,c=J/2,H=r.x,$=r.y,A=br.Math.Vector2,T=new A(-x+H,-c+$),o=new A(x+H,c+$),b=new A(o.x,T.y),G=new A(T.x,o.y),U=this,Q=U.intersectLine(T,b),M=U.intersectLine(b,o),i=U.intersectLine(o,G),P=U.intersectLine(G,T),f=Q.concat(M).concat(i).concat(P);return f},Gd.prototype.intersectLine=function(U,Q){var M,j,p,w,H,D,O,a,V,k,K,Y,o,i=this,t=U.clone().min(Q),d=U.clone().max(Q);w=i._p1,H=i._p2,D=i._p3,O=i._p4,M=w.clone().multiplyScalar(-1),j=H.clone().multiplyScalar(3),p=D.clone().multiplyScalar(-3),K=M.add(j).add(p).add(O),M=w.clone().multiplyScalar(3),j=H.clone().multiplyScalar(-6),p=D.clone().multiplyScalar(3),k=M.add(j).add(p),M=w.clone().multiplyScalar(-3),j=H.clone().multiplyScalar(3),V=M.add(j),a=w.clone(),o=new br.Math.Vector2(U.y-Q.y,Q.x-U.x),Y=U.x*Q.y-Q.x*U.y;for(var s=i.getRoots(o.dot(K),o.dot(k),o.dot(V),o.dot(a)+Y),B=new Array,v=0,W=s.length;W>v;v++){var N=s[v];if(!(0>N||N>1)){var F=w.clone().lerp(H,N),e=H.clone().lerp(D,N),b=D.clone().lerp(O,N),m=F.lerp(e,N),G=e.lerp(b,N),I=m.lerp(G,N);I.t=N,U.x==Q.x?t.y<=I.y&&I.y<=d.y&&B.push(I):U.y==Q.y?t.x<=I.x&&I.x<=d.x&&B.push(I):I.x>=t.x&&I.y>=t.y&&I.x<=d.x&&I.y<=d.y&&B.push(I)}}return B},Gd.prototype.solveTForPoint=function(L){var T,A,h,v,y=this;T=y._p1.x-L.x,A=y._p2.x-L.x,h=y._p3.x-L.x,v=y._p4.x-L.x;for(var n=y.getRoots(v-3*h+3*A-T,3*h-6*A+3*T,3*A-3*T,T),g=C,d=1/0,e=0,o=n.length;o>e;e++){var P=n[e];if(!(0>P||P>1)){var Y=y._p1.clone().lerp(y._p2,P),X=y._p2.clone().lerp(y._p3,P),_=y._p3.clone().lerp(y._p4,P),r=Y.lerp(X,P),D=X.lerp(_,P),j=r.lerp(D,P);j.t=P;var G=Math.abs(j.y-L.y);d>G&&(d=G,g=j)}}return g},Gd.prototype.getPointAt=function(F){var _=this,W=_._p1,I=_._p2,b=_._p3,K=_._p4,f=W.clone().lerp(I,F),G=I.clone().lerp(b,F),Q=b.clone().lerp(K,F),L=f.lerp(G,F),s=G.lerp(Q,F);return L.lerp(s,F)},Gd.prototype.getRoots=function(j,k,v,N){var T,C,X,M,B,z=new Array;if(Math.abs(j)<1e-6){var T=k,C=v/T,X=N/T,M=C*C-4*X;if(M>0){var B=Math.sqrt(M);z.push(.5*(-C+B)),z.push(.5*(-C-B))}else 0==M&&z.push(.5*-C)}k/=j,v/=j,N/=j,T=(3*v-k*k)/3,C=(2*k*k*k-9*v*k+27*N)/27;var H=k/3,u=C*C/4+T*T*T/27,o=C/2;if(Math.abs(u)<=1e-6&&(u=0),u>0){var G,a,B=Math.sqrt(u);G=-o+B,a=G>=0?Math.pow(G,1/3):-Math.pow(-G,1/3),G=-o-B,G>=0?a+=Math.pow(G,1/3):a-=Math.pow(-G,1/3),z.push(a-H)}else if(0>u){var s=Math.sqrt(-T/3),O=Math.atan2(Math.sqrt(-u),-o)/3,n=Math.cos(O),S=Math.sin(O),Z=Math.sqrt(3);z.push(2*s*n-H),z.push(-s*(n+Z*S)-H),z.push(-s*(n-Z*S)-H)}else{var G;G=o>=0?-Math.pow(o,1/3):Math.pow(-o,1/3),z.push(2*G-H),z.push(-G-H)}return z},Gd.prototype._70I=function(){var d=this;return d._p1.distanceToSquared(d._p2)<1e-10&&d._p3.distanceToSquared(d._p4)<1e-10},Gd.prototype.insertKnot=function(K){var Q=this,m=Q._p1,A=Q._p2,h=Q._p3,f=Q._p4,x=m.clone().lerp(A,K),O=A.clone().lerp(h,K),I=h.clone().lerp(f,K),$=x.clone().lerp(O,K),k=O.clone().lerp(I,K),P=$.clone().lerp(k,K);return Q._70I()?(m.clone().lerp(f,K),[new br.Math.CubicBezier(m,m.clone(),P.clone(),P),new br.Math.CubicBezier(P,P.clone(),f.clone(),f)]):[new br.Math.CubicBezier(m,x,$,P),new br.Math.CubicBezier(P,k,I,f)]};var mo=M.Default.getInternal().ui().EdgeUI,qk={_47O:function(d){var G=this,L=qk.getBackups()._47O;br.inEdit(G.gv)||L.call(G,d)}};br.Inject.registAsModule(qk,mo);var Vf=M.Default.getInternal().ui().NodeUI,$n={_47O:function(A){var x=this,E=$n.getBackups()._47O;br.inEdit(x.gv)||E.call(x,A)},getSelectWidth:function(){var q=this,J=q.gv,l=q._data;if(J.isEditable(l)&&br.inEdit(J))return 0;var I=$n.getBackup("getSelectWidth");return I.call(q)}};br.Inject.registAsModule($n,Vf);var Sc=M.graph.GraphView,gd={_editPointSize:function(){var q=M.Default.isTouchable,u=br.getStyle("pointSize");return u[q?0:1]}(),isPointEditable:function(c){var I=this;if(br.inEdit(I))return I._pointEditableFunc?I._pointEditableFunc(c):!0;var q=gd.getBackup("isPointEditable");q.call(I,c)},isEditable:function(C){var I,v=this,x=gd.getBackup("isEditable");if(I=C instanceof br.Group?!0:x.call(v,C),!br.inEdit(v))return I;if(!(C instanceof M.Edge))return I;if(!C.s("2d.editable"))return!1;var X=v.getEditableFunc();return X?X(C):!0},_42:function(s,M){var W=this,F=gd.getBackups()._42;if(F.call(W,s,M),br.inEdit(W)){var c=W.getEditInteractor();c.drawImpl()}}};br.Inject.registAsModule(gd,Sc);var yk=M.Default.getInternal().ui().ShapeUI,Ze={_47O:function(E){var i=this,u=Ze.getBackups()._47O;br.inEdit(i.gv)||u.call(i,E)}};br.Inject.registAsModule(Ze,yk);var Df=M.graph.DefaultInteractor,pc={handle_mousewheel:function(N){var m=this,G=pc.getBackup("handle_mousewheel");br.inEdit(m.gv)||G.call(m,N)}};br.Inject.registAsModule(pc,Df);var Zd=M.graph.MoveInteractor,Of={_calcShift:function(c,s){var l=this,n=Of.getBackup("_calcShift"),g=l.gv;if(!br.inEdit(g))return n.call(l,c,s);var B=g.getEditInteractor(),q=B.getSubModule("Move").calcShift(c,s,l);return q||n.call(l,c,s)},clear:function(H){var R=this,Q=Of.getBackup("clear");Q.call(R,H);var O=R.gv;if(br.inEdit(O)){var Y=O.getEditInteractor();Y.getSubModule("Move").clear(H)}}};br.Inject.registAsModule(Of,Zd);var fi=br.Rect=function(z){this.catalog="Rect",this._interactor=z};fi.prototype={},fi.prototype.constructor=fi,fi.prototype.gatherInfo=function(J,u){var V=this;if(1===u.length){var A=u[0];return A instanceof M.Shape&&A._70I()?V.gatherLine(J,A):ad(A,J)?!1:V.gatherSingleTarget(J,A)}return u.length>1?V.gatherMultiTargets(J,u):!1},fi.prototype.gatherSingleTarget=function(n,x){if(x.getCorners){var e,T=this,W=T.info;T.target=x,e=T.screenInfo={};var p=x.getCorners();W.LT=new br.Math.Vector2(p[0]),W.LB=new br.Math.Vector2(p[1]),W.RB=new br.Math.Vector2(p[2]),W.RT=new br.Math.Vector2(p[3]),W.T=W.LT.clone().add(W.RT).divideScalar(2),W.B=W.LB.clone().add(W.RB).divideScalar(2),W.L=W.LT.clone().add(W.LB).divideScalar(2),W.R=W.RT.clone().add(W.RB).divideScalar(2);for(var q in W)e[q]=br.toScreenPosition(n,W[q]);var C=T._interactor,t=C.getStyle("checkSize"),v=function(X,b,h){var G=b.clone().sub(X).setLength(-t),d=h.clone().sub(X).setLength(-t),B=G.add(d).add(X);return B};return e.rotLT=v(e.LT,e.RT,e.LB),e.rotLB=v(e.LB,e.LT,e.RB),e.rotRB=v(e.RB,e.LB,e.RT),e.rotRT=v(e.RT,e.LT,e.RB),e.rotT=e.rotLT.clone().add(e.rotRT).divideScalar(2),e.rotB=e.rotLB.clone().add(e.rotRB).divideScalar(2),e.rotL=e.rotLT.clone().add(e.rotLB).divideScalar(2),e.rotR=e.rotRT.clone().add(e.rotRB).divideScalar(2),e.rotation=x.getRotation(),T.gatherConnectInfo(),!0}},fi.prototype.gatherConnectInfo=function(){var u=this,w=u.target,r=u._interactor,v=u.screenInfo,i=r.gv;if(i.isConnectActionVisible(w)&&r.getStyle("connectGuideVisible")){var g;w.s&&(g=w.s("connectGuideShift")),g||(g=r.getStyle("connectGuideShift"));var Q=w.getAnchor(),B=w.getSize(),L=w.toGlobal({x:B.width*(g[0]-Q.x),y:B.height*(g[1]-Q.y)});L=br.toScreenPosition(i,L),v.P1?L.add(v.P2.clone().sub(v.P1).setLength(g[2])):(L.add(v.RT.clone().sub(v.LT).setLength(g[2])),L.add(v.LB.clone().sub(v.LT).setLength(g[3]))),v.connect=L}},fi.prototype.gatherMultiTargets=function(V,N){var t=br.Group.findOrCreateGroup(N);if(!t)return!1;var P=this;return P.editing&&"rotate"!==P.editing.mode||t.calcInfo(),P.gatherSingleTarget(V,t)},fi.prototype.gatherLine=function(C,b){this.target=b;var D=this.screenInfo={},u=b.getPoints(),i=br.getDataMatrix(b);return D.P1=br.toScreenPosition(C,i.apply(u.get(0))),D.P2=br.toScreenPosition(C,i.apply(u.get(1))),this.gatherConnectInfo(),!0},fi.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],fi.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],fi.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],fi.prototype.check=function(c,T,n){if(M.Default.isLeftButton(T)){var z=this;if(z.editing=null,z.tipInfo=null,z.screenInfo){var r=z.target,v=c.isEditable(r),N=z.screenInfo;if(v&&N.connect){var j=z._checkConnect(n);if(j)return j}if(N.P1)return z._checkLine(n);var a,s,R,Q=null,Z=z._interactor,d=Z.getStyle("checkSize");if(v&&c.isRectEditable(r))for(s=0;s<br.Rect.ResizeKeys.length;s++)if(R=br.Rect.ResizeKeys[s],br.checkHit(n,N[R],d)){Q=R,a="resize";break}if(!Q&&v&&c.isRotationEditable(r)&&!Z.getStyle("rotateAsClock")){var B=Z.getStyle("rotateCheckSize");for(s=0;s<br.Rect.RotateKeys.length;s++)if(R=br.Rect.RotateKeys[s],br.checkHit(n,N[R],B)){Q=R,a="rotate";break}}if(!Q)return Z.setCursor("default"),void 0;if("rotate"===a){var F,D=c.lp(T);if(r instanceof br.Group){var U=Z.getStyle("groupRotateModeKey");"string"==typeof U&&(U=[U]);for(var X=!1,y=0,H=U.length;H>y;y++)if(T[U[y]]){X=!0;break}var l=Z.getStyle("groupRotateModeDefault");F=X?"batch"===l?"block":"batch":l}var g="batch"===F?r.getAnchor2():r.getPosition(),e=Math.atan2(D.y-g.y,D.x-g.x);Z._setRotateCursor(e),z.editing={mode:a,key:Q,pos:g,flipY:r.getScale().y<0,rotation:r.getRotation(),hitRot:e},F&&(z.editing.groupRotateMode=F)}else{var i=br.Rect.ResizeKeys.indexOf(Q),P=br.Rect.ResizeDirection[i],k=Math.cos(r.getRotation()),p=Math.sin(r.getRotation()),S=P.x*Math.sign(r.getScale().x),m=P.y*Math.sign(r.getScale().y),J=Math.atan2(-p*S-k*m,k*S-p*m),o=(Math.round(J/(Math.PI/4))+8)%8,u=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][o];this._interactor.setCursor(u);var I=r.getWidth(),E=r.getHeight(),w=r.getAnchor();z.editing={mode:a,key:Q,rect:{x:-I*w.x,y:-E*w.y,width:I,height:E},anchor:w,matrix:r.getMatrix()}}return Q}}},fi.prototype._checkLine=function(t){var W=this;W.screenInfo;var e,_=W._interactor.getStyle("checkSize");if(br.checkHit(t,W.screenInfo.P1,_))e="P1";else{if(!br.checkHit(t,W.screenInfo.P2,_))return this._interactor.setCursor("default"),void 0;e="P2"}return W.editing={mode:"line",key:e},e},fi.prototype._checkConnect=function(N){var h=this,A=h.screenInfo,i=h._interactor,O=i.getStyle("connectGuideIntersectSize"),v=A.connect,f=N.x,y=v.x;if(y>f&&O>y-f&&Math.abs(v.y-N.y)<O||f>=y&&br.checkHit(N,v,O)){var t="connect",S=w.getConnectAction(i.gv);if(h.editing={mode:t},S&&S.delete)if(h.target instanceof br.Group){var V=!0;i.gv.sm().getSelection().each(function(c){S.delete.visible.call(null,i.gv,c)||(V=!1)}),h.editing.hasDeleteAction=V}else S.delete.visible.call(null,i.gv,h.target)&&(h.editing.hasDeleteAction=!0);return i.setCursor("default"),t}},fi.prototype._fireEditEvent=function(y,c){var t=this._interactor,P=this.editing;if(P){var H=P.mode;H="rotate"===H?"Rotation":"connect"===H?"Connection":H[0].toUpperCase()+H.slice(1),t.fi({kind:y+"Edit"+H,event:c})}},fi.prototype.startEdit=function(z,a){z.startDragging(a);var A=this;A._interactor.fi({kind:"prepareEdit",event:a});var y=A.editing,M=A.target;if(y){if(A._fireEditEvent("begin",a),"rotate"===y.mode)return y.groupRotateMode&&M.beginRotate(y),void 0;if("connect"!==y.mode)("line"===y.mode||M&&0===M.getRotation())&&(A._inSmartGuide=!0,A._interactor.rectGuide.gatherRects());else if(y.hasDeleteAction){var g=z.gv,L=A._interactor.getStyle("connectGuideGarbageShift");y.garbageInfo={x:g.getWidth()*L[0]+L[2],y:g.getHeight()*L[1]+L[3],size:A._interactor.getStyle("connectGuideGarbageIntersectsize")},z._42()}}},fi.prototype._46O=function(n){var E,v,g=this,S=g.editing,b=g.target;if(S){if("connect"===S.mode&&!S.canceled&&!S.deleted)try{S.garbageInfo&&S.garbageInfo.hover?w.doDeleteConnectionAction(g._interactor.gv,b):w.doConnectAction(g._interactor.gv,b,S.target)}catch(V){console.error(V)}v=S.freezeFlag,E=g.editing.groupRotateMode,g._fireEditEvent("end",n),g.editing=null}g.tipInfo=null,g._inSmartGuide&&(g._interactor.rectGuide.clear(),g._inSmartGuide=!1),E&&b&&b.endRotate(),b instanceof M.Block&&(v===C?delete b._freezeSyncFromChildren:b._freezeSyncFromChildren=v,b.updateFromChildren())},fi.prototype.handleNormalStateDelete=function(){var T=this,Y=T.editing;if(Y&&"connect"===Y.mode&&!Y.canceled&&!Y.deleted){if(Y.garbageInfo){try{w.doDeleteConnectionAction(T._interactor.gv,T.target)}catch(P){console.error(P)}Y.garbageInfo=null}return Y.cursorPos=null,Y.targetCorners=null,Y.deleted=!0,T._interactor._42(),!0}},fi.prototype.handleNormalStateKeyDown=function(I){var N=this,y=N.editing;return!y||"connect"!==y.mode||y.canceled||y.deleted?void 0:M.Default.isEsc(I)?(y.cursorPos=null,y.targetCorners=null,y.canceled=!0,N._interactor._42(),!0):void 0},fi.prototype.handleEdit=function(h,N){var x=this,r=x.editing;if(r){var K,U,W,Q,w,k=x.target,g=r.key,m=r.mode,L=h.lp(N),e=x._interactor;if("connect"===m){if(r.canceled)return;if(r.deleted)return;r.cursorPos=e._getLogicalPoint(N);var l=r.garbageInfo;return l&&br.checkHit(r.cursorPos,l,l.size)?(l.hover=!0,r.target=null,r.targetCorners=null):(l&&(l.hover=!1),r.target=h.getDataAt(L,function(O){return h.isSelectable(O)?yr(O)?!0:!1:!1})||null,r.targetCorners=br.getTargetCornersOnScreen(h,r.target)),e._42(),void 0}if("rotate"===m){var p,n,G=r.pos,c=Math.atan2(L.y-G.y,L.x-G.x);if(r.groupRotateMode?n=c-r.hitRot:(p=c-r.hitRot,n=r.rotation+p),n%=2*Math.PI,0>n&&(n+=2*Math.PI),!M.Default.isCtrlDown(N)){var y,C;gb(N)?(y=e.getStyle("shiftRotateRound"),C=y/2):(y=e.getStyle("rotateRound"),C=e.getStyle("rotateSensitivity")),n=br.roundTo(n,y,C)}r.groupRotateMode?(p=n-(r.lastRotation||0),0!==p&&(k.addRotation(p,r.groupRotateMode),r.lastRotation=n)):k.setRotation(n),e._setRotateCursor(c),n>Math.PI&&(n-=2*Math.PI);var v=180*(n/Math.PI);v=v.toFixed(2),K=""+v+""}else if("resize"===m){var J=r.rect;W=J.x,Q=J.y;var O,E=J.width,P=J.height,f=r.anchor,d=r.matrix,T=k.s&&k.s("keepAspectRatio")||e.getStyle("keepAspectRatio");gb(N)&&(T=!T);var z=x._unionPointMode1,Z=x._unionPointMode2;if(x._inSmartGuide&&!M.Default.isCtrlDown(N)&&!T){var Y;"L"===g||"R"===g?Y="x":("T"===g||"B"===g)&&(Y="y"),x._adsorbedToClosest(L,Y),w=!0}O=d.tfi(L);var o;"LT"===g?(J=z(O,{x:W+E,y:Q+P},E,P,T),o=9):"T"===g?(J=Z({x:W,y:O.y},{x:W+E,y:Q+P},E,P,T,"v"),o=1):"RT"===g?(J=z(O,{x:W,y:Q+P},E,P,T),o=33):"L"===g?(J=Z({x:O.x,y:Q},{x:W+E,y:Q+P},E,P,T,"h"),o=8):"R"===g?(J=Z({x:W,y:Q},{x:O.x,y:Q+P},E,P,T,"h"),o=32):"LB"===g?(J=z(O,{x:W+E,y:Q},E,P,T),o=12):"B"===g?(J=Z({x:W,y:Q},{x:W+E,y:O.y},E,P,T,"v"),o=4):"RB"===g&&(J=z(O,{x:W,y:Q},E,P,T),o=36);var V=d.tf(J.x+J.width*f.x,J.y+J.height*f.y);k instanceof M.Block&&(r.hasOwnProperty("freezeFlag")||(r.freezeFlag=k._freezeSyncFromChildren,k._freezeSyncFromChildren=!0)),k.setPosition(V),k.setSize(J.width,J.height),w&&(U=k.getRect(),e.rectGuide.gatherLines({node:k,x:U.x,y:U.y,w:U.width,h:U.height},Y,o)),K=""+Math.round(J.width)+" * "+Math.round(J.height)}else if("line"===m){if(gb(N)){var $=k.getPoints(),a="P1"===g?$.get(1):$.get(0),H={x:L.x-a.x,y:L.y-a.y},X=e.getStyle("shiftLineRotateRound"),S=x._shiftDirList;if(!S||x._shiftRotateRound!==X){x._shiftRotateRound=X,x._shiftDirList=S=[];for(var q=0;q<Math.PI;q+=X)S.push({x:F(q),y:i(q)})}for(var A,s=0,D=0,_=S.length;_>D;D++){var B=S[D],I=B.x*H.x+B.y*H.y;Math.abs(I)>Math.abs(s)&&(s=I,A=B)}L={x:a.x+A.x*s,y:a.y+A.y*s},e.rectGuide.clear()}else x._inSmartGuide&&!M.Default.isCtrlDown(N)&&(x._adsorbedToClosest(L),w=!0);var j=br.getDataMatrix(k).applyInverse(L);k.setPoint("P1"===g?0:1,j,!0);var t=k.getPoints(),u=t.get(0),b=t.get(1);W=u.x-b.x,Q=u.y-b.y,K=" "+Math.round(Math.sqrt(W*W+Q*Q))+" ",w&&(U=k.getRect(),e.rectGuide.gatherLines({node:k,x:U.x,y:U.y,w:U.width,h:U.height}))}if(K){var R=M.Default.getLogicalPoint(N,e._canvas);R.x+=br.Icons.TipShiftX,R.y+=br.Icons.TipShiftY,x.tipInfo={helperPos:R,text:K,size:K.length}}x._fireEditEvent("between",N)}},fi.prototype._unionPointMode1=function(Q,i,u,B,J){if(J&&u&&B){var T=Q.x-i.x,A=Q.y-i.y;Math.abs(T*B)<Math.abs(A*u)?(A=Math.sign(A)*Math.abs(T*B/u),Q.y=i.y+A):(T=Math.sign(T)*Math.abs(A*u/B),Q.x=i.x+T)}return M.Default.unionPoint(Q,i)},fi.prototype._unionPointMode2=function(E,K,F,B,u,W){var a=M.Default.unionPoint(E,K);if(u&&F&&B){var i;"v"===W?(i=a.x+a.width/2,a.width=F*a.height/B,a.x=i-a.width/2):(i=a.y+a.height/2,a.height=B*a.width/F,a.y=i-a.height/2)}return a},fi.prototype._adsorbedToClosest=function(K,J){var V=this,r=V._interactor,T=r.rectGuide.findClosest(K,J),E=r.gridGuide.findClosest(K,J),N=1/0,l=1/0;T&&(isFinite(T.x)&&(N=T.x),isFinite(T.y)&&(l=T.y)),E&&(isFinite(E.x)&&Math.abs(E.x)<Math.abs(N)&&(N=E.x),isFinite(E.y)&&Math.abs(E.y)<Math.abs(l)&&(l=E.y)),isFinite(N)&&(K.x+=N),isFinite(l)&&(K.y+=l)},fi.prototype._42=function(c,d,i){var o=this;o.info={},o.screenInfo=null;var y=o._interactor;if(!y.editDetail&&o.gatherInfo(d,i)){var T=o.editing,u=T?T.groupRotateMode:null,h=o.screenInfo;"block"!==u&&(h.P1?br.Icons.DrawIcon(y,c,br.Icons.Line,h):br.Icons.DrawIcon(y,c,br.Icons.Rect,h),h.connect&&(br.Icons.DrawIcon(y,c,br.Icons.ConnectGuide,{rotation:h.rotation,connect:h.connect,cursorPos:T?T.cursorPos:null}),T&&(T.targetCorners&&br.Icons.DrawIcon(y,c,br.Icons.NodeHoverGuide,T.targetCorners),T.garbageInfo&&br.Icons.DrawIcon(y,c,br.Icons.ConnectGuideGarbage,T.garbageInfo))),o.tipInfo&&br.Icons.DrawIcon(y,c,br.Icons.TipHelper,o.tipInfo)),o.target instanceof br.Group&&o.target._42(y,c,d)}};var is=br.Anchor=function(l){this.catalog="Anchor",this._interactor=l};is.prototype={},is.prototype.constructor=is,is.prototype.gatherInfo=function(E,f){var O=this;if(1===f.length){var R=f[0];if(!R.getAnchor)return;if(R instanceof M.Shape&&R._70I())return;if(ad(R,E))return;return O.gatherSingleTarget(E,f[0])}return f.length>1?O.gatherMultiTargets(E,f):!1},is.prototype.gatherSingleTarget=function(N,x){var G=this;return G.info.POS=x.getPosition(),G.screenInfo.POS=br.toScreenPosition(N,G.info.POS),G.target=x,!0},is.prototype.gatherMultiTargets=function(H,r){var _=this,n=br.Group.findOrCreateGroup(r);
return n?(_.screenInfo.POS=br.toScreenPosition(H,n.getAnchor2()),_.target=n,!0):!1},is.prototype.isVisible=function(){var i=this,o=i._interactor;if(o.getStyle("anchorVisible")===!1)return!1;var g=i.target;if(g){if(this.editing)return!0;var k=g.getAnchor(),y=o.getStyle("anchorOutsideVisibleThreshold");if(k.x<-y||k.x>1+y||k.y<-y||k.y>1+y)return!0;var R=g.getSize(),t=g.getScale(),P=Math.min(Math.abs(R.width*t.x),Math.abs(R.height*t.y));if(P*o.gv._zoom<o.getStyle("anchorHideThreshold"))return!1}return!0},is.prototype.check=function(W,_,B){if(M.Default.isLeftButton(_)){var j=this,c=j._interactor;if(j.isVisible()&&c.getStyle("anchorMovable")!==!1){j.editing=null,j.tipInfo=null;var Y=j.target;if(Y&&W.isAnchorEditable(Y)&&W.isEditable(Y)){var P;if(j.screenInfo&&(P=j.screenInfo.POS)&&br.checkHit(B,new br.Math.Vector2(P),c.getStyle("checkSize"))){if(Y instanceof br.Group)return j.editing={},!0;var i=Y.getWidth(),N=Y.getHeight(),E=Y.getAnchor();return j.editing={rect:{x:-i*E.x,y:-N*E.y,width:i,height:N},anchor:E,matrix:Y.getMatrix()},!0}}}}},is.prototype.startEdit=function(f,C){f.startDragging(C),f.fi({kind:"beginEditAnchor",event:C})},is.prototype._46O=function(x){var k=this;k.editing&&(k.editing=null,k._interactor.fi({kind:"endEditAnchor",event:x})),k.tipInfo=null},is.prototype.handleEdit=function(S,q){var c=this,l=c.target;if(l){var G=c.editing;if(G){var B=S.lp(q),m=c._interactor;if(l instanceof br.Group)return l.setAnchor2(B),m._42(),void 0;var y=G.matrix,F=y.tfi(B),A=G.rect,N=(F.x-A.x)/A.width,v=(F.y-A.y)/A.height;if(!M.Default.isCtrlDown(q)){var g=m.getStyle("anchorRound"),p=m.getStyle("anchorSensitivity");N=br.roundTo(N,g,p),v=br.roundTo(v,g,p)}l.setAnchor(N,v,!0);var Q=M.Default.getLogicalPoint(q,m._canvas);Q.x+=br.Icons.TipShiftX,Q.y+=br.Icons.TipShiftY;var f=""+N.toFixed(2)+", "+v.toFixed(2);c.tipInfo={helperPos:Q,text:f,size:f.length},m.fi({kind:"betweenEditAnchor",event:q})}}},is.prototype._42=function(w,b,Z){var x=this;x.info={},x.screenInfo={};var F=x._interactor;F.editDetail||x.gatherInfo(b,Z)&&x.isVisible()&&(br.Icons.DrawIcon(F,w,br.Icons.Anchor,x.screenInfo),x.tipInfo&&br.Icons.DrawIcon(F,w,br.Icons.TipHelper,x.tipInfo))};var Oj=br.MoveDummy=function(y){this.catalog="MoveDummy",this._interactor=y};Oj.prototype={},Oj.prototype.constructor=Oj,Oj.prototype.gatherInfo=function(){var i=this,B=this._interactor.getSubModule("Rect");if(B){var o=B.screenInfo;if(o){var t=i._interactor,h=i.getMovableTarget(B.target);if(h){var R=t.getStyle("moveDummyVisible"),C=o.LT||o.P1,s=o.RT||o.P2,O=o.LB||C;if(C){var r=o.P1,x=Math.min(C.distanceTo(O),C.distanceTo(s));if(!(x>R)){var G=t.getStyle("moveDummyPosition"),S=s.clone().sub(C),K=O.clone().sub(C),y=G[2],v=G[3];if(r){var J=t.getStyle("moveDummyLineExtraShift");J&&(y+=J[0],v+=J[1])}var f=C.clone().add(S.clone().multiplyScalar(G[0])).add(S.setLength(y)).add(K.clone().multiplyScalar(G[1])).add(K.setLength(v));return i.screenInfo.pos=f,i.screenInfo.size=t.getStyle("moveDummySensitivity"),!0}}}}}},Oj.prototype.getMovableTarget=function(q){var U=this._interactor.gv;if(yr(q)){if(U.isMovable(q))return q}else if(q instanceof br.Group)for(var _=q._entities,y=_.length-1;y>=0;y--){var Q=_[y];if(yr(Q)&&U.isMovable(Q))return Q}return null},Oj.prototype.getMoveInteractor=function(){for(var y,_,u,T=this._interactor.gv,$=T.getInteractors(),y=0,_=$.length;_>y;y++)if(u=$.get(y),u instanceof Zd)return u},Oj.prototype.startEdit=function(p,c){p.startDragging(c);var I=this.getMoveInteractor();if(I){var T=this.selectedTarget,M=p.gv;M._moving=1,I._data=T,M.handleMouseDown&&M.handleMouseDown(c,T)}},Oj.prototype._46O=function(v){var R=this,Z=R.getMoveInteractor();Z&&(Z.handleWindowMouseUp(v),R.selectedTarget=null)},Oj.prototype.handleEdit=function(D,P){var _=this.getMoveInteractor();_&&_.handleWindowMouseMove(P)},Oj.prototype.check=function(v,G,T){if(this.selectedTarget=null,M.Default.isLeftButton(G)&&!v._scrolling&&!rp()){var N=this,i=N.screenInfo.pos;if(i&&!(T.distanceTo(i)>N.screenInfo.size)){var n=N._interactor;return N.selectedTarget=N.getMovableTarget(n.getSubModule("Rect").target),n.setCursor("default"),!0}}},Oj.prototype._42=function(O,X,y){var Z=this;Z.screenInfo={};var M=Z._interactor;M.editDetail||Z.gatherInfo(X,y)&&(!M.gvEditing||Z.selectedTarget)&&br.Icons.DrawIcon(M,O,br.Icons.MoveDummy,Z.screenInfo)};var Ik=br.RotateX=function(O){this.catalog="RotateX",this._interactor=O};Ik.prototype={},Ik.prototype.constructor=Ik,Ik.prototype.gatherInfo=function(P,v){var r=this;if(1===v.length){var B=v[0];return B instanceof M.Shape&&B._70I()||ad(B,P)?!1:r.gatherSingleTarget(P,B)}return v.length>1?r.gatherMultiTargets(P,v):!1},Ik.prototype.gatherSingleTarget=function(){var z=new M.Math.Vector2,V=new M.Math.Vector2,h=new M.Math.Vector2,S=new M.Math.Vector2,U=function(e,i){var X=e.x-i.x,G=e.y-i.y;return X*X+G*G};return function(p,P){if(P.getCorners){var k=this,l=P.getCorners(),_=15,Q=P.getPosition();z.copy(l[0]),h.copy(l[1]),S.copy(l[3]),V.copy(z).add(S).divideScalar(2).add(z.sub(h).setLength(_/p.getZoom()));var J=Math.max(U(Q,l[0]),U(Q,l[1]),U(Q,l[2]),U(Q,l[3]));return k.info.POS=V.clone(),k.screenInfo.POS=br.toScreenPosition(p,k.info.POS),k.screenInfo.LEN=Math.sqrt(J)*p.getZoom()+_,k.screenInfo.CENTER=br.toScreenPosition(p,Q),k.target=P,!0}}}(),Ik.prototype.gatherMultiTargets=function(C,h){var m=this,o=br.Group.findOrCreateGroup(h);if(!o)return!1;var m=this;return m.gatherSingleTarget(C,o)},Ik.prototype.isVisible=function(){var y=this._interactor;if(!y.getStyle("rotateAsClock"))return!1;var C=this.target;if(!C)return!0;var j=y.gv;return j.isEditable(C)&&j.isRotationEditable(C)?!0:!1},Ik.prototype.check=function(C,X,V){var S=this,I=S._checkImpl(C,X,V);return(I||S._clockPainted)&&S._interactor._42(),I},Ik.prototype._checkImpl=function(C,u,l){if(M.Default.isLeftButton(u)){var V=this;V.editing=null,V.tipInfo=null;var H;if(V.screenInfo&&(H=V.screenInfo.POS)&&V.isVisible()){var k=V._interactor;if(br.checkHit(l,H,k.getStyle("checkSize"))){var Z=V.target,y=C.lp(u),c=Z.getPosition(),K=Math.atan2(y.y-c.y,y.x-c.x);return k._setRotateCursor(K),V.editing={pos:c,rotation:Z.getRotation(),hitRot:K,groupRotateMode:"block",screenInfo:{CENTER:V.screenInfo.CENTER,LEN:V.screenInfo.LEN}},!0}}}},Ik.prototype.startEdit=function(f,M){f.startDragging(M),f.fi({kind:"beginEditRotation",event:M}),this.target instanceof br.Group&&this.target.beginRotate(this.editing)},Ik.prototype._46O=function(f){var Q=this;Q.editing&&(Q.editing=null,Q._interactor.fi({kind:"endEditRotation",event:f})),Q.target instanceof br.Group&&Q.target.endRotate(),Q.tipInfo=null},Ik.prototype.handleEdit=function(G,t){var j=this,b=j.editing;if(b){var e,T,z=j.target,R=G.lp(t),k=j._interactor,_=b.pos,$=Math.atan2(R.y-_.y,R.x-_.x),Y=z instanceof br.Group;if(Y?T=$-b.hitRot:(e=$-b.hitRot,T=b.rotation+e),T%=2*Math.PI,0>T&&(T+=2*Math.PI),!M.Default.isCtrlDown(t)){var i,L;gb(t)?(i=k.getStyle("shiftRotateRound"),L=i/2):(i=k.getStyle("rotateRound"),L=k.getStyle("rotateSensitivity")),T=br.roundTo(T,i,L)}Y?(e=T-(b.lastRotation||0),0!==e&&(z.addRotation(e,b.groupRotateMode),b.lastRotation=T)):z.setRotation(T),k._setRotateCursor($),T>Math.PI&&(T-=2*Math.PI);var F=180*(T/Math.PI),r=""+F.toFixed(2)+"",w=M.Default.getLogicalPoint(t,k._canvas);w.x+=br.Icons.TipShiftX,w.y+=br.Icons.TipShiftY,j.tipInfo={helperPos:w,text:r,size:r.length},k.fi({kind:"betweenEditRotation",event:t})}},Ik.prototype._42=function(U,i,X){var Q=this;Q._clockPainted=!1,Q.info={},Q.screenInfo={};var e=Q._interactor;e.editDetail||Q.gatherInfo(i,X)&&Q.isVisible()&&(br.Icons.DrawIcon(e,U,br.Icons.RoundPoint,Q.screenInfo.POS),Q.tipInfo&&br.Icons.DrawIcon(e,U,br.Icons.TipHelper,Q.tipInfo),Q.editing&&Q.drawClock(U))},Ik.prototype.drawClock=function(H){H.save();var m=this;m._clockPainted=!0;var w=m.editing||{},U=w.screenInfo||m.screenInfo,D=U.LEN,b=D+8,K=D+18;H.save(),H.translate(U.CENTER.x,U.CENTER.y),H.beginPath(),H.strokeStyle="rgb(150, 150, 150)";for(var l,a,f,t,g,h=0;360>h;h++)l=h*Math.PI/180,0===h%5&&(a=i(l)*D,f=F(l)*D,t=i(l)*b,g=F(l)*b,H.moveTo(a,f),H.lineTo(t,g)),0===h%45&&(a=i(l)*D,f=F(l)*D,t=i(l)*K,g=F(l)*K,H.moveTo(a,f),H.lineTo(t,g));H.stroke(),H.rotate(-A);var B=w.lastRotation||m.target.getRotation();H.beginPath(),H.fillStyle="rgba(255, 0, 0, 0.1)",H.strokeStyle="rgb(157, 157, 157)",H.moveTo(0,0),H.arc(0,0,K,0,B,!1),H.fill(),H.beginPath(),H.moveTo(0+K,0),H.arc(0,0,K,0,B,!1),H.stroke(),H.restore()};var tk=br.Curve=function(B){this.catalog="Curve",this._interactor=B};tk.prototype={},tk.prototype.constructor=tk,v.defineProperties(tk.prototype,{activing:{get:function(){return this._activing},set:function(M){var o=this;if(M)o._activing=new br.CurveActiving(this,M);else{var F=o._activing;F&&F.dispose(),o._activing=null}}}}),tk.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},tk.prototype.setUp=function(){var r=this,Q=r._interactor;Q&&Q.gv.mp(r._onGraphviewPropertyChanged,r)},tk.prototype._onGraphviewPropertyChanged=function(P){("zoom"===P.property||"translateX"===P.property||"translateY"===P.property)&&this._handleDataChanged()},tk.prototype.tearDown=function(){var S=this,b=S._interactor;b&&b.gv.ump(S._onGraphviewPropertyChanged,S)},tk.prototype.canEnterEditDetailMode=function(){var T=this,S=T._interactor,p=S._getValidSelection();if(1===p.length){var W=p[0],u=W instanceof M.Edge;if(W instanceof M.Shape||u){if(u){var E=W.s("edge.type");if(E&&"points"!==E)return}var m=S.gv;if(m.isPointEditable(W)&&m.isEditable(W))return T.target=W,!0}}},tk.prototype.canQuitEditDetailMode=function(I){var S=this,f=S._interactor._getLogicalPoint(I);return S._checkEditRealPoint(f)?void 0:S._interactor.gv.getDataAt(I)!==S.target?!0:void 0},tk.prototype.preHandleScroll=function(){var r=this.editing;return r&&r.inEdit?!0:void 0},tk.prototype.getCurrentSelectintStatus=function(){var M=this;if(M.activing&&!M.activing.selections){if(M.activing.status!=C)return M.activing.status;var Q=function(A){var R=M.activing.status;M.activing.status=A,M._interactor.fp("shapePointStatus",R,A)},k=br.Curve.PointType,H=M.activing.point,R=M.activing.pairs;if(!R||1!==R.length)return Q(k.Mirrored);var y=R[0],T=y.c1&&y.c1.isNearEnough(H),F=y.c2&&y.c2.isNearEnough(H);if(!y.c1||!y.c2)return T||F?Q(k.Straight):Q(k.Disconnected);if(T&&F)return Q(k.Straight);if(T||F)return Q(k.Asymmetric);var x=y.c1.clone().sub(H),X=y.c2.clone().sub(H);return Math.abs(x.x*X.y-x.y*X.x)>1e-5||x.x*X.x>0?Q(k.Disconnected):Math.abs(x.length()-X.length())>1e-5?Q(k.Asymmetric):Q(k.Mirrored)}},tk.prototype.handle_keydown=function(v){var h=this;if(h._interactor.editDetail){var N=br.Curve.PointType;"1"===v.key?h._setCurrentSelectionStatus(N.Straight):"2"===v.key?h._setCurrentSelectionStatus(N.Mirrored):"3"===v.key?h._setCurrentSelectionStatus(N.Disconnected):"4"===v.key&&h._setCurrentSelectionStatus(N.Asymmetric)}},tk.prototype.setCurrentSelectionStatus=function(n){var M=this,$=M._interactor;if($){var O=$.gv;O.dm().beginTransaction(),this._setCurrentSelectionStatus(n),O.dm().endTransaction()}},tk.prototype._setCurrentSelectionStatus=function(P){var q=this,c=q.activing;if(c){var N=q.getCurrentSelectintStatus();if(null!==N&&N!==P){c.status=P;var f=q.activing.point,B=q.activing.pairs;if(B&&1===B.length){var e=B[0],w=q.screenInfo.curve,d=br.Curve.PointType,m=function(){q._writeToHt(),q._interactor.fp("shapePointStatus",N,P)};if(P===d.Straight)return w.moveCtrlPoint(e,f,"c1"),w.moveCtrlPoint(e,f,"c2"),m(),void 0;if(N===d.Straight){var u=w.findPairs(f,!0),I=u[0],C=I.r1||f,K=I.r2||f,E=K.clone().sub(C).multiplyScalar(.25);return w.moveCtrlPoint(e,f.clone().sub(E),"c1"),w.moveCtrlPoint(e,f.clone().add(E),"c2"),m(),void 0}var y=e.c1,o=e.c2;if(y&&o){if(P===d.Mirrored)return w.moveCtrlPoint(e,f.clone().multiplyScalar(2).sub(o),"c1"),m(),void 0;if(P===d.Asymmetric&&N===d.Disconnected){var z=y.clone().sub(f).length(),E=f.clone().sub(o).setLength(z).add(f);return w.moveCtrlPoint(e,E,"c1"),m(),void 0}}c._firePointChange(),q._interactor.fp("shapePointStatus",N,P)}}}},tk.prototype._handleDataChanged=function(){var k="points,segments,shape,position,rotation,scale".split(",");return function(_){var W=this;if(W.screenInfo&&W.target){if(_&&k.indexOf(_.property)<0)return;var v=W._interactor;W.gatherSingleTarget(v.gv,W.target,!0),W.check(v.gv,null,new br.Math.Vector2(v._lastClientPoint)),v._42()}}}(),tk.prototype.gatherSingleTarget=function(P,L,y){var j,r,D=this;D.screenInfo&&D.screenInfo.curve&&(r=D.screenInfo.curve._curves);var B=D.editing;j=B?D.screenInfo:D.screenInfo={};var b,H,k=L instanceof M.Edge;k?(b=L.s("edge.segments"),H=L.s("edge.points")||new M.List):(b=L._58O,H=L._59O),j.S=b;var Y,v=j.P=[],Z=br.getDataMatrix(L);if(L instanceof M.Polyline&&(Y=L.getElevation()||0,j.E=[]),H.each(function(A){j.E&&j.E.push(A.e||Y),A=Z.apply(A);var R=br.toScreenPosition(P,A);v.push(R.x,R.y)}),k){var m=br.toScreenPosition(P,L._lastSourcePoint),C=br.toScreenPosition(P,L._lastTargetPoint);v.splice(0,0,m.x,m.y),v.push(C.x,C.y)}if(!j.S||!j.S.size()){j.S=new M.List,j.S.add(1);for(var T=0;T<v.length/2-1;T++)j.S.add(2)}if((!B||y)&&D.convertToCubicBezier(r),D.activing&&(y||!D.editing||"realPoint"===D.editing.type)){var p=j.curve.findPairs(D.activing.point);D.activing.pairs=p}k&&"points"!==L.s("edge.type")&&D._writeToHt()},tk.prototype._convertToNewPoint=function(r,L,A){var _,e,m;for(_=0,e=L.length;e>_;_++){if(m=L[_],m._p1.isNearEnough(r))return m._p1;if(m._p4.isNearEnough(r))return m._p4}if(A)for(_=0,e=Math.min(A.length,e);e>_;_++){if(m=A[_],m._p1===r)return L[_]._p1;if(m._p4===r)return L[_]._p4}},tk.prototype.convertToCubicBezier=function(o){var C,y,u=this,H=new br.Math.Curve,L=u.screenInfo;if(H.createFromHtShape(L.P,L.S,L.E),L.curve=H,u.activing){var J=H._curves;if(C=u.activing.point,y=u._convertToNewPoint(C,J,o),y&&(u.activing.point=y),u.activing.selections){var F=-1,_=u.activing.selections;_.forEach(function(z){F++,y=u._convertToNewPoint(z,J,o),y&&(_[F]=y)})}}},tk.prototype.check=function(B,T,y){if(!T||oh(T)||Hm(T)){var z=this;if(z._interactor.setCursor("default"),z.editing=null,z.highlight=null,z.tipInfo=null,z.edgeEditResult=null,z.screenInfo){if(rp()||Hm(T))return z._interactor._42(),!0;if(z._checkEditCtrlPoint(y))return z._interactor._42(),!0;if(z._checkEditRealPoint(y))return z._interactor._42(),!0;if(z._checkEditElevation(y))return z._interactor._42(),!0;var x=z.screenInfo.curve,M=x.checkPoint(y,z._interactor.getStyle("curveIntersectSize"));if(M){var G=z.highlight={};G.type="insertKnot",G.bezier=M.bezier,G.point=M.intersection}return z._interactor._42(),!0}}},tk.prototype._checkEditRealPoint=function(n){var W,Z,b,V,U,l,B=this,o=B.screenInfo.curve._curves,y=B._interactor.getStyle("curvePointIntersectSize"),Y=1/0;for(y*=y,b=0,V=o.length;V>b;b++)W=o[b],U=W._p1,l=n.distanceToSquared(U),Y>l&&(Y=l,Z=U),U=W._p4,l=n.distanceToSquared(U),Y>l&&(Y=l,Z=U);if(Y>y)return!1;var E=B.highlight={};return E.type="changeRealPoint",E.point=Z,B.editing={type:"realPoint",point:Z,shiftGuide:{point:Z.clone(),dir:"x",limit:0}},B._interactor.setCursor("crosshair"),!0},tk.prototype._checkEditElevation=function(L){var B=this;if(!B._interactor.getStyle("curveElevationVisible"))return!1;var u=B.activing;if(!u)return!1;var i=u.getCurrentEditingPoint();if(!i)return!1;var P=B._interactor,x=P.getStyle("curveElevationGuideShift"),M=P.getStyle("curveElevationIntersectSize"),G=L.distanceToSquared({x:i.x+x[0],y:i.y+x[1]});if(!(G>M*M)){var R=B.highlight={};R.type="elevation";var p=new br.Math.Vector2(L.x,L.y,i.e);return B.editing={type:"elevation",startPoint:p},B._interactor.setCursor("crosshair"),!0}},tk.prototype._checkEditCtrlPoint=function(C){var Y=this;if(Y.activing&&!Y.activing.selections){var N=Y.getCurrentSelectintStatus();if(N!==br.Curve.PointType.Straight){var K=Y.activing.pairs;if(K){var v=Y._interactor.getStyle("curvePointIntersectSize");v*=v;var D,e,V,c,h,R,l,q,d,r=1/0;for(l=0,d=K.length;d>l;l++)for(c=K[l],q=0;2>q;q++)h=0===q?"c1":"c2",c[h]&&(R=C.distanceToSquared(c[h]),r>R&&(r=R,D=c,e=l,V=h));if(r>v)return!1;Y.activing.hlpair=D,Y.activing.hltype=V;var T=Y.highlight={};return T.type="changeCtrlPoint",T.point=D[V],Y.editing={type:"ctrlPoint",pair:D,pairId:e,ctrlType:V,direction:D[V].clone().sub(Y.activing.point).normalize()},Y._interactor.setCursor("crosshair"),!0}}}},tk.prototype.startEdit=function(J,s){J.startDragging(s);var H=this;H.highlight&&"insertKnot"===H.highlight.type&&(H.insertKnot(),H.gatherSingleTarget(H._interactor.gv,H.target),H.activing=null,H._checkEditRealPoint(H._interactor._getLogicalPoint(s)));var h=H._activing;if(h){var n=H.editing?H.editing.type:null;"ctrlPoint"===n?h.editingCtrl={pairId:H.editing.pairId,type:h.hltype}:"realPoint"===n&&(h.editingCtrl=!1)}var _=H.highlight,e=M.Default.isCtrlDown(s);if(!_||rp()||Hm(s)){var j=H._interactor.gv;if(!j.setFocus(s)||j._scrolling)return;return e?H._multiSelect={startPoint:j.lp(s)}:j.isPannable()&&(oh(s)||Hm(s))&&(H._pan={tx:j.tx(),ty:j.ty()},J.fi({kind:"beginPan",event:s})),void 0}if("changeRealPoint"===_.type){var F,d=H.activing?H.activing.point:null,O=H.activing?H.activing.selections:null;if(e&&H.activing)d===_.point?(O?(H.activing={point:O[0]},O.length>1&&(O.splice(0,1),H.activing.selections=O)):H.activing=null,H.editing=null):O&&(F=O.indexOf(_.point))>=0?(O.length>1?O.splice(F,1):delete H.activing.selections,H.editing=null):O?(O.push(d),H.activing={point:_.point,selections:O}):H.activing={point:_.point,selections:[d]};else if(O)d===_.point||((F=O.indexOf(_.point))>=0?(O.splice(F,1,d),H.activing={point:_.point,selections:O}):H.activing={point:_.point});else{var p;d===_.point&&(p=H.activing.status),H.activing={point:_.point},p&&(H.activing.status=p)}J.fi({kind:"beginEditPoint",event:s})}},tk.prototype.insertKnot=function(){var B=this,Y=B.highlight,_=B.screenInfo.curve;_.insertKnot(Y.bezier,Y.point.t),B._writeToHt()},tk.prototype._writeToHt=function(){var P,z,W,j,N=this,A=N.screenInfo.curve,J=A.toHtShape(),S=J.points,t=[],Y=J.segments,q=N._interactor.gv,h=N.target,v=h instanceof M.Edge,y=br.getDataMatrix(h).invert();j=h instanceof M.Polyline,j&&(W=h.getElevation());for(var U=0,d=S.length;d>U;U++)P=S[U],z=br.toWorldPosition(q,P),z=y.apply(z),P.e!=C&&P.e!==W&&(z.e=P.e),t.push(z);if(h._writing=!0,v){h.s("edge.type","points"),h.setStyle("edge.segments",Y),h.setStyle("edge.points",t.slice(1,t.length-1)),h.setStyle("edge.source.offset.x",0),h.setStyle("edge.source.offset.y",0),h.setStyle("edge.target.offset.x",0),h.setStyle("edge.target.offset.y",0);var T=N._nextChangeEdgeHost;delete N._nextChangeEdgeHost,T&&("source"===T.type?h.setSource(T.host):h.setTarget(T.host)),N._writeEdgeHostAnchor("source",t[0]),N._writeEdgeHostAnchor("target",t[t.length-1])}else t.length?(h.setSegments(Y),h.setPoints(t,!0)):h.removeFromDataModel();delete h._writing},tk.prototype._writeEdgeHostAnchor=function(P,$){var w=this,F=w.target,l=w._calcHostAnchor(F,P,$);l.index!==C?(F.setStyle("edge."+P+".index",l.index),F.setStyle("edge."+P+".percent",C),F.setStyle("edge."+P+".anchor.x",C),F.setStyle("edge."+P+".anchor.y",C)):l.percent!==C?(F.setStyle("edge."+P+".percent",l.percent),F.setStyle("edge."+P+".index",C),F.setStyle("edge."+P+".anchor.x",C),F.setStyle("edge."+P+".anchor.y",C)):(F.s("edge."+P+".anchor.x",l.x),F.s("edge."+P+".anchor.y",l.y),l.offsetX||l.offsetY?(F.s("edge."+P+".offset.x",l.offsetX),F.s("edge."+P+".offset.y",l.offsetY)):(F.s("edge."+P+".offset.x",0),F.s("edge."+P+".offset.y",0)))},tk.prototype._calcHostAnchor=function(T,t,c,e){e||(e="source"===t?T.getSource():T.getTarget());var M=this._interactor.gv,R=M.calculateAttachPoint(e,c);if(R)return R.info;if(ps(e)){var s=M.calculateEdgePosition(e,c);return s}var m=e.getRotation(),I=e.getAnchor();if(ad(e,M)&&(m=0),m){var U=e.getMatrix(),h=U.tfi(c),N=e.getSize();return{x:h.x/N.width+I.x,y:h.y/N.height+I.y}}var q=Pe(M,e),X={x:(c.x-q.x)/q.width,y:(c.y-q.y)/q.height};return X},tk.prototype._handlePanning=function(w){var Z=this,R=Z._pan;if(R){R.started=!0;var v=Z._interactor,W=v.gv,m=v._lastClientPoint,e=Qf(w);W.setTranslate(R.tx+e.x-m.x,R.ty+e.y-m.y),Z.gatherSingleTarget(v.gv,Z.target),v._42(),v.fi({kind:"betweenPan",event:w})}},tk.prototype.handleEdit=function(q,l){var o=this,K=o.editing;if(o._pan)return o._handlePanning(l),void 0;if(o._multiSelect)return o._multiSelect.endPoint=q.lp(l),o._interactor.redraw(),void 0;if(K){K.inEdit=!0;var u,n,X,r=o._interactor._getLogicalPoint(l),O=M.Default.isCtrlDown(l),$=M.Default.isShiftDown(l),Z=K.type,d=o.activing;if(o._guideInfo=null,"ctrlPoint"===Z&&$){var c=o.editing.direction.clone();u=d.point;var R=c.dot(r.clone().sub(u));r=c.setLength(R).add(u)}else if("ctrlPoint"===Z||"realPoint"===Z){var c;if("realPoint"===Z&&$){var s=o.editing.shiftGuide;n=s.point;var Y=Math.abs(r.x-n.x),j=Math.abs(r.y-n.y);Y>j&&Y>s.limit&&"y"===s.dir&&(s.dir="x"),j>Y&&j>s.limit&&"x"===s.dir&&(s.dir="y"),c=s.dir,"x"===c?(r.y=n.y,s.limit=Math.max(s.limit,Y)):"y"===c&&(r.x=n.x,s.limit=Math.max(s.limit,j))}var J=o._isEditEdgeSourceTarget();if(J){var H=o._editEdgeSourceTarget(J,r,O);H&&(o.edgeEditResult=H,X=H.tipText)}else if(!O){var i=o._guidingToEdit(r,c),y="realPoint"===Z?o._interactor.gridGuide.findClosest(r,c,!0):null,L=1/0,E=1/0;y&&(y.x&&(L=y.x),y.y&&(E=y.y));var B=!1;i&&(i.xList&&(Math.abs(i.x)<=Math.abs(L)?(B=!0,L=i.x):delete i.xList),i.yList&&(Math.abs(i.y)<=Math.abs(E)?(B=!0,E=i.y):delete i.yList),B&&(o._guideInfo=i)),isFinite(L)&&(r.x+=L),isFinite(E)&&(r.y+=E),B&&(i.v=r)}}var U=o.screenInfo.curve;if("realPoint"===K.type){u=K.point,u.e!==C&&(r.e=u.e),U.moveRealPoint(u,r),K.point=r,o.highlight.point=r;var e=d.status,F=d.selections;if(o.activing={point:r,status:e},F){var k=r.clone().sub(u),w=0;F.forEach(function(j){var N=j.clone().add(k);U.moveRealPoint(j,N),F[w++]=N}),o.activing.selections=F}}else if("ctrlPoint"===K.type){var D=d.pairs,S=D[K.pairId];U.moveCtrlPoint(S,r,K.ctrlType);var I=d.status,g=br.Curve.PointType;if((I===g.Mirrored||I===g.Asymmetric)&&S.c1&&S.c2){var u=new br.Math.Vector2(d.point),p="c1"===K.ctrlType?"c2":"c1";if(I===br.Curve.PointType.Mirrored)U.moveCtrlPoint(S,u.clone().multiplyScalar(2).sub(r),p);else if(I===g.Asymmetric){var R=S[p].clone().sub(u).length(),T=u.clone().sub(S[K.ctrlType]).setLength(R).add(u);isNaN(T.x)||U.moveCtrlPoint(S,T,p)}}d._firePointChange()}else if("elevation"===K.type){n=K.startPoint;var _=n.e+(n.y-r.y)/q._zoom;o._setCurrentPointImpl("e",_),d._firePointChange(),X="E: "+br.toFixed(_)}var f=M.Default.getLogicalPoint(l,o._interactor._canvas);if(f.x+=br.Icons.TipShiftX,f.y+=br.Icons.TipShiftY,!X){var m=br.toWorldPosition(q,r);X=""+br.toFixed(m.x)+", "+br.toFixed(m.y)}o.tipInfo={helperPos:f,text:X,size:X.length},o._writeToHt(),o._interactor.fi({kind:"betweenEditPoint",event:l})}},tk.prototype._setCurrentPointImpl=function(X,D){var l=this,n=l._activing;if(!n)return!1;var x=l.target;if(!x)return!1;var O=n.getCurrentEditingPoint();if(!O)return!1;var p=n.editingCtrl;if(!p)var S=O.clone();if("e"===X)O.e=D;else{var r;if("x"===X||"y"===X){var B=n._lastFirePoint;r="x"===X?{x:D,y:B?B.y:0}:{x:B?B.x:0,y:D}}else"object"==typeof X?(r=X,X.e!==C&&(O.e=X.e)):(r={x:arguments[0],y:arguments[1]},arguments[2]!==C&&(O.e=arguments[2]));var $=br.getDataMatrix(x);r=br.toScreenPosition(l._interactor.gv,$.apply(r)),O.x=r.x,O.y=r.y}if(!p){var M=S.multiplyScalar(-1).add(O);O.e&&S.e&&(M.e=O.e-S.e),l.screenInfo.curve.moveCtrlDueToRealPointMovement(O,M)}return!0},tk.prototype.setCurrentPoint=function(t,v){return this._setCurrentPointImpl(t,v)?(this._writeToHt(),!0):!1},tk.prototype._isEditEdgeSourceTarget=function(){var D=this,b=D.target;if(!(b instanceof M.Edge))return!1;var N=D.editing.point,g=D.screenInfo.curve._curves;return N===g[0]._p1?"source":N===g[g.length-1]._p4?"target":!1},tk.prototype._editEdgeSourceTarget=function(e,$,u){var v,J=this,w=J.target;if(v="source"===e?w.getSource():w.getTarget()){var y,I=J._interactor.gv,N=br.toWorldPosition(I,$),K=J._calcHostAnchor(w,e,N,v);if(y=K.index!==C||K.percent!==C?K.distance*I.getZoom()>J._interactor.getStyle("edgeHostEdgeMaxDistance"):J._interactor.getStyle("edgeHostDetectPerFrame")?!0:K.x<0||K.x>1||K.y<0||K.y>1?!0:!1){var W=I.getDataAt(N,function(C){return I.isSelectable(C)?C===v?!1:w.canSetSourceTarget(C,e)?!0:!1:!1});if(W){var Z=J._calcHostAnchor(w,e,N,W);v=W,J._nextChangeEdgeHost={type:e,host:W},K=Z}}var F,O,M;if(u||K.x===C)(K.percent!==C||K.index!==C)&&(O=K.point);else{var h=J._interactor.getStyle("anchorRound"),q=J._interactor.getStyle("anchorSensitivity");F=I.calculateAttachPoint(v,N),F?K=F.info:(K.x=br.roundTo(K.x,h,q),K.y=br.roundTo(K.y,h,q)),O=v.getAttachPosition(K.x,K.y,K.offsetX,K.offsetY)}O&&(M=br.toScreenPosition(I,O),$.x=M.x,$.y=M.y),J._edgeHostGuideInfo={corners:br.getTargetCornersOnScreen(I,v),attach:F?F.index:-1,host:v};var c;return K.percent!==C?c="percent: "+K.percent.toFixed(2):K.index!==C?c="index: "+K.index:(c=""+K.x.toFixed(2)+", "+K.y.toFixed(2),(K.offsetX||K.offsetY)&&(c+=" offset: "+K.offsetX.toFixed(2)+", "+K.offsetY.toFixed(2))),{host:v,anchor:K,tipText:c}}},tk.prototype._guidingToEdit=function(Z,h){var G,s,S=this;if(G=S.screenInfo.curve){s=G._curves;var E,R,p,U,M,P,O,g,N=1/0,A=1/0,w=[];for(S.editing&&"realPoint"===S.editing.type&&(g=S.editing.point),M=0,P=2*s.length;P>M;M++)O=s[Math.floor(M/2)][M%2?"_p4":"_p1"],w.indexOf(O)>=0||(w.push(O),g&&g===O||(p=O.x-Z.x,U=O.y-Z.y,Math.abs(p)<Math.abs(N)?(N=p,E=[O]):p===N&&E.push(O),Math.abs(U)<Math.abs(A)?(A=U,R=[O]):U===A&&R.push(O)));var o=S._interactor.getStyle("smartGuideSensitivity");if((Math.abs(N)>o||"y"===h)&&(E=null),(Math.abs(A)>o||"x"===h)&&(R=null),E||R){var W=!1,L={};if(E&&(W=!0,L.xList=E,L.x=N),R&&(W=!0,L.yList=R,L.y=A),W)return L}}},tk.prototype._46O=function(T){var A=this;A.editing&&(A.editing=null,A._interactor.fi({kind:"endEditPoint",event:T})),A._guideInfo=null,A._edgeHostGuideInfo=null,A._pan&&(A._pan=null,A._interactor.fi({kind:"endPan",event:T})),A._multiSelect&&(A._handleMultiSelect(A._multiSelect),A._multiSelect=null),A.tipInfo=null,A.edgeEditResult=null},tk.prototype._handleMultiSelect=function(Z){if(Z.startPoint&&Z.endPoint){var j,E,e,$,z,x=this,b=x._interactor,u=b.gv,y=br.toScreenPosition(u,Z.startPoint),v=br.toScreenPosition(u,Z.endPoint),g=M.Default.unionPoint(y,v),d=x.screenInfo.curve._curves,D=[],p=function(f){f.x>=g.x&&f.y>=g.y&&f.x<=g.x+g.width&&f.y<=g.y+g.height&&D.indexOf(f)<0&&D.push(f)};for(j=0,E=d.length;E>j;j++)z=d[j],p(z._p1),p(z._p4);if(D.length){var V=x.activing||{},B=V.selections||[];for(V.point&&B.push(V.point),j=0,E=B.length;E>j;j++)e=B[j],$=D.indexOf(e),$>=0?D[$]=C:D.push(e);var m=D;for(D=[],j=0,E=m.length;E>j;j++)m[j]&&D.push(m[j]);E=D.length,0===E?x.activing=null:1===E?x.activing={point:D[0]}:(e=D[E-1],x.activing={point:e,selections:D.splice(0,E-1)}),b.redraw()}}},tk.prototype._canDeletePoint=function(O,q){var g=this.target;if(!(g instanceof M.Edge))return!0;var J=O._curves[0],X=O._curves[O._curves.length-1];return J._p1===q||X._p4===q?!1:!0},tk.prototype.handleDelete=function(){var A=this;if(A.activing&&A.screenInfo){var m=M.Default.isShiftDown(),u=A.screenInfo.curve;A._canDeletePoint(u,A.activing.point)&&u.deleteRealPoint(A.activing.point,m),A.activing.selections&&A.activing.selections.forEach(function(w){A._canDeletePoint(u,w)&&u.deleteRealPoint(w,m)}),A.activing=null,delete A.editing,delete A.tipInfo,delete A.edgeEditResult,delete A._pan,delete A._multiSelect,A._writeToHt(),A._interactor.fp("deleteShapePoint",!1,!0)}},tk.prototype.handleDoubleClick=function($){var h=this,y=h._interactor._getLogicalPoint($);if(h.screenInfo&&h._checkEditRealPoint(y)){var l=h.getCurrentSelectintStatus(),q=br.Curve.PointType;return l=l===q.Mirrored?q.Straight:q.Mirrored,h._setCurrentSelectionStatus(l),h._interactor._42(),!0}},tk.prototype._drawHighlight=function(x){var D=this,y=D.highlight;if(y){var p=y.bezier,E=D._interactor;p&&br.Icons.DrawIcon(E,x,br.Icons.ShapeHighlightCurve,[p._p1.x,p._p1.y,p._p2.x,p._p2.y,p._p3.x,p._p3.y,p._p4.x,p._p4.y]);var W=y.point;W&&"insertKnot"===y.type&&br.Icons.DrawIcon(E,x,br.Icons.ShapeHighlighPoint,W)}},tk.prototype._drawGuide=function(A){var H=this,T=H._guideInfo;if(T){var k,a,M,Y,q=T.v;for(k=0;2>k;k++)if(Y=0===k?T.xList:T.yList)for(a=0,M=Y.length;M>a;a++)br.Icons.DrawIcon(H._interactor,A,br.Icons.ShapeGuideLine,[q.x,q.y,Y[a].x,Y[a].y])}},tk.prototype._drawCurrentPoint=function(C){var B=this;if(B.activing){var K=B.activing,w=B.getCurrentSelectintStatus(),f=B._interactor;if(w!==br.Curve.PointType.Straight){var i=K.pairs;K.hlpair,K.hltype;var s=K.selections,c=K.editingCtrl;if(i&&!s){var A,z,Q;for(z=0,Q=i.length;Q>z;z++)A=i[z],c&&z===c.pairId&&A[c.type]?br.Icons.DrawIcon(f,C,br.Icons.ShapeActivingCtrl,{point:A.point,c1:A.c1,c2:A.c2,hl:c.type}):br.Icons.DrawIcon(f,C,br.Icons.ShapeActivingCtrl,A)}}br.Icons.DrawIcon(f,C,br.Icons.ShapeHighlighRealPoint,B.activing.point),s&&s.forEach(function(w){br.Icons.DrawIcon(f,C,br.Icons.ShapeHighlighRealPoint,w)})}},tk.prototype.clear=function(){var X=this;X.editing=null,X._guideInfo=null,X.activing=null,X.highlight=null},tk.prototype._42=function(N){var v=this;v.info={},v.editing||(v.screenInfo=null);var w=v._interactor;if(!w.editDetail)return v.clear(),void 0;var Q=w.gv;if(!v.target||!Q.isSelected(v.target)||!Q.isVisible(v.target))return w.editDetail=!1,v.clear(),void 0;if(v.gatherSingleTarget(Q,v.target),br.Icons.DrawIcon(w,N,br.Icons.ShapeBgCurve,v.screenInfo),v._drawHighlight(N),v._drawCurrentPoint(N),v._getRealPoint().forEach(function(Q){br.Icons.DrawIcon(w,N,br.Icons.ShapePoint,Q)}),v._drawGuide(N),v.tipInfo&&br.Icons.DrawIcon(w,N,br.Icons.TipHelper,v.tipInfo),v._edgeHostGuideInfo){br.Icons.DrawIcon(w,N,br.Icons.NodeHoverGuide,v._edgeHostGuideInfo.corners);var Y=v._edgeHostGuideInfo.host;if(Y){var X=Q.getAttachPoints(Y);if(X&&X.length)for(var I=0,y=X.length;y>I;I++){var Z=X[I],h=Y.getAttachPosition(Z.x,Z.y,Z.offsetX,Z.offsetY);h=br.toScreenPosition(Q,h),h.isAttach=v._edgeHostGuideInfo.attach===I,br.Icons.DrawIcon(w,N,br.Icons.AttachPoint,h)}}}if(v._interactor.getStyle("curveElevationVisible")&&v.target instanceof M.Polyline&&v.activing){var e=v.activing.getCurrentEditingPoint();e&&br.Icons.DrawIcon(w,N,br.Icons.EdgeElevationGuide,e)}if(v.edgeEditResult&&v._drawEdgeHostHighlight(N,v.edgeEditResult.host,v.edgeEditResult.anchor),v._multiSelect&&v._multiSelect.endPoint){var k=M.Default.unionPoint(br.toScreenPosition(Q,v._multiSelect.startPoint),br.toScreenPosition(Q,v._multiSelect.endPoint));k.color=Q.getRectSelectBorderColor(),N.save(),N.setTransform(1,0,0,1,0,0);var g=P.devicePixelRatio,t=k.borderWidth=Math.round(g);t/=2,k.x=Math.round(k.x*g)+t,k.y=Math.round(k.y*g)+t,k.width=Math.round(k.width*g),k.height=Math.round(k.height*g),br.Icons.DrawIcon(w,N,br.Icons.SimpleRect,k),N.restore()}},tk.prototype._drawEdgeHostHighlight=function(q,i,D){this.drawEdgeHostHighlight(q,i,D),this._interactor.redraw()},tk.prototype.drawEdgeHostHighlight=function(O,a,F){if(ps(a)){var q,M,N,L,T=this,k=T._interactor,B=k.gv,W=B.getDataUI(a),V=ic(W),o=[];for(N=0,L=V.points.length;L>N;N++)M=br.toScreenPosition(B,V.points.get(N)),o.push(M.x,M.y);V.segments&&(q=V.segments.toArray());var J=k.getStyle("edgeHostHighlighPeriod"),u=k.getStyle("edgeHostEdgeHighlighColor");br.Icons.DrawIcon(k,O,br.Icons.ShapeBgCurve,{P:o,S:q,color:u,dynamicVisible:F.index===C,dynamicPeriod:J}),u=k.getStyle("edgeHostPointHighlighColor");var h=Op(W);for(N=0,L=h.length;L>N;N++){var D=h[N],m=br.toScreenPosition(B,D);br.Icons.DrawIcon(k,O,br.Icons.ShapePoint,{point:{x:m.x,y:m.y},color:u,size:12,dynamicVisible:N===F.index,dynamicPeriod:J})}}},tk.prototype._getRealPoint=function(){var K,i=this.screenInfo,O=i.P,A=i.S,_=-1,T=[],B=-1,e=A.length;return A.each(function(P){B++;var k=1;if(3===P)k=2;else if(4===P)k=3;else if(5===P)return;_+=k,K=B+1>=e?!0:1===A.get(B+1)?!0:!1,T.push({point:{x:O[2*_],y:O[2*_+1]},segmentIndex:B,pointIndex:_,isEnd:K})}),T},tk.prototype.getEditingPointsInfo=function(h){var k=this,R=k.activing;if(!R)return!1;var V=R.point;if(!V)return!1;var F=this._getRealPoint(),e=[{screen:V}];R.selections&&R.selections.forEach(function(c){e.push({screen:c})});var l,x,U=F.length;return e.forEach(function(X){for(l=0;U>l;l++)if(x=F[l],X.screen.isNearEnough(x.point)){X.segmentIndex=x.segmentIndex,X.pointIndex=x.pointIndex,X.point=k.target.getPoints().get(x.pointIndex);
break}}),h&&e.sort(function(A,u){return A.segmentIndex-u.segmentIndex}),e};var ih=br.MoveHelper=function(F){var k=this;k.catalog="Move",k._interactor=F};ih.prototype={},ih.prototype.constructor=ih,ih.prototype.calcShift=function(k,H,l){var y,_,J=this,Y=J._interactor.gv,q=Y.lp(H);if("beginMove"===k&&J._gatherGridInfo(l._lastLogicalPoint||q),y=J._target){var m=y.downPosition;if(m){var B=J._interactor.getStyle("moveSensitivity")/Y._zoom;if(m.distanceTo(q)<B)return{x:0,y:0};delete y.downPosition}var Q;_=M.Default.isShiftDown(H),_&&(q=J._dealShiftDown(q),Q=y.shiftGuide.dir);var c,$=y.rawPos={x:y.pos.x+q.x-y.lp.x,y:y.pos.y+q.y-y.lp.y};if(M.Default.isCtrlDown(H)){if(c=J._calcShiftByAddon(),J._target.node instanceof br.Group){var i=J._target.node;i._position.x+=c.x,i._position.y+=c.y}return c}for(var x,P=y.x+$.x,u=y.y+$.y,t={x:P,y:u},r={x:P+y.w/2,y:u+y.h/2},v={x:P+y.w,y:u+y.h},s=J._interactor.rectGuide,W=J._interactor.gridGuide,V=[s.findClosest(t,Q),s.findClosest(r,Q),s.findClosest(v,Q),W.findClosest(t,Q),W.findClosest(r,Q),W.findClosest(v,Q)],L=1/0,X=1/0,O=0,I=V.length;I>O;O++)x=V[O],x&&(P=x.x,u=x.y,isFinite(P)&&Math.abs(P)<Math.abs(L)&&(L=P),isFinite(u)&&Math.abs(u)<Math.abs(X)&&(X=u));if(isFinite(L)||(L=0),isFinite(X)||(X=0),c=J._calcShiftByAddon(L,X),J._target.node instanceof br.Group){var i=J._target.node;i._position.x+=c.x,i._position.y+=c.y}var n=y.node;if(!ad(n,Y)){var b=$.x+L,o=$.y+X;J._interactor.rectGuide.gatherLines({node:n,x:y.x+b,y:y.y+o,w:y.w,h:y.h},Q)}return c}},ih.prototype._calcShiftByAddon=function(d,F){var s=this._target,k=s.rawPos,E=s.node.getPosition();return d=d||0,F=F||0,{x:k.x-E.x+d,y:k.y-E.y+F}},ih.prototype._dealShiftDown=function(q){var T=this,c=T._target.shiftGuide,O=T._target.lp,A=Math.abs(q.x-O.x),W=Math.abs(q.y-O.y);A>W&&A>c.limit&&"y"===c.dir&&(c.dir="x"),W>A&&W>c.limit&&"x"===c.dir&&(c.dir="y");var C=c.dir;return"x"===C?(q.y=O.y,c.limit=Math.max(c.limit,A)):"y"===C&&(q.x=O.x,c.limit=Math.max(c.limit,W)),q},ih.prototype._gatherGridInfo=function(g){var H,e=this,U=e._interactor,N=U._getValidSelection();if(N.length){if(1===N.length){if(H=N[0],!H.getRect)return e._target=null,void 0}else if(H=br.Group.findOrCreateGroup(N),!H)return e._target=null,void 0}else{var N=U.gv.sm().getSelection();if(N.length&&(H=N.get(0),!H.getRect))return e._target=null,void 0}var G=H.getPosition(),w=H.getRect();e._target={node:H,x:w.x-G.x,y:w.y-G.y,w:w.width,h:w.height,lp:{x:g.x,y:g.y},pos:{x:G.x,y:G.y},shiftGuide:{dir:"x",limit:0},downPosition:new br.Math.Vector2(g)},U.rectGuide.gatherRects()},ih.prototype.clear=function(){var n=this;n._interactor.rectGuide.clear(),n._interactor._42()};var Co="directional",Bm="point",rm="spot",lc="light.color",bf=function(S,I){pl(I)&&Po.test(I)?Do(S,I):kf(I)&&I.modelType?Af(S,I):Zl[S]=I},gs=function(H){if(kf(H))return H.modelType?H.uuid?Zl[H.uuid]:(H.uuid=M.Math.generateUUID(),Af(H.uuid,H),C):H;var f=Zl[H];return H&&f===C&&Po.test(H)&&(Rr&&Rr[H]||Do(H,H)),f},ko=function(I,k){I.frameStack?I.frameStack.push(k):I.frameStack=[k],I.bindFramebuffer(I.FRAMEBUFFER,k)},Kd=function(U){var p=U.frameStack;if(p){if(p.pop(),p.length)return U.bindFramebuffer(U.FRAMEBUFFER,p[p.length-1]),void 0;U.frameStack=null}U.bindFramebuffer(U.FRAMEBUFFER,null)};Iq(w,{graph3dViewAttributes:o,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:s/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:Gb,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:s/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:bf,getShape3dModel:gs,createMatrix:function(P,Q){Ef(P)||(P=[P]);for(var X=P.length-1;X>=0;X--){var C=P[X];Q=bn(C.mat,C.s3,C.r3,C.rotationMode,C.t3,Q)}return Q},transformVec:function(s,D){return Hd(s,D)},glBindFrame:ko,glUnbindFrame:Kd,createBoxModel:function(){return{vs:ee,ns:Mg,uv:Zh,is:$m}},createRoundRectModel:function(q,R){return gl.roundRect(q,R)},createStarModel:function(H,Y){return gl.star(H,Y)},createRectModel:function(t,a){return gl.rect(t,a)},createTriangleModel:function(g,Y){return gl.triangle(g,Y)},createRightTriangleModel:function(E,c){return gl.rightTriangle(E,c)},createParallelogramModel:function(c,X){return gl.parallelogram(c,X)},createTrapezoidModel:function(W,f){return gl.trapezoid(W,f)},createSmoothSphereModel:function(i,R,B,L,A,r,s){return Wr(new ob(i,R,B,L,A,r,s))},createSphereModel:function(d,I,O,s,_,P){return d?_e(d,I,O,s,_,P):w.createSmoothSphereModel()},createSmoothConeModel:function(P,M,J,U,$){return Ok(P,M,J,U,$)},createConeModel:function(C,L,r,i,B,z){return C?Yq(C,L,r,i,B,z):Ok(z)},createSmoothCylinderModel:function(v,C,N,Q,G,Y,M,E){return Wr(new ng(v,C,N,Q,G,Y,M,E))},createCylinderModel:function(j,y,B,G,c,x,W){return j?Dq(j,y,B,G,c,x,W):Rq(x,W)},createSmoothTorusModel:function(T,L,X,D,r,j){return Wr(new xs(T,L,X,D,r,j))},createTorusModel:function(c,F,D,N,A,J,O){return c?jq(c,F,D,N,A,J,O):Bn(J,O)},createExtrusionModel:function(A,O,t,z,V,N,s,C){return Ri(A,O,t,z,V,N,s,C)},createSmoothRingModel:function(U,b,B,N,L,r){for(var W=[],R=0;R<U.length-1;R+=2)W.push({x:U[R],y:U[R+1]});for(U=we(W,b,B)[0],W=[],R=0;R<U.length;R++){var x=U[R];W.push(new Bk(x.x,0,x.y))}return Wr(new Dp(W,r,N,L))},createTextGeometry:function(H,g){return Wr(new He(H,g))},loadFontFace:function(m,W){w.xhrLoad(m,function(U){if(!U)return W();var b;try{b=JSON.parse(U)}catch(G){b=JSON.parse(U.substring(65,U.length-2))}dh.loadFace(b),W&&W(b.familyName.toLowerCase())},W?null:{sync:!0})},createRingModel:function(L,D,x,s,f,e,b,k,n,Z){for(var h=[],q=0;q<L.length-1;q+=2)h.push({x:L[q],y:L[q+1]});e=e||w.shapeSide,b=b||0,k=k||e;var d,y,E,g,Y,X,N,M,S,P,q,c,j,V,R,_,r,W,K=[],T=[],J=n?[]:o,z=n?[]:o,B=Z?[]:o,H=Z?[]:o,p=s?[]:o,I=s?[]:o,u=f?[]:o,t=f?[]:o,L=we(h,D,x),v=cb(L),a=0,O=2*Math.PI/e;return L.forEach(function(Q){if(E=Q.length,E>1){if(g=Q[0],s)for(X=g.x,M=g.y,q=b;k>q;q++)c=q+1,j=q*O,V=c*O,R=i(j),_=F(j),r=i(V),W=F(V),p.push(R*X,M,-_*X,r*X,M,-W*X,0,M,0),I.push(.5-.5*R,.5-.5*_,.5-.5*r,.5-.5*W,.5,.5);for(P=0;E>P;P++){for(Y=Q[P],X=g.x,N=Y.x,M=g.y,S=Y.y,d=a/v,a+=$q(g,Y),y=a/v,q=b;k>q;q++)c=q+1,j=q*O,V=c*O,R=i(j),_=F(j),r=i(V),W=F(V),K.push(R*N,S,-_*N,r*N,S,-W*N,R*X,M,-_*X,r*N,S,-W*N,r*X,M,-W*X,R*X,M,-_*X),T.push(q/e,y,c/e,y,q/e,d,c/e,y,c/e,d,q/e,d),n&&q===b&&(J.push(0,M,0,0,S,0,R*N,S,-_*N,R*N,S,-_*N,R*X,M,-_*X,0,M,0),z.push(0,.5-M,0,.5-S,2*N,.5-S,2*N,.5-S,2*X,.5-M,0,.5-M)),Z&&c===k&&(B.push(0,M,0,r*N,S,-W*N,0,S,0,r*N,S,-W*N,0,M,0,r*X,M,-W*X),H.push(1,.5-M,1-2*N,.5-S,1,.5-S,1-2*N,.5-S,1,.5-M,1-2*X,.5-M));g=Y}if(f)for(X=g.x,M=g.y,q=b;k>q;q++)c=q+1,j=q*O,V=c*O,R=i(j),_=F(j),r=i(V),W=F(V),u.push(r*X,M,-W*X,R*X,M,-_*X,0,M,0),t.push(.5-.5*r,.5+.5*W,.5-.5*R,.5+.5*_,.5,.5)}}),{vs:K,uv:T,bottom_vs:u,bottom_uv:t,top_vs:p,top_uv:I,from_vs:J,from_uv:z,to_vs:B,to_uv:H}}},!0),Iq(k,{"3d.move.mode":C,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":C,"edge.gradient.color":C,"edge.source.t3":C,"edge.target.t3":C,"light.type":Bm,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":s/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":ib,"wf.short":!1,"wf.mat":C,"wf.geometry":!1,batch:C,"transparent.mask":!1,brightness:C,"select.brightness":.7,"repeat.uv.length":C,alphaTest:.4,renderTextureSamples:4,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"shape3d.vector.dynamic.maxsize":2048,"label.face":Qm,"label.t3":C,"label.r3":C,"label.texture.scale":2,"label.rotationMode":Fq,"label.light":!1,"label.blend":C,"label.reverse.flip":!1,"label.reverse.color":er,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Qm,"label2.t3":C,"label2.r3":C,"label2.texture.scale":2,"label2.rotationMode":Fq,"label2.light":!1,"label2.blend":C,"label2.reverse.flip":!1,"label2.reverse.color":er,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Qm,"note.t3":C,"note.r3":C,"note.texture.scale":2,"note.rotationMode":Fq,"note.light":!1,"note.blend":C,"note.reverse.flip":!1,"note.reverse.color":er,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Qm,"note2.t3":C,"note2.r3":C,"note2.texture.scale":2,"note2.rotationMode":Fq,"note2.light":!1,"note2.blend":C,"note2.reverse.flip":!1,"note2.reverse.color":er,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:C,"shape3d.color":Nh,"shape3d.top.color":C,"shape3d.bottom.color":C,"shape3d.from.color":C,"shape3d.to.color":C,"shape3d.image":C,"shape3d.top.image":C,"shape3d.bottom.image":C,"shape3d.from.image":C,"shape3d.to.image":C,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":C,"shape3d.side.to":C,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":C,"shape3d.opacity":C,"shape3d.reverse.flip":!1,"shape3d.reverse.color":er,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":C,"shape3d.uv.scale":C,"shape3d.top.uv.offset":C,"shape3d.top.uv.scale":C,"shape3d.bottom.uv.offset":C,"shape3d.bottom.uv.scale":C,"shape3d.from.uv.offset":C,"shape3d.from.uv.scale":C,"shape3d.to.uv.offset":C,"shape3d.to.uv.scale":C,"shape3d.top.cap":C,"shape3d.bottom.cap":C,"shape3d.start.angle":0,"shape3d.sweep.angle":g,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":C,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":Nh,"all.image":C,"all.blend":C,"all.opacity":C,"all.reverse.flip":!1,"all.reverse.color":er,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":C,"all.uv.offset":C,"all.uv.scale":C,"all.discard.selectable":!0,mat:C,"left.mat":C,"right.mat":C,"top.mat":C,"bottom.mat":C,"front.mat":C,"back.mat":C},!0);var nj,fl=!1,Ll=[0,0,0,0],mr={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:de,2:rb,3:kl,4:uo,5:Qm,6:Zo}},Qi=function(H,x,I,z){if(x.getFaceVisible(H,I)){ns(x,yj(H,x.getFaceMat(H,I)||x.getMat(H)));var T=x._26I;x.getFaceReverseCull(H,I)?T.enable(T.CULL_FACE):T.disable(T.CULL_FACE),lg(T,x._prg.uFixPickReverseColor,mr[I]),id(T),vk(T,z,6),Ah(T),yb(x)}},Hj=function(v){return v instanceof Fc},Og=function(u){return[u.x,u.e||0,u.y]},ls=function(v,L,g){for(var L=Zk(L),d=L[0],O=L[1],q=L[2];g--;)v.push(d,O,q)},np=function(k,A,E){for(var A=Zk(A),H=A[0],V=A[1],D=A[2],X=A[3];E--;)k.push(H,V,D,X)},Qc=function(I,e,T){if(e)for(var J,G,$,M=e[0],t=e[1],q=e[2],L=e[4],c=e[5],m=e[6],g=e[8],Y=e[9],Z=e[10],z=e[12],C=e[13],p=e[14],h=T.length,F=0,F=0;h>F;F+=3)J=T[F],G=T[F+1],$=T[F+2],I.push(M*J+L*G+g*$+z,t*J+c*G+Y*$+C,q*J+m*G+Z*$+p);else hh(I,T)},Kj=function(K,J){var n=J.s("light.intensity"),i=Zk(J.s(lc)),L=i[0],t=i[1],r=i[2];1!==n&&(L*=n,t*=n,r*=n),K.push(L,t,r,J.s("light.disabled")?1:0)},Sm=function(N,h,$){lg(h,$.uHeadlightRange,N._headlightRange);var r=N._headlightIntensity,g=Zk(N._headlightColor);1!==r&&(g=[g[0]*r,g[1]*r,g[2]*r]),lg(h,$.uHeadlightColor,[g[0],g[1],g[2],N._headlightDisabled?1:0]);var q=N._59O,w=N._spots,e=N._dirs;if(q.length){var B=[],J=[],a=[];q.forEach(function(n){Kj(B,n),hh(J,N._transformPointToViewSpace(n.p3())),a.push(n.s("light.range"))}),h.uniform4fv($.uPointColor,B),h.uniform1fv($.uPointRange,a),h.uniform3fv($.uPointPosition,J)}if(w.length){var H=[],n=[],U=[],c=[],z=[],p=[];w.forEach(function(D){Kj(H,D),hh(n,N._transformPointToViewSpace(D.p3())),hh(z,N._transformDirectionToViewSpace(D.p3(),D.s("light.center"))),U.push(D.s("light.range")),c.push(i(D.s("light.angle")/2)),p.push(D.s("light.exponent"))}),h.uniform4fv($.uSpotColor,H),h.uniform1fv($.uSpotRange,U),h.uniform1fv($.uSpotAngle,c),h.uniform1fv($.uSpotExponent,p),h.uniform3fv($.uSpotPosition,n),h.uniform3fv($.uSpotDirection,z)}if(e.length){var T=[],t=[];e.forEach(function(Y){Kj(T,Y),hh(t,N._transformDirectionToViewSpace(Y.p3()))}),h.uniform4fv($.uDirColor,T),h.uniform3fv($.uDirDirection,t)}},Up=function(N){return N>0&&0===(N-1&N)},En=function(P){return P=J(0,m(s,P)),P=J(Mp,m(s-Mp,P))},Nk=function(){return.05+H()/2},_k=function(J,N,Y,Q){var X,M=J.getEye();return J.isOrtho()?(X=jb(J.getCenter(),M),X[0]+=Q[0],X[1]+=Q[1],X[2]+=Q[2]):X=M,vd(N,Y,Q,X)},vd=function(Q,p,L,g){var S=Xm(Q,p),d=jb(g,L,!0),I=Xm(d,p);if(T(I)<Mp)return o;var U=(S-Xm(L,p))/I;return[L[0]+d[0]*U,L[1]+d[1]*U,L[2]+d[2]*U]},Ih=function(Z,G){return{x:2*Z.x-G.x,y:2*Z.y-G.y}},Ch=function(o,Y,C,a){var I,g;if(!o)return I=h(Y.y-C.y,C.x-Y.x),{x:Y.x+a*F(I),y:Y.y+a*i(I)};if(!C)return I=h(o.y-Y.y,Y.x-o.x),{x:Y.x+a*F(I),y:Y.y+a*i(I)};var N=jb([o.x,o.y,0],[Y.x,Y.y,0],!0),S=jb([C.x,C.y,0],[Y.x,Y.y,0],!0),B=-(N[0]+S[0])/2,t=-(N[1]+S[1])/2,s=u(B*B+t*t);if(Mp>s)return I=h(o.y-Y.y,Y.x-o.x),{x:Y.x+a*F(I),y:Y.y+a*i(I)};var $=o.x-Y.x,y=o.y-Y.y,f=C.x-Y.x,H=C.y-Y.y,L=u($*$+y*y),Q=u(f*f+H*H);I=W(Xm(N,S))/2,g=N[1]*S[0]-N[0]*S[1]>0?-1:1,B/=s,t/=s;var l=a/F(I),n=J(L,Q)/i(I);s=Math.min(l,n);var Z={x:Y.x+g*s*B,y:Y.y+g*s*t};return C.b&&l>Q/i(I)&&(Z.adjust=!0),Z},Yd=function(E){var A=E[1],i=E[2],j=E[3],w=E[6],b=E[7],h=E[11];E[1]=E[4],E[2]=E[8],E[3]=E[12],E[4]=A,E[6]=E[9],E[7]=E[13],E[8]=i,E[9]=w,E[11]=E[14],E[12]=j,E[13]=b,E[14]=h},yf=function(U){var X=U[0],_=U[1],D=U[2],e=U[3],A=U[4],u=U[5],l=U[6],Y=U[7],$=U[8],Q=U[9],P=U[10],W=U[11],O=U[12],k=U[13],T=U[14],N=U[15],i=X*u-_*A,r=X*l-D*A,I=X*Y-e*A,M=_*l-D*u,F=_*Y-e*u,z=D*Y-e*l,Z=$*k-Q*O,s=$*T-P*O,G=$*N-W*O,R=Q*T-P*k,h=Q*N-W*k,t=P*N-W*T,j=i*t-r*h+I*R+M*G-F*s+z*Z;return j?(j=1/j,U[0]=(u*t-l*h+Y*R)*j,U[1]=(D*h-_*t-e*R)*j,U[2]=(k*z-T*F+N*M)*j,U[3]=(P*F-Q*z-W*M)*j,U[4]=(l*G-A*t-Y*s)*j,U[5]=(X*t-D*G+e*s)*j,U[6]=(T*I-O*z-N*r)*j,U[7]=($*z-P*I+W*r)*j,U[8]=(A*h-u*G+Y*Z)*j,U[9]=(_*G-X*h-e*Z)*j,U[10]=(O*F-k*I+N*i)*j,U[11]=(Q*I-$*F-W*i)*j,U[12]=(u*s-A*R-l*Z)*j,U[13]=(X*R-_*s+D*Z)*j,U[14]=(k*r-O*M-T*i)*j,U[15]=($*M-Q*r+P*i)*j,void 0):o},Pr=function(f,B){if(B){var L=B[0],Z=B[1],h=B[2];f[12]=f[0]*L+f[4]*Z+f[8]*h+f[12],f[13]=f[1]*L+f[5]*Z+f[9]*h+f[13],f[14]=f[2]*L+f[6]*Z+f[10]*h+f[14],f[15]=f[3]*L+f[7]*Z+f[11]*h+f[15]}},$k=function(e,n){if(n){var r=n[0],p=n[1],D=n[2];e[0]=e[0]*r,e[1]=e[1]*r,e[2]=e[2]*r,e[3]=e[3]*r,e[4]=e[4]*p,e[5]=e[5]*p,e[6]=e[6]*p,e[7]=e[7]*p,e[8]=e[8]*D,e[9]=e[9]*D,e[10]=e[10]*D,e[11]=e[11]*D}},Fe=function(_,D,h){var f=D[0],P=D[1],k=D[2],I=D[3],O=D[4],g=D[5],J=D[6],n=D[7],H=D[8],t=D[9],B=D[10],Q=D[11],m=D[12],Z=D[13],q=D[14],A=D[15],N=h[0],X=h[1],S=h[2],w=h[3];return _[0]=N*f+X*O+S*H+w*m,_[1]=N*P+X*g+S*t+w*Z,_[2]=N*k+X*J+S*B+w*q,_[3]=N*I+X*n+S*Q+w*A,N=h[4],X=h[5],S=h[6],w=h[7],_[4]=N*f+X*O+S*H+w*m,_[5]=N*P+X*g+S*t+w*Z,_[6]=N*k+X*J+S*B+w*q,_[7]=N*I+X*n+S*Q+w*A,N=h[8],X=h[9],S=h[10],w=h[11],_[8]=N*f+X*O+S*H+w*m,_[9]=N*P+X*g+S*t+w*Z,_[10]=N*k+X*J+S*B+w*q,_[11]=N*I+X*n+S*Q+w*A,N=h[12],X=h[13],S=h[14],w=h[15],_[12]=N*f+X*O+S*H+w*m,_[13]=N*P+X*g+S*t+w*Z,_[14]=N*k+X*J+S*B+w*q,_[15]=N*I+X*n+S*Q+w*A,_},pr=function(O,D,U,L){var K,r,Z,e,p,n,l,W,H,m,$=D[0],C=D[1],q=D[2],B=L[0],t=L[1],b=L[2],s=U[0],y=U[1],Y=U[2];return T($-s)<Mp&&T(C-y)<Mp&&T(q-Y)<Mp?df(O):(l=$-s,W=C-y,H=q-Y,m=1/u(l*l+W*W+H*H),l*=m,W*=m,H*=m,K=t*H-b*W,r=b*l-B*H,Z=B*W-t*l,m=u(K*K+r*r+Z*Z),m?(m=1/m,K*=m,r*=m,Z*=m):(K=0,r=0,Z=0),e=W*Z-H*r,p=H*K-l*Z,n=l*r-W*K,m=u(e*e+p*p+n*n),m?(m=1/m,e*=m,p*=m,n*=m):(e=0,p=0,n=0),O[0]=K,O[1]=e,O[2]=l,O[3]=0,O[4]=r,O[5]=p,O[6]=W,O[7]=0,O[8]=Z,O[9]=n,O[10]=H,O[11]=0,O[12]=-(K*$+r*C+Z*q),O[13]=-(e*$+p*C+n*q),O[14]=-(l*$+W*C+H*q),O[15]=1,O)},vl=function(e,U,K,A,R){var M=1/G(U/2),S=1/(A-R);return e[0]=M/K,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=M,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(R+A)*S,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*R*A*S,e[15]=0,e},mk=function(P,L,u,I,F,E,A){var K=1/(L-u),Q=1/(I-F),j=1/(E-A);return P[0]=-2*K,P[1]=0,P[2]=0,P[3]=0,P[4]=0,P[5]=-2*Q,P[6]=0,P[7]=0,P[8]=0,P[9]=0,P[10]=2*j,P[11]=0,P[12]=(L+u)*K,P[13]=(F+I)*Q,P[14]=(A+E)*j,P[15]=1,P},zd=function(x,W){var p=W[0],M=W[1],e=W[2],G=W[3],r=p*p+M*M+e*e+G*G,F=r?1/r:0;return x[0]=-p*F,x[1]=-M*F,x[2]=-e*F,x[3]=G*F,x},vb=function(a,W){var n=W[0]+W[5]+W[10],D=0;return n>0?(D=2*Math.sqrt(n+1),a[3]=.25*D,a[0]=(W[6]-W[9])/D,a[1]=(W[8]-W[2])/D,a[2]=(W[1]-W[4])/D):W[0]>W[5]&W[0]>W[10]?(D=2*Math.sqrt(1+W[0]-W[5]-W[10]),a[3]=(W[6]-W[9])/D,a[0]=.25*D,a[1]=(W[1]+W[4])/D,a[2]=(W[8]+W[2])/D):W[5]>W[10]?(D=2*Math.sqrt(1+W[5]-W[0]-W[10]),a[3]=(W[8]-W[2])/D,a[0]=(W[1]+W[4])/D,a[1]=.25*D,a[2]=(W[6]+W[9])/D):(D=2*Math.sqrt(1+W[10]-W[0]-W[5]),a[3]=(W[1]-W[4])/D,a[0]=(W[8]+W[2])/D,a[1]=(W[6]+W[9])/D,a[2]=.25*D),a},Ep=function(W,R,x){var D=R[0],t=R[1],O=R[2],Y=R[3],p=D+D,K=t+t,h=O+O,_=D*p,m=D*K,Z=D*h,q=t*K,X=t*h,Q=O*h,N=Y*p,H=Y*K,y=Y*h;return W[0]=1-(q+Q),W[1]=m+y,W[2]=Z-H,W[3]=0,W[4]=m-y,W[5]=1-(_+Q),W[6]=X+N,W[7]=0,W[8]=Z+H,W[9]=X-N,W[10]=1-(_+q),W[11]=0,W[12]=x[0],W[13]=x[1],W[14]=x[2],W[15]=1,W},zq=function(){var H=[0,0,0],O=[0,0,0],l=[0,0,0],V=function(O,G,v){O[0]=G[1]*v[2]-G[2]*v[1],O[1]=G[2]*v[0]-G[0]*v[2],O[2]=G[0]*v[1]-G[1]*v[0]},v=function(_){return _[0]*_[0]+_[1]*_[1]+_[2]*_[2]},n=function(m){var q=Math.sqrt(v(m));m[0]/=q,m[1]/=q,m[2]/=q},g=function(Z,X,p){Z[0]=X[0]-p[0],Z[1]=X[1]-p[1],Z[2]=X[2]-p[2]};return function(A,i,$){var j=cj();return g(l,A,i),0===v(l)&&(l[2]=1),n(l),V(H,$,l),0===v(H)&&(1===Math.abs($[2])?l[0]+=1e-4:l[2]+=1e-4,n(l),V(H,$,l)),n(H),V(O,l,H),j[0]=H[0],j[4]=O[0],j[8]=l[0],j[1]=H[1],j[5]=O[1],j[9]=l[1],j[2]=H[2],j[6]=O[2],j[10]=l[2],j}}(),eq=function(V,e){if(V.vr.enable){var t=V.vr.getViewMatrix(e);if(t)return t}return pr(e?e:cj(),V._eye,V._center,V._up)},xf=function(i){if(i.vr.enable){var l=i.vr.getProjectMatrix();if(l)return l}var e=i.getAspect(),b=i._near,k=i._far,C=cj();if(i._ortho){var z=i._orthoWidth/2,M=z/e;mk(C,-z,z,-M,M,b,k)}else vl(C,i._fovy,e,b,k);return C},Jd=function(J,i){if(!J)return o;var m=0,S=1,W=2,f=[],t=0,M=J.length,p=M/3;if(i){for(;M>t;t++)f[t]=0;for(t=0;t<i.length;t+=3){var r=[],l=[],z=[];r[m]=J[3*i[t+1]+m]-J[3*i[t]+m],r[S]=J[3*i[t+1]+S]-J[3*i[t]+S],r[W]=J[3*i[t+1]+W]-J[3*i[t]+W],l[m]=J[3*i[t+2]+m]-J[3*i[t+1]+m],l[S]=J[3*i[t+2]+S]-J[3*i[t+1]+S],l[W]=J[3*i[t+2]+W]-J[3*i[t+1]+W],z[m]=r[S]*l[W]-r[W]*l[S],z[S]=r[W]*l[m]-r[m]*l[W],z[W]=r[m]*l[S]-r[S]*l[m];for(var C=0;3>C;C++)f[3*i[t+C]+m]+=z[m],f[3*i[t+C]+S]+=z[S],f[3*i[t+C]+W]+=z[W]}}else for(t=0;p>t;t+=3){var r=[],l=[],z=[];r[m]=J[3*(t+1)+m]-J[3*t+m],r[S]=J[3*(t+1)+S]-J[3*t+S],r[W]=J[3*(t+1)+W]-J[3*t+W],l[m]=J[3*(t+2)+m]-J[3*(t+1)+m],l[S]=J[3*(t+2)+S]-J[3*(t+1)+S],l[W]=J[3*(t+2)+W]-J[3*(t+1)+W],z[m]=r[S]*l[W]-r[W]*l[S],z[S]=r[W]*l[m]-r[m]*l[W],z[W]=r[m]*l[S]-r[S]*l[m];for(var C=0;3>C;C++)f[3*(t+C)+m]=z[m],f[3*(t+C)+S]=z[S],f[3*(t+C)+W]=z[W]}for(t=0;M>t;t+=3){var q=[];q[m]=f[t+m],q[S]=f[t+S],q[W]=f[t+W];var v=u(q[m]*q[m]+q[S]*q[S]+q[W]*q[W]);0===v&&(v=Mp),q[m]=q[m]/v,q[S]=q[S]/v,q[W]=q[W]/v,f[t+m]=q[m],f[t+S]=q[S],f[t+W]=q[W]}return new sm(f)},Sf=function(B,t,q,K){if(q||(q=B.createTexture()),t){var X=B.TEXTURE_2D,I=B.REPEAT,J=B.CLAMP_TO_EDGE,U=B.TEXTURE_MIN_FILTER;K!==B.NEAREST&&(K=B.LINEAR),jj(B,q),B.texImage2D(X,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,t),ms(B,B.TEXTURE_MAG_FILTER,K);var p=t.naturalWidth||t.width,Z=t.naturalHeight||t.height;Up(p)&&Up(Z)&&!t.clampToEdge?(ms(B,B.TEXTURE_WRAP_S,I),ms(B,B.TEXTURE_WRAP_T,I),ms(B,U,B.LINEAR_MIPMAP_LINEAR),B.generateMipmap(X)):(ms(B,B.TEXTURE_WRAP_S,J),ms(B,B.TEXTURE_WRAP_T,J),ms(B,U,K)),jj(B,o)}return q},Bh=function(t,g){var K=new Uint8Array(4);return g=g||t.createTexture(),jj(t,g),ms(t,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,K),g},Wp=function(E){E._26I&&E._prg&&(E._26I.deleteProgram(E._prg),E._prg=o)},Oe=function(R,i,C,r){var P=R.createShader(C);return R.shaderSource(P,r),R.compileShader(P),R.attachShader(i,P),P},Cq=function(q){return q.createBuffer()},jj=function(j,q){j.bindTexture(j.TEXTURE_2D,q)},ms=function(h,b,x){h.texParameteri(h.TEXTURE_2D,b,x)},hj=function(I,r){I.enable(I.POLYGON_OFFSET_FILL),I.polygonOffset(r[0],r[1])},Wi=function($){$.disable($.POLYGON_OFFSET_FILL)},Oq=function(X,N){if(N){var N=Zk(N);X.clearColor(N[0],N[1],N[2],N[3])}},Fi=function($,G){lg($,G.uFix,!0),Si($,G.aNormal)},Bp=function(x,F){lg(x,F.uFix,!1),Qd(x,F.aNormal)},iq=function(e,_,S,y,L,K,z,Z){e._picking||(S?(lg(e,_.uBlend,!0),lg(e,_.uBlendColor,S)):lg(e,_.uBlend,!1),lg(e,_.uLight,y==o?!0:y),Pn(L)&&1!==L&&lg(e,_.uPartOpacity,L),lg(e,_.uReverseFlip,K==o?!1:K),lg(e,_.uFixPickReverseColor,z||er)),Z?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)},ac=function(T,i){T._picking||lg(T,i.uPartOpacity,1)},id=function(){var X=[0,0,1,1];return function(u,b,h,d,k,A,s,$,t){return h?(lg(u,b.uTexture,!0),lg(u,b.uDiscardSelectable,Yb(d)?d:!0),Qd(u,b.aUv),Aq(u,k,A,b.aUv,2),t?(lg(u,b.uBlendTexture,!0),u.activeTexture(u.TEXTURE1),jj(u,t),u.uniform1i(b.uBlendSampler,1)):(lg(u,b.uBlendTexture,!1),u.activeTexture(u.TEXTURE1),jj(u,u._emptyBlendTexture)),u.activeTexture(u.TEXTURE0),jj(u,h),u.uniform1i(b.uSampler,0),s?(X[0]=s[0],X[1]=s[1]):(X[0]=0,X[1]=0),$?(X[2]=$[0],X[3]=$[1]):(X[2]=1,X[3]=1),lg(u,b.uOffsetScale,X),void 0):(u.activeTexture(u.TEXTURE0),jj(u,u._emptyTexture),u.activeTexture(u.TEXTURE1),jj(u,u._emptyBlendTexture),void 0)}}(),Ah=function(l,B,m){l.activeTexture(l.TEXTURE0),jj(l,o),l.activeTexture(l.TEXTURE1),jj(l,o),m&&(Si(l,B.aUv),lg(l,B.uTexture,!1),lg(l,B.uBlendTexture,!1))},ai=function(m,b,D,g,C,n){!D||$||Zm||m.lineWidth(D),g&&!m._picking&&lg(m,b.uFixPickReverseColor,g),C&&Aq(m,C,n,b.aPosition)},xo=function(W,B,k,K){nj&&(K=W[nj]),W.drawArrays(K==o?W.TRIANGLES:K,B,k);var S=W._renderInfo;S&&(S.calls++,S.vertices+=k,(K==o||K===W.TRIANGLES)&&(S.faces+=k/3),K===W.LINES&&(S.lines+=k/2))},vk=function(y,e,H,M){nj&&(M=y[nj]),y.drawElements(M==o?y.TRIANGLES:M,H,y.UNSIGNED_SHORT,e==o?0:2*e);var X=y._renderInfo;X&&(X.calls++,X.vertices+=H,(M==o||M===y.TRIANGLES)&&(X.faces+=H/3),M===y.LINES&&(X.lines+=H/2))},Ab=function(Y,f,i,P,n){var x=Y.ARRAY_BUFFER;Y.bindBuffer(x,f),i&&Y.bufferData(x,i,Y.STATIC_DRAW),P!=o&&Y.vertexAttribPointer(P,n?n:3,Y.FLOAT,!1,0,0)},Aq=function(c,Q,E,L,U){return E?(gf(c,c.ARRAY_BUFFER,Q,E),L!=o&&c.vertexAttribPointer(L,U?U:3,c.FLOAT,!1,0,0),void 0):Ab(c,Q,E,L,U)},xn=function(T,n,t){var c=T.ELEMENT_ARRAY_BUFFER;T.bindBuffer(c,n),t&&T.bufferData(c,t,T.STATIC_DRAW)},Mo=function(K,J,l){gf(K,K.ELEMENT_ARRAY_BUFFER,J,l)},gf=function(T,a,h,m){var x=m._bufId;x||(x=m._bufId=M.Math.generateIncreasingID());var h,F=T._bufPool;(h=F[x])&&h._buf?T.bindBuffer(a,h._buf):(h=F[x]={_buf:Cq(T)},T.bindBuffer(a,h._buf),T.bufferData(a,m,T.STATIC_DRAW)),h._fid=T._renderInfo.frame},lg=function(u,A,j){if(j!=o&&A!=o){j=Zk(j);var p=j.length;3===p?u.uniform3fv(A,j):4===p?u.uniform4fv(A,j):16===p?u.uniformMatrix4fv(A,!1,j):Yb(j)?u.uniform1i(A,j?1:0):2===p?u.uniform2fv(A,j):u.uniform1f(A,j)}},Qd=function(G,J){J!=o&&J>=0&&G.enableVertexAttribArray(J)},Si=function(c,u){u!=o&&u>=0&&c.disableVertexAttribArray(u)},yb=function(I,X){var U=I.getGL(),p=I._prg;I._7O=I._8O.pop(),X&&(lg(U,p.uMVMatrix,I._7O),I._6O=X,lg(U,p.uNMatrix,X))},wj=function(w,F){return F||(F=cj()),uh(F,w),yf(F),Yd(F),F},ns=function(d,Q){var D=d.getGL(),t=d._prg,J=d._7O;Q&&(d._8O.push(th(J)),lg(D,t.uMMatrix,Q),Fe(J,J,Q),d._7O=J),lg(D,t.uMVMatrix,J),lg(D,t.uNMatrix,wj(J,d._6O))},ii=function(a,y,v,w,J,p){if(v){if(w){var z=v.value++,M=2147483648|z,S=[(255&M>>16)/255,(255&M>>8)/255,(255&M)/255,(255&M>>24)/255];v[z]={data:J,part:p}}else S=Ll;return lg(a,y.uFixPickReverseColor,S),S}},le=function(){var x={center:function(N,w,u,P,s){var i=-w[1]/2,L={x:-w[0]/2,y:i,width:w[0],height:w[1]},I=dm(N,L,u);return[I.x+P,-I.y-s,Nk()]},front:function(c,T,Z,x,u){var z=-T[1]/2,y={x:-T[0]/2,y:z,width:T[0],height:T[1]},f=dm(c,y,Z);return[f.x+x,-f.y-u,T[2]/2+Nk()]},back:function(w,m,o,b,s){var i=-m[0]/2,t=-m[1]/2,B={x:i,y:t,width:m[0],height:m[1]},v=dm(w,B,o);return[-v.x-b,-v.y-s,-m[2]/2-Nk()]},left:function(g,Q,L,J,n){var T=-Q[1]/2,F={x:-Q[2]/2,y:T,width:Q[2],height:Q[1]},v=dm(g,F,L);return[-Q[0]/2-Nk(),-v.y-n,v.x+J]},right:function(z,Y,G,P,T){var p=-Y[2]/2,k=-Y[1]/2,g={x:p,y:k,width:Y[2],height:Y[1]},I=dm(z,g,G);return[Y[0]/2+Nk(),-I.y-T,-I.x-P]},top:function($,L,l,e,D){var o={x:-L[0]/2,y:-L[2]/2,width:L[0],height:L[2]},x=dm($,o,l);return[x.x+e,L[1]/2+Nk(),x.y+D]},bottom:function(n,A,q,D,y){var z=-A[2]/2,f={x:-A[0]/2,y:z,width:A[0],height:A[2]},Y=dm(n,f,q);return[Y.x+D,-A[1]/2-Nk(),-Y.y-y]}};return function(g,z,w,O,y,i){return x[O](g,z,w,y||0,i||0)}}(),an=function(F,E,J,O,l,b,S,Y,I,V){if(l&&(E[0]+=l[0],E[1]+=l[1],E[2]+=l[2]),Pr(F,J),Y){var f=cj();if(Ji(f,I,V),Hd(E,f),Pr(F,E),F.auto=Y,F.pos=Hd([0,0,0],F),b){var h=F.mat2=cj();Ji(h,b,S)}}else Ji(F,I,V),Pr(F,E),O===de?co(F,-A):O===rb?co(F,A):O===kl?Eh(F,-A):O===uo?Eh(F,A):O===Zo&&co(F,s),Ji(F,b,S);return F},Tn=function(Q,R){var k=R.auto,G=R.mat2,f=Q.gv;if(k){var n,X=cj(),d=[0,0,0,0];n="string"==typeof k?[k.indexOf("x")<0?f._eye[0]:f._center[0],k.indexOf("y")<0?f._eye[1]:f._center[1],k.indexOf("z")<0?f._eye[2]:f._center[2]]:f._eye,vb(d,pr(cj(),n,f._center,f._up)),Ep(X,zd(d,d),R.pos),G&&Fe(X,X,G),ns(f,X)}else ns(f,R)},wl=function(J,w,k,z,u){var G=J.s,M=J.gv,d=M.getGL(),v=M._prg,t=M._buffer,X=M._1O;Sf(d,_l,X),Tn(J,k),iq(d,v,G(w+".blend"),G(w+".light"),G(w+".opacity"),G(w+".reverse.flip"),G(w+".reverse.color"),G(w+".reverse.cull")),id(d,v,X,u,t.uv,tf),Aq(d,t.vs,z,v.aPosition),Aq(d,t.ns,tn,v.aNormal),Mo(d,t.is,xm),vk(d,0,xm.length),Ah(d,v,X),ac(d,v),yb(M)},vj=function(P,F,y){var I=P.gv,j=P.data,K=P[F]={blend:I.getBodyColor(j)||I.getFaceBlend(j,F),light:I.getFaceLight(j,F),color:I.getFaceColor(j,F),opacity:I.getFaceOpacity(j,F),transparent:I.getFaceTransparent(j,F),reverseFlip:I.getFaceReverseFlip(j,F),reverseColor:I.getFaceReverseColor(j,F),reverseCull:I.getFaceReverseCull(j,F),texture:I.getFaceImage(j,F),blendTexture:I.getFaceBlendImage(j,F),discardSelectable:I.getFaceDiscardSelectable(j,F)};if("csg"!==F){K.uv=I.getFaceUv(j,F)||y&&y[F+"Uv"],K.uvScale=I.getFaceUvScale(j,F)||y&&y[F+"UvScale"],K.uvOffset=I.getFaceUvOffset(j,F)||y&&y[F+"UvOffset"];var M=I.getFaceMat(j,F);M&&(K.mat=yj(j,M))}return K},jn=function(T,J,U,O,V){if(O){if(!V(O.transparent))return;var E=T.data,N=T.gv,Z=N._buffer,w=N.getTexture(O.texture,E),F=N.getTexture(O.blendTexture,E);id(J,U,w,O.discardSelectable,Z.uv,O.tuv,O.uvOffset,O.uvScale,F),iq(J,U,O.blend,O.light,O.opacity,O.reverseFlip,O.reverseColor,O.reverseCull),lg(J,U.uDiffuse,O.color||k["color.empty"]),Aq(J,Z.vs,O.vs,U.aPosition),Aq(J,Z.ns,O.ns,U.aNormal),xo(J,0,O.vs.length/3),ac(J,U),Ah(J,U,w)}},ki=function(b,l,x,m,k,E){var C,v,o,D,S,I,K,t,R,L,F,A=[m-l,k-x],H=b?b.length:0;for(o=0;H>o;o++){for(D=2,C=b[o],S=C[0],I=C[1];D+1<C.length;){if(K=C[D],t=C[D+1],v=fk(l,x,m,k,S,I,K,t,!0)){R=[K-S,t-I],L=$q(R),R[0]/=L,R[1]/=L,L=Xm(A,R),L=L>0?E:-E,F=[R[0]*L,R[1]*L];break}S=K,I=t,D+=2}if(F)break}if(F)for(m=l+F[0],k=x+F[1],o=0;H>o;o++)for(D=2,C=b[o],S=C[0],I=C[1];D+1<C.length;){if(K=C[D],t=C[D+1],v=fk(l,x,m,k,S,I,K,t,!0))return[0,0];S=K,I=t,D+=2}return F?F:[m-l,k-x]},ye=M.graph3d={},jd=function(w,W,E){_p(K+".graph3d."+w,W,E)},ts="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",Jh="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~~<esbdtje|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";
Iq(w,{setBatchInfo:function(L,P){Al[L]=P},getBatchInfo:function(G){return Al[G]}},!0);var ml=[1,1,1],Xc=[1,0,0,0,0,1,0,1,1,1,1,0],di=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],To=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],jm=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],dq=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],ig=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],ve=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],ql=function(x,h){vi(x,h,"_batchModelMap","_batchIndexMap"),as(x,h,"_wireframeModelMap","_wireframeIndexMap"),as(x,h,"_polylineModelMap","_polylineIndexMap"),as(x,h,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),as(x,h,"_polylineModelMapSwap","_polylineIndexMapSwap")},vi=function(Y,b,u,A){if(!b)return Y[u]={},Y[A]={},void 0;var t=b._id,r=Y[A],P=r[t];if(P){var g=Y[u],c=P.batch,i=g[c],l=i.ds,B=P.index;if(i.invalidate=!0,delete r[t],l.splice(B,1),dr(l))return delete g[c],void 0;for(var K=P.begin,G=P.size,k=3*K,v=3*G,C=4*K,s=4*G,W=i.vs,R=i.ps,m=i.uv,D=i.cs,j=i.bs,E=i.rs,h=i.ns,H=i.ls;B<l.length;B++)P=r[l[B]._id],P.index--,P.begin-=G;W.splice(k,v),R.splice(C,s),m&&m.splice(2*K,2*G),D&&D.splice(C,s),j&&j.splice(k,v),E&&E.splice(K,G),h&&h.splice(k,v),H&&H.splice(K,G)}},as=vi,hs=function(e,O,g,D){if(!D)return o;var S=O[D];if(!S){var x=Al[D]||xd,Y=x.image?[]:o;S=O[D]={vs:[],ns:[],uv:Y,cs:Y?o:x.color?o:[],bs:x.blend?[]:o,ps:[],rs:x.brightness?[]:o,ds:[]}}return S.invalidate=!0,e[g._id]={index:S.ds.length,begin:S.vs.length/3,batch:D},S.ds.push(g),S},Ho=function(R,n){return n!=o&&1!==n?[R[0]*n,R[1]*n,R[2]*n,R[3]]:R},dc=function(I,F,J){var t=I.getBrightness(F),H=Zk(J.color||"white"),O=H[3]<1,p=Math.ceil(J.width)||1,i=(O?"T":"O")+p,x=I._wireframeIndexMap,k=I._wireframeModelMap,L=k[i];L||(L=k[i]={vs:[],cs:[],ps:[],ds:[],T:O,W:p});var N,n=I.getData3dUI(F),A=po(n);if(J.geometry){if(!A)return;if(N=Xk(A),!N)return}else N=J.short?jk:Bf;L.invalidate=!0;var W=L.vs,q=L.cs,y=L.ds,b=x[F._id]={index:y.length,begin:W.length/3,batch:i};y.push(F);var R=yj(F,J.mat),G=n._calcAnchorMat(F);G&&Fe(R,R,G),Qc(W,R,N);var K=b.size=W.length/3-b.begin;np(q,Ho(H,t),K)},wd=function(X,Z,x,H,K,k,r,J,C){var d=X.getBrightness(Z);d==o&&(d=1);var $=Ho(Zk(H),d),m=$[3]<1;k=Math.ceil(k)||1;var Q=(m?"T":"O")+k;if(r){var D=r[0],R=(r[1]||D)+D;Q+="-"+D+"-"+R,C&&(Q+="-"+Md(C)+"-"+d,C=Ho(Zk(C),d))}var W=X._polylineIndexMap,t=X._polylineModelMap,z=t[Q];z||(z=t[Q]={vs:[],cs:[],ps:[],ds:[],ls:r?[]:o,T:m,W:k},r&&(z.D=D,z.G=R,z.A=C)),z.invalidate=!0;var F,G=z.vs,f=z.cs,c=z.ds,O=z.ls,S=W[Z._id]={index:c.length,begin:G.length/3,batch:Q};c.push(Z),hh(G,x);var a,w=S.size=G.length/3-S.begin,g=x.length,n=0,l=[];if(r||K)for(F=0;g>F;F+=6)a=$q([x[F],x[F+1],x[F+2]],[x[F+3],x[F+4],x[F+5]]),l.push(a),n+=a;if(n&&K){var h,p=Ho(Zk(K),d),V=[p[0]-$[0],p[1]-$[1],p[2]-$[2],p[3]-$[3]],E=0;for(F=0;g>F;F+=6)h=E/n,np(f,[$[0]+V[0]*h,$[1]+V[1]*h,$[2]+V[2]*h,$[3]+V[3]*h],1),E+=l[F/6],h=E/n,np(f,[$[0]+V[0]*h,$[1]+V[1]*h,$[2]+V[2]*h,$[3]+V[3]*h],1)}else np(f,$,w);if(r)for(E=J||0,F=0;g>F;F+=6)O.push(E),E+=l[F/6],O.push(E)},Xi=function(t,L,e){if(L)for(var D=4*L.begin,h=e[L.batch].ps,S=0;S<L.size;S++)h[D++]=t[0],h[D++]=t[1],h[D++]=t[2],h[D++]=t[3]},Wb=function(A,D){var n=D+["32"],N=A[D],W=A[n];N?W&&W.length===N.length?(W.set(N),W._bufId=null):A[n]=new sm(N):delete A[n]},fh=function(g,e,w,y,h,E,M,c,p){if(Ef(w))w.forEach(function(R){fh(g,e,R,y,h,E,M,c,p)});else if(pl(w))fh(g,e,po(y,w),y,h,E,M,c,p);else if(kf(w)){var q,i=Bs(w.mat,e,g),f=Bs(w.s3,e,g),u=Bs(w.t3,e,g),L=Bs(w.r3,e,g);if((f||L||u||i)&&(q=bn(i,f,L,Bs(w.rotationMode,e,g),u),E.push(q)),w.shape3d)fh(g,e,w.shape3d,y,h,E,M,c,w);else{var H=y.s;p=p||xd;var I=E[0],z=E.length,d=H("shape3d.color",w.color,p.color);if(h||(h=H("shape3d.blend",w.blend,p.blend)),z>1){I=th(I);for(var l=1;z>l;l++)Fe(I,I,E[l])}w.vs&&H(Jf,w.visible,p.visible)&&yq(I,M,c,w.vs,w.uv,w.is,h,d),w.top_vs&&H(kg,w.topVisible,p.topVisible)&&yq(I,M,c,w.top_vs,w.top_uv,w.top_is,h,H("shape3d.top.color",w.topColor,p.topColor)||d),w.bottom_vs&&H(Ck,w.bottomVisible,p.bottomVisible)&&yq(I,M,c,w.bottom_vs,w.bottom_uv,w.bottom_is,h,H("shape3d.bottom.color",w.bottomColor,p.bottomColor)||d),w.from_vs&&H(Tp,w.fromVisible,p.fromVisible)&&yq(I,M,c,w.from_vs,w.from_uv,w.from_is,h,H("shape3d.from.color",w.fromColor,p.fromColor)||d),w.to_vs&&H(Rb,w.toVisible,p.toVisible)&&yq(I,M,c,w.to_vs,w.to_uv,w.to_is,h,H("shape3d.to.color",w.toColor,p.toColor)||d)}q&&E.pop()}},yq=function(h,r,V,e,P,w,X,G){var x,f=r.cs,Z=r.uv,g=r.bs;if(w){x=w.length;for(var W=0;x>W;W++){var E=w[W];Qc(V,h,[e[3*E],e[3*E+1],e[3*E+2]]),Z&&hh(Z,[P[2*E],P[2*E+1]])}}else x=e.length/3,Qc(V,h,e),Z&&hh(Z,P);f&&np(f,G,x),g&&(X?ls(g,X,x):hh(g,ml,x))},Jc=function(J,D,F,v){var E=[];v?fh(J.gv,J.data,v,J,J.getBodyColor(),[D],F,E):(qs(J,de,D,F,E),qs(J,rb,D,F,E),qs(J,Qm,D,F,E),qs(J,Zo,D,F,E),qs(J,kl,D,F,E),qs(J,uo,D,F,E),qs(J,"csg",D,F,E)),E.length&&(hh(F.vs,E),hh(F.ns,Jd(E)))},qs=function(l,T,L,$,h){var N=l[T];if(N){var w=N.tuv;if(w){var F,x,Z,O,g=N.uvScale,f=N.uvOffset;if(g)for(F=w.length,x=g[0],Z=g[1],O=0;F>O;O+=2)w[O]*=x,w[O+1]*=Z;if(f)for(F=w.length,x=f[0],Z=f[1],O=0;F>O;O+=2)w[O]+=x,w[O+1]+=Z}yq(L,$,h,N.vs,w,o,N.blend,N.color)}},ik=function(K,E,T,b,$,L,t,q){var r,J=T.cs,S=T.uv,g=T.bs;if(K.getFaceVisible(E,L)){var v=K.getFaceMat(E,L);if(v&&($=yj(E,v)),Qc(t,$,q),J&&np(J,K.getFaceColor(E,L),6),S){var D=K.getFaceUv(E,L)||b[L+"Uv"],R=K.getFaceUvScale(E,L)||b[L+"UvScale"],I=K.getFaceUvOffset(E,L)||b[L+"UvOffset"];D=D?[D[6],D[7],D[0],D[1],D[2],D[3],D[2],D[3],D[4],D[5],D[6],D[7]]:Xc;var U=D[0],F=D[1],O=D[2],s=D[3],y=D[4],n=D[5],P=D[6],h=D[7],w=D[8],j=D[9],Z=D[10],X=D[11];if(R){var C=R[0],c=R[1];U*=C,F*=c,O*=C,s*=c,y*=C,n*=c,P*=C,h*=c,w*=C,j*=c,Z*=C,X*=c}if(I){var o=I[0],a=I[1];U+=o,F+=a,O+=o,s+=a,y+=o,n+=a,P+=o,h+=a,w+=o,j+=a,Z+=o,X+=a}S.push(U,F,O,s,y,n,P,h,w,j,Z,X)}g&&(r=K.getBodyColor(E)||K.getFaceBlend(E,L),r?ls(g,r,6):hh(g,ml,6))}},Uf=function(S,B,v,n){var a=S.getGL(),w=S._prg,Q=S._buffer;if(!S.drawFilter&&!Od(B)){ns(S),Fi(a,w);for(var r in B){var T=B[r];if(!(n&&!T.T||!n&&T.T)){T.invalidate?(T.invalidate=!1,Wb(T,"vs"),Wb(T,"cs"),Wb(T,"ls"),Wb(T,"ps")):v&&Wb(T,"ps");var j=T.vs32,I=v?T.ps32:T.cs32;ai(a,w,T.W,o,Q.vs,j);var l=T.D,N=!S._dashDisabled&&l;lg(a,w.uAlphaTest,k.alphaTest),N&&(lg(a,w.uDash,!0),lg(a,w.uDashDistance,l),lg(a,w.uDashGapDistance,T.G),Qd(a,w.aLineDistance),Aq(a,Q.lineDistance,T.ls32,w.aLineDistance,1),lg(a,w.uDiffuse,T.A||k["color.empty"]));var R=!S._batchColorDisabled;R&&(lg(a,w.uBatchColor,!0),Qd(a,w.aBatchColor),Aq(a,Q.batchColor,I,w.aBatchColor,4)),id(a),xo(a,0,j.length/3,a.LINES),Ah(a),R&&(lg(a,w.uBatchColor,!1),Si(a,w.aBatchColor)),N&&(lg(a,w.uDash,!1),Si(a,w.aLineDistance))}}Bp(a,w)}},Fg=function(m,M,J){var F,e,D,O,w,H,B,Q,P,I,f,d=m.getGL(),X=m._prg,r=m._buffer,U=m._batchModelMap;if(!Od(U)){ns(m);for(F in U)if(e=Al[F]||xd,!(J&&!e.transparent||!J&&e.transparent)&&(D=U[F],M||!e.transparentMask)){var p=J&&e.autoSort!==!1&&(m._33Q||D.invalidate);if(D.invalidate?(D.invalidate=!1,Wb(D,"vs"),Wb(D,"ns"),Wb(D,"cs"),Wb(D,"rs"),Wb(D,"ps"),Wb(D,"bs"),Wb(D,"uv")):M&&Wb(D,"ps"),w=D.vs32,H=M?D.ps32:D.cs32,P=D.uv32,B=D.bs32,Q=D.rs32,f=w.length/3,p&&(D.is=Zf(w,m.getEye())),f){O=e.light,I=m.getTexture(e.image),iq(d,X,o,e.light,e.opacity,e.reverseFlip,e.reverseColor,e.reverseCull),H?m._batchColorDisabled||(lg(d,X.uBatchColor,!0),Qd(d,X.aBatchColor),Aq(d,r.batchColor,H,X.aBatchColor,4)):lg(d,X.uDiffuse,e.color||k["color.empty"]);var t=e.alphaTest;lg(d,X.uAlphaTest,t===C?k.alphaTest:t);var $=B&&!m._batchBlendDisabled;$&&(lg(d,X.uBatchBlend,!0),Qd(d,X.aBatchBlend),Aq(d,r.batchBlend,B,X.aBatchBlend));var S=Q&&!m._batchBrightnessDisabled;S&&(lg(d,X.uBatchBrightness,!0),Qd(d,X.aBatchBrightness),Aq(d,r.batchBrightness,Q,X.aBatchBrightness,1)),P?id(d,X,I,e.discardSelectable,r.uv,P,e.uvOffset,e.uvScale):id(d),Aq(d,r.vs,w,X.aPosition),Aq(d,r.ns,D.ns32,X.aNormal),D.is?(xn(d,r.is,D.is),vk(d,0,f)):xo(d,0,f),P?Ah(d,X,I):Ah(d),H&&!m._batchColorDisabled&&(lg(d,X.uBatchColor,!1),Si(d,X.aBatchColor)),$&&(lg(d,X.uBatchBlend,!1),Si(d,X.aBatchBlend)),S&&(lg(d,X.uBatchBrightness,!1),Si(d,X.aBatchBrightness)),ac(d,X)}}}},Zf=function(n,V){for(var p=n.length/3,c=new Array(p),r=p/3,i=new Array(r),o=0;r>o;o++)i[o]=o;i.sort(function(t,S){var K=9*t,y=[(n[K]+n[K+3]+2*n[K+6])/4,(n[K+1]+n[K+4]+2*n[K+7])/4,(n[K+2]+n[K+5]+2*n[K+8])/4];K=9*S;var p=[(n[K]+n[K+3]+2*n[K+6])/4,(n[K+1]+n[K+4]+2*n[K+7])/4,(n[K+2]+n[K+5]+2*n[K+8])/4],h=$q(V,y)-$q(V,p);return h>0?-1:0>h?1:0});for(var o=0;r>o;o++){var J=3*o,h=3*i[o];c[J]=h,c[J+1]=h+1,c[J+2]=h+2}return new Lg(c)},tc={obj:function(l,V){var c={mat:l.mat,s3:l.s3,r3:l.r3,rotationMode:l.rotationMode,t3:l.t3,cube:l.cube==o?!0:l.cube,center:l.center==o?!0:l.center,ignoreMtls:l.ignoreMtls,ignoreTransparent:l.ignoreTransparent,ignoreColor:l.ignoreColor,ignoreImage:l.ignoreImage,ignoreNormal:l.ignoreNormal,prefix:l.prefix,flipY:l.flipY,flipFace:l.flipFace,reverseFlipMtls:l.reverseFlipMtls,finishFunc:function(h,P){if(h){var P=[];for(var U in h){var O=h[U];P.rawS3=O.rawS3,P.push(O),l.eachModel&&l.eachModel(U,O)}P.json=l,V(P)}else V()}};w.loadObj(l.obj,l.mtl,c)}};w.getModelTypeHandlers=function(){return tc},w.setModelTypeHandler=function(C,p){tc[C]=p},w.getModelTypeHandler=function(x){return tc[x]},w.handleModelLoaded=function(){},w.handleUnfoundModel=function(){};var Rr=o,Ng=o,Wc=function(D){Rr&&!D._loadingModelView_&&(Ng||(Ng={}),Ng[D._loadingModelView_=fe()]=D)},Do=function(N,q){Rr||(Rr={});var W=Rr[N];if(W){if(W.url===q)return;W.request.onload=Mc,W.request.onerror=Mc}var v=new gm;if(Rr[N]={request:v,url:q},q=w.beforeLoadURL(q),q.data){var b=w.parse(q.data);Af(N,b,q)}else{v.onload=function(){if(200===this.status||0===this.status){delete Rr[N];var U=w.parse(v.getResponseText());Af(N,U,q)}else cg(N,w.handleUnfoundModel(N,q)||o)},v.onerror=function(){cg(N,w.handleUnfoundModel(N,q)||o)};var U={};U.url=encodeURI(q),U.sync=!1,v.send(U)}},Af=function(X,N,y){var U=N.modelType;if(!U)return cg(X,N),w.handleModelLoaded(X,N),void 0;var Q=w.getModelTypeHandler(U);if(Q){if(Rr||(Rr={}),Rr[X])return;Rr[X]=!0;var r=function(n){n?(cg(X,n),w.handleModelLoaded(X,n)):cg(X,w.handleUnfoundModel(X,y)||o)};Q(N,r)}else cg(X,w.handleUnfoundModel(X,y)||o)},cg=function(r,B){if(Zl[r]=B,delete Rr[r],Od(Rr)&&(Rr=o,Ng)){for(var b in Ng){var M=Ng[b];M.invalidateAll&&M.invalidateAll(C,"modelLoaded",r),M.redraw&&M.redraw(),M.iv(),delete M._loadingModelView_}Ng=o}if(B&&Ng)for(var b in Ng){var M=Ng[b];M.invalidateAll&&M.invalidateAll(C,"modelLoading",r),M.redraw&&M.redraw(),M.iv()}},tf=new sm([0,0,0,1,1,1,1,0]),tn=new sm([0,0,1,0,0,1,0,0,1,0,0,1]),xm=new Lg([0,1,2,2,3,0]),ee=new sm([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),$m=new Lg([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Zh=new sm([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Mg=Jd(ee,$m),_j=(new sm([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Lg([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[de,Qm,rb,Zo,kl,uo]),Bf=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],jk=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],_e=function(U,d,V,L,a,R){R=R||16,U=U||16,d=d||0,V=V||U;var n,Z,o,G,$,q,k,M,J=.5,A=[],D=[],v=g/U,N=s/R;for(n=0;R>n;n++)for($=n+1,G=n*N,M=$*N,Z=d;V>Z;Z++)q=Z+1,o=Z*v,k=q*v,A.push(J*F(G)*i(o),J*i(G),-J*F(G)*F(o),J*F(M)*i(k),J*i(M),-J*F(M)*F(k),J*F(G)*i(k),J*i(G),-J*F(G)*F(k),J*F(G)*i(o),J*i(G),-J*F(G)*F(o),J*F(M)*i(o),J*i(M),-J*F(M)*F(o),J*F(M)*i(k),J*i(M),-J*F(M)*F(k)),D.push(Z/U,n/R,q/U,$/R,q/U,n/R,Z/U,n/R,Z/U,$/R,q/U,$/R);if(L){var T=[],r=[];for(o=d*v,n=0;R>n;n++)$=n+1,G=n*N,M=$*N,T.push(0,0,0,J*F(M)*i(o),J*i(M),-J*F(M)*F(o),J*F(G)*i(o),J*i(G),-J*F(G)*F(o)),r.push(0,.5,d/U,$/R,d/U,n/R)}if(a){var X=[],z=[];for(o=V*v,n=0;R>n;n++)$=n+1,G=n*N,M=$*N,X.push(0,0,0,J*F(G)*i(o),J*i(G),-J*F(G)*F(o),J*F(M)*i(o),J*i(M),-J*F(M)*F(o)),z.push(1,.5,V/U,n/R,V/U,$/R)}return{vs:A,uv:D,from_vs:T,from_uv:r,to_vs:X,to_uv:z}},Bn=function(I,M,N){I=I||.17,M=M||12,N=N||18,0>I?I=0:I>.25&&(I=.25);var l,S,b,V,e,B,E,X=.5,u=[],J=[],y=[],W=g/N,f=g/M,D=X-I;for(S=0;M>=S;S++)for(V=-s+S*f,B=i(V),e=F(V),l=0;N>=l;l++)b=l*W,E=D+I*B,u.push(i(b)*E,e*I,-F(b)*E),J.push(l/N,1-S/M);for(S=0;M>S;S++){var w=S*(N+1),Q=(S+1)*(N+1);for(l=0;N>l;l++)y.push(w+l,Q+l+1,Q+l,w+l,w+l+1,Q+l+1)}return{vs:u,uv:J,is:y}},jq=function(x,I,W,a,D,z,u){u=u||12,x=x||18,I=I||0,W=W||x,z=z||.17,0>z?z=0:z>.25&&(z=.25);var b,y,H,v,r,c,$,M,p,V,J=.5,q=[],f=[],K=g/x,E=g/u,B=J-z;for(H=0;u>H;H++)for(v=H+1,$=-s+H*E,M=-s+v*E,b=I;W>b;b++)y=b+1,r=b*K,c=y*K,p=B+z*i($),V=B+z*i(M),q.push(i(r)*p,F($)*z,-F(r)*p,i(c)*p,F($)*z,-F(c)*p,i(c)*V,F(M)*z,-F(c)*V,i(r)*p,F($)*z,-F(r)*p,i(c)*V,F(M)*z,-F(c)*V,i(r)*V,F(M)*z,-F(r)*V),f.push(b/x,1-H/u,y/x,1-H/u,y/x,1-v/u,b/x,1-H/u,y/x,1-v/u,b/x,1-v/u);if(a){var A=[],S=[];for(H=0;u>H;H++)v=H+1,$=-s+H*E,M=-s+v*E,r=I*K,p=B+z*i($),V=B+z*i(M),A.push(i(r)*p,F($)*z,-F(r)*p,i(r)*V,F(M)*z,-F(r)*V,i(r)*B,0,-F(r)*B),S.push(.5+.5*i($),.5-.5*F($),.5+.5*i(M),.5-.5*F(M),.5,.5)}if(D){var L=[],k=[];for(H=0;u>H;H++)v=H+1,$=-s+H*E,M=-s+v*E,r=W*K,p=B+z*i($),V=B+z*i(M),L.push(i(r)*p,F($)*z,-F(r)*p,i(r)*B,0,-F(r)*B,i(r)*V,F(M)*z,-F(r)*V),k.push(.5-.5*i($),.5-.5*F($),.5,.5,.5-.5*i(M),.5-.5*F(M))}return{vs:q,uv:f,from_vs:A,from_uv:S,to_vs:L,to_uv:k}},Rq=function(M,b){for(var U,B,o,l=.5,c=16,S=[],a=[],T=[],v=g/c,Q=0;c>=Q;Q++)U=Q*v,B=i(U)*l,o=F(U)*l,S.push(B,-l,o,B,l,o),a.push(1-Q/c,1,1-Q/c,0);for(Q=0;c>Q;Q++)T.push(2*Q,2*Q+1,2*Q+3,2*Q,2*Q+3,2*Q+2);if(b){var R=[],W=[],D=[];for(R.push(0,-l,0),W.push(.5,.5),Q=0;c>=Q;Q++)U=Q*v,B=i(U),o=F(U),R.push(B*l,-l,-o*l),W.push(.5+.5*B,.5+.5*o);for(Q=0;c>Q;Q++)D.push(0,Q+2,Q+1)}if(M){var t=[],w=[],V=[];for(t.push(0,l,0),w.push(.5,.5),Q=0;c>=Q;Q++)U=Q*v,B=i(U),o=F(U),t.push(B*l,l,-o*l),w.push(.5+.5*B,.5-.5*o);for(Q=0;c>Q;Q++)V.push(0,Q+1,Q+2)}return{vs:S,uv:a,is:T,bottom_vs:R,bottom_uv:W,bottom_is:D,top_vs:t,top_uv:w,top_is:V}},Dq=function(I,r,v,R,O,K,B){I=I||12,r=r||0,v=v||I;for(var V,n,t,q,N,G,S,E,Y=.5,A=[],z=[],X=g/I,k=r;v>k;k++)V=k+1,n=k*X,t=V*X,q=i(n)*Y,N=F(n)*Y,G=i(t)*Y,S=F(t)*Y,A.push(q,-Y,-N,G,-Y,-S,q,Y,-N,G,-Y,-S,G,Y,-S,q,Y,-N),z.push(k/I,1,V/I,1,k/I,0,V/I,1,V/I,0,k/I,0);if(B){var w=[],p=[];for(k=r;v>k;k++)n=X*k,t=X*(k+1),q=i(n),N=F(n),G=i(t),S=F(t),w.push(q*Y,-Y,-N*Y,0,-Y,0,G*Y,-Y,-S*Y),p.push(.5+.5*q,.5+.5*N,.5,.5,.5+.5*G,.5+.5*S)}if(K){var D=[],y=[];for(k=r;v>k;k++)n=X*k,t=X*(k+1),q=i(n),N=F(n),G=i(t),S=F(t),D.push(q*Y,Y,-N*Y,G*Y,Y,-S*Y,0,Y,0),y.push(.5+.5*q,.5-.5*N,.5+.5*G,.5-.5*S,.5,.5)}if(R){var o=[],T=[];n=X*r,q=i(n)*Y,N=F(n)*Y,E=r/I,o.push(0,Y,0,0,-Y,0,q,-Y,-N,q,-Y,-N,q,Y,-N,0,Y,0),T.push(0,0,0,1,E,1,E,1,E,0,0,0)}if(O){var e=[],b=[];n=X*v,q=i(n)*Y,N=F(n)*Y,E=v/I,e.push(0,-Y,0,0,Y,0,q,Y,-N,q,Y,-N,q,-Y,-N,0,-Y,0),b.push(1,1,1,0,E,0,E,0,E,1,1,1)}return{vs:A,uv:z,bottom_vs:w,bottom_uv:p,top_vs:D,top_uv:y,from_vs:o,from_uv:T,to_vs:e,to_uv:b}},Ok=function(D,s,f,e,a){s=s||18,f=f||0,e=e==o?g:e,a=a==o?.5:a;for(var b,r,l,d,H,x,Y=[0,.5,.75,.875,.9375],_=[],S=[],u=[],Q=e/s,K=0;K<Y.length;K++){var Z=0===K%2?0:.5;for(b=0;s>=b;b++)r=(b+Z)*Q+f,l=1-Y[K],_.push(i(r)*a*l,-a+2*Y[K]*a,-F(r)*a*l),S.push((b+Z)/s,l)}for(K=0;K<Y.length-1;K++){var L=K*(s+1),U=(K+1)*(s+1);for(b=0;s>b;b++)u.push(L+b,U+b+1,U+b,L+b,L+b+1,U+b+1)}for(x=_.length/3-(s+1),b=0;s>b;b++)_.push(0,a,0),S.push((b+.5)/s,0);for(b=0;s>b;b++)u.push(x+b,x+b+1,x+(s+1)+b);if(D){var M=[],O=[],N=[];for(M.push(0,-a,0),O.push(.5,.5),b=0;s>=b;b++)r=b*Q+f,d=i(r),H=F(r),M.push(d*a,-a,-H*a),O.push(.5+.5*d,.5+.5*H);for(b=0;s>b;b++)N.push(0,b+2,b+1)}return{vs:_,uv:S,is:u,bottom_vs:M,bottom_uv:O,bottom_is:N}},Yq=function(S,j,T,Y,z,I){S=S||16,j=j||0,T=T||S;for(var M=.5,b=[],A=[],y=g/S,c=j;T>c;c++){var V=c+1,d=y*c,x=y*V;b.push(i(d)*M,-M,-F(d)*M,i(x)*M,-M,-F(x)*M,0,M,0),A.push(c/S,1,V/S,1,(c+V)/2/S,0)}if(I){var N=[],u=[];for(c=j;T>c;c++){d=y*c,x=y*(c+1);var B=i(d),E=F(d),D=i(x),Z=F(x);N.push(B*M,-M,-E*M,0,-M,0,D*M,-M,-Z*M),u.push(.5+.5*B,.5+.5*E,.5,.5,.5+.5*D,.5+.5*Z)}}if(Y){var Q=[],U=[];d=y*j,Q.push(0,M,0,0,-M,0,i(d)*M,-M,-F(d)*M),U.push(0,0,0,1,j/S,1)}if(z){var C=[],_=[];d=y*T,C.push(0,-M,0,0,M,0,i(d)*M,-M,-F(d)*M),_.push(1,1,1,0,T/S,1)}return{vs:b,uv:A,bottom_vs:N,bottom_uv:u,from_vs:Q,from_uv:U,to_vs:C,to_uv:_}},Ri=function(U,f,Z,F,S,i,k,T){for(var X=[],C=0;C<U.length-1;C+=2)X.push({x:U[C],y:U[C+1]});return qi(X,f,Z,F,S,i,k,T,!1)},gl={roundRect:function(A,D){return Ri([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],A,D,3)},star:function(H,k){return Ri([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],H,k)},rect:function(u,b){return Ri([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],u,b)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(m,$){return Ri([0,-.5,.5,.5,-.5,.5],[1,2,2,5],m,$)},rightTriangle:function(Z,f){return Ri([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],Z,f)},parallelogram:function(F,$){return Ri([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],F,$)},trapezoid:function(l,H){return Ri([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],l,H)}},yp={sphere:1,cylinder:1,cone:1,torus:1},Wf={torus:1,sphere:1},Mn=Iq(mq(gl),{cylinder:1}),uf=Iq(mq(gl),{cylinder:1,cone:1}),Me=function(p,U,w){var k,N=Bs(p.anchor3d,w,U),C=Bs(p.mat,w,U),c=Bs(p.s3,w,U),l=Bs(p.t3,w,U),i=Bs(p.r3,w,U),e=c||i||l||C;if(N||e){k=th(U._6O);var E=e?bn(C,c,i,Bs(p.rotationMode,w,U),l):cj();N&&Pr(E,[.5-N[0],.5-N[1],.5-N[2]]),ns(U,E)}return k},om=function(p,d,W,y,z,R,X){if(Ef(W))W.forEach(function(e){om(p,d,e,y,z,R,X)});else if(pl(W))om(p,d,po(y,W),y,z,R,X);else if(kf(W))if(W.shape3d){var s=Me(W,p,d);om(p,d,W.shape3d,y,z,R,W),s&&yb(p,s)}else Ko(p,d,W,y.s,z,R,X)},Ko=function(G,H,S,Y,O,R,k){if(k=k||xd,!R||R(Y("shape3d.transparent",S.transparent,k.transparent))){var v=Me(S,G,H);Dr(S);var N=G._26I,m=G._prg,$=G._buffer,q=Y("shape3d.color",S.color,k.color);O||(O=Y("shape3d.blend",S.blend,k.blend));var F,s=S.opacity==o?k.opacity:S.opacity,z=Y("shape3d.opacity");F=z!=o&&s!=o?s*z:s!=o?s:z,iq(N,m,O,Y("shape3d.light",S.light,k.light),F,Y("shape3d.reverse.flip",S.reverseFlip,k.reverseFlip),Y("shape3d.reverse.color",S.reverseColor,k.reverseColor),Y("shape3d.reverse.cull",S.reverseCull,k.reverseCull));var P=Y("polygonOffset",S.polygonOffset,k.polygonOffset);S.vs&&Y(Jf,S.visible,k.visible)&&Rc(N,m,$,q,G.getTexture(Y("shape3d.image",S.image,k.image),H),Y("shape3d.discard.selectable",S.discardSelectable,k.discardSelectable),S.vs,S.uv,S.ns,S.is,Y("shape3d.uv.offset",S.uvOffset,k.uvOffset),Y("shape3d.uv.scale",S.uvScale,k.uvScale),P),S.top_vs&&Y(kg,S.topVisible,k.topVisible)&&Rc(N,m,$,Y("shape3d.top.color",S.topColor,k.topColor)||q,G.getTexture(Y("shape3d.top.image",S.topImage,k.topImage),H),Y("shape3d.top.discard.selectable",S.topDiscardSelectable,k.topDiscardSelectable),S.top_vs,S.top_uv,S.top_ns,S.top_is,Y("shape3d.top.uv.offset",S.topUvOffset,k.topUvOffset),Y("shape3d.top.uv.scale",S.topUvScale,k.topUvScale),P),S.bottom_vs&&Y(Ck,S.bottomVisible,k.bottomVisible)&&Rc(N,m,$,Y("shape3d.bottom.color",S.bottomColor,k.bottomColor)||q,G.getTexture(Y("shape3d.bottom.image",S.bottomImage,k.bottomImage),H),Y("shape3d.bottom.discard.selectable",S.bottomDiscardSelectable,k.bottomDiscardSelectable),S.bottom_vs,S.bottom_uv,S.bottom_ns,S.bottom_is,Y("shape3d.bottom.uv.offset",S.bottomUvOffset,k.bottomUvOffset),Y("shape3d.bottom.uv.scale",S.bottomUvScale,k.bottomUvScale),P),S.from_vs&&Y(Tp,S.fromVisible,k.fromVisible)&&Rc(N,m,$,Y("shape3d.from.color",S.fromColor,k.fromColor)||q,G.getTexture(Y("shape3d.from.image",S.fromImage,k.fromImage),H),Y("shape3d.from.discard.selectable",S.fromDiscardSelectable,k.fromDiscardSelectable),S.from_vs,S.from_uv,S.from_ns,S.from_is,Y("shape3d.from.uv.offset",S.fromUvOffset,k.fromUvOffset),Y("shape3d.from.uv.scale",S.fromUvScale,k.fromUvScale),P),S.to_vs&&Y(Rb,S.toVisible,k.toVisible)&&Rc(N,m,$,Y("shape3d.to.color",S.toColor,k.toColor)||q,G.getTexture(Y("shape3d.to.image",S.toImage,k.toImage),H),Y("shape3d.to.discard.selectable",S.toDiscardSelectable,k.toDiscardSelectable),S.to_vs,S.to_uv,S.to_ns,S.to_is,Y("shape3d.to.uv.offset",S.toUvOffset,k.toUvOffset),Y("shape3d.to.uv.scale",S.toUvScale,k.toUvScale),P),ac(N,m),v&&yb(G,v)}},Rc=function(W,p,j,t,s,i,Z,I,g,Y,X,y,M){Z&&(M&&hj(W,M),lg(W,p.uDiffuse,t||k["color.empty"]),I?id(W,p,s,i,j.uv,I,X,y):id(W),Aq(W,j.vs,Z,p.aPosition),Aq(W,j.ns,g,p.aNormal),Y?(Mo(W,j.is,Y),vk(W,0,Y.length)):xo(W,0,Z.length/3),I?Ah(W,p,s):Ah(W),M&&Wi(W))},po=function(Y,d){var B=Y.s;if(d||(d=B(pi)),!d)return o;var A=gs(d);if(A)return A;if("text"===d){var a={amount:B("shape3d.text.amount"),size:B("shape3d.text.size"),font:B("shape3d.text.font"),style:B("shape3d.text.style"),weight:B("shape3d.text.weight"),fill:B("shape3d.text.fill"),curveSegments:B("shape3d.text.curveSegments"),spacing:B("shape3d.text.spacing")},L=Y.gv.getShape3dText(Y.data),$=L;for(var t in a)$+="_"+(a[t]===C?"U":a[t]);return Y._cachedTextKey===$?Y._cachedTextGeometry:(Y._cachedTextKey=$,Y._cachedTextGeometry=w.createTextGeometry(L,a))}var t=d;if(yp[d]){var T=B("shape3d.side"),J=B("shape3d.side.from"),H=B("shape3d.side.to"),E=B(Tp),R=B(Rb);3>T?(T=0,J=0,H=0,E=!1,R=!1):((J==o||0>J)&&(J=0),(H==o||H>T)&&(H=T),0===J&&H===T&&(E=!1,R=!1)),t+="-"+T+"-"+J+"-"+H+"-"+E+"-"+R}if(Mn[d]){var c=B(kg);t+="-"+c}if(uf[d]){var z=B(Ck);t+="-"+z}if("torus"===d){var j=B("shape3d.torus.radius");0>j?j=0:j>.25&&(j=.25),t+="-"+j}if(Wf[d]){var F=B(kp);t+="-"+F}return A=fg[t],A||("box"===d?A=w.createBoxModel():gl[d]?A=gl[d](c,z):"sphere"===d?A=w.createSphereModel(T,J,H,E,R,F):d===vg?A=w.createCylinderModel(T,J,H,E,R,c,z):"cone"===d?A=w.createConeModel(T,J,H,E,R,z):"torus"===d&&(A=w.createTorusModel(T,J,H,E,R,j,F)),fg[t]=A),A},Dr=function(){var r=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],H=["is","top_is","bottom_is","from_is","to_is"];return t=Mb(ts.substr(ts.indexOf("^#")+2)),qq(w[ir(qh+r[15]+"n"+r[16])]())&&Bg()?function(a){a&&!a._complete_&&(a._complete_=!0,a.vs&&dr(a.ns)&&(a.ns=Jd(a.vs,a.is)),a.top_vs&&dr(a.top_ns)&&(a.top_ns=Jd(a.top_vs,a.top_is)),a.bottom_vs&&dr(a.bottom_ns)&&(a.bottom_ns=Jd(a.bottom_vs,a.bottom_is)),a.from_vs&&dr(a.from_ns)&&(a.from_ns=Jd(a.from_vs,a.from_is)),a.to_vs&&dr(a.to_ns)&&(a.to_ns=Jd(a.to_vs,a.to_is)),r.forEach(function(F){var V=a[F];Ef(V)&&(a[F]=new sm(V))}),H.forEach(function(Y){var f=a[Y];Ef(f)&&(a[Y]=new Lg(f))}))}:void 0}(),hf=function(u,y){var m=u[y];Ef(m)&&(u[y]=new sm(m))};Iq(js,{_25Q:function(i){i._16O=function(R,u,e,M,y,A,H,S,v){var N=this.info;if(N){var F,K,O,z,D,V,j=cj();if(Wg[u]?(F=N.p3,K=N.c1,O=N.c2):Vh[u]?(K=N.s1||N.c1,O=N.s2||N.c2):(K=N.t1||N.c1,O=N.t2||N.c2),F)V=le(u,Vc,e,M,S,v);else{var f=jb(O,K),Y=$q(K,O);z=[0,-h(f[2],f[0]),Z(f[1]/Y)],D="zyx",F=[(K[0]+O[0])/2,(K[1]+O[1])/2,(K[2]+O[2])/2],V=le(u,[Y,0,0],e,M,S,v)}return an(j,V,F,M,y,A,H,R,z,D)}return sc},i._80o=function(A,k,w){var O=this,z=O.shapeModel;if(z){var F=O.gv;ns(F),om(F,O.data,z,O,O.getBodyColor(),w)}},i.createLineModel=function(V,p,Z,h,f){for(var R=this,e=R.s,Q=mi(V,p,e(kp)),r=[],U=0;U<Q.length;U++){var w=Q[U],E=w.length;if(E>1){var A=w[0];r.push(A.x,A.y,A.z);for(var J=1;E-1>J;J++)A=w[J],r.push(A.x,A.y,A.z),r.push(A.x,A.y,A.z);A=w[E-1],r.push(A.x,A.y,A.z)}}var X,W,_,G=e(h+".color"),s=e(f),Y=0;return s&&(W=e(f+".color"),X=e(f+".pattern"),Y=e(f+".offset"),_=G),wd(R.gv,R.data,r,W||G,_?o:e(h+".gradient.color"),Z,X||e(h+".pattern"),Y,_),Q},i.createTubeModel=function(r,B,C,f){for(var E=this,v=E.s,m=v("shape3d.side")||bj,F=v("shape3d.start.angle"),a=v("shape3d.sweep.angle"),D=v(kg)?v("shape3d.top.cap"):o,J=v(Ck)?v("shape3d.bottom.cap"):o,N="flat"===D,H="flat"===J,P=N&&(f?f.uv:v("shape3d.top.image")),z=H&&(f?f.uv:v("shape3d.bottom.image")),S=f?f.uv:v("shape3d.image"),w={vs:[],uv:S?[]:o,top_vs:N?[]:o,top_uv:P?[]:o,bottom_vs:H?[]:o,bottom_uv:z?[]:o},Q=mi(r,B,v(kp),C),j=0,Y=Q.length;Y>j;j++)sf(w,Q[j],v(Nn),C,m,F,a,D,J);if(f){var x=[];fh(E.gv,E.data,w,E,E.getBodyColor(),[],f,x),x.length&&(hh(f.vs,x),hh(f.ns,Jd(x)))}else E.shapeModel=w;return Q},i.getCache=function(){var s=this.info;if(s){var D=s.list;if(D){var T=s.cache;return T||(T=s.cache=bd(D)),T}}return o}}});var rf=function(B,k){for(var z,u=0,Y=B.length,n=0,A=Y-1;A>=n;)if(u=y(n+(A-n)/2),z=B[u].length-k,0>z)n=u+1;else{if(!(z>0)){A=u;break}A=u-1}u=A;var o=B[u],p=o.point;return u===Y-1||o.length===k||(p=(new Bk).subVectors(B[u+1].point,p).normalize().multiplyScalar(k-o.length).add(p)),{point:p,tangent:o.tangent}},bd=function(N){for(var T,b,V=[],Q=0,_=0;_<N.length;_++){for(var D=N[_],y=0;y<D.length;y++){T=D[y],b&&(Q+=b.distanceTo(T));var U=new Bk,O=D[y+1];O?U.subVectors(O,T):b?U.subVectors(T,b):U.x=1,U.normalize(),V.push({point:T,length:Q,tangent:U}),b=T}b=null}return V},mi=function(R,X,y,s){y=y||cs;for(var Z=[],t=0,i=R.size();i>t;t++){var k=R.get(t);Z.push(new Bk(k.x,k.e||0,k.y))}X&&(Jq(X)&&(X=X._as),X.length||(X=null));for(var M,$,N,F,w,L=[],O=0,T=0,q=X?X.length:i;q>T;T++)if(w=X?X[T]:0===T?1:2,1===w)L.push(N=[]),N.push(Z[O++]);else if(2===w||5===w)if(F=2===w?Z[O++]:N[0],s){var B=X?X[T+1]:q>T+1?2:o;if(2===B||5===B){var G=N[N.length-1],x=2===B?Z[O]:N[0],A=(new Bk).subVectors(G,F),I=(new Bk).subVectors(x,F),h=A.length(),P=I.length();if(h&&P)if(s>h/2&&s>P/2)N.push(F);else for(A.multiplyScalar(m(s,h/2)/h).add(F),I.multiplyScalar(m(s,P/2)/P).add(F),M=new nr(A,F,I).getPoints(y),$=0;y>=$;$++)N.push(M[$])}else N.push(F)}else N.push(F);else if(3===w)for(M=new nr(N[N.length-1],Z[O++],Z[O++]).getPoints(y),$=1;y>=$;$++)N.push(M[$]);else if(4===w)for(M=new Rh(N[N.length-1],Z[O++],Z[O++],Z[O++]).getPoints(y),$=1;y>=$;$++)N.push(M[$]);return L},Nj=function(t){for(var v,X,H=new Bk,q=[],s=[],B=[],$=0,z=t.length;z>$;$++)v=t[$],X=t[$+1],X?H.subVectors(X,v):H.subVectors(v,t[$-1]),q.push(H.normalize().clone());var m,M,N,Z,E=new Bk,w=new Bk,U=new qe,V=1e-4,d=Number.MAX_VALUE,h=q[0],C=s[0]=new Bk,K=B[0]=new Bk;for(M=T(h.x),N=T(h.y),Z=T(h.z),d>=M&&(d=M,E.set(1,0,0)),d>=N&&(d=N,E.set(0,1,0)),d>=Z&&E.set(0,0,1),w.crossVectors(h,E).normalize(),C.crossVectors(h,w),K.crossVectors(h,C),$=1;z>$;$++)s[$]=s[$-1].clone(),B[$]=B[$-1].clone(),w.crossVectors(q[$-1],q[$]),w.length()>V&&(w.normalize(),m=W(wb(q[$-1].dot(q[$]),-1,1)),s[$].applyMatrix4(U.makeRotationAxis(w,m))),B[$].crossVectors(q[$],s[$]);return{B:B,T:q,N:s}},sf=function(){var b=function(H){for(var Z=1;Z<arguments.length;Z++){var A=arguments[Z];H.push(A.x,A.y,A.z)}},P=function(r){for(var L=1;L<arguments.length;L++){var B=arguments[L].uv;r.push(B[0],B[1])}},T=function(j,R,C,u,X){var H=-u*i(X),t=u*F(X);return new Bk(j.x+H*C.x+t*R.x,j.y+H*C.y+t*R.y,j.z+H*C.z+t*R.z)},x=function(P,F,O,U,A,R,x,s){x=x||g;for(var G=[],m=x/A,S=0;A>=S;S++){var t=T(P,F,O,U,S*m+R);G.push(t),s!=o&&(t.uv=[s,S/A])}return G},S=function(V,I,Q,G,S,N,o,q,K){K=K||g;var a=I?V.top_vs:V.bottom_vs;if(a)for(var w=I?V.top_uv:V.bottom_uv,d=K/o,n=0;o>n;n++){var R,H;I?(R=n*d+q,H=(n+1)*d+q):(H=n*d+q,R=(n+1)*d+q),b(a,T(Q,G,S,N,R),T(Q,G,S,N,H),Q),w&&w.push(.5-.5*i(R),.5-.5*F(R),.5-.5*i(H),.5-.5*F(H),.5,.5)}};return function(j,f,z,D,a,W,T,w,k){var p=f.length;if(p>1){var h,v,N,R,V,F,d,t=Nj(f),y=t.T,Z=t.N,H=t.B;"flat"===w&&S(j,!0,f[0],H[0],Z[0],D,a,W,T),"flat"===k&&S(j,!1,f[p-1],H[p-1],Z[p-1],D,a,W,T);var M,B,O=[],e=E(a/2),m="round"===w,X="round"===k,G=f[0],Y=y[0],r=H[0],I=Z[0],A=f[p-1],U=y[p-1],l=H[p-1],g=Z[p-1];if(m){for(N=1;e>=N;N++)Z.splice(0,0,I),H.splice(0,0,r),y.splice(0,0,Y),B=-N/e*D,f.splice(0,0,Y.clone().multiplyScalar(B).add(G)),O[e-N]=u(D*D-B*B);p+=e}if(X){for(N=1;e>=N;N++)Z.push(g),H.push(l),y.push(U),B=N/e*D,f.push(U.clone().multiplyScalar(B).add(A)),O[f.length-1]=u(D*D-B*B);p+=e}if(j.uv){var _=0,Q=0,$=[];for(z&&(_=z),V=f[0],$[0]=0,N=1;p>N;N++)R=f[N],$[N]=V.distanceTo(R),V=R,z||(_+=$[N]);for(M=[],N=0;p>N;N++)Q+=$[N],M[N]=_?Q/_:0}for(N=0;p>N;N++){if(R=f[N],F=H[N],d=Z[N],h=x(R,F,d,O[N]===C?D:O[N],a,W,T,M?M[N]:o),v)for(var J=0;a>J;J++){var n=v[J],L=v[J+1]||v[0],q=h[J],K=h[J+1]||h[0];b(j.vs,L,n,q,q,K,L),j.uv&&P(j.uv,L,n,q,q,K,L)}v=h}}}}();Iq(w,{getLineLength:function(b){return b[b.length-1].length},getLineOffset:function($,q){return rf($,q)},getLineCacheInfo:function(p,_,x,v){return bd(mi(p,_,x,v))}});var ao=M.graph3d.RenderLite={},Nl=new Array(0),Ob=ao.Buffer=function(I,K,N,i){this.gl=I,this.buffer=I.createBuffer(),this.type=K||I.ARRAY_BUFFER,this.drawType=i||I.STATIC_DRAW,this.data=Nl,N&&this.upload(N)};Ob.prototype.upload=function(F,b,V){V||this.bind();var p=this.gl;F=F||this.data,b=b||0,this.data.byteLength>=F.byteLength?p.bufferSubData(this.type,b,F):p.bufferData(this.type,F,this.drawType),this.data=F},Ob.prototype.bind=function(){var n=this.gl;n.bindBuffer(this.type,this.buffer)},Ob.createVertexBuffer=function(w,d,T){return new Ob(w,w.ARRAY_BUFFER,d,T)},Ob.createIndexBuffer=function(d,f,x){return new Ob(d,d.ELEMENT_ARRAY_BUFFER,f,x)},Ob.create=function(N,j,Y,P){return new Ob(N,j,P)},Ob.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var Ed=ao.Shader=function(r,u,R){this.gl=r,this.program=zs(r,u,R),this.attributes=qb(r,this.program);var q=We(r,this.program);this.uniforms=gk(r,q)};Ed.prototype.bind=function(){this.gl.useProgram(this.program)},Ed.prototype.destroy=function(){this.gl};var zs=function(B,F,a){var N=aq(B,B.VERTEX_SHADER,F),R=aq(B,B.FRAGMENT_SHADER,a);B.getShaderParameter(R,B.COMPILE_STATUS)||console.error(B.getError());var X=B.createProgram();return B.attachShader(X,N),B.attachShader(X,R),B.linkProgram(X),B.getProgramParameter(X,B.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",B.getProgramParameter(X,B.VALIDATE_STATUS)),console.error("gl.getError()",B.getError()),""!==B.getProgramInfoLog(X)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",B.getProgramInfoLog(X)),B.deleteProgram(X),X=null),B.deleteShader(N),B.deleteShader(R),X},aq=function(e,Q,z){var h=e.createShader(Q);return e.shaderSource(h,z),e.compileShader(h),e.getShaderParameter(h,e.COMPILE_STATUS)?h:(console.log(e.getShaderInfoLog(h)),null)},We=function(x,r){for(var E={},N=x.getProgramParameter(r,x.ACTIVE_UNIFORMS),n=0;N>n;n++){var w=x.getActiveUniform(r,n),Y=w.name.replace(/\[.*?\]/,""),P=Tq(x,w.type);E[Y]={type:P,size:w.size,location:x.getUniformLocation(r,Y),value:_i(P,w.size)}}return E},qb=function(x,w){for(var N={},J=x.getProgramParameter(w,x.ACTIVE_ATTRIBUTES),U=0;J>U;U++){var V=x.getActiveAttrib(w,U),I=Tq(x,V.type);N[V.name]={type:I,size:hb(I),gl:x,location:x.getAttribLocation(w,V.name),pointer:te}}return N},te=function(o,s,K,k,Z){var b=this.gl;b.enableVertexAttribArray(this.location),b.bindBuffer(o.type,o.buffer),b.vertexAttribPointer(this.location,this.size,s||b.FLOAT,K||!1,k||0,Z||0)},hb=function(E){return Rp[E]},Rp={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},Tq=function(w,u){if(!qr){var a=v.keys(Uc);
qr={};for(var z=0;z<a.length;++z){var R=a[z];qr[w[R]]=Uc[R]}}return qr[u]},qr=null,Uc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},_i=function(f,D){switch(f){case"float":return 0;case"vec2":return new Float32Array(2*D);case"vec3":return new Float32Array(3*D);case"vec4":return new Float32Array(4*D);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*D);case"ivec3":return new Int32Array(3*D);case"ivec4":return new Int32Array(4*D);case"bool":return!1;case"bvec2":return cm(2*D);case"bvec3":return cm(3*D);case"bvec4":return cm(4*D);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},cm=function(Z){for(var Y=new Array(Z),L=0;L<Y.length;L++)Y[L]=!1;return Y},gk=function(y,g){var C={data:{}};C.gl=y;for(var d=v.keys(g),j=0;j<d.length;j++){var S=d[j],U=S.split("."),i=U[U.length-1],W=es(U,C),z=g[S];W.data[i]=z,W.gl=y,v.defineProperty(W,i,{get:Nd(i),set:yg(i,z)})}return C},Nd=function(r){var x=Sd.replace("%%",r);return new Function(x)},yg=function(s,A){var x,N=Dk.replace(/%%/g,s);return x=1===A.size?Yo[A.type]:ag[A.type],x&&(N+="\nthis.gl."+x+";"),new Function("value",N)},es=function(Q,N){for(var $=N,v=0;v<Q.length-1;v++){var j=$[Q[v]]||{data:{}};$[Q[v]]=j,$=j}return $},Sd=["return this.data.%%.value;"].join("\n"),Dk=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Yo={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},ag={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},Fc=M.Light=function(){ek(Fc,this),this.s(lc,k[lc]),this.s(pi,"sphere"),this.s3(20,20,20)};Lj("Light",lf,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(B,H,w){Fc.superClass.onStyleChanged.apply(this,arguments),B===lc&&this.s("shape3d.color",w)}});var qf=ye.Graph3dView=function(e,M){var O=this;O._webGLVersion=1,O._attributes=M||w.graph3dViewAttributes,O._25I={},O._view=jh(1,O);var U=O._canvas=ep(O._view);U.addEventListener("webglcontextlost",function(p){p.preventDefault(),Wp(O),O._26I&&O._doBufferGC(O._26I,!0),O._26I=o,O._1o.texture=o,O._35O=!0},R),U.addEventListener("webglcontextrestored",function(){O._35O=!1,O.iv()},R),O._batchIndexMap={},O._batchModelMap={},O._wireframeIndexMap={},O._wireframeModelMap={},O._wireframeIndexMapSwap={},O._wireframeModelMapSwap={},O._polylineIndexMap={},O._polylineIndexMap={},O._polylineIndexMapSwap={},O._polylineIndexMapSwap={},O._8O=[],O._7O=cj(),O._6O=cj(),O._1o=new Uj(O),O._30O=new Oi(O),O._31O=new bb(O),O._32O=new Gc(O),O._raycaster=new Ip(O),O._highlightHelper=new Tb(O),O._postProcessing=new ws(O),O.vr=new en(O),O._33Q=!0,O._eye=mq(w.graph3dViewEye),O._center=mq(w.graph3dViewCenter),O._up=mq(w.graph3dViewUp),O._lightChanged=!1,O._59O=[],O._spots=[],O._dirs=[],O._frameId=0,O.overlappingBox=new ph(O),O.dm(e?e:new hd),O._coreInteractor=new rq(this),O.setInteractors([new ah(O)])},Yp={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},Eo=0;jd("Graph3dView",v,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",Pb,Np,"firstPersonMode",El,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",mg,ak,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:w.graph3dViewEditHelperDisabled,_devicePixelRatio:C,_boundaries:C,_moveStep:w.graph3dViewMoveStep,_rotateStep:w.graph3dViewRotateStep,_pannable:w.graph3dViewPannable,_rotatable:w.graph3dViewRotatable,_walkable:w.graph3dViewWalkable,_resettable:w.graph3dViewResettable,_zoomable:w.graph3dViewZoomable,_firstPersonMode:w.graph3dViewFirstPersonMode,_mouseRoamable:w.graph3dViewMouseRoamable,_gridVisible:w.graph3dViewGridVisible,_gridSize:w.graph3dViewGridSize,_gridGap:w.graph3dViewGridGap,_gridColor:w.graph3dViewGridColor,_originAxisVisible:w.graph3dViewOriginAxisVisible,_centerAxisVisible:w.graph3dViewCenterAxisVisible,_axisXColor:w.graph3dViewAxisXColor,_axisYColor:w.graph3dViewAxisYColor,_axisZColor:w.graph3dViewAxisZColor,_ortho:w.graph3dViewOrtho,_orthoWidth:w.graph3dViewOrthoWidth,_fovy:w.graph3dViewFovy,_near:w.graph3dViewNear,_far:w.graph3dViewFar,_headlightColor:w.graph3dViewHeadlightColor,_headlightIntensity:w.graph3dViewHeadlightIntensity,_headlightRange:w.graph3dViewHeadlightRange,_headlightDisabled:w.graph3dViewHeadlightDisabled,_rectSelectable:w.graph3dViewRectSelectable,_rectSelectBackground:w.graph3dViewRectSelectBackground,_editSizeColor:w.graph3dViewEditSizeColor,_autoMakeVisible:Fd,_fogDisabled:w.graph3dViewFogDisabled,_fogColor:w.graph3dViewFogColor,_fogNear:w.graph3dViewFogNear,_fogFar:w.graph3dViewFogFar,_dashDisabled:w.graph3dViewDashDisabled,_batchColorDisabled:w.graph3dViewBatchColorDisabled,_batchBlendDisabled:w.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:w.graph3dViewBatchBrightnessDisabled,setEye:function(q,N,h){1===arguments.length&&(N=q[1],h=q[2],q=q[0]);var $=this._eye;$[0]=q,$[1]=N,$[2]=h,this.fp(mg,o,$)},setCenter:function($,P,y){1===arguments.length&&(P=$[1],y=$[2],$=$[0]);var m=this._center;m[0]=$,m[1]=P,m[2]=y,this.fp(ak,o,m)},setUp:function(b,n,M){1===arguments.length&&(n=b[1],M=b[2],b=b[0]);var r=this._up;r[0]=b,r[1]=n,r[2]=M,this.fp("up",o,r)},getDevicePixelRatio:function(){return this._devicePixelRatio||tb},isTransparentMask:function(N){return N.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var q=this,J=q._aspect;return J?J:(J=q.getWidth()/q.getHeight(),J||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(O){var Q=this,z=Q._dataModel,J=Q._selectionModel;z!==O&&(z&&(z.ump(Q.handleDataModelPropertyChange,Q),z.umm(Q.handleDataModelChange,Q),z.umd(Q.handleDataPropertyChange,Q),J||z.sm().ums(Q.handleSelectionChange,Q)),Q._dataModel=O,O.mp(Q.handleDataModelPropertyChange,Q),O.mm(Q.handleDataModelChange,Q),O.md(Q.handleDataPropertyChange,Q),J?J._21I(O):O.sm().ms(Q.handleSelectionChange,Q),Q._postProcessing.handleDataModleChange(z,O),Q.invalidateAll(!0),Q.invalidateLight(),Q.fp(Ur,z,O),Q._canvas.style.background=O.getBackground()||"")},handleDataModelPropertyChange:function(T){if("background"===T.property){var J=this._canvas.style.background,c=T.newValue||"";this._canvas.style.background=c,this.fp("canvasBackground",J,c)}else"envmap"===T.property&&this.iv()},handleDataPropertyChange:function(Q){var R=Q.data;this.invalidateData(R),Hj(R)&&"s:light.type"===Q.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(s){var P=this,i=s.property;P.iv(),P._18Q=o,"eye"===i?P._33Q=!0:"devicePixelRatio"===i?P._42(o,P.getDevicePixelRatio()):Yp[i]&&Wp(P)},_5O:function(c){var M=c._22Q();return M?new M(this,c):o},getData3dUI:function(D){var $=this._25I[D._id];return $===C&&($=this._5O(D),this._25I[D._id]=$),$},invalidateAll:function(Q){var W=this;if(Q){for(var I in W._25I){var z=W._25I[I];z&&z.dispose()}W._25I={},W.iv(),ql(W)}else ql(W),W.dm().each(function(Y){W.invalidateData(Y)})},invalidateSelection:function(){var q=this;q.sm().each(function($){q.invalidateData($)})},invalidateData:function(I){var x=this,m=x.getData3dUI(I);m&&(m.iv(),x.iv()),ql(x,I)},getShape3dText:function(T){return T.getStyle("shape3d.text")||this.getLabel(T)},invalidateBatch:function(u){var i=this,_=i._batchModelMap,F=_[u],b=[],a={};if(F){F.ds.forEach(function(I){var k=i.getData3dUI(I);k&&k.iv(),delete i._batchIndexMap[I._id],b.push(I._id)}),delete _[u];for(var L,O,R,J,m,Y,g,I,X,n=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],e=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],H=0;H<n.length;H++){var y=i[n[H]],E=i[e[H]];for(a={},I=0;I<b.length;I++){var Q=E[b[I]];if(Q){delete E[b[I]],X=Q.batch,L=y[X];var f=Q.begin,W=Q.size,h=3*f,v=3*W,Z=4*f,M=4*W;for(O=L.ds,R=L.vs,J=L.cs,m=L.ps,Y=L.ls,g=Q.index,L.invalidate=!0,O[g]=C,g=h;h+v>g;g++)R[g]=C;for(g=Z;Z+M>g;g++)J[g]=C;for(g=Z;Z+M>g;g++)m[g]=C;if(Y)for(g=h;h+v>g;g++)Y[g]=C;a[X]=!0}}for(X in a){L=y[X],O=L.ds,R=L.vs,J=L.cs,m=L.ps,Y=L.ls;var t=[];for(g=0;g<O.length;g++)O[g]!==C&&t.push(O[g]);if(0===t.length)delete y[X];else{for(L.ds=t,t=[],g=0;g<R.length;g++)R[g]!==C&&t.push(R[g]);for(L.vs=t,t=[],g=0;g<J.length;g++)J[g]!==C&&t.push(J[g]);for(L.cs=t,t=[],g=0;g<m.length;g++)m[g]!==C&&t.push(m[g]);if(L.ps=t,Y){for(t=[],g=0;g<Y.length;g++)Y[g]!==C&&t.push(Y[g]);L.ls=t}}}}i.iv()}},handleDataModelChange:function(Y){var i=this,P=Y.kind,q=Y.data;if("add"===P)i.invalidateData(q),ps(q)&&q.getEdgeGroup()&&q.getEdgeGroup().eachSiblingEdge(i.invalidateData,i),Hj(q)&&i.invalidateLight();else if(P===nm){var C=q._id,t=i._25I[C];t&&(t.dispose(),delete i._25I[C],i.iv()),q===i._currentSubGraph&&i.setCurrentSubGraph(o),ql(i,q),Hj(q)&&i.invalidateLight()}else P===fq&&(i.invalidateAll(!0),i.setCurrentSubGraph(o),ql(i),i.invalidateLight())},toCanvas:function(p,H,M){var n=this,B=n.getGL();if(n.validate(),p){var s=B.getParameter(B.COLOR_CLEAR_VALUE);Oq(B,p)}n._42(o,1);var d=n.getWidth(),I=n.getHeight(),r=new Uint8Array(4*d*I),m=ep(),h=m.getContext("2d");B.readPixels(0,0,d,I,B.RGBA,B.UNSIGNED_BYTE,r),ol(m,d,I,1);for(var Q=h.getImageData(0,0,d,I),z=Q.data,W=0;W<z.length;W+=4){var Y=W/4,O=y(Y/d),K=Y-O*d;Y=4*((I-1-O)*d+K),z[Y]=r[W],z[Y+1]=r[W+1],z[Y+2]=r[W+2],z[Y+3]=r[W+3]}if(h.putImageData(Q,0,0),p&&Oq(B,s),n._42(o,n.getDevicePixelRatio()),H&&M){var f=ep(),V=f.getContext("2d");return H=H,M=M,ol(f,H,M,1),w.drawImage(V,m,0,0,H,M),f}return m},toDataURL:function(c,b){var U=this,H=U.getGL();if(U.validate(),c){var M=H.getParameter(H.COLOR_CLEAR_VALUE);Oq(H,c)}U._42(o,1);var Y=U._canvas.toDataURL(b||"image/png",1);return c&&Oq(H,M),U._42(o,U.getDevicePixelRatio()),Y},getGL:function(){var X=this._26I;if(X)return this.acquireProgram(),X;var W=this,E=W._canvas,x=W._attributes;try{X=E.getContext("webgl2",x)||E.getContext("experimental-webgl2",x),X&&(W._webGLVersion=2,W._26I=X)}catch(m){}if(!X)try{X=E.getContext("webgl",x)||E.getContext("experimental-webgl",x)}catch(m){throw new Error("WebGL not supported")}W._26I=X,W._2O={},X._emptyTexture=Bh(X),X._emptyBlendTexture=Bh(X),X._bufPool={},X._id=++Eo,W._buffer={vs:Cq(X),ns:Cq(X),is:Cq(X),uv:Cq(X),batchColor:Cq(X),batchBlend:Cq(X),batchBrightness:Cq(X),lineDistance:Cq(X)},W._1O=Sf(X);var I=W._cube={vs:Cq(X),ns:Cq(X),is:Cq(X),uv:Cq(X)};return Ab(X,I.vs,ee),Ab(X,I.ns,Mg),Ab(X,I.uv,Zh),xn(X,I.is,$m),W.acquireProgram(),X},acquireProgram:function(){var I=this,h=I._26I;if(h){var W=M.Default.getImage(I.dm().getEnvmap())?!0:!1,N=I._prg&&I._prg.envMapFlag?!0:!1;if(!I._prg||W!==N){var J=I._prg=h.createProgram();if(!J)return o;J.envMapFlag=W;var q=I._dirs.length,v=I._spots.length,E=I._59O.length,p=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];q&&p.push("uDirColor","uDirDirection"),v&&p.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),E&&p.push("uPointColor","uPointRange","uPointPosition"),Oq(h,[0,0,0,0]),h.clearDepth(1),h.enable(h.DEPTH_TEST),h.depthFunc(h.LEQUAL),h.enable(h.BLEND),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),fl||(ts=Mb(ts.substring(0,ts.indexOf("^#"))),Jh=Mb(Jh),fl=!0);var C=["#define MAX_DIR "+q,"#define MAX_SPOT "+v,"#define MAX_POINT "+E,I._fogDisabled?"":"#define FOG",I._dashDisabled?"":"#define DASH",W?"#define USE_ENVMAP":"",I.isOrtho()?"#define ORTHOGRAPHIC":"",I._batchColorDisabled?"":"#define BATCHCOLOR",I._batchBlendDisabled?"":"#define BATCHBLEND",I._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),S=Oe(h,J,h.VERTEX_SHADER,ts.replace("PREFIX",C));h.getShaderParameter(S,h.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",h.getShaderInfoLog(S));var A=Oe(h,J,h.FRAGMENT_SHADER,Jh.replace("PREFIX",C));h.getShaderParameter(A,h.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",h.getShaderInfoLog(A)),$?p.push("aPosition"):(J.aPosition=0,h.bindAttribLocation(J,0,"aPosition")),h.linkProgram(J),p.forEach(function(o){J[o]=/^u/.test(o)?h.getUniformLocation(J,o):h.getAttribLocation(J,o)}),h.useProgram(J),h.deleteShader(S),h.deleteShader(A)}}},getBrightness:function(w){var C=w.s("brightness"),i=this.isSelected(w)?w.s("select.brightness"):o;return C==o?i:i==o?C:C*i},setHighlightMode:function(v){var u;u="selection"===v?Tb.Mode.Selection:"mouseover"===v?Tb.Mode.MouseOver:Tb.Mode.Disable,this._highlightHelper.mode=u},getHighlightMode:function(){var b=this._highlightHelper.mode;return b===Tb.Mode.Selection?"selection":b===Tb.Mode.MouseOver?"mouseover":"disable"},bindEnvMap:function(Z){var s=this,B=s._prg,V=5,i=s.dm().getEnvmap(),W=M.Default.getImage(i);if(W){if(i!==s._lastEnvMap){s._envMapTexture&&Z.deleteTexture(s._envMapTexture);var T=s._envMapTexture=Z.createTexture();Z.bindTexture(Z.TEXTURE_CUBE_MAP,T),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,W),Z.bindTexture(Z.TEXTURE_CUBE_MAP,null),s._lastEnvMap=i}Z.activeTexture(Z.TEXTURE0+V),Z.bindTexture(Z.TEXTURE_CUBE_MAP,s._envMapTexture),Z.uniform1i(B.uEnvMap,V)}},getWireframe:function(y){var r=y.s("wf.visible"),K=y.s("wf.width");return r===!0||K>0&&"selected"===r&&this.isSelected(y)?{color:y.s("wf.color"),width:K,"short":y.s("wf.short"),mat:y.s("wf.mat")}:void 0},_transformPointToViewSpace:function(L){var R=[L[0],L[1],L[2]];return Hd(R,this._viewMatrix),R},_transformDirectionToViewSpace:function(u,Z){var w=[u[0],u[1],u[2]];Hd(w,this._viewMatrix);var t=Z?[Z[0],Z[1],Z[2]]:[0,0,0];Hd(t,this._viewMatrix);var s=t[0]-w[0],r=t[1]-w[1],x=t[2]-w[2],b=Math.sqrt(s*s+r*r+x*x);return b?[s/b,r/b,x/b]:[s,r,x]},getWireframeGeometry:function(v){return v.s("wf.geometry")?{color:v.s("wf.color"),width:v.s("wf.width"),mat:v.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(D){return D.s("body.color")},getMat:function(n){return n.getMat?n.getMat():n.s("mat")},getFaceMat:function(Z,w){return Z.getFaceMat?Z.getFaceMat(w):Z.s(w+".mat")},getFaceBlend:function(a,o){return a.s(o+".blend")||a.s("all.blend")},getFaceColor:function(J,B){return J.s(B+".color")||J.s("all.color")},getFaceImage:function(D,a){return D.s(a+".image")||D.s("all.image")},getFaceBlendImage:function(c,$){return c.s($+".blend.image")||c.s("all.blend.image")},getFaceDiscardSelectable:function(b,d){var n=b.s(d+".discard.selectable");return n==o?b.s("all.discard.selectable"):n},getFaceUv:function(E,x){return E.s(x+".uv")||E.s("all.uv")},getFaceUvOffset:function(R,L){return R.s(L+".uv.offset")||R.s("all.uv.offset")},getFaceUvScale:function(Q,w){return Q.s(w+".uv.scale")||Q.s("all.uv.scale")},getFaceLight:function(c,p){var A=c.s(p+".light");return A==o?c.s("all.light"):A},getFaceVisible:function(h,k){var a=h.s(k+".visible");return a==o?h.s("all.visible"):a},getFaceOpacity:function(F,E){var u=F.s(E+".opacity");return u==o?F.s("all.opacity"):u},getFaceTransparent:function(b,L){var m=b.s(L+".transparent");return m==o?b.s("all.transparent"):m},getFaceReverseColor:function(D,k){return D.s(k+".reverse.color")||D.s("all.reverse.color")},getFaceReverseFlip:function(w,y){var e=w.s(y+".reverse.flip");return e==o?w.s("all.reverse.flip"):e},getFaceReverseCull:function(N,Y){var x=N.s(Y+".reverse.cull");return x==o?N.s("all.reverse.cull"):x},getTextureMap:function(){return this._2O},deleteTexture:function(t){var o=this,m=o._2O[t];m&&(delete o._2O[t],o.getGL().deleteTexture(m))},invalidateShape3dCachedImage:function(m){var Q=this.getData3dUI(m);Q.invalidateCachedTexture(this.getGL())},isInteractive:function(D){return D.s("interactive")},getTexture:function(J,d){if(!J)return o;var i=this,Q=i.getGL(),X=i._2O[J];if(!X){var r=Wl(J);if(!r)return Q._emptyTexture;if(r.uuid||(r.uuid=M.Math.generateUUID()),r.tagName){if(r.dynamic)return Sf(Q,r,i._1O);X=i._2O[J]=Sf(Q,r)}else{var n,p=d&&d.s("shape3d.image.cache")&&!i.isInteractive(d),B=i.vr.isPresenting();if(B&&(d._textureUpdateFrame===Q._renderInfo.frame?p=!0:d._textureUpdateFrame=Q._renderInfo.frame),p&&(n=i.getData3dUI(d),X=n.getCachedTexture()),!X){if(p){if(Q._renderInfo.cacheTimeCost>w.graph3dMaxVectorCacheTime)return i.redraw(),Q._emptyTexture;if(!ec(r,d))return Q._emptyTexture}var U,e=d&&d.s("shape3d.fixSizeOnScreen"),Z=e?Q.NEAREST:Q.LINEAR;e||d&&d.s("shape3d.vector.dynamic")&&(n||(n=i.getData3dUI(d)),e=n.getVectorDynamicSize(),e&&(U=i.getDevicePixelRatio(),e[0]*=U,e[1]*=U));var N,R,k=d&&d.s("shape3d.texture.scale")||1;if(e?(U||(U=i.getDevicePixelRatio()),N=e[0]>0?e[0]:k*lj(r,d)*U,R=e[1]>0?e[1]:k*sr(r,d)*U):(N=k*lj(r,d),R=k*sr(r,d)),N>=1&&R>=1){var F=0;p&&(F=Date.now());var f=Kc(N,R);if(!n&&d&&(n=i.getData3dUI(d)),n&&n.interactiveInfo){var b=J;"object"==typeof b&&(b=b.uuid||(b.uuid=M.Math.generateUUID()));var q=n.interactiveInfo[b]={};f.interactiveInfo=q.bodyInfo={compInfos:[],matrix:new xc,rect:{x:0,y:0,width:N,height:R}}}Rm(f,r,0,0,N,R,d,i),f.interactiveInfo&&(f.interactiveInfo=null),f.restore(),p||B?(X=Sf(Q,_l,null,Z),n.setCachedTexture(X),Q._renderInfo.cacheTimeCost+=Date.now()-F,_l=null):X=Sf(Q,_l,i._1O,Z)}}}}return X},redraw:function(){this.iv()},validateImpl:function(){var G=this;if(G._lightChanged){G._lightChanged=!1;var Q=[],N=[],w=[];G.dm().each(function(Y){if(Hj(Y)){var V=Y.s("light.type");V===Bm?Q.push(Y):V===rm?N.push(Y):V===Co&&w.push(Y)}}),(Q.length!==G._59O.length||N.length!==G._spots.length||w.length!==G._dirs.length)&&Wp(G),G._59O=Q,G._spots=N,G._dirs=w}G._42(),G._1o.iv()},getRenderInfo:function(){var W=this.getGL();return W?W._renderInfo:void 0},getDebugTip:function(){var s=this,S=s.getRenderInfo();if(S){var Z=s.getGL()._validBufCount||0,E="Draw Calls: "+S.calls+"<br/>"+"Vertices: "+S.vertices+"<br/>"+"Faces: "+S.faces+"<br/>"+"Lines: "+S.lines+"<br/>"+"Buffer Count: "+Z;return s.vr.isPresenting()&&(E+="<br/>VR fps: "+s.vr.getFps()),E}},_42:function(g,d){var s=this;if(!s._35O&&(!Bq||Bo(Bq))){var t,L;g&&(g instanceof lf?L=g:t=g);var j=s._canvas,X=s.getGL(),m=s._prg;if(X){var a=s.getWidth(),B=s.getHeight();d?g||ol(j,a,B,d):(d=s.getDevicePixelRatio(),g||a===j.clientWidth&&B===j.clientHeight||ol(j,a,B,d)),X.clear(X.COLOR_BUFFER_BIT),s.drawFilter||(X._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:g?s._frameId:++s._frameId,cacheTimeCost:0});var v=function(){if(s.overlappingBox.clear(),s._81O=o,X.clear(X.DEPTH_BUFFER_BIT),lg(X,m.uBrightness,1),lg(X,m.uOpacity,1),lg(X,m.uPartOpacity,1),X._picking=!!g,lg(X,m.uPick,!!g),lg(X,m.uTexture,!1),lg(X,m.uBlendTexture,!1),lg(X,m.uAlphaTest,k.alphaTest),lg(X,m.uTransparent,!1),lg(X,m.uFix,!1),lg(X,m.uBatchColor,!1),lg(X,m.uBatchBlend,!1),lg(X,m.uBatchBrightness,!1),lg(X,m.uReflectivity,s._envmapReflectivity||.5),lg(X,m.uCameraPosition,s.getEye()),lg(X,m.uPMatrix,s._projectMatrix=xf(s)),lg(X,m.uViewMatrix,eq(s,s._7O)),s.bindEnvMap(X),s._viewMatrix=th(s._7O),g||(Sm(s,X,m),s._fogDisabled||(lg(X,m.uFogColor,s._fogColor),lg(X,m.uFogNear,s._fogNear),lg(X,m.uFogFar,s._fogFar))),Qd(X,m.aPosition),Qd(X,m.aNormal),Si(X,m.aUv),Si(X,m.aBatchColor),Si(X,m.aBatchBlend),Si(X,m.aBatchBrightness),Si(X,m.aLineDistance),L){var z=X.getParameter(X.COLOR_CLEAR_VALUE);X.clearColor(0,0,0,0),X.disable(X.BLEND),Si(X,m.aNormal),Ab(X,s._cube.vs,o,m.aPosition),xn(X,s._cube.is),Qi(L,s,de,0),Qi(L,s,Qm,6),Qi(L,s,rb,12),Qi(L,s,Zo,18),Qi(L,s,kl,24),Qi(L,s,uo,30),Qd(X,m.aNormal),Oq(X,z)}else if(t){t.value=2;var z=X.getParameter(X.COLOR_CLEAR_VALUE);X.clearColor(0,0,0,0),X.disable(X.BLEND),s._95I(X,m,t),Fg(s,t),Uf(s,s._polylineModelMap,t),Uf(s,s._wireframeModelMap,t),lg(X,m.uTransparent,!0),s._95I(X,m,t,!0),Fg(s,t,!0),Uf(s,s._polylineModelMap,t,!0),Uf(s,s._wireframeModelMap,t,!0),lg(X,m.uTransparent,!1),X.clear(X.DEPTH_BUFFER_BIT),s._swapLineMap(),s._95I(X,m,t,!1,!0),Uf(s,s._polylineModelMap,t),Uf(s,s._wireframeModelMap,t),s._swapLineMap(),s._swapLineMap(),s._95I(X,m,t,!1,!0),Uf(s,s._polylineModelMap,t),Uf(s,s._wireframeModelMap,t),lg(X,m.uTransparent,!0),s._95I(X,m,t,!0,!0),Uf(s,s._polylineModelMap,t,!0),Uf(s,s._wireframeModelMap,t,!0),lg(X,m.uTransparent,!1),s._swapLineMap(),X.disable(X.DEPTH_TEST),s.drawFilter||s._30O._42(X,m,t),X.enable(X.DEPTH_TEST),Oq(X,z)}else X.disable(X.BLEND),s.drawSky(X,m),s._31O._42(X,m),s._95I(X,m),Fg(s),Uf(s,s._polylineModelMap),Uf(s,s._wireframeModelMap),X.enable(X.BLEND),lg(X,m.uTransparent,!0),X.depthMask(!1),s._95I(X,m,o,!0),Fg(s,o,!0),Uf(s,s._polylineModelMap,o,!0),Uf(s,s._wireframeModelMap,o,!0),X.depthMask(!0),lg(X,m.uTransparent,!1),X.clear(X.DEPTH_BUFFER_BIT),s._swapLineMap(),X.disable(X.BLEND),s._95I(X,m,o,!1,!0),Uf(s,s._polylineModelMap),Uf(s,s._wireframeModelMap),X.enable(X.BLEND),lg(X,m.uTransparent,!0),X.depthMask(!1),s._95I(X,m,o,!0,!0),Uf(s,s._polylineModelMap,o,!0),Uf(s,s._wireframeModelMap,o,!0),X.depthMask(!0),lg(X,m.uTransparent,!1),s._swapLineMap(),X.disable(X.DEPTH_TEST),X.disable(X.BLEND),s._32O._42(X,m),s._30O._42(X,m),s._highlightHelper._42(X,m),X.enable(X.DEPTH_TEST);Ab(X,o),xn(X,o)},P=!1,R=a*d,K=B*d,U=s.vr;U.enable&&U._42(X,R,K,v)&&(P=!0);var G=s.envRenderer;G&&G.enable&&G._42(X,R,K,v)&&(P=!0);var f=s._postProcessing;f._42(X,R,K,v,g)&&(P=!0),P||(s.setViewport(X,0,0,a*d,B*d),v()),s._33Q=!1,s.drawFilter||s.countFrame(),s._doBufferGC(X)}}},enablePostProcessing:function(U,F){return this._postProcessing.enableModule(U,F)},getPostProcessingModule:function(y){return this._postProcessing.getModule(y)},setViewport:function(V,b,O,i,p){this._viewport=[b,O,i,p],V.viewport(b,O,i,p)},getViewport:function(){return this._viewport},setBufferGCInterval:function(l){this._bufferGCInterval=l},_doBufferGC:function(a,Q){var M,S,j=a._bufPool,o=0,w=0,L=a._renderInfo.frame,v=this._bufferGCInterval||10;for(M in j)o++,S=j[M],S&&(Q||L-S._fid>v?(a.deleteBuffer(S._buf),S._buf=null,j[M]=null):w++);if(o/2>w&&o>128){var C={};for(M in j)j[M]&&(C[M]=j[M]);a._bufPool=C}a._validBufCount=w},_swapLineMap:function(){var t=this;c=t._polylineModelMap,t._polylineModelMap=t._polylineModelMapSwap,t._polylineModelMapSwap=c,c=t._wireframeModelMap,t._wireframeModelMap=t._wireframeModelMapSwap,t._wireframeModelMapSwap=c,c=t._polylineIndexMap,t._polylineIndexMap=t._polylineIndexMapSwap,t._polylineIndexMapSwap=c,c=t._wireframeIndexMap,t._wireframeIndexMap=t._wireframeIndexMapSwap,t._wireframeIndexMapSwap=c},_updateSkyBox:function(Q){if(this._skyBox&&Q){var H=Q.property,f=!1,B=this._skyBox;if("eye"===H||"forceUpdate"===H){var k=this._eye;B.p3(k[0],k[1],k[2]),f=!0}if("near"===H||"far"===H||"forceUpdate"===H){var V=this._near,F=this._far,c=B.getFinalScale3d();if(c[0]/=2,c[1]/=2,c[2]/=2,c[0]<=V||c[0]>=F||c[1]<=V||c[1]>=F||c[2]<=V||c[2]>=F){var E=2*V*F/(V+F),r=Math.min(c[0],c[1],c[2]),I=E/r,s=B.getScale3d();B.setScale3d(s[0]*I,s[1]*I,s[2]*I),f=!0}}f&&this.invalidateData(B)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(c){var o=this._skyBox;o&&(this._skyBoxStyleMap&&o.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&o.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&o.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=c,this.ump(this._updateSkyBox,this),c&&(c.dm()&&c.dm().remove(c),this._skyBoxStyleMap=M.Default.clone(c.getStyleMap()),this._skyBoxAnchor3d=c.getAnchor3d(),c.setAnchor3d(.5,.5,.5),this._skyBoxP3=c.p3().slice(0),c.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",o,c)},drawSky:function(S,L,x){var C=this,l=C._skyBox;if(l){var K=C._headlightIntensity,M=Zk(C._headlightColor),L=C._prg;1!==K&&(M=[M[0]*K,M[1]*K,M[2]*K]),lg(S,L.uHeadlightColor,[M[0],M[1],M[2],1]);var o=C.getData3dUI(l);if(o){var Y,E=C.isOrtho();E&&(Y=C._projectMatrix,C.setOrtho(!1),lg(S,L.uPMatrix,C._projectMatrix=xf(C))),o._42(S,L,x,function(){return!0}),E&&(C.setOrtho(!0),lg(S,L.uPMatrix,C._projectMatrix=Y))}S.clear(S.DEPTH_BUFFER_BIT),lg(S,L.uHeadlightColor,[M[0],M[1],M[2],C._headlightDisabled?1:0])}},_95I:function(b,L,r,Z,M){function P(g){if(!!g.s("shape3d.alwaysOnTop")==!!M&&$.isVisible(g)&&(!B||U)){if(!r&&$.isTransparentMask(g))return;var Q=$.getData3dUI(g);Q&&Q._42(b,L,r,c)}}var $=this,c=function(G){return Z?G:!G};$.sky&&b.clear(b.DEPTH_BUFFER_BIT);var H=$.drawFilter;H?$.dm().each(function(I){H(I)||P(I)}):$.dm().each(function(i){P(i)})},getLogicalPoint:function(U){return xk(U,this._canvas)},isRectOverlapping:function(h){var a=this.getData3dUI(h);return a._rectOverlapping},getHitFaceInfo:function(R){R.target&&(R=this.lp(R));var c=this.getDataInfoAt(R);if(c){var n=this._1o.face(c.data,Jr(R.x,R.y));if(n)return{data:c.data,face:n}}return o},unproject:function(D,J){var R=this,W=R.getWidth(),$=R.getHeight(),S=D.target?R.lp(D):D,C=S.x-W/2,g=S.y-$/2,m=2*(C/W),F=2*(-1*g/$);J=J||0;var b=cj(),T=xf(R),k=eq(R);Fe(b,T,k),yf(b);var z=kj([m,F,J,1],b);return[z[0]/z[3],z[1]/z[3],z[2]/z[3]]},getDataAt:function(w){var C=this.getDataInfoAt(w);return C?C.data:o},getDataInfoAt:function(f,O){return f.target&&(f=this.lp(f)),this._1o.get(Jr(f.x,f.y,O),!0)},getDatasInRect:function($){return this._1o.get($)},setEditable:function(m){var r=this,L=r._editable;r._editable=m,this.fp(hn,L,m)},isEditable:function(f){var Y=this;return Y._editable?yr(f)?f.s("3d.editable")?Y._editableFunc?Y._editableFunc(f):!0:!1:!1:!1},isSelectable:function(V){return V.s("3d.selectable")&&this.sm().isSelectable(V)},isMovable:function(H){var r=this;return ps(H)&&H.getStyle(Xq)!==_g?!1:H.s("3d.movable")?r._movableFunc?r._movableFunc(H):!0:!1},isSizeEditable:function(H){return yr(H)?this._sizeEditableFunc?this._sizeEditableFunc(H):!0:!1},isRotationEditable:function(L){return yr(L)&&L.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(L):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(c){this.setZoom(Or,c)},zoomOut:function(H){this.setZoom(1/Or,H)},setZoom:function(O,H){if(1!==O){var S=this;if(S._ortho)return S.setOrthoZoom(O,H),void 0;S._14o&&S._14o.stop(!0);var y=1/O,K=S._eye,R=S._center,e=R[0]+(K[0]-R[0])*y-K[0],P=R[1]+(K[1]-R[1])*y-K[1],I=R[2]+(K[2]-R[2])*y-K[2];if(!($q(K,R)<S._moveStep&&1>y)){if(H=yo(H)){var i=mq(K);return H.action=function(R){S.fi({kind:S._zooming?"betweenZoom":"beginZoom"}),S._zooming=1,K[0]=i[0]+e*R,K[1]=i[1]+P*R,K[2]=i[2]+I*R,S.fp(mg,o,K)},H._37o=function(){delete S._14o,delete S._zooming,S.fi({kind:"endZoom"}),S.onZoomEnded()},S._14o=$h(H)}K[0]+=e,K[1]+=P,K[2]+=I,S.fp(mg,o,K)}}},setOrthoZoom:function(Q,W){if(1!==Q){var d=this;d._14o&&d._14o.stop(!0);var c=d._orthoWidth,z=c/Q-c;if(!(c<d._moveStep&&Q>1))return(W=yo(W))?(W.action=function($){d.fi({kind:d._zooming?"betweenZoom":"beginZoom"}),d._zooming=1,d.setOrthoWidth(c+z*$)},W._37o=function(){delete d._14o,delete d._zooming,d.fi({kind:"endZoom"}),d.onZoomEnded()},d._14o=$h(W)):(d.setOrthoWidth(c/Q),void 0)}},getPositionInfo:function(l){var y=this,V=y._eye,$=y._center,J=y.getAspect(),Y=l?Xm(jb($,V,!0),jb(l,V)):$q(V,$);if(y._ortho){var N=y._orthoWidth;return{length:Y,height:N/J,width:N}}var t=2*G(y._fovy/2)*Y;return{length:Y,height:t,width:t*J}},getCenterInfo:function(){var Q=this;return Q._81O||(Q._81O=Q.getPositionInfo()),mq(Q._81O)},rotate:function(b,V,K,j){var e=this;if(b||V){j==o&&(j=e._firstPersonMode),e._88O&&e._88O.stop(!0);var x=e._center,Z=e._eye,d=e.getCenterInfo().length,m=j?x:Z,v=j?Z:x,P=jb(m,v),I=h(P[0],P[2]),U=h(u(P[0]*P[0]+P[2]*P[2]),P[1]),p=j?ak:mg;return j&&(V=-V),(K=yo(K))?(K.action=function(R){e.fi({kind:e._rotating?"betweenRotate":"beginRotate"}),e._rotating=1;var J=I+b*R,O=U+V*R;O=En(O),P[0]=d*F(O)*F(J),P[1]=d*i(O),P[2]=d*F(O)*i(J),m[0]=v[0]+P[0],m[1]=v[1]+P[1],m[2]=v[2]+P[2],e.fp(p,o,m)},K._37o=function(){delete e._88O,delete e._rotating,e.fi({kind:"endRotate"}),e.onRotateEnded()},e._88O=$h(K)):(I+=b,U+=V,U=En(U),P[0]=d*F(U)*F(I),P[1]=d*i(U),P[2]=d*F(U)*i(I),m[0]=v[0]+P[0],m[1]=v[1]+P[1],m[2]=v[2]+P[2],e.fp(p,o,m),void 0)}},pan:function(L,i,J,T){if(L||i){var m=this;T==o&&(T=m._firstPersonMode),m._89O&&m._89O.stop(!0);var f=eq(m),l=[f[0]*L,f[4]*L,f[8]*L],j=[f[1]*i,f[5]*i,f[9]*i],Z=l[0]+j[0],h=l[1]+j[1],t=l[2]+j[2],B=m._center,U=m._eye;if(T){var R=ki(m.getBoundaries(),U[0],U[2],U[0]+Z,U[2]+t,u(Z*Z+t*t));Z=R[0],t=R[1]}if(J=yo(J)){var X=mq(U),I=mq(B);return J.action=function(L){m.fi({kind:m._panning?"betweenPan":"beginPan"}),m._panning=1,B[0]=I[0]+Z*L,B[1]=I[1]+h*L,B[2]=I[2]+t*L,U[0]=X[0]+Z*L,U[1]=X[1]+h*L,U[2]=X[2]+t*L,m.fp(mg,o,U),m.fp(ak,o,B)},J._37o=function(){delete m._89O,delete m._panning,m.fi({kind:"endPan"}),m.onPanEnded()},m._89O=$h(J)}B[0]+=Z,B[1]+=h,B[2]+=t,U[0]+=Z,U[1]+=h,U[2]+=t,m.fp(mg,o,U),m.fp(ak,o,B)}},walk:function(g,s,w){if(g){var k=this;w==o&&(w=k._firstPersonMode),k._90O&&k._90O.stop(!0);var t=k._center,I=k._eye,X=jb(t,I,!0);if(w){var l=ki(k.getBoundaries(),I[0],I[2],I[0]+X[0]*g,I[2]+X[2]*g,T(g));
if(g=$q(l),!g)return;X=[l[0]/g,0,l[1]/g]}if(s=yo(s)){var M=mq(I),N=mq(t);return s.action=function($){k.fi({kind:k._walking?"betweenWalk":"beginWalk"}),k._walking=1;var C=g*$;I[0]=M[0]+X[0]*C,I[1]=M[1]+X[1]*C,I[2]=M[2]+X[2]*C,t[0]=N[0]+X[0]*C,t[1]=N[1]+X[1]*C,t[2]=N[2]+X[2]*C,k.fp(mg,o,I),k.fp(ak,o,t)},s._37o=function(){delete k._90O,delete k._walking,k.fi({kind:"endWalk"}),k.onWalkEnded()},k._90O=$h(s)}I[0]+=X[0]*g,I[1]+=X[1]*g,I[2]+=X[2]*g,t[0]+=X[0]*g,t[1]+=X[1]*g,t[2]+=X[2]*g,k.fp(mg,o,I),k.fp(ak,o,t)}},handleScroll:function(i,W){i.preventDefault();var V=this,c=V._moveStep,K=V.getDataInfoAt(i);if(K){var A=K.data;if(A&&V.isInteractive(A)){var M=V.intersectObject(i,A);if(M){var e=M.part,X=Wl(A.s(e+".image")||A.s("shape3d."+e+".image")||A.s("all.image")||A.s("shape3d.image"));if(X&&Bs(X.scrollable,A,V))return}}}V.isFirstPersonMode()?V.isPannable()&&V.pan(0,W>0?c:-c):V.isZoomable()&&V.setZoom(0>W?1/al:al)},handlePinch:function(P,U){this.isZoomable()&&this.setZoom(U>P?1/Kl:Kl)},reset:function(){this.setCenter(w.graph3dViewCenter),this.setEye(w.graph3dViewEye),this.setUp(w.graph3dViewUp)},moveSelection:function(Y,e,R){var F=this;F.dm().beginTransaction(),Wj(this.sm().toSelection(this.isMovable,this),Y,e,R),F.dm().endTransaction()},getMoveMode:function(h,q){var i=q.s("3d.move.mode");if(i)return i;var T="88",U="89",P="90";return gb(h)||De[T]&&De[U]&&De[P]?"xyz":De[T]&&De[U]?"xy":De[T]&&De[P]?"xz":De[U]&&De[P]?"yz":De[T]?"x":De[U]?"y":De[P]?"z":"xz"},handleTick:function(){var U=this,A=!1,f=U._moveStep,e=f,o=!1,d=!0,I=U._rotateStep*(d?-1:1);if(U.isWalkable()||(e=0),U.isPannable()||(f=0),U.isRotatable()||(I=0),U._32Q){var $=(Pg()-U._32Q)/50;e*=$,f*=$,I*=$}U._31Q&&(Cs(U._31Q),delete U._31Q,delete U._32Q),zf()&&(A=!0,U.pan(-f,0,o,d)),Pq()&&(A=!0,U.pan(f,0,o,d)),Yl()&&(A=!0,gb()?U.pan(0,f,o,d):U.walk(e,o,d)),cp()&&(A=!0,gb()?U.pan(0,-f,o,d):U.walk(-e,o,d)),us()&&(A=!0,U.rotate(-I,0,o,d)),nq()&&(A=!0,U.rotate(I,0,o,d)),ni()&&(A=!0,U.rotate(0,-I/2,o,d)),Bd()&&(A=!0,U.rotate(0,I/2,o,d)),A&&(U._32Q=Pg(),U._31Q=Wn(U.handleTick,U))},handleKeyDown:function(s){var U=this;!tl(s)&&tp[s.keyCode]?U.handleTick():Fp(s)?U.selectAll():jp(s)?U.handleDelete(s):rp(s)&&this.isResettable()&&U.reset()},checkDoubleClickOnNote:function(S,F,N){var R=this;if(N===Fk){if(F.s("note.toggleable"))return F.s(If,!F.s(If)),R.fi({kind:"toggleNote",event:S,data:F,part:N}),!0}else if(N===Sn&&F.s("note2.toggleable"))return F.s(Vb,!F.s(Vb)),R.fi({kind:"toggleNote2",event:S,data:F,part:N}),!0;return!1},checkDoubleClickOnRotation:function(C,r,m){return m===hm?(r.setRotationX(0),!0):m===Dj?(r.setRotationY(0),!0):m===cr?(r.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(Y){var y=this;if(y.isOrtho())return y.getWidth()/y.getOrthoWidth();var d=y.getCenter(),O=y.getHeight(),E=y.getEye(),M=[d[0]-E[0],d[1]-E[1],d[2]-E[2]],t=[Y[0]-E[0],Y[1]-E[1],Y[2]-E[2]],r=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2]),N=1/Math.tan(y.getFovy()/2);return O*r*N/(t[0]*M[0]+t[1]*M[1]+t[2]*M[2])},inViewSpace:function(F){var g,l=this,n=l._transformPointToViewSpace(F),S=l.getAspect(),O=l.getNear(),U=l.getFar();return-n[2]<O||-n[2]>U?!1:l.isOrtho()?(g=l.getOrthoWidth()/2,Math.abs(n[0])<=g&&Math.abs(n[1]*S)<=g):(g=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])*Math.tan(l.getFovy()/2),Math.abs(n[1]<=g)&&Math.abs(n[0])<=g*S)},toViewPosition:function(Z){var X=this,U=X.getWidth()/2,C=X.getHeight()/2,w=X._18Q;return w&&w._wh===U/C||(w=xf(X),X._18Q=Fe(w,w,eq(X)),X._18Q._wh=U/C),Z=kj([Z[0],Z[1],Z[2],1],w),{x:U+U*Z[0]/Z[3],y:C-C*Z[1]/Z[3]}},getHitPosition:function(R,G,H){var n=this,$=n.getWidth(),z=n.getHeight(),h=R.target?n.lp(R):R,o=h.x-$/2,P=h.y-z/2,L=n.getCenterInfo(),u=eq(n);G=G?G:[0,0,0],H=H?H:[0,1,0],o=o/$*L.width,P=-1*P/z*L.height;var c=[u[0]*o,u[4]*o,u[8]*o],W=[u[1]*P,u[5]*P,u[9]*P],J=[c[0]+W[0],c[1]+W[1],c[2]+W[2]],d=n.getCenter(),r=_k(n,G,H,[J[0]+d[0],J[1]+d[1],J[2]+d[2]]);return r?r:[0,0,0]},intersectObject:function(o,A){return this._raycaster.intersectObject(o,A)},intersectObjects:function(A,D,y){return this._raycaster.intersectObjects(A,D,y)},getLineLength:function(e){this.validate();var U=this.getData3dUI(e);if(U&&U.getCache){var k=U.getCache();if(k)return k[k.length-1].length}return 0},getLineOffset:function(u,y){var C=this.getData3dUI(u);if(C&&C.getCache){var t=C.getCache();if(t)return rf(t,y)}return o},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(b,U,k){var c=this,A=c.getEye();A=[A[0],A[1],A[2]];var J=c.getCenter();if(J=[J[0],J[1],J[2]],b||(b=A),U||(U=J),c._flyAnim&&c._flyAnim.stop(!0),k=yo(k),!k)return c.setEye(b[0],b[1],b[2]),c.setCenter(U[0],U[1],U[2]),delete c._flyAnim,!0;var s=[b[0]-A[0],b[1]-A[1],b[2]-A[2]],R=[U[0]-J[0],U[1]-J[1],U[2]-J[2]];return k.action=function(Z){c.setCenter(J[0]+R[0]*Z,J[1]+R[1]*Z,J[2]+R[2]*Z),c.setEye(A[0]+s[0]*Z,A[1]+s[1]*Z,A[2]+s[2]*Z)},k._37o=function(){delete c._flyAnim},c._flyAnim=$h(k)},flyTo:function(){function $(F,o,p){if(p instanceof M.Node){v.fromArray(yj(p,o.getMat(p)));var B=p.getAnchor3d();F.push((new Tl).set(0-B.x,0-B.y,0-B.z).applyMatrix4(v)),F.push((new Tl).set(0-B.x,0-B.y,1-B.z).applyMatrix4(v)),F.push((new Tl).set(0-B.x,1-B.y,0-B.z).applyMatrix4(v)),F.push((new Tl).set(0-B.x,1-B.y,1-B.z).applyMatrix4(v)),F.push((new Tl).set(1-B.x,0-B.y,0-B.z).applyMatrix4(v)),F.push((new Tl).set(1-B.x,0-B.y,1-B.z).applyMatrix4(v)),F.push((new Tl).set(1-B.x,1-B.y,0-B.z).applyMatrix4(v)),F.push((new Tl).set(1-B.x,1-B.y,1-B.z).applyMatrix4(v))}}var J=new Tl,f=new Tl,o=new Tl,h=new Tl,v=new yi,c=new M.Math.Quaternion,Z=new $o;return function(W,q,P){var S=this;if(P!==C)q={animation:q,ratio:P};else{var b=typeof q;("boolean"===b||"object"===b&&q.duration)&&(q={animation:q})}q=q||{},J.fromArray(S.getEye()),f.fromArray(S.getCenter());var j,s,z=[],i=q.center,I=q.distance===C;if(i&&o.fromArray(i),W instanceof M.Node)i||o.fromArray(W.p3()),I&&($(z,S,W),j=z.length);else{if(W||(W=S.dm().getDatas()),!W.length)return;if((I||!i)&&(z=[],W.forEach(function(V){$(z,S,V)}),j=z.length),!j)return;if(!i){for(o.set(0,0,0),s=0;j>s;s++)o.add(z[s]);o.multiplyScalar(1/j)}}if(S.setCenter(o.x,o.y,o.z),h.subVectors(J,f),q.direction||q.worldDirection){!q.worldDirection&&W instanceof M.Node?c.setFromEuler(Z.set(W.r3(),W.getRotationMode(),!0)):c.set(0,0,0,1);var T=h.length();h.fromArray(q.worldDirection||q.direction).applyQuaternion(c).setLength(T)}if(I){for(var D,e,n,l,R,L=S.getNear(),r=10,P=q.ratio||.8;r--;){for(S._eye[0]=h.x+o.x,S._eye[1]=h.y+o.y,S._eye[2]=h.z+o.z,D=xf(S),Fe(D,D,eq(S)),l=!0,R=-1/0,s=0;j>s;s++){if(n=z[s],e=kj([n.x,n.y,n.z,1],D),e[3]<L&&r){h.multiplyScalar(2),l=!1;break}R=Math.max(R,Math.max(Math.abs(e[0]),Math.abs(e[1]))/P-e[3])}if(l)break}h.setLength(R+h.length()).add(o)}else h.setLength(q.distance).add(o);S._flyAnim&&S._flyAnim.stop(!0);var H=yo(q.animation);if(H){S.setEye(J.x,J.y,J.z),S.setCenter(f.x,f.y,f.z);var O=(new Tl).subVectors(h,J),u=(new Tl).subVectors(o,f),G=new Tl,t=new Tl;return H.action=function(_){G.copy(J).addScaledVector(O,_),t.copy(f).addScaledVector(u,_),S.setCenter(t.x,t.y,t.z),S.setEye(G.x,G.y,G.z)},H._37o=function(){delete S._flyAnim},{lastEye:J,lastCenter:f,eye:h,center:o,animation:S._flyAnim=$h(H)}}return S.setEye(h.x,h.y,h.z),delete S._flyAnim,{lastEye:J,lastCenter:f,eye:h,center:o}}}(),getBoundingBox:function(){function q(G,n,y){l.fromArray(yj(y,n.getMat(y)));var m=y.getAnchor3d();G.push((new Tl).set(0-m.x,0-m.y,0-m.z).applyMatrix4(l)),G.push((new Tl).set(0-m.x,0-m.y,1-m.z).applyMatrix4(l)),G.push((new Tl).set(0-m.x,1-m.y,0-m.z).applyMatrix4(l)),G.push((new Tl).set(0-m.x,1-m.y,1-m.z).applyMatrix4(l)),G.push((new Tl).set(1-m.x,0-m.y,0-m.z).applyMatrix4(l)),G.push((new Tl).set(1-m.x,0-m.y,1-m.z).applyMatrix4(l)),G.push((new Tl).set(1-m.x,1-m.y,0-m.z).applyMatrix4(l)),G.push((new Tl).set(1-m.x,1-m.y,1-m.z).applyMatrix4(l))}var l=new yi;return function(u){if(u=u||this.sm().getSelection(),u instanceof M.Node&&(u=[u]),0===u.length)return o;var P=[];u.forEach(function(x){q(P,this,x)},this);var w=[1/0,1/0,1/0],v=[-1/0,-1/0,-1/0];return P.forEach(function(l){w[0]=Math.min(l.x,w[0]),w[1]=Math.min(l.y,w[1]),w[2]=Math.min(l.z,w[2]),v[0]=Math.max(l.x,v[0]),v[1]=Math.max(l.y,v[1]),v[2]=Math.max(l.z,v[2])}),{min:w,max:v}}}()}),ye.RenderEnv=function(J){this.gv=J,this.enable=!1},v.defineProperties(ye.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(l){this._debugOn=l,this.capture&&this.capture()}}}),v.assign(ye.RenderEnv.prototype,{renderEnvToCube:function(O,V,D,A){var n=this,B=n.gv;if(!O||!V||!D)return n.enable=!1,n._42=null,void 0;n.enable=!0;var o=Math.floor(A/O*V),w=B.getGL(),x=n._renderTargets;x?x.length<D&&(x=n._renderTargets=x.concat(new Array(D-x.length))):x=n._renderTargets=new Array(D);for(var C=0;D>C;C++)x[C]?x[C].setSize(w,A,o):x[C]=new ye.RenderTarget(B,w,A,o);var W=!1;n.capture=function(){W=!0,B._42(),W=!1};var y=new Tl,f=new Tl,u=new Tl,F=new Tl,I=(new Tl).setY(0),l=2*Math.PI/D,J=O/2/Math.tan(Math.PI/D),b=2*Math.atan2(V/2,J),H=O/V;n._42=function(Y,i,E,G){var g=n._debugOn;if(!W&&!g)return!1;y.copy(B.getEye()),F.copy(B.getCenter()).sub(y);var p=Math.atan2(F.z,F.x),$=B.getNear(),d=B.getFovy(),R=B.getAspect();f.copy(B.getCenter());for(var K,M=0;D>M;M++)if(K=x[M],I.setZ(Math.cos(p)).setX(Math.sin(p)).multiplyScalar(J),p-=l,u.addVectors(y,I),B.setNear(J),B.setCenter([u.x,u.y,u.z]),B.setFovy(b),B.setAspect(H),g){var _=Math.round(i/D);Y.viewport(_*M,0,_,E),G()}else ko(Y,K.frame),Y.viewport(0,0,K.width,K.height),Y.clear(Y.COLOR_BUFFER_BIT),G(),Kd(Y),K.assureTexture();return B.setNear($),B.setCenter([f.x,f.y,f.z]),B.setFovy(d),B.setAspect(R),!0},n.capture()},getTextureInfo:function(o){var E=this._renderTargets;if(!E)return null;var e=this._renderTargets[o];return e?{index:o,texture:e.texture,textureName:e.uuid}:null}}),v.assign(ye.Graph3dView.prototype,{renderEnvToCube:function($,e,I,v){var h=this;h.envRenderer||(h.envRenderer=new ye.RenderEnv(h)),h.envRenderer.renderEnvToCube($,e,I,v)}}),ye.RenderTarget=function(Z,I,B,y,p){var o=this;p=p||{},p.samples=p.samples&&p.samples>1&&2===Z._webGLVersion?p.samples:C,o.options=p,o.uuid=M.Math.generateUUID(),o.gv=Z,o.init(Z,I,p),o.setSize(I,B,y)},v.assign(ye.RenderTarget.prototype,{bind:function(D){ko(D,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(A){Kd(A),this.options.samples&&(A.bindFramebuffer(A.READ_FRAMEBUFFER,this._MSAAFbo),A.bindFramebuffer(A.DRAW_FRAMEBUFFER,this.frame),A.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,A.COLOR_BUFFER_BIT,A.NEAREST))},init:function(T,E,g){var w=this,J=w.texture=E.createTexture();E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,J),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE);var P=g.samples,l=P?E.NEAREST:E.LINEAR;E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,g.minFilter||l),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,g.magFilter||l),E.bindTexture(E.TEXTURE_2D,null),w.render=E.createRenderbuffer(),w.frame=E.createFramebuffer(),P&&(w._MSAAFbo=E.createFramebuffer(),w._MSAARbO=E.createRenderbuffer()),T._2O[w.uuid]=J},assureTexture:function(){var O=this,q=O.uuid,t=O.gv._2O;t[q]||(t[q]=O.texture)},setSize:function(q,y,S){var Y=this;if(y&&S&&(Y.width!==y||Y.height!==S)){var J=q.RGBA,b=q.TEXTURE_2D,B=q.RENDERBUFFER,u=q.FRAMEBUFFER,W=Y.options.samples;jj(q,Y.texture),q.texImage2D(b,0,J,y,S,0,J,q.UNSIGNED_BYTE,o),q.bindRenderbuffer(B,Y.render),W?q.renderbufferStorageMultisample(B,W,q.DEPTH_COMPONENT16,y,S):q.renderbufferStorage(B,q.DEPTH_COMPONENT16,y,S),ko(q,Y.frame),q.framebufferTexture2D(u,q.COLOR_ATTACHMENT0,b,Y.texture,0),W||q.framebufferRenderbuffer(u,q.DEPTH_ATTACHMENT,B,Y.render),Kd(q),W&&(q.bindRenderbuffer(q.RENDERBUFFER,Y._MSAARbO),q.renderbufferStorageMultisample(q.RENDERBUFFER,W,q.RGBA8,y,S),ko(q,Y._MSAAFbo),q.framebufferRenderbuffer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.RENDERBUFFER,Y._MSAARbO),q.framebufferRenderbuffer(u,q.DEPTH_ATTACHMENT,B,Y.render),Kd(q)),jj(q,o),q.bindRenderbuffer(B,o),Y.width=y,Y.height=S}},toCanvas:function(){var o=this,f=o.gv.getGL();ko(f,o.frame);var h=o.width,E=o.height,k=new Uint8Array(4*h*E);f.readPixels(0,0,h,E,f.RGBA,f.UNSIGNED_BYTE,k),Kd(f);var R=V.createElement("canvas");R.width=h,R.height=E;var D=R.getContext("2d"),b=D.createImageData(h,E);return b.data.set(k),D.putImageData(b,0,0),R}});var Ec=ye.Interactor=function(c){this.gv=c};jd("Interactor",v,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var ah=ye.DefaultInteractor=function(P){ek(ah,this,[P])};jd("DefaultInteractor",Ec,{handle_contextmenu:function(t){Eb(t)},handle_mousewheel:function($){this.gv.handleScroll($,$.wheelDelta/40)},handle_DOMMouseScroll:function(_){2===_.axis&&this.gv.handleScroll(_,-_.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)},handle_mousedown:function(f){this.handle_touchstart(f)},handle_touchstart:function(r){Eb(r);var S=this,c=S.gv,s=oh(r),h=c.getDataInfoAt(r),W=h?h.data:o,w=h?h.part:o,j=c.sm(),L=$p(r),g=Am(r);c.setFocus(r)&&(S._62O=o,S._57I=o,W?tl(r)?j.co(W)?j.rs(W):j.as(W):j.co(W)||j.ss(W):s&&(tl(r)?c.isRectSelectable()&&(S._62O=od):S._57I=Qf(r)),S._31Q&&(Cs(S._31Q),delete S._31Q,delete S._32Q),S._62O||(c.isFirstPersonMode()&&(gb(r)||Hm(r)||g>2?S._62O="pan":c.isMouseRoamable()||Em?(S._62O="roaming",S.foward=L&&oh(r),S._32Q=Pg(),S._31Q=Wn(S.tick,S)):s||(S._62O="roaming")),S._62O||(s&&L&&No[w]?(S._62O=w,S.p3=W.p3()):s&&L&&yr(W)&&c.isSelected(W)?c.isMovable(W)?(S._62O="move",S.p3=W.p3(),S.movedata=W):c.isInteractive(W)&&(S._62O="none"):Em&&(g>2?S._62O="pan":2===g&&(S.dist=si(r),S._62O="pinch")))),S.point=c.lp(r),Fr(S,r),Gi(r)?c.handleDoubleClick(r,W,w):c.handleClick(r,W,w))},tick:function(){var s=this,o=s.gv,f=o._moveStep;s.point&&o.isWalkable()&&(s._32Q&&(f*=(Pg()-s._32Q)/50),o.walk(s.foward?f:-f),s._32Q=Pg(),s._31Q=Wn(s.tick,s))},handle_mouseup:function(x){this.handle_touchend(x)},handle_touchend:function(B){var x=this._57I;x&&($q(x,Qf(B))<=1&&this.gv.sm().cs(),this._57I=o)},handleWindowMouseMove:function(b){this.handleWindowTouchMove(b)},handleWindowTouchMove:function(R){var f,N,Z=this,i=Z.gv,_=Z._62O,A=Z.point,K=i.dm(),L=i.lp(R),d=L.x-A.x,F=L.y-A.y,B=i.getWidth(),G=i.getHeight();if(B&&G){var C=-g*d/B,W=-g*F/G;if("roaming"===_)Z.rotate(R,C/2,W/2);else if(_===hm||_===Dj||_===cr)i._86O||K.beginTransaction(),i.fi({kind:i._86O?"betweenEditRotation":"beginEditRotation",event:R}),i._86O=1,i.sm().each(function(f){if(yr(f)&&i.isRotationEditable(f)){var l=T(C)>T(W)?C:W;_===hm?f.setRotationX(f.getRotationX()+l):_===Dj?f.setRotationY(f.getRotationY()+l):_===cr&&f.setRotationZ(f.getRotationZ()+l)}});else if("move"===_||No[_]){_===Ap||_===Cr||_===zj?(i._87O||K.beginTransaction(),i.fi({kind:i._87O?"betweenEditScale":"beginEditScale",event:R}),i._87O=1):(i._moving||K.beginTransaction(),i.fi({kind:i._moving?"betweenMove":"beginMove",event:R}),i._moving=1);var b,O=Z.p3,x=i.getPositionInfo(O),w=eq(i);b=_===Ek?"x":_===Xl?"y":_===lp?"z":_===Ap?"sx":_===Cr?"sy":_===zj?"sz":i.getMoveMode(R,Z.movedata),d=d/B*x.width,F=-1*F/G*x.height;var U,r,p=[w[0]*d,w[4]*d,w[8]*d],I=[w[1]*F,w[5]*F,w[9]*F],t=p[0]+I[0],c=p[1]+I[1],m=p[2]+I[2],s=[O[0]+t,O[1]+c,O[2]+m],k=jb(i.getEye(),s,!0);if("xyz"===b?(U=s,i.moveSelection(t,c,m)):"xz"===b?(U=_k(i,O,[0,1,0],s),U&&i.moveSelection(U[0]-O[0],0,U[2]-O[2])):"xy"===b?(U=_k(i,O,[0,0,1],s),U&&i.moveSelection(U[0]-O[0],U[1]-O[1],0)):"yz"===b?(U=_k(i,O,[1,0,0],s),U&&i.moveSelection(0,U[1]-O[1],U[2]-O[2])):"x"===b||"sx"===b?(k[0]=0,U=_k(i,O,k,s),U&&(r=U[0]-O[0],"x"===b?i.moveSelection(r,0,0):i.sm().each(function(j){yr(j)&&i.isSizeEditable(j)&&(f=j.getScaleX()+r/100,N=f/j.getScaleX(),j.setScaleX(f),gb(R)&&(j.setScaleY(j.getScaleY()*N),j.setScaleTall(j.getScaleTall()*N)))}))):"y"===b||"sy"===b?(k[1]=0,U=_k(i,O,k,s),U&&(r=U[1]-O[1],"y"===b?i.moveSelection(0,r,0):i.sm().each(function(p){yr(p)&&i.isSizeEditable(p)&&(f=p.getScaleTall()+r/100,N=f/p.getScaleTall(),p.setScaleTall(f),gb(R)&&(p.setScaleY(p.getScaleY()*N),p.setScaleX(p.getScaleX()*N)))}))):("z"===b||"sz"===b)&&(k[2]=0,U=_k(i,O,k,s),U&&(r=U[2]-O[2],"z"===b?i.moveSelection(0,0,r):i.sm().each(function(I){yr(I)&&i.isSizeEditable(I)&&(f=I.getScaleY()+r/100,N=f/I.getScaleY(),I.setScaleY(f),gb(R)&&(I.setScaleX(I.getScaleX()*N),I.setScaleTall(I.getScaleTall()*N)))}))),!U)return;Z.p3=U}else if(_===od){var n=Z.div;n||(n=Z.div=tq(),ke(Z.getView(),n),n.op=A,n.style.background=i.getRectSelectBackground()),i.fi({kind:i._rectSelecting?"betweenRectSelect":"beginRectSelect",event:R}),i._rectSelecting=1,n.rect=nb(n.op,L),pq(n,n.rect)}else if("pinch"===_&&2===Am(R)){i.fi({kind:i._pinching?"betweenPinch":"beginPinch",event:R}),i._pinching=1;var r=si(R);i.handlePinch(r,Z.dist),Z.dist=r}else"pan"===_||gb(R)||Hm(R)?Z.pan(R,d,F):"none"===_||i.isFirstPersonMode()||(oh(R)?Z.rotate(R,C,W):(Z.pan(R,d,0),i.isWalkable()&&(i.fi({kind:i._walking?"betweenWalk":"beginWalk",event:R}),i._walking=1,i.walk(F/i.getHeight()*i.getCenterInfo().height))));Z.point=L}},pan:function(R,V,W){var m=this.gv;if(m.isPannable()){var u=m.getWidth(),U=m.getHeight();if(!u||!U)return;var s=m.getCenterInfo(),n=V/u*s.width,N=-1*W/U*s.height;m.fi({kind:m._panning?"betweenPan":"beginPan",event:R}),m._panning=1,m.pan(-n,-N)}},rotate:function(s,d,t){var w=this.gv;w.isRotatable()&&(w.fi({kind:w._rotating?"betweenRotate":"beginRotate",event:s}),w._rotating=1,w.rotate(d,t))},handleWindowMouseUp:function(X){this.handleWindowTouchEnd(X)},handleWindowTouchEnd:function(j){var G=this,O=G.gv,p=O.dm(),A=G.div;if(A){var Q=O.getDatasInRect(A.rect);if(!Q.isEmpty()){var E=O.sm(),i=E.toSelection();Q.each(function(R){E.co(R)?i.remove(R):i.add(R)}),E.ss(i)}Cc(A)}O._moving&&(delete O._moving,O.fi({kind:"endMove",event:j}),O.onMoveEnded(),p.endTransaction()),O._panning&&(delete O._panning,O.fi({kind:"endPan",event:j}),O.onPanEnded()),O._rotating&&(delete O._rotating,O.fi({kind:"endRotate",event:j}),O.onRotateEnded()),O._86O&&(delete O._86O,O.fi({kind:"endEditRotation",event:j}),p.endTransaction()),O._87O&&(delete O._87O,O.fi({kind:"endEditScale",event:j}),p.endTransaction()),O._pinching&&(delete O._pinching,O.fi({kind:"endPinch",event:j}),O.onPinchEnded()),O._rectSelecting&&(delete O._rectSelecting,O.fi({kind:"endRectSelect",event:j}),O.onRectSelectEnded()),O._walking&&(delete O._walking,O.fi({kind:"endWalk",event:j}),O.onWalkEnded()),G.dist=G.point=G._62O=G.p3=G.movedata=G.div=G._57I=G._32Q=G._31Q=G.foward=o}});var vm=ye.MapInteractor=function(M){ek(vm,this,[M]),this._minPhi=0,this._maxPhi=5*s/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right"};jd("MapInteractor",Ec,{handle_contextmenu:function(u){Eb(u)},handle_mousewheel:function($){this.gv.handleScroll($,$.wheelDelta/40)},handle_DOMMouseScroll:function(T){2===T.axis&&this.gv.handleScroll(T,-T.detail)},handle_keydown:function(T){this.gv.handleKeyDown(T)},handle_mousedown:function(z){this.handle_touchstart(z)},handle_touchstart:function(Z){Eb(Z);var N=this,D=N.gv;if(D.setFocus(Z)){D.lp(Z);var w=D.getDataInfoAt(Z),_=w?w.data:o,e=w?w.part:o;if(!_||!D.isInteractive(_)){var V=N.editing={point:D.lp(Z)};Em?V.touch=!0:(V.touch=!1,V.clickLeft=oh(Z),V.pan=Hm(Z)?!0:"left"===this.panButton===V.clickLeft),Fr(N,Z)}Gi(Z)?D.handleDoubleClick(Z,_,e):D.handleClick(Z,_,e)}},handle_mouseup:function(y){this.handle_touchend(y)},handle_touchend:function(){},handleWindowMouseMove:function(l){this.handleWindowTouchMove(l)},handleWindowTouchMove:function(d){var p=this,T=p.gv,J=p.editing;if(J){var y=T.lp(d),f=J.point,M=y.x-f.x,S=y.y-f.y;if(!J.moved){if(Math.abs(M)<p.threshold&&Math.abs(S)<p.threshold&&!(d.touches&&d.touches.length>1))return;J.moved=!0}if(J.point=y,J.touch){var _=d.touches.length;if(2!==_)p.pan(d,M,S);else{if(1>=_)return;var z=d.touches,w={x:z[0].clientX,y:z[0].clientY},H={x:z[1].clientX,y:z[1].clientY},n={x:H.x-w.x,y:H.y-w.y},R=J.lastCenter,D=Math.atan2(n.y,n.x),v=J.theta,O=0;v==o?v=J.theta=D:(O=D-v,J.thetaStarted||Math.abs(O)>p.touchRotateThreshold?(J.thetaStarted=!0,J.theta=D):O=0);var N=s*(w.y+H.y)/2/T.getHeight(),F=J.phi,W=0;F==o?F=J.phi=N:(W=N-F,J.phiStarted||Math.abs(W)>p.touchRotateThreshold?(J.phiStarted=!0,J.phi=N):W=0);var t,Q=Math.sqrt(n.x*n.x+n.y*n.y),C=J.vlen;if(C){var $=w.x-R.x,L=w.y-R.y,K=H.x-R.x,A=H.y-R.y,j=Math.sqrt($*$+L*L),i=Math.sqrt(K*K+A*A),m=C/2,G=p._sign2(j-m),q=p._sign2(i-m);0>G*q||0===G&&0===q?(t=1,J.vlen=Q):(t||(t=Q/C),J.scaleStarted||Math.abs(t-1)>p.touchScaleThreshold?(J.vlen=Q,J.scaleStarted=!0):t=1)}else C=J.vlen=Q,t=1;1!==t&&T.setZoom(t),(W||O)&&p.rotate(d,O,-W),J.lastCenter={x:(H.x+w.x)/2,y:(H.y+w.y)/2}}}else if(J.pan)p.pan(d,M,S);else{var x=T.getWidth(),u=T.getHeight();if(!x||!u)return;var b=-g*M/x,B=-g*S/u;p.rotate(d,b,B)}}},_sign2:function(i){return Math.abs(i)<this._touchScaleCheckAccuracy?0:i>0?1:-1},handleWindowMouseUp:function(R){this.handleWindowTouchEnd(R)},handleWindowTouchEnd:function(f){var $=this,x=$.editing;if($.editing=null,x){var s=$.gv;if(!x.moved&&x.clickLeft){var m=s.getDataAt(f);m?s.sm().setSelection([m]):s.sm().clearSelection()}else s._panning=null,s._rotating=null,s.fi({kind:x.pan?"endPan":"endRotate",event:f})}},pan:function(x,f,m){var G=this,T=G.gv;if(T.isPannable()){var j=T.getWidth(),i=T.getHeight();if(j&&i){var b=T.getCenterInfo(),R=-f/j*b.width,U=1*m/i*b.height;T.fi({kind:T._panning?"betweenPan":"beginPan",event:x}),T._panning=1;var O=G.keepHorizon,D=G.editing.touch;if((D&&x.touches&&x.touches.length>1||!D&&gb(x))&&(O=!O),!O)return T.pan(R,U);if(R||U){var Q=eq(T),t=[Q[0]*R,Q[4]*R,Q[8]*R],c=[Q[1],0,Q[9]],P=Math.sqrt(c[0]*c[0]+c[2]*c[2]);P&&(c=[c[0]/P*U,0,c[2]/P*U]);var H=t[0]+c[0],l=t[1]+c[1],Z=t[2]+c[2],L=T._center,K=T._eye;L[0]+=H,L[1]+=l,L[2]+=Z,K[0]+=H,K[1]+=l,K[2]+=Z,T.fp(mg,o,K),T.fp(ak,o,L)}}}},rotate:function(x,m,V){var $=this,c=$.gv;if(c.isRotatable()){var X=c._center,p=c._eye,A=jb(p,X),s=h(u(A[0]*A[0]+A[2]*A[2]),A[1]),w=s+V;w=Math.max($.minPhi,Math.min($.maxPhi,w)),V=w-s,c.fi({kind:c._rotating?"betweenRotate":"beginRotate",event:x}),c._rotating=1,c.rotate(m,V)}}}),v.defineProperties(vm.prototype,{panButton:{get:function(){return this._panButton},set:function(o){this._panButton=o}},minPhi:{get:function(){return this._minPhi},set:function(O){this._minPhi=O}},maxPhi:{get:function(){return this._maxPhi},set:function(t){this._maxPhi=t}},keepHorizon:{get:function(){return this._keepHorizon},set:function(M){this._keepHorizon=M}},threshold:{get:function(){return this._threshold},set:function(p){this._threshold=p}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(h){this._touchScaleThreshold=h}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(N){this._touchRotateThreshold=N}}});var Uj=function($){this.gv=$};_p(Uj,v,{_iv:!0,iv:function(){this._iv=!0},face:function(n,T){var _=this,x=_.gv.getGL();if(!x||!yr(n))return o;var v=T.x,N=T.width,b=T.height,C=_.height-T.y-b,c=y(N/2),D=new Uint8Array(4*N*b),G=0;for(_.iv(),_.validate(n),ko(x,_.frame),x.readPixels(v,C,N,b,x.RGBA,x.UNSIGNED_BYTE,D),Kd(x),_.iv();c>=G;G++)for(var t=c-G,j=c+G,Z=t;j>=Z;Z++)for(var f=t;j>=f;f++)if(Z===t||Z===j||f===t||f===j){var S=mr.m[D[4*(Z*N+f)]];if(S)return S}},get:function(t,p){this.validate();var m=this,h=m.gv.getGL();if(!h)return o;var n,b,l=t.x,W=t.width,O=t.height,H=m.height-t.y-O,F=y(W/2),R=new Uint8Array(4*W*O),v=0,Z=R.length,C=p?o:new Uh,I=p?o:{};if(ko(h,m.frame),h.readPixels(l,H,W,O,h.RGBA,h.UNSIGNED_BYTE,R),Kd(h),p){for(;F>=v;v++)for(var T=F-v,J=F+v,S=T;J>=S;S++)for(var B=T;J>=B;B++)if((S===T||S===J||B===T||B===J)&&(n=m.info(R,4*(S*W+B))))return n}else for(;Z>v;v+=4)n=m.info(R,v),n&&(b=n.data,I[b._id]||(C.add(b),I[b._id]=b));return C},info:function(w,N){return this.colorMap[(w[N]<<16)+(w[N+1]<<8)+w[N+2]+((127&w[N+3])<<24)]},validate:function(d){var A=this,i=A.gv,W=i.getGL();if(W){var $=i.getWidth(),f=i.getHeight(),z=W.RGBA,x=W.TEXTURE_2D,m=W.RENDERBUFFER,R=W.FRAMEBUFFER;A.texture||(A.texture=Sf(W),A.render=W.createRenderbuffer(),A.frame=W.createFramebuffer()),(A.width!==$||A.height!==f)&&(jj(W,A.texture),W.texImage2D(x,0,z,$,f,0,z,W.UNSIGNED_BYTE,o),ms(W,W.TEXTURE_MIN_FILTER,W.LINEAR),W.bindRenderbuffer(m,A.render),W.renderbufferStorage(m,W.DEPTH_COMPONENT16,$,f),ko(W,A.frame),W.framebufferTexture2D(R,W.COLOR_ATTACHMENT0,x,A.texture,0),W.framebufferRenderbuffer(R,W.DEPTH_ATTACHMENT,m,A.render),jj(W,o),W.bindRenderbuffer(m,o),Kd(W),A.width=$,A.height=f),A._iv&&(A._iv=!1,ko(W,A.frame),i._42(d||(A.colorMap={}),1),Kd(W))}}});var bb=function(u){this.gv=u};_p(bb,v,{gap:0,size:0,_42:function(M,O){var Q=this,$=Q.gv,P=$._gridGap,K=$._gridSize;if($._gridVisible){if(Q.gap!==P||Q.size!==K){for(var Y=[],C=$._gridSize/2,L=P*C,W=0;2*C+1>W;W++){var N=6*W,m=6*(2*C+1)+N;Y[N]=-L,Y[N+1]=0,Y[N+2]=-L+W*P,Y[N+3]=L,Y[N+4]=0,Y[N+5]=-L+W*P,Y[m]=-L+W*P,Y[m+1]=0,Y[m+2]=-L,Y[m+3]=-L+W*P,Y[m+4]=0,Y[m+5]=L}Q.vs=new sm(Y),Q.gap=P,Q.size=K}ns($),Fi(M,O),id(M),ai(M,O,1,$._gridColor,$._buffer.vs,Q.vs),xo(M,0,Q.vs.length/3,M.LINES),Ah(M),Bp(M,O)}else Q.vs=Q.gap=Q.size=o}});var Gc=function(W){this.gv=W};_p(Gc,v,{_42:function(E,M){var j=this.gv,Q=j._buffer.vs,X=j._axisXColor,e=j._axisYColor,z=j._axisZColor,v=j._originAxisVisible,h=j._centerAxisVisible;if(v||h){var i=$?E.TRIANGLES:E.TRIANGLE_FAN,P=E.LINES;if(ns(j),Fi(E,M),id(E),v){var R=j.getCenterInfo(),t=m(R.width,R.height)/5,l=.8*t,_=.05*t;ai(E,M,1.5,X,Q,new sm([0,0,0,t,0,0,l,_,0,l,0,_,l,-_,0,l,0,-_,l,_,0,0,0,0,0,t,0,_,l,0,0,l,_,-_,l,0,0,l,-_,_,l,0,0,0,0,0,0,t,_,0,l,0,_,l,-_,0,l,0,-_,l,_,0,l])),xo(E,0,2,P),xo(E,1,6,i),ai(E,M,o,e),xo(E,7,2,P),xo(E,8,6,i),ai(E,M,o,z),xo(E,14,2,P),xo(E,15,6,i)}if(h){var K=j._center,x=K[0],O=K[1],Y=K[2],R=j.getPositionInfo(K);t=m(R.width,R.height)/20,ai(E,M,1.5,X,Q,new sm([x,O,Y,x+t,O,Y,x,O,Y,x,O+t,Y,x,O,Y,x,O,Y+t])),xo(E,0,2,P),ai(E,M,o,e),xo(E,2,2,P),ai(E,M,o,z),xo(E,4,2,P)}Ah(E),Bp(E,M)}}});var Tb=function(X){this.gv=X,this.onMouseOver=this.onMouseOver.bind(this),this.mode=Tb.Mode.Disable};Tb.Mode={Disable:0,Selection:1,MouseOver:2},_p(Tb,v,{onMouseOver:function(U){w.preventDefault(U);var O=this.gv.getDataAt(U);O!==this.mouseOverData&&(this.mouseOverData=O,this.gv.iv())},setFetchTargetFunc:function(O){this.fetchTargetFunc=O},_42:function(I,V){var L,H=this,R=H._mode;if(R!==Tb.Mode.Disable&&(R===Tb.Mode.Selection?L=H.gv.sm().getSelection().toArray(function(O){return O.s("highlight.visible")}):R===Tb.Mode.MouseOver&&H.mouseOverData&&H.mouseOverData.s("highlight.visible")&&(L=[H.mouseOverData]),H.fetchTargetFunc&&(L=H.fetchTargetFunc(L)),L&&L.length)){var W=H.gv,Z=W.vr.isPresenting(),F=W.getWidth();if(Z){var g=W.getWidth;F/=2,W.getWidth=function(){return F};var z=W.getViewport()}var J,E=W.getDevicePixelRatio(),D=F*E,X=W.getHeight()*E;(J=H._renderTarget)?J.setSize(I,D,X):H._renderTarget=J=new ye.RenderTarget(W,I,D,X),ko(I,J.frame),W.drawFilter=function(E){return L.indexOf(E)<0?!0:void 0},W._42({}),W.drawFilter=null,Kd(I),Z&&(W.getWidth=g,W.setViewport(I,z[0],z[1],z[2],z[3])),H.shader||(H.shader=new ao.Shader(I,nh.vs,nh.fs));var p=H.shader;if(H.shader.bind(),I.enable(I.BLEND),I.activeTexture(I.TEXTURE0+0),I.bindTexture(I.TEXTURE_2D,J.texture),p.uniforms.image=0,p.uniforms.textureSize=[D,X],p.uniforms.edgeWidth=k["highlight.width"],H.highlightColor!==k["highlight.color"]){var M=Md(H.highlightColor=k["highlight.color"]);H.highlightColorData=[M[0]/255,M[1]/255,M[2]/255,M[3]/255]}p.uniforms.edgeColor=H.highlightColorData,H.ibuffer?(H.ibuffer.upload(),H.vbuffer.upload()):(H.ibuffer=ao.Buffer.createIndexBuffer(I,new Uint16Array([0,2,1,1,2,3])),H.vbuffer=ao.Buffer.createVertexBuffer(I,new Float32Array([0,0,1,0,0,1,1,1]))),p.attributes.pos.pointer(H.vbuffer),I.drawElements(I.TRIANGLES,6,I.UNSIGNED_SHORT,0),I.disable(I.BLEND),I.bindTexture(I.TEXTURE_2D,null),I.useProgram(V)}}}),v.defineProperties(Tb.prototype,{mode:{get:function(){return this._mode},set:function(n){var E=this._mode;n!==E&&(this._mode=n,n===Tb.Mode.MouseOver?this.gv.getView().addEventListener("mousemove",this.onMouseOver,!1):E===Tb.Mode.MouseOver&&this.gv.getView().removeEventListener("mousemove",this.onMouseOver))}}});var nh={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Oi=function(H){this.gv=H},Ek="edit_tx",Xl="edit_ty",lp="edit_tz",hm="edit_rx",Dj="edit_ry",cr="edit_rz",Ap="edit_sx",Cr="edit_sy",zj="edit_sz",No={};No[Ek]=1,No[Xl]=1,No[lp]=1,No[hm]=1,No[Dj]=1,No[cr]=1,No[Ap]=1,No[Cr]=1,No[zj]=1,_p(Oi,v,{_42:function(e,z,S){var O=this,C=O.gv,c=C.sm().ld();if(c&&C.isEditable(c)&&!C.isEditHelperDisabled()&&yr(c)&&(!C.isFirstPersonMode()||!C.isMouseRoamable()&&!Em)){ns(C);var I,T,r=C.isMovable(c),h=C.isRotationEditable(c),D=C.isSizeEditable(c),J=C._axisXColor,i=C._axisYColor,K=C._axisZColor,u=C._editSizeColor,P=c.p3(),A=$q(C.getEye(),P)/10,v=A/(S?5:10),l=.7*A,t=.4*l,H=P[0],q=P[1],o=P[2];I=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],r&&O._17O(e,z,c,S,Ek,J,I,[H,q-v,o,H+l,q-v,o,H+l,q,o,H+l,q,o,H,q,o,H,q-v,o,H,q-v,o+v,H+l,q-v,o+v,H+l,q-v,o,H+l,q-v,o,H,q-v,o,H,q-v,o+v]),T=H+l,D&&O._17O(e,z,c,S,Ap,u,I,[T,q-v,o,T+t,q-v,o,T+t,q,o,T+t,q,o,T,q,o,T,q-v,o,T,q-v,o+v,T+t,q-v,o+v,T+t,q-v,o,T+t,q-v,o,T,q-v,o,T,q-v,o+v]),T+=t,h&&O._17O(e,z,c,S,hm,J,I,[T,q-v,o,T+t,q-v,o,T+t,q,o,T+t,q,o,T,q,o,T,q-v,o,T,q-v,o+v,T+t,q-v,o+v,T+t,q-v,o,T+t,q-v,o,T,q-v,o,T,q-v,o+v]),I=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],r&&O._17O(e,z,c,S,Xl,i,I,[H,q,o,H,q+l,o,H-v,q+l,o,H-v,q+l,o,H-v,q,o,H,q,o,H,q,o,H,q,o-v,H,q+l,o-v,H,q+l,o-v,H,q+l,o,H,q,o]),T=q+l,D&&O._17O(e,z,c,S,Cr,u,I,[H,T,o,H,T+t,o,H-v,T+t,o,H-v,T+t,o,H-v,T,o,H,T,o,H,T,o,H,T,o-v,H,T+t,o-v,H,T+t,o-v,H,T+t,o,H,T,o]),T+=t,h&&O._17O(e,z,c,S,Dj,i,I,[H,T,o,H,T+t,o,H-v,T+t,o,H-v,T+t,o,H-v,T,o,H,T,o,H,T,o,H,T,o-v,H,T+t,o-v,H,T+t,o-v,H,T+t,o,H,T,o]),I=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],r&&O._17O(e,z,c,S,lp,K,I,[H,q,o,H,q,o+l,H,q-v,o+l,H,q-v,o+l,H,q-v,o,H,q,o,H,q-v,o,H-v,q-v,o,H-v,q-v,o+l,H-v,q-v,o+l,H,q-v,o+l,H,q-v,o]),T=o+l,D&&O._17O(e,z,c,S,zj,u,I,[H,q,T,H,q,T+t,H,q-v,T+t,H,q-v,T+t,H,q-v,T,H,q,T,H,q-v,T,H-v,q-v,T,H-v,q-v,T+t,H-v,q-v,T+t,H,q-v,T+t,H,q-v,T]),T+=t,h&&O._17O(e,z,c,S,cr,K,I,[H,q,T,H,q,T+t,H,q-v,T+t,H,q-v,T+t,H,q-v,T,H,q,T,H,q-v,T,H-v,q-v,T,H-v,q-v,T+t,H-v,q-v,T+t,H,q-v,T+t,H,q-v,T])}},_17O:function(f,i,B,F,H,j,P,V){var g=this.gv._buffer;ii(f,i,F,!0,B,H),iq(f,i,o,!0,o,!0,o,!1),lg(f,i.uDiffuse,j),Ab(f,g.vs,new sm(V),i.aPosition),Ab(f,g.ns,new sm(P),i.aNormal),id(f),xo(f,0,12),Ah(f),ac(f,i)}});var Ip=M.Raycaster=function($){this.gv=$,this.maxTriangleTest=1/0};Lj("Raycaster",v,{intersect:function(w){var v=this,C=v.gv,N=C.getDataAt(w);return N?v.intersectObject(w,N):null},intersectObjects:function(N,c,R){var G,A,K,Y,h=this,L=1/0,X=N.origin||(new Tl).fromArray(h.gv.getEye()),x=h.maxTriangleTest,q=[];return c.forEach(function(C){R&&R(C)===!1||C.s("intersect")!==!1&&q.push(C)}),q.sort(function(L,D){return X.distanceToSquared2(L.p3())-X.distanceToSquared2(D.p3())
}),h.countTriangles=0,q.forEach(function(k){h.countTriangles>x||(G=h.intersectObject(N,k),G&&(A=X.distanceToSquared(G.world),L>A&&(K=k,Y=G,L=A)))}),h.countTriangles=0,{data:K,intersect:Y}},intersectObject:function(d,J){if(d instanceof Tk)return this._intersectObjectImpl(d,J);var i,C,X=this,k=X.gv;C=k.unproject(d);var O=k.getEye();k.isOrtho()?(i=jb(k.getCenter(),O),i[0]+=i[0],i[1]+=i[1],i[2]+=i[2]):i=O,i=new Tl(i);var t=new Tl(C).sub(i).normalize(),r=new M.Math.Ray(i,t);return X._intersectObjectImpl(r,J)},_intersectObjectImpl:function(){function l(){var c=new Tl;return c.subVectors(g,B),C.subVectors(t,B),c.cross(C).normalize(),c}function O(T,l,z,Q,f,Z,S){return xg.barycoordFromPoint(T,l,z,Q,v),f.multiplyScalar(v.x),Z.multiplyScalar(v.y),S.multiplyScalar(v.z),f.add(Z).add(S),f.clone()}var i=new yi,c=new yi,u=new Tk,N=new Tl,K=new Tl,o=new Tl,A=new Tl,X=new Tl,t=new Tl,B=new Tl,g=new Tl,f=new Ym,n=new Ym,h=new Ym,C=new Tl,S={vs:ee,is:$m,uv:Zh},v=new Tl;return function(d,W){var C=this.gv.getData3dUI(W),T=W.mat||C.mat;if(T){i.fromArray(T),c.getInverse(i),u.copy(d).applyMatrix4(c);var Y,U,x="body",J=C.shapeModel;if(J||(J=po(C)),J||(W instanceof M.Node&&!(W instanceof M.Shape)?(Y=!0,J=S):(U=!0,J=[C.left,C.front,C.right,C.back,C.top,C.bottom])),!J)return console.log("Can not find shape model."),null;Ef(J)||(J=[J]);var b,a,G,q,Z,H,z,D,E,P,p,r,_,j,F,I,R=1/0,Q=["","top_","bottom_"],k=!1;for(b=0,a=J.length;a>b;b++)if(_=J[b])for(G=0,q=Q.length;q>G;G++)if(j=Q[G],z=_[j+"vs"],D=_[j+"is"],E=_[j+"uv"]||_[j+"tuv"],z){if(F=_[j+"boundingBox"]){var p=u.intersectBox(F);if(!p)continue;if(u.origin.distanceTo(p)>R)continue;I=!1}else _[j+"boundingBox"]=F=new M.Math.Box3,I=!0;for(Z=0,H=D?D.length:z.length/3;H>Z;Z+=3)this.countTriangles++,D?(K.fromArray(z,3*D[Z]),o.fromArray(z,3*D[Z+1]),A.fromArray(z,3*D[Z+2])):(K.fromArray(z,3*Z),o.fromArray(z,3*(Z+1)),A.fromArray(z,3*(Z+2))),I&&(F.expandByPoint(K),F.expandByPoint(o),F.expandByPoint(A)),P=u.intersectTriangle(K,o,A,!0,N),P&&(r=u.origin.distanceTo(P),R>r&&(R=r,X.copy(P),t.copy(K),B.copy(o),g.copy(A),""!==j?x=j.slice(0,-1):Y?x=_j[Math.floor(Z/6)]:U&&(x=_j[b]),E&&(k=!0,D?(f.fromArray(E,2*D[Z]),n.fromArray(E,2*D[Z+1]),h.fromArray(E,2*D[Z+2])):(f.fromArray(E,2*Z),n.fromArray(E,2*(Z+1)),h.fromArray(E,2*(Z+2))))))}if(!isFinite(R))return null;var L,v=X.clone().applyMatrix4(i);k&&(L=O(X,t,B,g,f,n,h));var V=l(t,B,g),m=l(t.applyMatrix4(i),B.applyMatrix4(i),g.applyMatrix4(i)),s=u.direction.dot(V);return s>0&&(V.multiplyScalar(-1),m.multiplyScalar(-1)),{world:v,local:X.clone(),worldNormal:m,normal:V,uv:L,part:x}}}}()});var Pd=function(k,R){this.gv=k,this.s=function(g,X,J){return X==o&&(X=J),X==o?R.getStyle(g):Bs(X,R,k)},this.data=R};_p(Pd,v,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(a,e,O,E){var y=this,_=y.data;if(!(_ instanceof Uk)){var u,n,r,T,J,s,d,S=y.gv,b=_._id,Z=y.s("shape3d.alwaysOnTop")?null:y.s("batch"),t=S._batchIndexMap,R=S._batchModelMap,N=S.isSelectable(_),f=S.getBrightness(_),l=f!=o&&1!==f;if(y.needValidate(a)){if(r=hs(t,R,_,Z),y.validate(r,Z?Al[Z]||xd:o),r&&(T=t[b],J=T.size=r.vs.length/3-T.begin,d=r.rs))for(f=l?f:1,s=0;J>s;s++)d.push(f);if(yr(_)){var B=S.getWireframeGeometry(_);if(B)dc(S,_,B);else{var g=S.getWireframe(_);g&&dc(S,_,g)}}y.labelInfo=y.label2Info=y.noteInfo=y.note2Info=y._38o=o,y._24O(uq,"getLabel"),y._24O(qm,"getLabel2"),y._26O(Fk,"getNote"),y._26O(Sn,"getNote2"),y._15O(),y.interactiveInfo=S.isInteractive(_)?{}:o,y._iv=!1}l&&lg(a,e.uBrightness,f),lg(a,e.uAlphaTest,y.s("alphaTest")),lg(a,e.uUseEnvMap,_.s("envmap")?!0:!1),lg(a,e.uReflectivity,_.s("envmap")||.01),n=ii(a,e,O,N,_,pd),n&&(Xi(n,t[b],R),Xi(n,S._polylineIndexMap[b],S._polylineModelMap),Xi(n,S._wireframeIndexMap[b],S._wireframeModelMap)),t[b]||y._80o(a,e,E),S.isLabelVisible(_)&&((u=y.labelInfo)&&(ii(a,e,O,N,_,uq),y._28O(u,uq,E)),(u=y.label2Info)&&(ii(a,e,O,N,_,qm),y._28O(u,qm,E))),S.isNoteVisible(_)&&((u=y.noteInfo)&&(ii(a,e,O,N,_,Fk),y._29O(u,Fk,E)),(u=y.note2Info)&&(ii(a,e,O,N,_,Sn),y._29O(u,Sn,E))),(u=y._38o)&&y._99O(a,e,u,O,N,E),l&&lg(a,e.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return sc},_80o:function(){},dispose:function(){},_calcAnchorMat:function(Z){if(Z.hasOwnProperty("_anchor")||Z.hasOwnProperty("_anchorElevation")){var N=Z.getAnchor3d(),e={x:N.x-.5,y:N.y-.5,z:N.z-.5},k=cj();return Pr(k,[-e.x,-e.y,-e.z]),k}},getBodyColor:function(w){var G=this.data,s=this.gv.getBodyColor(G);return s?s:w?G.getStyle(w):o},_24O:function(N,R){var E=this,M=E.data,X=E.gv,H=E.s,z=X[R](M);if(z!=o){var u=H(N+".scale"),K=H(N+".max"),q=E[N+"Info"]={label:z,textureScale:H(N+".texture.scale"),color:X[R+"Color"](M),font:H(N+".font"),align:H(N+".align"),background:X[R+"Background"](M)},r=q.rect=_r(q,z);K>0&&K<r.width&&(q.labelWidth=r.width,r.width=K),r.x=r.y=0,r.width*=u,r.height*=u,q.mat=E._16O(H(N+".autorotate"),H(N+".position"),r,H(N+".face"),H(N+".t3"),H(N+".r3"),H(N+".rotationMode"));var T=r.width/2,w=r.height/2;q.vs=new sm([-T,w,0,-T,-w,0,T,-w,0,T,w,0]),r.width/=u,r.height/=u}},_26O:function(y,f){var C=this,Q=C.data,a=C.gv,m=C.s,l=a[f](Q);if(l!=o){var i=m(y+".scale"),A=this[y+"Info"]={note:l,textureScale:m(y+".texture.scale"),expanded:m(y+".expanded"),font:m(y+".font"),color:m(y+".color"),align:m(y+".align"),borderWidth:m(y+".border.width"),borderColor:m(y+".border.color"),background:a[f+"Background"](Q)};if(A.expanded){var S=m(y+".max"),P=_r(A,l);P.width+=6,P.height+=2,S>0&&S<P.width&&(A.labelWidth=P.width,P.width=S);var Z={x:-P.width/2,y:-8-P.height,width:P.width,height:P.height+8}}else Z={x:-6,y:-18,width:12,height:18};A.mat=C._16O(m(y+".autorotate"),m(y+".position"),o,m(y+".face"),m(y+".t3"),m(y+".r3"),m(y+".rotationMode")),A.rect=Z,1!==i&&(Z=mq(Z),Z.x*=i,Z.height*=i,Z.y=-Z.height,Z.width*=i);var s=Z.x,B=Z.y,D=Z.width,I=Z.height;A.vs=new sm([s,-B,0,s,-B-I,0,s+D,-B-I,0,s+D,-B,0])}},_28O:function(v,o,_){if(_(this.s(o+".transparent"))){var O=v.rect,c=v.textureScale,N=O.width*c,A=O.height*c;if(N>=1&&A>=1){var M=Kc(N,A);1!==c&&(M.translate(M,O.x,O.y),M.scale(c,c),M.translate(M,-O.x,-O.y)),Xh(M,v),M.restore(),wl(this,o,v.mat,v.vs,!0)}}},_29O:function(s,z,f){if(f(this.s(z+".transparent"))){var B=s.rect,X=s.textureScale,P=B.x,y=B.y,p=B.width*X,D=B.height*X;if(p>=1&&D>=1){B.x=B.y=0;var Q=Kc(p,D);1!==X&&Q.scale(X,X),$d(Q,s),Q.restore(),B.x=P,B.y=y,wl(this,z,s.mat,s.vs,!1)}}},_99O:function(C,E,i,W,w,X){if(i){var x=this,V=x.gv,H=x.data,B=V._buffer,L=V._1O,T=i.icons;for(var v in T){var y=T[v],$=i.rects[v];if($&&X(Bs(y.transparent,H,V))){ii(C,E,W,w,H,v);var j=Bs(y.shape3d,H,V),t=j?[j]:Bs(y.names,H,V),Z=t?t.length:0,F=Bs(y.textureScale,H,V)||1,R=Bs(y.light,H,V);R==o&&(R=j?!0:!1),iq(C,E,Bs(y.blend,H,V),R,Bs(y.opacity,H,V),Bs(y.reverseFlip,H,V),Bs(y.reverseColor,H,V),Bs(y.reverseCull,H,V));for(var h=0;Z>h;h++){var a=t[h],G=$[h];if(Tn(x,G.mat),j)om(V,H,po(x,j),x);else{var c=Wl(a);if(c){var O=G.width*F,e=G.height*F;if(O>=1&&e>=1){var k=Kc(O,e);im(k,c,Bs(y.stretch,H,V),0,0,O,e,H,V),k.restore(),Sf(C,_l,L),id(C,E,L,Bs(y.discardSelectable,H,V),B.uv,tf),Ab(C,B.vs,G.vs,E.aPosition),Aq(C,B.ns,tn,E.aNormal),Mo(C,B.is,xm),vk(C,0,xm.length),Ah(C,E,L)}}}yb(V)}ac(C,E)}}}}});var Gj=function(c,i){ek(Gj,this,[c,i])};_p(Gj,Pd,{_16O:function(D,_,f,b,C,e,y,u,v){var o=this.data,i=o.getFinalScale3d(),S=le(_,i,f,b,u,v);if(o.hasOwnProperty("_anchor")||o.hasOwnProperty("_anchorElevation")){var t=o.getAnchor3d();S[0]-=(t.x-.5)*i[0],S[1]-=(t.y-.5)*i[1],S[2]-=(t.z-.5)*i[2]}return an(cj(),S,o.p3(),b,C,e,y,D,o.getFinalRotation3d(),o.getRotationMode())},clear:function(){var c=this;c.faceMat=c.mat=c.shapeModel=c.left=c.right=c.front=c.back=c.top=c.bottom=c.csg=o},needValidate:function(X){if(this._iv)return this._validateFrameId=X._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var O=X._renderInfo.frame;if(this._validateFrameId!==O)return this._validateFrameId=O,!0}return!1},validate:function(s,K){var g=this,j=g.gv,T=g.data,h=g.shapeName=g.s(pi),J=po(g,h);g._updateAutoRotation(),g._updateFixSize2d(),g._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(as(j,T,"_wireframeModelMap","_wireframeIndexMap"),as(j,T,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var A=yj(T,j.getMat(T),J?g.s("shape3d.scaleable"):!0),V=g._calcAnchorMat(T);if(V&&Fe(A,A,V),T.mat=A,g.clear(),J||!h)if(s){var t=[];J?fh(j,T,J,g,g.getBodyColor(),[A],s,t):(ik(j,T,s,K,A,de,t,di),ik(j,T,s,K,A,rb,t,To),ik(j,T,s,K,A,kl,t,jm),ik(j,T,s,K,A,uo,t,dq),ik(j,T,s,K,A,Qm,t,ig),ik(j,T,s,K,A,Zo,t,ve)),t.length&&(hh(s.vs,t),hh(s.ns,Jd(t)))}else g.mat=A,(g.shapeModel=J)||(g._cubeUvs=null,g.vf(de,0),g.vf(rb,16),g.vf(Qm,8),g.vf(Zo,24),g.vf(kl,32),g.vf(uo,40))},_updateAutoRotation:function(){var Y=new $o;return function(){var p=this,E=p.data,H=p.s("shape3d.autorotate");if(!H)return E._dynamicRotation&&delete E._dynamicRotation,void 0;var y,t=p.gv;y="string"==typeof H?[H.indexOf("x")<0?t._eye[0]:t._center[0],H.indexOf("y")<0?t._eye[1]:t._center[1],H.indexOf("z")<0?t._eye[2]:t._center[2]]:t._eye;var W=t._center,Z=E.p3(),i=zq([Z[0]+y[0]-W[0],Z[1]+y[1]-W[1],Z[2]+y[2]-W[2]],Z,t._up);Y.set(0,0,0,E.getRotationMode(),!0).setFromRotationMatrix(i);var C=E._dynamicRotation;C&&Math.abs(C[0]-Y.x)<1e-5&&Math.abs(C[1]-Y.y)<1e-5&&Math.abs(C[2]-Y.z)<1e-5||(E._dynamicRotation=[Y.x,Y.y,Y.z])}}(),_updateFixSize2d:function(){var G=this,T=G.data,B=G.s("shape3d.fixSizeOnScreen");if(!B)return T._dynamicScale3d&&delete T._dynamicScale3d,void 0;var b=G.gv;T.getFinalScale3d();var R=yj(T,b.getMat(T)),s=Hd([0,0,0],R),p=b.toViewPosition(s);if(!isNaN(p.x)&&!isNaN(p.y)){var D=Hd([1,0,0],R),i=b.toViewPosition(D),u=Hd([0,1,0],R),y=b.toViewPosition(u),t=i.x-p.x,q=y.y-p.y;if(t&&q){var F=T._dynamicScale3d||[1,1,1],h=Wl(T.s("shape3d.image")),r=B[0]>0?B[0]:h?lj(h,T):20,M=B[1]>0?B[1]:h?sr(h,T):20,W=Math.abs(t/r),w=Math.abs(q/M);Math.abs(W-1)<.001&&Math.abs(w-1)<.001||(T._dynamicScale3d=[F[0]/W,F[1]/w,F[2]])}}},_updateOverlapping:function(){var r=this,u=r.s("hide.overlapping.group");if(!u)return r._rectOverlapping&&(r._rectOverlapping=C),void 0;var H,b,P,v=r.gv,p=r.data,g=yj(p,v.getMat(p)),n=1/0,k=1/0,O=-1/0,q=-1/0,X=p.getAnchor3d(),V=X.x,R=X.y,J=X.z;for(H=0;8>H;H++){if(b=Hd([(H>>2)-V,(1&H>>1)-R,(1&H)-J],g),P=v.toViewPosition(b),isNaN(P.x)||isNaN(P.y))return;n=Math.min(n,P.x),O=Math.max(O,P.x),k=Math.min(k,P.y),q=Math.max(q,P.y)}var m={x:n,y:k,w:O-n,h:q-k};r._rectOverlapping=v.overlappingBox.isOverlapping(u,m)},getVectorDynamicSize:function(){var E,$=this,c=$.s("shape3d"),s=$.data;if("billboard"===c||"plane"===c||(E=s._currentCubeElementId)!=o){var G,V,p=$.gv,n=yj(s,p.getMat(s)),A=s.getAnchor3d(),h=.5-A.x,U=.5-A.y,u=.5-A.z,b=$.s("shape3d.vector.dynamic.maxsize"),W=function(s,z){s[0]+=h,s[1]+=U,s[2]+=u,z[0]+=h,z[1]+=U,z[2]+=u;var r=p.toViewPosition(Hd(s,n)),T=p.toViewPosition(Hd(z,n)),A=r.x-T.x,N=r.y-T.y;return Math.min(b,Math.sqrt(A*A+N*N))};if("billboard"===c)G=W([-.5,0,0],[.5,0,0]),V=W([0,-.5,0],[0,.5,0]);else if("plane"===c)G=W([-.5,0,0],[.5,0,0]),V=W([0,0,-.5],[0,0,.5]);else if(s._currentCubeElementId!=o){var g=3*$m[E+1],i=3*$m[E],f=3*$m[E+2];G=W([ee[g],ee[g+1],ee[g+2]],[ee[f],ee[f+1],ee[f+2]]),V=W([ee[g],ee[g+1],ee[g+2]],[ee[i],ee[i+1],ee[i+2]])}return[G,V]}},getCachedTexture:function(){var i=this,p=i.data,T=p._currentCubeElementId;return T!=o?i._cubeCachedImage?i._cubeCachedImage[T]:null:i._shape3dCachedImage},setCachedTexture:function(Z){var l=this,T=l.data,B=T._currentCubeElementId;B!=o?(l._cubeCachedImage||(l._cubeCachedImage={}),l._cubeCachedImage[B]=Z):l._shape3dCachedImage=Z},invalidateCachedTexture:function(C){var J,A,v,U=this;if((v=U._shape3dCachedImage)&&(C.deleteTexture(v),U._shape3dCachedImage=null),A=U._cubeCachedImage){for(J in A)C.deleteTexture(A[J]);U._cubeCachedImage=null}},vf:function(V,e){var A=this;if(A.gv.getFaceVisible(A.data,V)){var b=vj(A,V);b.mat&&(A.faceMat=!0);var I=b.uv;if(I){var B=A._cubeUvs;B||(B=A._cubeUvs=new sm([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var G=0;8>G;G++)B[e+G]=I[G]}return b}},_80o:function(z,N,i){var V=this;if(V._rectOverlapping)return!0;var D=V.shapeModel;if(D||!V.shapeName){var r=V.gv,g=V.data,h=r._cube;ns(r,V.mat),D?om(r,g,D,V,V.getBodyColor(),i):(Ab(z,h.vs,o,N.aPosition),Ab(z,h.ns,o,N.aNormal),xn(z,h.is),V._18O(z,N,V.left,0,i),V._18O(z,N,V.front,6,i),V._18O(z,N,V.right,12,i),V._18O(z,N,V.back,18,i),V._18O(z,N,V.top,24,i),V._18O(z,N,V.bottom,30,i)),yb(r),V.faceMat&&(V._18O(z,N,V.left,0,i,!0),V._18O(z,N,V.front,6,i,!0),V._18O(z,N,V.right,12,i,!0),V._18O(z,N,V.back,18,i,!0),V._18O(z,N,V.top,24,i,!0),V._18O(z,N,V.bottom,30,i,!0))}},_18O:function(S,H,b,_,L,A){if(b){if(!L(b.transparent))return;if(A&&!b.mat||!A&&b.mat)return;var K=this.data.s("polygonOffset");K&&hj(S,K),A&&ns(this.gv,b.mat);var P=this,y=P.data;y._currentCubeElementId=_;var s=P.gv,W=s.getTexture(b.texture,y),t=b.uv,V=b.uvScale,f=b.uvOffset,g=b.discardSelectable;W?t?id(S,H,W,g,s._buffer.uv,P._cubeUvs,f,V):id(S,H,W,g,s._cube.uv,o,f,V):id(S),iq(S,H,b.blend,b.light,b.opacity,b.reverseFlip,b.reverseColor,b.reverseCull),lg(S,H.uDiffuse,b.color||k["color.empty"]),vk(S,_,6),ac(S,H),Ah(S,H,W),A&&yb(s),K&&Wi(S),y._currentCubeElementId=null}}});var fc=function(i,m){ek(fc,this,[i,m])};_p(fc,Pd,{_25Q:1,validate:function(h){var H=this,S=H.gv,s=H.data,A=H.s,J=A("edge.width"),C=s._40I,t=s._41I;if(H.shapeModel=H.info=o,C&&t){var B,x,k,n,E,l,i,O,P,F,X=s.isLooped(),a=A(Xq),z=w.getEdgeType(a);if(z){var G=z(s,Sk(H,S,s,X,a),S,H._19Q);if(!G.points||G.points.isEmpty())return;l=H.info={},i=G.segments,E=G.points,O=E.size();for(var $=C.getElevation(),U=t.getElevation(),K=0;O>K;K++){var I=E.get(K);I.e==o&&(I.e=$+(U-$)*K/(O-1))}P=Og(E.get(0)),F=Og(E.get(O-1));var D=O%2;0===D?(l.c1=Og(E.get(O/2-1)),l.c2=Og(E.get(O/2))):l.p3=Og(E.get((O-D)/2)),l.s1=P,l.s2=Og(E.get(1)),l.t1=Og(E.get(O-2)),l.t2=F}else{E=new Uh,l=H.info={};var Q=A("edge.offset"),e=A("edge.center"),r=A("edge.source.t3"),v=A("edge.target.t3"),M=C.p3(),y=t.p3();if(r&&(M[0]+=r[0],M[1]+=r[1],M[2]+=r[2]),v&&(y[0]+=v[0],y[1]+=v[1],y[2]+=v[2]),a===_g){i=A("edge.segments");var R=l.points=A(to)||Oo;if(O=R.size()){P=Og(R.get(0)),F=Og(R.get(O-1)),!e&&Q&&(k=jb(P,M,!0),Q=m(Q,$q(M,P)),M=[M[0]+k[0]*Q,M[1]+k[1]*Q,M[2]+k[2]*Q],k=jb(y,F,!0),Q=m(Q,$q(F,y)),y=[y[0]-k[0]*Q,y[1]-k[1]*Q,y[2]-k[2]*Q]);var D=O%2;0===D?(B=Og(R.get(O/2-1)),x=Og(R.get(O/2))):l.p3=Og(R.get((O-D)/2)),l.s1=M,l.s2=P,l.t1=F,l.t2=y}else!e&&Q&&(k=jb(y,M,!0),n=$q(M,y),Q=gq(Q,n),M=[M[0]+k[0]*Q,M[1]+k[1]*Q,M[2]+k[2]*Q],y=[y[0]-k[0]*Q,y[1]-k[1]*Q,y[2]-k[2]*Q]),B=M,x=y;E.add({x:M[0],y:M[2],e:M[1]}),E.addAll(R),E.add({x:y[0],y:y[2],e:y[1]})}else{var N=Sk(H,S,s,X,a);if(H._19Q||(N=-N),X){var T=M[0],b=M[1],q=M[2],W=C.getTall()/2+N;B=[T-N,b+W,q],x=[T+N,b+W,q],E.add({x:T-N,y:q,e:b}),E.add({x:T-N,y:q,e:b+W}),E.add({x:T+N,y:q,e:b+W}),E.add({x:T+N,y:q,e:b})}else{k=jb(y,M,!0),n=$q(M,y);var j={x:M[0],y:M[2]},p={x:y[0],y:y[2]},f=Ch(o,j,p,N),d=f.x-j.x,u=f.y-j.y;Q=gq(Q,n),k[0]*=Q,k[1]*=Q,k[2]*=Q,B=[M[0]+k[0]+d,M[1]+k[1],M[2]+k[2]+u],x=[y[0]-k[0]+d,y[1]-k[1],y[2]-k[2]+u],e?(E.add({x:M[0],y:M[2],e:M[1]}),E.add({x:B[0],y:B[2],e:B[1]}),E.add({x:x[0],y:x[2],e:x[1]}),E.add({x:y[0],y:y[2],e:y[1]})):(E.add({x:B[0],y:B[2],e:B[1]}),E.add({x:x[0],y:x[2],e:x[1]}))}}l.c1=B,l.c2=x}l.list=A(pi)===vg?H.createTubeModel(E,i,J/2,h):H.createLineModel(E,i,J,"edge","edge.dash")}}});var Rn=function(e,U){ek(Rn,this,[e,U])};_p(Rn,Gj,{_80o:function(l,G,X){var c=this,x=c.gv,v=c.shapeModel;ns(x,c.mat),v?om(x,c.data,v,c,c.getBodyColor(),X):(jn(c,l,G,c.left,X),jn(c,l,G,c.front,X),jn(c,l,G,c.right,X),jn(c,l,G,c.back,X),jn(c,l,G,c.top,X),jn(c,l,G,c.bottom,X)),yb(x)},validate:function(s,F){var O,J,Z=this,R=Z.s,V=Z.data,Q=V.p3(),x=V._thickness/2,T=V.isClosePath(),m=V.getPoints(),u=V.getSegments(),X=R(kp),c=s&&s.uv;if(Z.clear(),0>x)J=Z.shapeModel=qi(m,u,R(kg),R(Ck),X,R(Nn),V.getTall(),V.getShapeElevation(),T),R(Jf)?R("shape3d.image")||delete J.uv:(delete J.vs,delete J.ns,delete J.uv),R("shape3d.top.image")||delete J.top_uv,R("shape3d.bottom.image")||delete J.bottom_uv;else if(R(pi)===vg)O=we(m,u,X,T),J=Z.shapeModel={vs:[]},R("shape3d.image")&&(J.uv=[],J.sum=R(Nn)||cb(O)||1,J.len=0),R(kg)&&!T&&(J.top_vs=[],R("shape3d.top.image")&&(J.top_uv=[])),R(Ck)&&!T&&(J.bottom_vs=[],R("shape3d.bottom.image")&&(J.bottom_uv=[])),Z._12O(O,x);else{var h,l,I,b,K,k,q,W,D,w;if(O=we(m,u,X,T),K=Z.vf(Qm,c,!1,F),x&&(k=Z.vf(Zo,c,!1,F),q=T?o:Z.vf(de,c,!1,F),W=T?o:Z.vf(rb,c,!1,F),D=Z.vf(kl,c,!1,F),w=Z.vf(uo,c,!1,F)),x){for(var N=0,p=O.length;p>N;N++)O[N]=Z._tryRemoveBezierPoints(O[N],x);Z._12O(O,x)}else K&&O.forEach(function(B){if(b=B.length,b>0)for(h=B[0],I=1;b>I;I++)l=B[I],Z.addV(K.vs,h,l),h=l});Z._20Q(O),s||(K&&(K.ns=Jd(K.vs),hf(K,"vs"),hf(K,Sg)),x&&(k&&(k.ns=Jd(k.vs),hf(k,"vs"),hf(k,Sg)),q&&(q.ns=Jd(q.vs),hf(q,"vs"),hf(q,Sg)),W&&(W.ns=Jd(W.vs),hf(W,"vs"),hf(W,Sg)),D&&(D.ns=Jd(D.vs),hf(D,"vs"),hf(D,Sg)),w&&(w.ns=Jd(w.vs),hf(w,"vs"),hf(w,Sg))))}var g=Z.mat=cj();Pr(g,Q),Ji(g,V.getFinalRotation3d(),V.getRotationMode());var E=V.getScale3d(),z=V._dynamicScale3d;z&&(E[0]*=z[0],E[1]*=z[1],E[2]*=z[2]),$k(g,E),Pr(g,Km(Q)),s&&(Jc(Z,g,s,J),Z.clear())},_20Q:function($){var V,m,v,h,u,F,N,K=this,c=K.front,f=K.back,r=K.top,E=K.bottom,s=c?c.tuv:o,D=f?f.tuv:o,i=r?r.tuv:o,t=E?E.tuv:o,B=0;(s||D||i||t)&&(V=K.s(Nn)||cb($)||1,$.forEach(function(s){if(m=s.length,m>0)for(F=s[0],v=1;m>v;v++)N=s[v],h=B/V,B+=$q(F,N),u=B/V,K._14O(c,h,u),K._14O(f,1-u,1-h),K._14O(r,h,u),K._14O(E,h,u),F=N}))},_14O:function(Y,D,v){if(Y){var o=Y.uv,A=Y.tuv;if(A){if(o)var I=o[0]+(o[6]-o[0])*D,l=o[1]+(o[7]-o[1])*D,F=o[2]+(o[4]-o[2])*D,t=o[3]+(o[5]-o[3])*D,B=o[2]+(o[4]-o[2])*v,g=o[3]+(o[5]-o[3])*v,h=o[0]+(o[6]-o[0])*v,m=o[1]+(o[7]-o[1])*v;else I=D,l=0,F=D,t=1,B=v,g=1,h=v,m=0;A.push(F,t,B,g,h,m,h,m,I,l,F,t)}}},_13O:function(S){var H=S.uv,J=S.tuv;J&&(H?J.push(H[2],H[3],H[4],H[5],H[6],H[7],H[6],H[7],H[0],H[1],H[2],H[3]):J.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function($,Y){var C=$.length;if(4>C)return $;var X,U,j,W,T,R,K=!1,m=function(e){return $[e]},y=function(y){return $[C-1-y]};for(T=0;1>=T;T++)for(R=T?y:m,U=R(0),j=R(1),X=2;C-1>X;X++)if(W=R(X),!W.remove)if(W.b){var v=Ch(U,j,W,Y);v.adjust?(W.remove=!0,K=!0):(U=j,j=W)}else U=j,j=W;if(!K)return $;var o=[];for(X=0;C>X;X++)$[X].remove||o.push($[X]);return o},_12O:function(t,A){var j,g,M,r,u,E=this;t.forEach(function($){if(u=$.length,u>0)for(j={p:$[0],n:!0},r=1;u>r;r++)g=$[r],M=u-1>r?$[r+1]:o,E.addPoint(j,g,M,A,$)})},addPoint:function(p,t,K,_,e){var h,I,P,m,C,n,$,H,f,k=this,V=p.p,F=p.f,S=p.b,G=k.s("shape3d.side")||bj,Y=k.s("shape3d.start.angle"),D=k.s("shape3d.sweep.angle"),X=k.shapeModel,W=k.data.isClosePath();if(p.n&&(p.n=!1,F=W&&e.length>2?Ch(e[e.length-2],V,t,_):Ch(o,V,t,_),S=Ih(V,F),X?X.top_vs&&k._10O(S,F,G,Y,D,X.top_vs,X.top_uv):(h=k.left)&&(k.addV(h.vs,S,F),k._13O(h))),I=K?Ch(V,t,K,_):W&&e.length>2?Ch(V,t,e[1],_):Ch(V,t,o,_),P=Ih(t,I),X){var T,b,A=X.vs,O=X.uv,r=X.sum;for(O&&(T=X.len/r,X.len+=$q(V,t),b=X.len/r),n=k._9O(S,F,G,Y,D),$=k._9O(P,I,G,Y,D),H=0;G>H;H++)f=H+1,hh(A,n[f]),hh(A,$[H]),hh(A,n[H]),hh(A,$[H]),hh(A,n[f]),hh(A,$[f]),O&&(m=H/G,C=f/G,O.push(T,C,b,m,T,m,b,m,T,C,b,C));!K&&X.bottom_vs&&k._10O(P,I,G,Y,D,X.bottom_vs,X.bottom_uv,!0)}else!K&&(h=k.right)&&(k.addV(h.vs,I,P),k._13O(h)),(h=k.front)&&k.addV(h.vs,F,I),(h=k.back)&&k.addV(h.vs,P,S),(h=k.top)&&k.addH(h.vs,F,I,P,S,!0),(h=k.bottom)&&k.addH(h.vs,S,P,I,F);p.p=t,p.f=I,p.b=P},_10O:function(q,L,Y,r,W,o,l,t){var z,C,m=this,X=m.data,w=m._9O(q,L,Y,r,W),d=(q.x+L.x)/2,x=(q.y+L.y)/2,e=X.getShapeElevation(),j=0;for(j=0;Y>j;j++)t?(hh(o,w[j]),hh(o,w[j+1])):(hh(o,w[j+1]),hh(o,w[j])),hh(o,[d,e,x]),l&&(t?(z=g*(j+1)/Y+r,C=g*j/Y+r):(z=g*j/Y+r,C=g*(j+1)/Y+r),l.push(.5-.5*i(C),.5-.5*F(C),.5-.5*i(z),.5-.5*F(z),.5,.5))},_9O:function(l,J,C,E,f){var a,K,B=this,v=B.data,w=[],V=(l.x+J.x)/2,O=(l.y+J.y)/2,r=v.getTall()/2,P=v.getShapeElevation(),M=0;for(f=f||g;C>=M;M++)a=f*M/C+E,K=i(a),w.push([V+(l.x-V)*K,P+r*F(a),O+(l.y-O)*K]);return w},addV:function(P,Y,O){var $=Y.x,X=Y.y,u=O.x,x=O.y,c=this.data,a=c.getShapeElevation(),p=c.getTall()/2;P.push($,a-p,X,u,a-p,x,u,a+p,x,u,a+p,x,$,a+p,X,$,a-p,X)},addH:function(M,L,_,B,w,O){var h=this.data,f=h.getTall()/2,u=h.getShapeElevation()+(O?f:-f);M.push(L.x,u,L.y,_.x,u,_.y,B.x,u,B.y,B.x,u,B.y,w.x,u,w.y,L.x,u,L.y)},vf:function(v,t,M,m){var V,K=this,n=K.gv.getFaceVisible(K.data,v);return(M||n)&&(V=vj(K,v,m),V.vs=[],V.tuv=n&&(V.texture||t)?[]:o,V.visible=n),V}});var zb=function(U,V){ek(zb,this,[U,V])};_p(zb,Pd,{_25Q:1,validate:function(w){var A=this,p=A.data,Z=A.s,U=p.getPoints(),r=U.size();if(A.shapeModel=A.info=o,r>1){var h=A.info={},x=p.getSegments(),q=p.getThickness(),s=Og(U.get(0)),T=Og(U.get(r-1)),G=r%2;0===G?(h.c1=Og(U.get(r/2-1)),h.c2=Og(U.get(r/2))):h.p3=Og(U.get((r-G)/2)),h.s1=s,h.s2=Og(U.get(1)),h.t1=Og(U.get(r-2)),h.t2=T,h.list=Z(pi)===vg?A.createTubeModel(U,x,q/2,w):A.createLineModel(U,x,q,"shape.border","shape.dash")}var v=p.p3(),L=A.mat=cj();Pr(L,v),Ji(L,p.getFinalRotation3d(),p.getRotationMode());var z=p.getScale3d(),n=p._dynamicScale3d;n&&(z[0]*=n[0],z[1]*=n[1],z[2]*=n[2]),$k(L,z),Pr(L,Km(v))},_80o:function(X,o,x){var e=this,K=e.shapeModel;if(K){var U=e.gv;ns(U,e.mat),om(U,e.data,K,e,e.getBodyColor(),x),yb(U)}}});var en=M.graph3d.VR=function(I){var G=this;G.gv=I,G._controllers=[],G.switch=new Io(G),G._enable=!1,G._defaultCallLater=M.Default.callLater,G._defaultCancelLater=Cs,"undefined"!=typeof P&&"VRFrameData"in P&&(G._frameData=new P.VRFrameData),G.measureOflength=1,G.eyesOffset=[0,0,0],G._orientation=new M.Math.Quaternion,G._lastHeadPose=[0,0,0],G._offsetToBeAdd=[0,0,0],G._fpsInfo={time:0,fps:0,frames:0}};_p(en,v,{ms_fire:!0,_42:function(g,y,z,_){var E=this,$=E.gv;if(!$.drawFilter&&E._deviceInAction){var V=E._device;if(V){var H=E._measureOflength;V.depthNear=$.getNear()*H,V.depthFar=$.getFar()*H;var B=E._offsetToBeAdd;if(E.eyesOffset[0]+=B[0],E.eyesOffset[1]+=B[1],E.eyesOffset[2]+=B[2],B[0]=0,B[1]=0,B[2]=0,V.isPresenting===!1)return E._controllers.forEach(function(k){k&&k.update()}),$.iv(),!1;var b=E._frameData;V.getFrameData(b);var S=b.pose.position;if(S){var w=E.toViewPosition(S);$.setEye(w),E._orientation.fromArray(b.pose.orientation);var j=new M.Math.Vector3(0,0,-10*E._scaleFactor);j.applyQuaternion(E._orientation),$.setCenter([w[0]+j.x,w[1]+j.y,w[2]+j.z])}E._controllers.forEach(function(O){O&&O.update()}),$.setViewport(g,0,0,y/2,z),E._viewMatrix=E._copyViewMatrix(b.leftViewMatrix),E._projectMatrix=E._copyProjectMatrix(b.leftProjectionMatrix),_(),$.setViewport(g,y/2,0,y/2,z),E._viewMatrix=E._copyViewMatrix(b.rightViewMatrix),E._projectMatrix=E._copyProjectMatrix(b.rightProjectionMatrix),_(),E._lastViewMatrix=E._viewMatrix,E._lastProjectMatrix=E._projectMatrix,E._viewMatrix=null,E._projectMatrix=null,E.submitFrame();var A=Date.now(),L=E._fpsInfo;return A-L.time>1e3?(L.fps=Math.round(1e3*(L.frames+1)/(A-L.time)),L.time=A,L.frames=0):L.frames++,!0}}},onVRDisplayPresentChange:function(){var b=this.isPresenting();this._injectGraphView(b),this.fp("present",!b,b)},getOrientation:function(){return this._orientation},addController:function(w){w=w||0;var z=this,Y=z.getController(w);return Y?Y:(Y=new fs(z,w),z._controllers.push(Y),Y)},getController:function(L){L=L||0;for(var Z=this._controllers,l=0,e=Z.length;e>l;l++)if(Z[l]&&Z[l].id===L)return Z[l];return null},removeController:function(b){b=b||0;for(var q=this._controllers,c=0,n=q.length;n>c;c++)if(q[c]&&q[c].id===b)return q.splice(c,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(M,Z){var H=this,V=H._scaleFactor,T=H._eyesOffset,B=H._lastHeadPose;return B[0]=M[0]*V,B[1]=M[1]*V,B[2]=M[2]*V,Z?(Z[0]=B[0]+T[0],Z[1]=B[1]+T[1],Z[2]=B[2]+T[2],Z):[B[0]+T[0],B[1]+T[1],B[2]+T[2]]},addEyesOffset:function(t,W,x){var w=this._offsetToBeAdd;w[0]+=t,w[1]+=W,w[2]+=x},_copyViewMatrix:function(n){var J=this.dup(n),K=this._scaleFactor;J[12]*=K,J[13]*=K,J[14]*=K;var h=this._eyesOffset;if(h&&(h[0]||h[1]||h[2])){var z=h[0],w=h[1],g=h[2];J[12]-=J[0]*z+J[4]*w+J[8]*g,J[13]-=J[1]*z+J[5]*w+J[9]*g,J[14]-=J[2]*z+J[6]*w+J[10]*g}return J},shutdown:function(){var a=this._device;a&&a.isPresenting&&a.exitPresent()},isPresenting:function(){var w=this._device;return w&&w.isPresenting},_copyProjectMatrix:function(q){var N=this.dup(q),U=this._scaleFactor;return N[14]*=U,N},dup:function(b,z){for(var $=b.length,G=z||new Array($);$--;)G[$]=b[$];return G},getViewMatrix:function(Z){var N=this._viewMatrix;return N?this.dup(N,Z):void 0},getProjectMatrix:function(){var z=this._projectMatrix;return z?this.dup(z):void 0},submitFrame:function(){var R=this;if(R._enable&&R._deviceInAction){var A=R._device;A&&A.isPresenting&&(A.submitFrame(),R.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(Q){var a=this.gv;return a.intersectObjects(Q,a.dm().getDatas())},setDevice:function(r){var J=this;J._device=r},_injectGraphView:function(){var w,n,L;return function(S){var o=this.gv;if(!S)return w&&(o.getWidth=w,o.getHeight=n,o.getDevicePixelRatio=L),void 0;var z=this._device,e=z.getEyeParameters("left"),p=e.renderWidth,$=e.renderHeight;w=o.getWidth,n=o.getHeight,L=o.getDevicePixelRatio,o.getWidth=function(){return 2*p},o.getHeight=function(){return $},o.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(Y){var L=this;if(!Y)return Wn=M.Default.callLater=L._defaultCallLater,Cs=M.Default.cancelLater=L._defaultCancelLater,void 0;var L=this;Wn=M.Default.callLater=function(p,m,J,Q){var h=L._device;return h&&h.isPresenting?Q?a(function(){Wn(p,m,J)},Q):h.requestAnimationFrame(function(){L._deviceInAction=!0,p.apply(m,J),L._deviceInAction=!1}):L._defaultCallLater(p,m,J,Q)},Cs=M.Default.cancelLater=function(z,l){var m=L._device;return m&&m.isPresenting?l?q(z):m.cancelAnimationFrame(z):L._defaultCancelLater(z,l)}}}),v.defineProperties(en.prototype,{enable:{get:function(){return this._enable},set:function(N){var E=this;E._enable!==N&&(E._enable=N,N?(E.switch.showButton(),E._injectCallLaterFunc(!0)):(E.shutdown(),E.switch.hideButton(),E._injectCallLaterFunc(!1)),E.fp("enable",!N,N))}},measureOflength:{get:function(){return this._measureOflength},set:function(Q){this._measureOflength=Q;var v=this._scaleFactor=1/Q;this._controllers.forEach(function(Q){Q&&Q._setScaleFactor(v)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(H){this._eyesOffset=H}},controllerModel:{get:function(){return this._controllerModel},set:function(j){var B;"object"==typeof j?(B=j.mtl,j=j.obj):(B=j+".mtl",j+=".obj");var d=this,H=d._controllerModel;H&&H.obj===j&&H.mtl===B||(H=d._controllerModel={obj:j,mtl:B},w.loadObj(j,B,{finishFunc:function(h,T){d._controllerModel===H&&w.setShape3dModel("vrControllerModel",T)}}))}},interactive:{get:function(){return!!this._interactive},set:function(v){!!v!=!!this._interactive&&(this._interactive=v,v&&this.addController(0),this.gv.getCoreInteractor().enableVR(v))}}});var fs=function(k,o){function f(x){var F=navigator.getGamepads&&navigator.getGamepads();if(F)for(var M=0,$=0,v=F.length;v>M;M++){var u=F[M];if(u){var Z=u.id;if("OpenVR Gamepad"===Z||"OpenVR Controller"===Z||0===Z.indexOf("Oculus Touch")||0===Z.indexOf("Spatial Controller")){if($===x)return u;$++}}}}function i(C,G,T){return Math.abs(C[0]-G[0])<T&&Math.abs(C[1]-G[1])<T&&Math.abs(C[2]-G[2])<T?!0:!1}var W=this;W.vr=k,W.id=o;var V,$,J=[0,0],v=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],P=new lf;P.s("shape3d","vrControllerModel"),P.isController=!0,P.s("intersect",!1),W.getGamepad=function(){return $},W.isButtonPressed=function(R){for(var m,l=0,G=v.length;G>l;l++)if(m=v[l],m.id===R)return m.pressed;return!1},W.getNode=function(){return P};var u=.003;W.setRotationEpsilon=function(P){u=P};var c=5e-4,Y=c;W.setPositionEpsilon=function(D){c=D,Y=D*W.vr._scaleFactor},W._setScaleFactor=function(j){P.s3(j,j,j),Y=c*j},W._setScaleFactor(W.vr._scaleFactor);var p,q=new gj,e=new yi,H=[0,0,0],I=[0,0,0],b=new $o,A=new Tl,x=new Tk;W.getRay=function(){return p?(x.origin.fromArray(H),x.direction.copy(A),p=!1,x):x},W.update=function(){if(V=$,$=f(o),V!=$&&console.log("gamepad changed",$),!$||$.pose===C)return $=null,P.s("3d.visible",!1),void 0;if(w.getShape3dModel("vrControllerModel")){P.dm()||k.gv.dm().add(P),P.s("3d.visible",!0);var X=$.pose;if(null!==X){X.position&&(W.vr.toViewPosition(X.position,H),i(P.p3(),H,Y)||(p=!0,P.p3(H))),X.orientation&&(q.fromArray(X.orientation),A.set(0,0,-1).applyQuaternion(q).normalize(),e.makeRotationFromQuaternion(q),b.set(0,0,0,P.getRotationMode(),!0).setFromRotationMatrix(e),I[0]=b.x,I[1]=b.y,I[2]=b.z,i(P.r3(),I,u)||(p=!0,P.r3(I))),p&&k.fp("gamepad.pose",null,{position:H,rotation:I,id:o});var Q=$.axes;(J[0]!==Q[0]||J[1]!==Q[1])&&(J=[Q[0],Q[1]],k.fp("gamepad.axes",null,{id:o,axes:J}));var U,S,l,G,x=$.buttons;for(U=0,S=x.length;S>U;U++)if(l=x[U],G=l.pressed,G!==v[U].pressed){v[U].pressed=G;var O={id:o},K="state";O[K]=O._62O=G?"down":"up",k.fp("gamepad.button."+v[U].id,null,O)}}}}},Io=function(G){this.vr=G,this._button=null};_p(Io,v,{showButton:function(){var b=this.assureButton();if(!b.parentNode){var x=this.vr.gv,T=x.getView();x._79O?T.insertBefore(b,x._79O):T.appendChild(b)}},hideButton:function(){var O=this._button;O&&O.parentNode&&O.parentNode.removeChild(O)},assureButton:function(){var o=this._button;return o?o:this._button=this.createButton(this.vr.gv)},createButton:function(S){function c(n,$){n.textContent=$&&$.isPresenting?" VR ":" VR "}function j(l){e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",c(e,l),e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){l.isPresenting?l.exitPresent():l.requestPresent([{source:S.getCanvas()}])},S.vr.setDevice(l)}function Y(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",c(e,null),e.onmouseenter=null,e.onmouseleave=null,e.onclick=null,S.vr.setDevice(null)}function N(T){T.style.position="absolute",T.style.bottom="20px",T.style.padding="12px 6px",T.style.border="1px solid #fff",T.style.borderRadius="4px",T.style.color="#000",T.style.font="normal 13px sans-serif",T.style.textAlign="center",T.style.opacity="0.5",T.style.outline="none",T.style.zIndex="999"}if("getVRDisplays"in navigator){var e=this._button=V.createElement("button");return e.style.display="none",N(e),P.addEventListener("vrdisplayconnect",function(q){j(q.display)},R),P.addEventListener("vrdisplaydisconnect",function(){Y()},R),P.addEventListener("vrdisplaypresentchange",function(a){c(e,a.display),S.vr.onVRDisplayPresentChange()},R),navigator.getVRDisplays().then(function(G){G.length>0?j(G[0]):Y()}),e}var A=V.createElement("a");return A.href="https://webvr.info",A.innerHTML=" webvr",A.style.left="calc(50% - 90px)",A.style.width="180px",A.style.textDecoration="none",N(A),A}}),v.defineProperties(Io.prototype,{});var ws=M.graph3d.PostProcessing=function(L){function n(){if(!y){var W=L.getGL();y=new ye.RenderTarget(L,W,null,null,{samples:k.renderTextureSamples||1}),u=new ao.Shader(W,C.vs,C.fs),M=ao.Buffer.createIndexBuffer(W,new Uint16Array([0,2,1,1,2,3])),I=ao.Buffer.createVertexBuffer(W,new Float32Array([0,0,1,0,0,1,1,1]))}}var y,u,M,I,a=this,o={},A=!1;!function(){v.keys(ws).forEach(function(u){o[u]=new ws[u](L)})}(),a.getModule=function(U){return U?o[U]:a},a.getModuleList=function(){return v.keys(o)},a.handleDataModleChange=function(k,N){k&&(k.setPostProcessingData(a.serialize()),k.removeSerializeListener(a.onDataModelSerialize,a)),N&&(N.addSerializeListener(a.onDataModelSerialize,a),a.deserialize(N.getPostProcessingData()))},a.onDataModelSerialize=function(o){"serialize"===o.type?L.dm()._postProcessingData=a.serialize():"deserialize"===o.type&&a.deserialize(L.dm().getPostProcessingData())},a.serialize=function(){var U,K,G,p={};for(U in o)K=o[U],p[U]={enable:K.enable},G=K.serializeProperties,G&&G.forEach(function(v){p[U][v]=K[v]});return p},a.deserialize=function($){if($){var Q,i,K,Y;for(Q in $)if(i=o[Q]){K=$[Q],a.enableModule(Q,K.enable);for(Y in K)"enable"!==Y&&(i[Y]=K[Y])}}else{var Q,i;
for(Q in o)i=o[Q],i.enable=!1,i.resetProperties&&i.resetProperties()}},a.decodeShader=function(m){var o,K,r,t="",n="";for(r=0;r<m.length;r++)o=m[r],"%"===o?o="'":"a"===o?o='"':"]"===o&&(o="\\"),K=String.fromCharCode(o.charCodeAt(0)-1),r%2?n+=K:t=K+t;return n+t},a.createShader=function(O,r,P){var _=r.indexOf("^#"),m=a.decodeShader(r.substr(0,_)),n=a.decodeShader(r.substr(_+2));if(P){var V=P(m,n);V&&V.vs&&(m=V.vs),V&&V.fs&&(n=V.fs)}return new ao.Shader(O,m,n)},a.enableModule=function(N,f){var W,v,e,b=N.split(",");for(W=0,v=b.length;v>W;W++)e=b[W].trim(),o[e]&&(o[e].enable=f);A=!1;for(e in o)if(o[e].enable){A=!0;break}A&&n()};var C={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};a._42=function(R,O,m,b,i){if(A&&!i){y.setSize(R,O,m),y.bind(R),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT),L.setViewport(R,0,0,O,m),b(),y.unbind(R);var t,F=y;for(t in o)F=o[t]._42(R,F)||F;return L.setViewport(R,0,0,O,m),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT),u.bind(),R.activeTexture(R.TEXTURE0+0),R.bindTexture(R.TEXTURE_2D,F.texture),u.uniforms.image=0,M.upload(),I.upload(),u.attributes.pos.pointer(I),R.drawElements(R.TRIANGLES,6,R.UNSIGNED_SHORT,0),R.bindTexture(R.TEXTURE_2D,null),R.useProgram(L._prg),!0}}},sn=M.graph3d.PostProcessing.Bloom=function(r){function D(){var e=r.getWidth(),h=r.getHeight();if(e&&h){M=[e,h],R=!0;var L,m=r.getGL(),w=Math.round(M[0]/2),g=Math.round(M[1]/2);for(I=new ye.RenderTarget(r,m,w,g),L=0;i>L;L++)b.push(new ye.RenderTarget(r,m,w,g)),q.push(new ye.RenderTarget(r,m,w,g)),w=Math.round(w/2),g=Math.round(g/2);var A=r._postProcessing;t=A.createShader(m,sn._34Q);for(var L=0;i>L;L++)J[L]=A.createShader(m,sn._35Q,function(e,R){return{fs:R.replace(/DEFINE_VALUE/g,n[L])}});P=A.createShader(m,sn._36Q,function(u,$){return{fs:$.replace(/NUM_MIPS/g,i)}}),Y=A.createShader(m,sn.finalShader),f=ao.Buffer.createIndexBuffer(m,new Uint16Array([0,2,1,1,2,3])),l=ao.Buffer.createVertexBuffer(m,new Float32Array([0,0,1,0,0,1,1,1]))}}var h,w,c,f,l,g=this,S=!1,R=!1;this.serializeProperties="strength,threshold,radius".split(","),this.resetProperties=function(){h=1.5,w=.55,c=.4},v.defineProperties(g,{enable:{get:function(){return S},set:function(l){!!S!=!!l&&(S=l,l&&!R&&D())}},strength:{get:function(){return h},set:function(v){h=v}},threshold:{get:function(){return w},set:function(r){w=r}},radius:{get:function(){return c},set:function(N){c=N}}}),this.resetProperties();var I,t,P,Y,M=[256,256],b=[],q=[],i=5,n=[3,5,7,9,11],J=[];g._42=function(X,K){function k(m,w,G,_){ko(X,w.frame),r.setViewport(X,0,0,w.width,w.height),_?_(X):X.clear(X.COLOR_BUFFER_BIT|X.DEPTH_BUFFER_BIT),e!==m&&m.bind();var k=0;for(var A in G){var L=G[A];L instanceof WebGLTexture&&(X.activeTexture(X.TEXTURE0+k),X.bindTexture(X.TEXTURE_2D,L),L=k,k++),m.uniforms[A]=L}for(e!==m&&(f.upload(),l.upload(),m.attributes.pos.pointer(l),e=m),X.drawElements(X.TRIANGLES,6,X.UNSIGNED_SHORT,0);k--;)X.activeTexture(X.TEXTURE0+k),X.bindTexture(X.TEXTURE_2D,null);Kd(X)}if(S){R||D();var e;k(t,I,{smoothWidth:.01,luminosityThreshold:w,tDiffuse:K.texture});var u,Z=I,g=Math.round(M[0]/2),U=Math.round(M[1]/2);for(u=0;i>u;u++)k(J[u],b[u],{colorTexture:Z.texture,direction:[1,0],texSize:[g,U]}),k(J[u],q[u],{colorTexture:b[u].texture,direction:[0,1],texSize:[g,U]}),g=Math.round(g/2),U=Math.round(U/2),Z=q[u];return k(P,b[0],{blurTexture1:q[0].texture,blurTexture2:q[1].texture,blurTexture3:q[2].texture,blurTexture4:q[3].texture,blurTexture5:q[4].texture,bloomStrength:h,bloomRadius:c,bloomTintColor:[1,1,1]}),k(Y,K,{image:b[0].texture},function(N){N.enable(N.BLEND),N.blendEquation(N.FUNC_ADD),N.blendFunc(N.SRC_ALPHA,N.ONE)}),X.blendEquationSeparate(X.FUNC_ADD,X.FUNC_ADD),X.blendFuncSeparate(X.SRC_ALPHA,X.ONE_MINUS_SRC_ALPHA,X.ONE,X.ONE_MINUS_SRC_ALPHA),K}}};sn._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",sn._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d1j/t2j!p-on!viTjuhiihqj!fgxm0pnbvuT<ftwvbgsgzjjeo)h5!dwffwd!3>!!wsVpwm<pDvhobjsgGp`smnh!t~bn<qxm!f+s!31E/!3d!p>m,p!snUvfTyuuivhsjff<xv<oxj!g+p!s*n3!fwmfqdn3b!tu!f,y!T2jf{mfq<nbvto)j!g>p,s!nn!vwTffdt3v!gegjjsefd<ucjhpso/<*u$fetfgggjPowfv!!L.F!SwOVFwM!`-SfBsEvJuVyTf!UEsFpGmJpOdF!`)WEB3MfVsFvu$yeffug!j>o!f3!fTmJqHnNbBt!!E4FdGfJwOF<`cWhBsM/V*FufgtmgpgbPuw!vh!b,v!twtVjwb!o-Qfesgv)ujyof!Ugsmppmbpud!!y)-E!3jfos!vgumypfbuu!!>t!j2hfnmbq*n!b|t!s4fdufvwso<!y1!/+4!:f9{:j5T!w+o!jf!y+q!)o!p.j1u/d6f!s+j!ey!!>+!!uyf0t)g!gtPjwhvn!b3!d+f!wtj<h*nbbn*h*j0Ttgj!h-nyb)<ge~Qowbpjjtet!vnbbhj!o>)!*x!!|ubwpfmdg3!<j*ojw)Tujb{pfm!g>!!>2!/y1!!u0b!pumfgyT|j!{*f!<,,g!mjp!b<uT!VgJTEjBhSn`bM!F>O!SgFmLp!b=u!)jT!J<H2N!B>*!<j!gumopjb!u)!sxpfgjh<inuvTTvuni!h>j!fhxb!v+t!tcjhbso/Q*ewgV)w1!/-1f-s!vguTyjfhUnsbp*m<pdw!f)dE43!fesjvgugyvftuf!T>v!n",sn._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",sn.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var pm=M.graph3d.PostProcessing.Dof=function($){function t(){S=!0;var k=$.getGL();f=new ye.RenderTarget($,k),c=$._postProcessing.createShader(k,pm._38Q),U=ao.Buffer.createIndexBuffer(k,new Uint16Array([0,2,1,1,2,3])),n=ao.Buffer.createVertexBuffer(k,new Float32Array([0,0,1,0,0,1,1,1]))}var f,c,U,n,z,A,i,L,_=this,e=!1,S=!1;this.serializeProperties="aperture,maxblur,image".split(","),this.resetProperties=function(){this.aperture=.025,this.maxblur=1,this.image=null},v.defineProperties(_,{enable:{get:function(){return e},set:function(Y){!!e!=!!Y&&(e=Y,Y&&!S&&t())}},image:{get:function(){return A},set:function(W){A!==W&&(A=W,z&&($.getGL().deleteTexture(z),z=null),$.iv())}},maxblur:{get:function(){return i},set:function(J){i!==J&&(i=J,$.iv())}},aperture:{get:function(){return L},set:function(j){L!==j&&(L=j,$.iv())}}}),this.resetProperties(),_._42=function(H,q){function Q(X,J,h,x){ko(H,J.frame),$.setViewport(H,0,0,J.width,J.height),x?x(H):H.clear(H.COLOR_BUFFER_BIT|H.DEPTH_BUFFER_BIT),d!==X&&X.bind();var p=0;for(var i in h){var C=h[i];C instanceof WebGLTexture&&(H.activeTexture(H.TEXTURE0+p),H.bindTexture(H.TEXTURE_2D,C),C=p,p++),X.uniforms[i]=C}for(d!==X&&(U.upload(),n.upload(),X.attributes.pos.pointer(n),d=X),H.drawElements(H.TRIANGLES,6,H.UNSIGNED_SHORT,0);p--;)H.activeTexture(H.TEXTURE0+p),H.bindTexture(H.TEXTURE_2D,null);Kd(H)}if(e){S||t();var d;if(!z){var N=Wl(this.image);if(!N||!N.tagName)return q;z=Sf(H,N)}var B=q.width,R=q.height;return f.setSize(H,B,R),Q(c,f,{tColor:q.texture,tDepth:z,aspect:B/R,aperture:this.aperture,maxblur:this.maxblur}),f}}};pm._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdvs<<*!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<fqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<dfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)Ev3ofjsgvpusynf!ug!m>p,b!um!pgdpd<v*t!<5svvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<fqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudjp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!uddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<dd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdUp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|qt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<wV~w!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dwf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|pd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!*<<*!~5sgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!j<o*!!g8mspvbmuc!ggpbes!!+*!!*|!u!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u!~>,g!mmppbdu!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdDm<j*q!!8*s<vm~cgwppej!e+!!n*b!juod)f*s!s|pdwufddf3q!tebp!g+c!m*v!s1</1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<fuj!g>!,)!vmtpfdEf<q*u!i8*s!v|mc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<mp!dep<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<pm~pDfum!t)fE!3|fs!veupygfcum!v>s,!!>m!pwdfd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds!<**!!*8<sv~mcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!)wEf3df3s!veupygfcum!v>s,5!!m>p!dep<g*c!m8vssv!m+c!g1p/e5!<+!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!u<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<mpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdpm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/y<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dyz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!zdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3E",Iq(w,{accordionViewExpandIcon:Hf(ij),accordionViewCollapseIcon:Hf(ij,!0),accordionViewLabelColor:eg,accordionViewLabelFont:hg,accordionViewTitleBackground:ro,accordionViewSelectBackground:ib,accordionViewSelectWidth:3,accordionViewSeparatorColor:C,splitViewDividerSize:1,splitViewDividerBackground:ro,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Cm,rect:[2,2,12,12],background:ij}]},propertyViewLabelColor:cc,propertyViewLabelSelectColor:eg,propertyViewLabelFont:hg,propertyViewExpandIcon:Hf(Lm),propertyViewCollapseIcon:Hf(Lm,!0),propertyViewBackground:gi,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:$r,propertyViewColumnLineColor:$r,propertyViewSelectBackground:ib,listViewLabelColor:cc,listViewLabelSelectColor:eg,listViewLabelFont:hg,listViewRowLineVisible:!1,listViewRowLineColor:$r,listViewSelectBackground:ib,treeViewLabelColor:cc,treeViewLabelSelectColor:eg,treeViewLabelFont:hg,treeViewExpandIcon:Hf(Yf),treeViewCollapseIcon:Hf(Yf,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:$r,treeViewSelectBackground:ib,treeViewDoubleClickToToggle:!0,tableViewLabelColor:cc,tableViewLabelSelectColor:eg,tableViewLabelFont:hg,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:$r,tableViewColumnLineColor:$r,tableViewSelectBackground:ib,treeTableViewLabelColor:cc,treeTableViewLabelSelectColor:eg,treeTableViewLabelFont:hg,treeTableViewExpandIcon:Hf(Yf),treeTableViewCollapseIcon:Hf(Yf,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:$r,treeTableViewColumnLineColor:$r,treeTableViewSelectBackground:ib,tableHeaderLabelColor:cc,tableHeaderLabelFont:hg,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:bh,tableHeaderBackground:gi,tableHeaderMoveBackground:dd,tableHeaderInsertColor:ib,tableHeaderSortDescIcon:Lb(Lm,!0),tableHeaderSortAscIcon:Lb(Lm),tabViewTabGap:1,tabViewLabelColor:eg,tabViewLabelFont:hg,tabViewTabBackground:ro,tabViewSelectWidth:3,tabViewSelectBackground:ib,tabViewMoveBackground:dd,tabViewInsertColor:ib,toolbarLabelColor:cc,toolbarLabelSelectColor:eg,toolbarLabelFont:hg,toolbarBackground:gi,toolbarSelectBackground:ib,toolbarItemGap:8,toolbarSeparatorColor:Vo},!0);var Rg={translateX:1,sortColumn:1},Pi={sortable:1,sortOrder:1,sortFunc:1},fb={focusData:1},on={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},wf={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},uc=function(k,G){G.add(k),k.hasChildren()&&k.eachChild(function(O){uc(O,G)})},tj=function(r,p,h,Y,b,P,Z,W,A,c,H){var j,T=h.getValueType(c),g=h.getAlign(c);if(h.getEnumValues(c)){var J=h.toEnumLabel(p,c),Q=Ij||0,V=0,t=P,z=w.getTextSize(Y,J).width;return j=Wl(h.toEnumIcon(p,c)),j&&(V=P+Ij/2,"center"===g?V+=(W-(Q+z))/2:"right"===g&&(V=V+W-(Q+z)),dj(r,j,V,Z+A/2,c,H),t=V+Ij/2),J!=o&&(j?mc(r,J,Y,b,t,Z,W-(t-P),A):mc(r,J,Y,b,P,Z,W,A,g)),void 0}return p=h.formatValue(p),p!=o?T===Fm?(Ql(r,P,Z,W,A,p),void 0):T===pp||!T&&Yb(p)?(j=Wl(p?rg:ch),dj(r,j,P+W/2,Z+A/2,c,H),void 0):(mc(r,p,Y,b,P,Z,W,A,g),void 0):void 0},ck=function(V,r){var R=r.view,b=jg(V),u=r.column||r.property;R.getDataModel().beginTransaction(),r.editor=V,V.info=r,R.setCurrentEditor(V),R.getView().insertBefore(b,R._79O),pq(V,r.editorRect),V.setFocus?V.setFocus():fp(V),V.commitValue=function(A,Z){V._17Q&&(V=V._17Q),Z||R.setValue(r.data,u,V.getValue?V.getValue():V.value),V.close&&V.close(),Cc(b)},u.onEditorCreated&&u.onEditorCreated(r)},Jl=function(x,b,I,T,U){var X=bi(x,I),v=b.value,K=b.view,y=U.getValueType(b.data);return X.onblur=X.onchange=function(){K.endEditing()},"input"===x?(v=U.formatValue(v),v!=o&&(X.value=v),X.onkeydown=function(a){sk(a)?K.endEditing():Ph(a)&&K.endEditing(!0)},(y===qh||y===So)&&X.addEventListener(vn,w.numberListener,R)):x===od&&T.forEach(function(g){var Z=V.createElement("option");Z.innerHTML=U.toEnumLabel(g),Z.value=g,U.isEnumEqual(v,g)&&(Z.selected=!0),ke(X,Z)}),ck(X,b),X},ym=M.widget={},_m=function(T,C,b){_p(K+".widget."+T,C,b)};Iq(js,{ms_value:function(X){X.getValue=function(c){var d=this.getItemById(c),i=d.element;return pl(i)?i:i?i.getValue?i.getValue():i.value:d.selected},X.setValue=function(K,G){var V=this.getItemById(K);if(V){var e=V.element;e&&!pl(e)?e.setValue?e.setValue(G):e.value=G:Yb(G)?(V.selected=G,this.iv()):(V.element=G,this.iv())}},X.v=function(C,I){var X=this;if(2===arguments.length)X.setValue(C,I);else{if(!kf(C))return X.getValue(C);for(var f in C)X.setValue(f,C[f])}return X}},_46o:function(t){t._icon=o,t._accessType=o,t._valueType=o,t._editable=!1,t._batchEditable=!0,t._align=de,t._nullable=!0,t._emptiable=!1,t.setParent=Ak,t.formatValue=function(I){var p=this,u=p._valueType;return p.getEnumValues()?p.toEnumLabel(I):u===pp?!!I:I!=o&&u===qh?f(I):I},t.setEnum=function(G,M,n,v,l,a,j){var A=this;G&&!Ef(G)&&G.values&&(v=G.editable,n=G.icons,M=G.labels,l=G.strict,a=G.maxHeight,j=G.dropDownWidth,G=G.values),Jq(G)&&(G=G._as),Jq(M)&&(M=M._as),Jq(n)&&(n=n._as),A._enumValues=G,A._enumLabels=M,A._enumIcons=n,A._enumEditable=v,A._enumStrict=l==o?!0:l,A._enumMaxHeight=a,A._enumDropDownWidth=j,G&&G.length&&Pn(G[0])&&(A._valueType=So),A.fp("enum",!1,!0)},t.getEnumDropDownWidth=function(){return this._enumDropDownWidth},t.getEnumMaxHeight=function(){return this._enumMaxHeight},t.isEnumEditable=function(){return this._enumEditable},t.getEnumValues=function(){return this._enumValues},t.getEnumLabels=function(){return this._enumLabels},t.getEnumIcons=function(){return this._enumIcons},t.isEnumStrict=function(){return this._enumStrict},t.isEnumEqual=function(c,r){return this._enumStrict?c===r:c==r},t.toEnumLabel=function(D,N){var m=this,H=m.getEnumValues(N),n=m.getEnumLabels(N);if(H&&n)for(var L=0;L<H.length;L++)if(m.isEnumEqual(D,H[L]))return n[L];return D},t.toEnumIcon=function(s,w){var I=this,v=I.getEnumValues(w),z=I.getEnumIcons(w);if(v&&z)for(var o=0;o<v.length;o++)if(I.isEnumEqual(s,v[o]))return z[o];return C}},_45o:function(w){w._87o=function(G,S,w,I,C,j){if(G){var y=this,B=y._90I,u=tq(1);y._columnLineVisible&&(C-=1),y._rowLineVisible&&(j-=1),0>=C||0>=j||(y._90I||(B=y._90I={}),B[S]||(B[S]=new Uh),pq(u,y.tx()+w,y.ty()+I,C,j),ke(u,G),y._view.insertBefore(u,y._79O),G.onParentAdded&&G.onParentAdded(u),B[S].add(u))}},w._76o=function(){var t=this,y=t._90I;if(y){for(var e in y)y[e].each(function(F){Cc(F)});delete t._90I}},w._77o=function(K){var V=this;if(V._90I){var T=V._90I[K];T&&(T.each(function(y){Cc(y)}),delete V._90I[K])}}},_47o:function(l){l.getValue=function(L,v){return v.getValue?v.getValue(L,v,this):Uo(L,v.getAccessType(),v.getName())},l.setValue=function(P,V,g){if(V.isEmptiable(P)||""!==g||(g=C),V.isNullable(P)||g!=o){var B=this,l=V.getName(P),m=V.getAccessType(P),N=V.getValueType(P);N===qh&&pl(g)?g=z(g):N===So&&pl(g)?g=parseFloat(g):N===pp&&pl(g)&&(g="true"===g),B._batchEditable&&V._batchEditable&&B.isSelected(P)?B.sm().each(function(k){V.setValue?V.setValue(k,V,g,B):Kh(k,m,l,g)}):V.setValue?V.setValue(P,V,g,B):Kh(P,m,l,g)}},l.setCurrentEditor=function($){this.endEditing(),this._currentEditor=$,this.redraw()},l.isEditing=function(V,Q){var S=this,H=S._currentEditor;if(!H)return!1;if(Q){var p=H.info;return p?(p.column||p.property)===Q&&p.data===V:!1}return!0},l.endEditing=function(v){var k=this,Z=k._currentEditor;Z&&(delete k._currentEditor,Z.commitValue&&Z.commitValue(Z.info,v),k.redraw(),k.getDataModel().endTransaction())},l.beginEditing=function(a){this.endEditing();var x=this,E=a.column||a.property;if(E.beginEditing)E.beginEditing(a);else{var b=a.data,k=a.value,n=x.getSelectBackground(b),B=E.getEnumValues(b),M=E.getSlider(b),I=E.getColorPicker(b);if(M){var s=Zi(ym.Slider,M);return s.setValue(k),s.getView().onblur=function(){x.endEditing()},s.isInstant()&&(s.onValueChanged=function(){x.setValue(b,E,s.getValue())}),ck(s,a),void 0}if(I||E.getValueType(b)===Fm){var v=Zi(ym.ColorPicker,I);return v.setValue(k),v.onClosed=function(){x.endEditing()},v.isInstant()&&(v.onValueChanged=function(O,X){x.setValue(b,E,X)}),ck(v,a),v.open(),void 0}if(B){if(ym.ComboBox){var U=new ym.ComboBox;U.setValue(k),U.setValues(B),U.setLabels(E.getEnumLabels(b)),U.setIcons(E.getEnumIcons(b)),U.setEditable(E.isEnumEditable(b)),U.setStrict(E.isEnumStrict(b)),U.setMaxHeight(E.getEnumMaxHeight(b)),U.setDropDownWidth(E.getEnumDropDownWidth(b)),U.onClosed=function(){x.endEditing()},ck(U,a),U.open()}else Jl(od,a,n,B,E);return}var V=E.getValueType(b);if(V===pp||Yb(k))return x.setValue(b,E,!k),void 0;if(E.getItemEditor(b)){var Y=Yi(E.getItemEditor(b)),O=new Y(b,E,x,a),X=O.getView();return X._17Q=O,O.setValue(k),Il(X),ck(X,a),O.editBeginning&&O.editBeginning(),void 0}Jl("input",a,n,o,E)}}},_44o:function(f){f.init=function(z){var d=this,r=d.th=new Ci(z),L=d._view=jh(1,d);d.tv=d._tableView=z,ke(L,r.getView()),ke(L,z.getView()),r.mp(function(A){A.property===$e&&d.iv()}),d.iv()},f.getTableView=function(){return this.tv},f.getTableHeader=function(){return this.th},f.getDataModel=function(){return this.tv.dm()},f.getColumnModel=function(){return this.tv.getColumnModel()},f.setColumns=function(i){this.tv.setColumns(i)},f.addColumns=function(f){this.tv.addColumns(f)},f.endEditing=function(){this.tv.endEditing()},f.validateImpl=function(){var z=this,e=z.th,U=bq(e),C={x:0,y:0,width:z.getWidth(),height:U};pq(e,C),C.y=U,C.height=J(0,z.getHeight()-U),pq(z.tv,C)}},ms_vs:function(g){g._41o=function(){return this._29I.height<this._59I},g._43o=function(){var y=this;y._41o()&&(y._58I||(a(function(){y._94O()},Ti),y.iv()),y._58I=new Date)},g._94O=function(){var e=this;if(e._58I){var W=new Date;W.getTime()-e._58I.getTime()>=Ti?(delete e._58I,e.iv()):a(function(){e._94O()},Ti)}},g._93I=function(){var s=this,N=s._27I;if(s._58I||!s._autoHideScrollBar){N||ke(s._79O,N=s._27I=tq());var _=s._29I,E=_.height,S=s._59I,F=s.getScrollBarSize(),D=_.width-F-2,I=E*(-s.ty()/S),$=E*(E/S),t=N.style;S>E?(ks>$&&(I=I+$/2-ks/2,0>I&&(I=0),I+ks>E&&(I=E-ks),$=ks),t.visibility=Qr,t.background=s.getScrollBarColor(),t.borderRadius=F/2+lo,pq(N,D,I,F,$)):t.visibility=xp}else N&&(N.style.visibility=xp)}},ms_hs:function(w){w._40o=function(){return this._29I.width<this._91I},w._42o=function(){var U=this;U._40o()&&(U._95O||(a(function(){U._94I()},Ti),U.iv()),U._95O=new Date)},w._94I=function(){var b=this;if(b._95O){var J=new Date;J.getTime()-b._95O.getTime()>=Ti?(delete b._95O,b.iv()):a(function(){b._94I()},Ti)}},w._92I=function(){var e=this,n=e._28I;if(e._95O||!e._autoHideScrollBar){n||ke(e._79O,n=e._28I=tq());var d=e._29I,S=d.width,I=e._91I,W=e.getScrollBarSize(),G=d.height-W-2,w=S*(-e.tx()/I),J=S*(S/I),H=n.style;I>S?(ks>J&&(w=w+J/2-ks/2,0>w&&(w=0),w+ks>S&&(w=S-ks),J=ks),H.visibility=Qr,H.background=e.getScrollBarColor(),H.borderRadius=W/2+lo,pq(n,w,G,J,W)):H.visibility=xp}else n&&(n.style.visibility=xp)}}}),ji(rg,Ei(16,16,[{type:jo,rect:[1,1,14,14],background:ib},{type:Vp,rect:[1,1,14,14],width:1,color:el},{type:Dg,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),ji(ch,Ei(16,16,{type:Vp,rect:[1,1,14,14],width:1,color:el})),ji(oe,Ei(16,16,[{type:wn,rect:[2,2,12,12],borderWidth:1,borderColor:el,background:"#FFF"},{type:wn,rect:[4,4,8,8],background:ib}])),ji(gc,Ei(16,16,{type:wn,rect:[2,2,12,12],borderWidth:1,borderColor:el})),js._15Q=function(u){u._29I=xh,u._59I=0,u._91I=0,u._5o=function(T){var R=this;R._30I=new Uh,R._rows=new Uh,R._rowMap={},R._31I=0,R._14I=0,R._view=jh(1,R),R._canvas=ep(R._view),ke(R._view,R._79O=tq()),R.dm(T?T:new hd)},u.getCheckIcon=function(Z){var x=this.sm(),v=x.co(Z);return x.sg()?Wl(v?oe:gc):Wl(v?rg:ch)},u.checkData=function(J){var V=this.sm(),I=V.co(J);V.sg()&&I||(this._32o=1,I?V.rs(J):V.as(J),delete this._32o)},u.getDataAt=function($){$.target&&($=this.lp($));var Y=y($.y/this._rowHeight),z=this._rows;return 0>Y||Y>=z.size()?o:z.get(Y)},u.onDataDoubleClicked=function(){},u.onDataClicked=function(){},u.adjustTranslateX=function(){return 0},u.adjustTranslateY=function(I){var Y=this.getHeight()-this._59I;return Y>I&&(I=Y),I>0?0:f(I)},u.onPropertyChanged=function(d){var j=this,W=d.property;on[W]?j.ivm():fb[W]||j.redraw(),W===db?j._42o():W===Kk&&j._43o()},u.getLabel=function(C){return C.toLabel()},u.getLabelFont=function(){return this._labelFont},u.getLabelColor=function(s){var u=this;if(u.isCheckMode()){if(u._focusData===s)return u._labelSelectColor}else if(u.isSelected(s))return u._labelSelectColor;return u._labelColor},u.getStartRowIndex=function(){return this._31I},u.getEndRowIndex=function(){return this._14I},u.getRowDatas=function(){return this._rows},u.getRowIndex=function(v){return this._rowMap[v._id]},u.getRowSize=function(){return this._rows.size()},u.getViewRect=function(){return mq(this._29I)},u.isVisible=function(T){return this._visibleFunc?this._visibleFunc(T):!0},u.getCurrentSortFunc=function(){return this._sortFunc},u.setDataModel=function(f){var Z=this,Y=Z._dataModel,r=Z._selectionModel;Y!==f&&(Y&&(Y.umm(Z.handleDataModelChange,Z),Y.umd(Z.handleDataPropertyChange,Z),Y.umh(Z.handleHierarchyChange,Z),r||Y.sm().ums(Z.handleSelectionChange,Z)),Z._dataModel=f,f.mm(Z.handleDataModelChange,Z),f.md(Z.handleDataPropertyChange,Z),f.mh(Z.handleHierarchyChange,Z),r?r._21I(f):f.sm().ms(Z.handleSelectionChange,Z),Z.fp("dataModel",Y,f))},u.validateModel=function(){var H=this;H._rows.clear(),H._rowMap={},H.buildChildren(H._dataModel._roots);var k=H._rows=H._rows.toList(H.isVisible,H),E=0,A=H.getCurrentSortFunc(),V=k.size();for(A&&k.sort(A);V>E;E++)H._rowMap[k.get(E)._id]=E},u.buildChildren=function(r){var C=this;r.each(function(X){C._rows.add(X),C.buildChildren(X._children)})},u.handleDataModelChange=function(){this.ivm()},u.handleDataPropertyChange=function(q){"parent"===q.property?this.ivm():this.invalidateData(q.data)},u.handleHierarchyChange=function(){this.ivm()},u.handleSelectionChange=function(L){L.datas.each(this.invalidateData,this),this.onSelectionChanged(L)},u.onSelectionChanged=function(x){var F=this,A=F.sm();!F.isAutoMakeVisible()||1!==A.size()||"set"!==x.kind&&"append"!==x.kind||F._32o||F.makeVisible(A.ld())},u.handleBackgroundClick=function(p){oh(p)&&!this.isCheckMode()&&this.sm().cs()},u.makeVisible=function(w){w&&(this._23I=w,this.iv())},u.scrollToIndex=function(c){var G=this,E=G._29I,p=E.height,e=G._rowHeight,k=e*c;c>=0&&c<G._rows.size()&&p>0&&(k+e>E.y+p?G.ty(-k+p-e):k<E.y&&G.ty(-k))},u.autoScroll=function(P,M){var u=this,X=u._rowHeight,n=X,v=X/4,L=u._29I,p=u.lp(P),s={x:u.tx(),y:u.ty()};return X>0&&L&&(p.x-L.x<n?u.translate(v,0):L.x+L.width-p.x<n&&u.translate(-v,0),p.y-L.y<n?u.translate(0,v):L.y+L.height-p.y<n&&u.translate(0,-v)),s.x=u.tx()-s.x,s.y=u.ty()-s.y,M&&(M.x+=s.x,M.y+=s.y),s},u.getTopRowOrderSelection=function(){var m=this.sm().getTopSelection(),i={},e=new Uh;return m.each(function(h){i[h._id]=h}),this._rows.each(function(m){i[m._id]&&e.add(m)}),e},u.getRowOrderSelection=function(){var A=new Uh;return this._rows.each(function(u){this.isSelected(u)&&A.add(u)},this),A},u.ivm=function(){this.invalidateModel()},u.invalidateModel=function(){var t=this;t._96I||(t._96I=1,t._32I=1,delete t._24I),t.iv()},u.redraw=function(){var Y=this;Y._32I||(Y._32I=1,delete Y._24I,Y.iv())},u.invalidateData=function(g){var V=this;O?V.redraw():V._32I||(V._24I||(V._24I={}),V._24I[g._id]=g,V.iv())},u.getFocusData=function(){return this._focusData},u.setFocusDataById=function(m){this.setFocusData(this.dm().getDataById(m))},u.setFocusData=function(I){var N=this,E=N._focusData;E!==I&&(N._focusData=I,N.fp("focusData",E,I),E&&N.invalidateData(E),I&&(N.invalidateData(I),N.isAutoMakeVisible()&&N.makeVisible(I)))},u.drawRowBackground=function(q,c,z,I,n,j,l){var s=this,E=s.isCheckMode();(c===s._focusData&&E||z&&!E)&&Ql(q,I,n,j,l,s.getSelectBackground(c))},u.drawData=function(t,w,$){var Q=this,d=Q._rowHeight,D=d*$,Y=Q._29I,e=Y.x,q=Y.width;t.save(),t.beginPath(),t.rect(e,D,q,d),t.clip(),Q._87o(Q.drawRow(t,w,Q.isSelected(w),e,D,q,d),$,e,D,q,d),t.restore(),Q._rowLineVisible&&Ql(t,e,D+d-1,q,1,Q._rowLineColor)},u._12I=function(J){var x=this,E=x._31I,i=x._29I,G=i.x,Y=i.y,v=i.width,C=i.height;for(J.beginPath(),J.rect(G,Y,v,C),J.clip(),J.clearRect(G,Y,v,C),x._76o(),x._93db(J);E<x._14I;E++)x.drawData(J,x._rows.get(E),E);x._92db(J)},u._13I=function(u){for(var Q,_=this,h=_._rowHeight,c=_._29I,V=c.x,K=c.width,H=_._31I,o=_._30I;H<_._14I;H++)Q=_._rows.get(H),_._24I[Q._id]&&o.add({data:Q,index:H});o.isEmpty()||(u.beginPath(),o.each(function($){u.rect(V,$.index*h,K,h)}),u.clip(),o.each(function(c){u.clearRect(V,c.index*h,K,h)}),o.each(function(z){_._77o(z.index)}),_._93db(u),o.each(function(k){_.drawData(u,k.data,k.index)}),_._92db(u),o.clear())},u.preValidateModel=function(){this.endEditing&&this.endEditing()},u.validateImpl=function(){var $=this,Y=$._canvas,C=$.getWidth(),F=$.getHeight(),m=$._rowHeight,h=$._32I;(C!==Y.clientWidth||F!==Y.clientHeight)&&(ol(Y,C,F),h=1);var r=B&&!U;$._96I&&!r&&($.preValidateModel(),$.validateModel());var H=$._29I,P={x:-$.tx(),y:-$.ty(),width:C,height:F},p=$._rows.size(),w=vp(Y),M=$._23I;h||ys(P,H)||(h=1),$._29I=P,$._59I=p*m+$.getScrollBarSize(),$._31I=y(P.y/m),$._14I=E((P.y+P.height)/m),$._31I<0&&($._31I=0),$._14I>p&&($._14I=p),$._99I&&h&&$._99I(),ln(w,$.tx(),$.ty(),1),h?$._12I(w):$._24I&&$._13I(w),$._93I(),$._92I(),w.restore(),$._32I=$._24I=$._96I=o,M&&($.scrollToIndex($.getRowIndex(M)),delete $._23I),$.tx($.tx()),$.ty($.ty())}},js._48o=function(s){s._rootVisible=!0,s._rootData=o,s._35o=function(){this._expandMap={},this._levelMap={}},s.validateModel=function(){var t=this,k=t._rootData;t._rows.clear(),t._levelMap={},t._rowMap={},t._currentLevel=0,k?t._rootVisible?t.isVisible(k)&&t.buildData(k):t.buildChildren(k):t.buildChildren(),delete t._currentLevel},s.buildData=function(f){var v=this,o=f._id,Z=v._rows;v._rowMap[o]=Z.size(),Z.add(f),v._levelMap[o]=v._currentLevel,v.isExpanded(f)&&(v._currentLevel++,v.buildChildren(f),v._currentLevel--)},s.buildChildren=function(B){var X=this,I=B?B._children:X._dataModel._roots,E=X.getCurrentSortFunc();E&&X.isChildrenSortable(B)?I.toList(X.isVisible,X).sort(E).each(X.buildData,X):I.each(function(n){X.isVisible(n)&&X.buildData(n)})},s.getLevel=function(R){return this._levelMap[R._id]},s.getToggleIcon=function(g){var P=this,j=P._loader,F=P._collapseIcon;return j&&!j.isLoaded(g)?F:g.hasChildren()?P.isExpanded(g)?P._expandIcon:F:o},s.isCheckMode=function(){return this._checkMode!=o
},s.isChildrenSortable=function(){return!0},s.handleDataModelChange=function(c){var N=this;c.kind===nm?delete N._expandMap[c.data._id]:c.kind===fq&&(N._expandMap={}),N.ivm()},s.toggle=function(Z){var v=this;v.isExpanded(Z)?v.collapse(Z):v.expand(Z)},s.isExpanded=function(y){return 1===this._expandMap[y._id]},s.expand=function(H){var l=this,y=l._loader;l.isExpanded(H)||(y&&!y.isLoaded(H)&&y.load(H),l._expandMap[H._id]=1,l.ivm(),l.onExpanded(H))},s.onExpanded=function(){},s.collapse=function(Z){var J=this;J.isExpanded(Z)&&(delete J._expandMap[Z._id],J.ivm(),J.onCollapsed(Z))},s.onCollapsed=function(){},s.expandAll=function(u){if(u)this.expand(u),u.eachChild(function(T){this.expandAll(T)},this);else{var y=this;y._dataModel.each(function(u){u.hasChildren()&&(y._expandMap[u._id]=1)}),y.ivm()}},s.collapseAll=function(){this._expandMap={},this.ivm()},s.makeVisible=function(E){if(E){var t=this;if(!t._rootData||E.isDescendantOf(t._rootData)){for(var d=E._parent;d;)t.expand(d),d=d._parent;t._23I=E,t.iv()}}},s.checkData=function(K){var d,g=this,u=g._checkMode,S=g.sm(),Z=S.co(K);if(!S.sg()||!Z){if(g._32o=1,u===Tf)Z?S.rs(K):S.as(K);else if(u===ce)d=new Uh(K),d.addAll(K._children);else if("descendant"===u)d=new Uh,uc(K,d);else if("all"===u&&(d=new Uh,uc(K,d),!Z))for(var H=K._parent;H;)d.add(H),H=H._parent;d&&(Z?S.rs(d):S.as(d)),delete g._32o}},s._97I=function(i,N,Z,O,u,H,W){var h=this,J=h._indent,M=h._levelMap[N._id],x=h.getIconWidth(N),R=Wl(h.getToggleIcon(N));R?(O+=J*M,dj(i,R,O+J/2,u+W/2,N,h),O+=J):O+=J*(M+1),h._checkMode&&(dj(i,h.getCheckIcon(N),O+J/2,u+W/2,N,h),O+=J),h.drawIcon(i,N,O,u,x,W),h.drawLabel(i,N,O+x,u,W)}},js._14Q=function(G){G.getIcon=function(q){return q.getIcon()},G.getIconWidth=function(V){return this.getIcon(V)?this._indent:0},G.drawIcon=function(C,D,G,d,A,q){if(A){var N=this,S=N.getBodyColor(D),X=Wl(N.getIcon(D),S);X&&(q-=N.isRowLineVisible()?1:0,im(C,X,dg,G,d,A,q,D,N,S),Tc(C,N.getBorderColor(D),G,d,A,q))}},G.drawLabel=function(C,g,E,S,I){var d=this;mc(C,d.getLabel(g),d.getLabelFont(g),d.getLabelColor(g),E,S,0,I)}},js._50o=function(g){g._98I=function(){var C=this,z=C._39o=new hd;C._60I=new Uh,z.mm(C._17o,C),z.md(C._18o,C),z.mh(C._19o,C)},g.setColumns=function(b){this._39o.clear(),this.addColumns(b)},g.addColumns=function(V){var r=this._39o;V.forEach(function(J){if(!(J instanceof Cj)){var c=Yi(J.className);J=Zi(c?c:Cj,J)}r.add(J)})},g.onColumnClicked=function(){},g.onCheckColumnClicked=function(){},g._3Q=function(r){for(var V,B=0,N=this._60I,t=N.size();t>B;B++)if(V=N.get(B),V.column===r)return V;return o},g.getColumnAt=function(N){var M=this._4Q(N);return M?M.column:o},g._4Q=function(I){for(var G=this,f=I.target?G.lp(I).x:I.x,H=G._60I,w=0;w<H.size();w++){var c=H.get(w),L=c.startX;if(f>=L&&f<L+c.column.getWidth())return c}return o},g.getToolTip=function(b){var S=this,L=S.getDataAt(b),w=S.getColumnAt(b);return L&&w?w.getToolTip(L,S):o},g.adjustTranslateX=function(s){var K=this.getWidth()-this._91I;return K>s&&(s=K),s>0?0:f(s)},g._99I=function(){var b=this,h=b._29I,r=b._60I;r.clear(),b._91I=0,b._39o._roots.each(function(O){if(O.isVisible()){var U=b._91I+O.getWidth();b._91I<=h.x+h.width&&U>=h.x&&r.add({column:O,startX:b._91I}),b._91I=U}}),b._91I+=b.getScrollBarSize()},g.drawData=function(d,t,M){var k=this,r=k._rowHeight,C=r*M,R=k.isSelected(t),W=k._29I,D=W.x,p=W.width;k.drawRowBackground(d,t,R,D,C,p,r),k._60I.each(function(_){var y=_.column,G=_.startX,Q=y.getWidth();Q>0&&!k.isEditing(t,y)&&(d.save(),d.beginPath(),d.rect(G,C,Q,r),d.clip(),k._87o(k.drawCell(d,t,R,y,G,C,Q,r),M,G,C,Q,r),k._columnLineVisible&&Ql(d,G+Q-1,C,1,r,k._columnLineColor),d.restore())}),k._rowLineVisible&&Ql(d,D,C+r-1,p,1,k._rowLineColor)},g.drawCell=function(J,t,y,l,B,v,N,j){var H=this;if(l.drawCell)return l.drawCell(J,t,y,l,B,v,N,j,H);var F=H.getValue(t,l);tj(J,F,l,H.getLabelFont(t,l,F),H.getLabelColor(t,l,F),B,v,N,j,t,H)},g.getColumnModel=function(){return this._39o},g._17o=function(){this.redraw()},g._18o=function(T){var W=this;T.data===W._sortColumn&&Pi[T.property]?W.ivm():(W._42o(),W.redraw())},g._19o=function(){this.redraw()},g.getCurrentSortFunc=function(){var x=this,F=x._sortColumn;if(F&&F.isSortable()){var y=F.getSortFunc(),C=Gq===F.getSortOrder()?1:-1;return y||(y=Yn),function(X,m){return y.call(x,x.getValue(X,F),x.getValue(m,F),X,m)*C}}return x._sortFunc},g.isCellEditable=function(N,I,X){return I.isEditable()&&this.isEditable()?I.isCellEditable?I.isCellEditable(N,I,X,this):!0:!1},g._37O=function(Y,X){if(oh(X))for(var $=this,i=$.lp(X),J=$._60I,Q=$._rowHeight,U=$._29I,H=U.x,a=U.y,S=U.width,r=U.height,k=0;k<J.size();k++){var n=J.get(k),L=n.startX,e=n.column,c=e.getWidth();if(e!==$._31o&&e!==$._4o&&i.x>=L&&i.x<L+c&&$.isCellEditable(Y,e,X)){var h={x:L,y:$.getRowIndex(Y)*Q,width:c,height:Q},C={x:h.x+$.tx(),y:h.y+$.ty(),width:h.width,height:h.height},d=0,T=0;return h.x<H?d=h.x-H:h.x+h.width>H+S&&(d=h.x+h.width-H-S),d&&($.tx($.tx()-d),C.x-=d),h.y<a?T=h.y-a:h.y+Q>a+r&&(T=h.y+Q-a-r),T&&($.ty($.ty()-T),C.y-=T),$.beginEditing({data:Y,column:e,value:$.getValue(Y,e),event:X,rect:h,editorRect:C,view:$}),void 0}}}},ym.BaseItemEditor=function(A,J,h,X){this._data=A,this._column=J,this._master=h,this._editInfo=X},_m("BaseItemEditor",v,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Wm=M.Tab=function(){ek(Wm,this)};Lj("Tab",un,{ms_ac:["view","closable","disabled","visible"],_icon:o,_closable:!1,_disabled:!1,_visible:!0,setParent:Ak});var Cj=M.Column=function(){ek(Cj,this)};Lj("Column",un,{_46o:1,ms_ac:["accessType","valueType",Qr,hn,Bj,lk,"align",Fm,"sortOrder",Ae,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Gq,_sortFunc:o,_sortable:!0,_clickable:!0,setWidth:function(n){16>n&&(n=16);var c=this._width;this._width=n,this.fp(lk,c,n)},getToolTip:function(O,d){return this.formatValue(d.getValue(O,this))}});var Qq=M.Property=function(){ek(Qq,this)};Lj("Property",un,{_46o:1,ms_ac:["accessType","valueType",hn,Bj,"categoryName",Fm,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:o,getToolTip:function(P,T,v){var _=this;return T?_.formatValue(v.getValue(P,_)):v.getPropertyName(_)}}),ym.AccordionView=function(){var I=this;I._20o={},I._21o=new Uh,I._10o=o,I._9o=o,I._11o=o,I._view=jh(0,I),I.iv()},_m("AccordionView",v,{ms_v:1,ms_fire:1,ms_ac:[Db,qd,"titleHeight",tr,mh,"titleBackground","selectWidth",bo,"orientation","separatorColor"],_expandIcon:w.accordionViewExpandIcon,_collapseIcon:w.accordionViewCollapseIcon,_titleHeight:gr,_labelColor:w.accordionViewLabelColor,_labelFont:w.accordionViewLabelFont,_titleBackground:w.accordionViewTitleBackground,_selectBackground:w.accordionViewSelectBackground,_selectWidth:w.accordionViewSelectWidth,_orientation:"v",_separatorColor:w.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(z,b,k,e){var i=this,H=tq();if(i._20o[z])throw z+" already exists";H.onmousedown=Eb,H.style.cursor=eb,H.addEventListener(Em?nn:_c,function(u){Eb(u)},R),H.addEventListener(Em?Hk:kr,function(d){Eb(d),oh(d)&&(i._10o===z?i.collapse():i.expand(z))},R),ke(i._view,H),i._20o[z]={content:b,div:H,canvas:ep(H),icon:e},i._21o.add(z),k&&i.expand(z),i.iv()},remove:function(G){var i=this,c=i._20o[G];c&&(Cc(c.div),delete i._20o[G],i._21o.remove(G),i.iv())},clear:function(){var $=this;$._21o.toArray().forEach($.remove,$),$._20o={},$._21o.clear(),$.iv()},isExpanded:function(D){return this._10o===D},expand:function(o){var M=this;M._20o[o]&&M._10o!==o&&(M._10o=o,M.onExpanded(o),M.iv())},onExpanded:function(){},collapse:function(){var h=this;h._10o&&(h.onCollapsed(h._10o),delete h._10o,h.iv())},onCollapsed:function(){},initCanvas:function(o,U,Z){ol(o,U,Z);var k=vp(o);return ln(k,0,0,1),k.clearRect(0,0,U,Z),k},drawTitle:function(k,g,E,i,G){var Z=this,x=Wl(G.icon),m=Z.isExpanded(g),o=Z._titleHeight,z=Z._titleBackground,M=Z._selectWidth,d=Z._separatorColor,K=Wl(m?Z._expandIcon:Z._collapseIcon),I=M+4;Ql(k,0,0,E,i,z),m&&M&&Ql(k,0,0,M,i,Z._selectBackground),(m||Z._21o.get(Z._21o.size()-1)!==g)&&Ql(k,0,i-1,E,1,d?d:Rl(z)),x&&(dj(k,x,I+lj(x)/2,o/2),I+=lj(x)+2),mc(k,g,Z.getLabelFont(g),Z.getLabelColor(g),I,0,0,o),K&&dj(k,K,E-lj(K)/2-4,o/2)},validateImpl:function(){var V=this,E=V._view,m=0,w=0,p=V.getWidth(),R=V.getHeight(),u=V._titleHeight,n=V._21o.size()*u,s=V._11o,W=V._9o;delete V._11o,delete V._9o,V._21o.each(function(h){var G,Y,E=V._20o[h],o=E.content,v=V._10o===h;Fj(V)?(pq(E.div,m,0,u,R),G=V.initCanvas(E.canvas,u,R),Ii(G,0,R),Gg(G,-A),V.drawTitle(G,h,R,u,E),G.restore(),v?(Y=J(0,p-n),o&&(V._11o=o,V._9o=jg(o),pq(o,m+u,0,Y,R)),m+=u+Y):m+=u):(pq(E.div,0,w,p,u),G=V.initCanvas(E.canvas,p,u),V.drawTitle(G,h,p,u,E),G.restore(),v?(Y=J(0,R-n),o&&(V._11o=o,V._9o=jg(o),pq(o,0,w+u,p,Y)),w+=u+Y):w+=u)});var I=V._9o;s&&s!==V._11o&&s.endEditing&&s.endEditing(),I&&I!==W&&ke(E,I),W&&W!==I&&Cc(W)}}),ym.SplitView=function(m,i,l,C){var v=this,D=v._dividerDiv=tq(),L=v._60O=ep(),h=v._61O=ep(),e=L.style,a=h.style;v._view=jh(1,v),ke(v._view,D),e.msTouchAction=ip,e.pointerEvents=ip,e.cursor=eb,a.msTouchAction=ip,a.pointerEvents=ip,a.cursor=eb,m&&v.setLeftView(m),i&&v.setRightView(i),l&&v.setOrientation(l),C!=o&&v.setPosition(C),v.setStatus(Go),new rn(v)},_m("SplitView",v,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:w.splitViewDividerSize,_dividerBackground:w.splitViewDividerBackground,_dragOpacity:w.splitViewDragOpacity,_toggleIcon:w.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(j,E){var D=this,i=D._position;isNaN(j)||(E||(D._82O=0>j?-1:j>1?1:0),D._position=j,D.fp(lm,i,j))},getLeftView:function(){return this._leftView},setLeftView:function(t){var p=this,m=p._leftView,x=p._view;if(p._leftView!==t){if(m&&m!==p._rightView){var M=jg(m);M.parentNode===x&&Cc(M)}if(p._leftView=t,t){var h=jg(t);h.parentNode!==x&&x.insertBefore(h,p._dividerDiv)}p.fp("leftView",m,t)}},getRightView:function(){return this._rightView},setRightView:function(Y){var i=this,L=i._rightView,Q=i._view;if(i._rightView!==Y){if(L&&L!==i._leftView){var N=jg(L);N.parentNode===Q&&Cc(N)}if(i._rightView=Y,Y){var u=jg(Y);u.parentNode!==Q&&Q.insertBefore(u,i._dividerDiv)}i.fp("rightView",L,Y)}},validateImpl:function(){var i=this,G=i._draggable,r=i._position,v=i.getWidth(),o=i.getHeight(),N=i._dividerSize,Z=i._dividerBackground,K=Em?18:8,j=i._dividerDiv,X=i._82O,R=i._60O,t=i._61O,u=i._toggleIcon,M=i._status,b=j.style,k=null,n=Em?20:4,I=u.comps[0];N>=K||0===N?i._coverDiv&&(Cc(i._coverDiv),delete i._coverDiv):i._coverDiv||(i._coverDiv=tq(),$&&(i._coverDiv.style.background=Qj),ke(j,i._coverDiv)),i._togglable?R.parentNode||(ke(j,R),ke(j,t)):(Cc(R),Cc(t));var W=i._coverDiv,L=i._leftView,O=i._rightView;if(Fj(i)){if(N>v&&(N=v),M===Go)if(1===X)var V=m(r,v),g=J(0,v-N-V);else-1===X?(g=m(-r,v),V=J(0,v-N-g)):(V=f((v-N)*r),g=J(0,v-N-V));else"cl"===M?(V=0,g=J(0,v-N)):"cr"===M&&(g=0,V=J(0,v-N));L&&pq(L,0,0,V,o),O&&pq(O,V+N,0,g,o),pq(j,V,0,N,o),i._22o=V,W&&(pq(W,N/2-K/2,0,K,o),W.style.cursor=G?wk:""),j.style.cursor=G?wk:"";var q=j.clientHeight/2,e=j.clientWidth;ol(R,e,e),pq(R,0,q-e-n,e,e),k=vp(R),ln(k,0,0,1),I.rotation=-A,Rm(k,u,0,0,e,e),k.restore(),ol(t,e,e),pq(t,0,q+n,e,e),k=vp(t),ln(k,0,0,1),I.rotation=A,Rm(k,u,0,0,e,e),k.restore()}else{if(N>o&&(N=o),M===Go)if(1===X)var d=m(r,o),B=J(0,o-N-d);else-1===X?(B=m(-r,o),d=J(0,o-N-B)):(d=f((o-N)*r),B=J(0,o-N-d));else"cl"===M?(d=0,B=J(0,o-N)):"cr"===M&&(B=0,d=J(0,o-N));L&&pq(L,0,0,v,d),O&&pq(O,0,d+N,v,B),pq(j,0,d,v,N),i._22o=d,W&&(pq(W,0,N/2-K/2,v,K),W.style.cursor=G?uk:""),b.cursor=G?uk:"";var F=j.clientWidth/2,e=j.clientHeight;ol(R,e,e),pq(R,F-e-n,0,e,e),k=vp(R),ln(k,0,0,1),I.rotation=0,Rm(k,u,0,0,e,e),k.restore(),ol(t,e,e),pq(t,F+n,0,e,e),k=vp(t),ln(k,0,0,1),I.rotation=s,Rm(k,u,0,0,e,e),k.restore()}b.background=Z}});var rn=function(G){this.sv=G,this.addListeners()};_p(rn,v,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(m){var W=this,F=W.sv,n=F._dividerDiv,V=F._60O,x=F._61O,C=F._status,T=m.target;if(T===V)C===Go?F.setStatus("cl"):"cr"===C&&F.setStatus(Go);else if(T===x)C===Go?F.setStatus("cr"):"cl"===C&&F.setStatus(Go);else if($p(m)&&(T===n||T===F._coverDiv)&&(Eb(m),F.isDraggable())){F.getLeftView(),F.getRightView();var v=W.maskDiv=tq();if(v.style.left=0,v.style.top=0,v.style.width=F.getWidth()+"px",v.style.height=F.getHeight()+"px",F.getView().appendChild(v),!F.isContinuousLayout()){var O=W.resizeDiv=tq();O.style.left=n.style.left,O.style.top=n.style.top,O.style.width=n.style.width,O.style.height=n.style.height,O.style.opacity=F.getDragOpacity(),O.style.background=F.getDividerBackground(),ke(W.getView(),O)}W._lastAbsPosition=F._22o,W._86o=Fj(F)?Qf(m).x:Qf(m).y,Fr(W,m)}},handleWindowTouchMove:function(A){$p(A)&&this.update(A,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(K){var $=this;$.update(K,!0),$.sv.setStatus(Go),$.maskDiv&&Cc($.maskDiv),$.resizeDiv&&Cc($.resizeDiv),$.maskDiv=$.resizeDiv=o},handle_mousedown:function(V){oh(V)&&this.handle_touchstart(V)},handleWindowMouseMove:function(X){this.handleWindowTouchMove(X)},handleWindowMouseUp:function(L){this.handleWindowTouchEnd(L)},update:function(y,W){var h=this,x=h.sv,d=Fj(x)?x.getWidth():x.getHeight(),I=x._dividerSize,i=h._lastAbsPosition-h._86o;Fj(x)?(i+=Qf(y).x,i>d-I&&(i=d-I),0>i&&(i=0),h.resizeDiv&&(h.resizeDiv.style.left=i+lo)):(i+=Qf(y).y,i>d-I&&(i=d-I),0>i&&(i=0),h.resizeDiv&&(h.resizeDiv.style.top=i+lo)),W&&d!==I&&(1===x._82O?x.setPosition(i,1):-1===x._82O?x.setPosition(i-d+I,1):x.setPosition(i/(d-I),1))}}),ym.TabView=function(){var q=this,Y=q._view=jh(1,q),W=q._91O=tq(1),G=q._tabModel=new hd,N=G.sm(),V=q.invalidate;q._7o=new Uh,q._canvas=ep(W),ke(Y,W),ke(Y,q._92O=tq(1)),N.setSelectionMode(Nb),N.ms(q.handleSelectionChange,q),G.mm(V,q),G.mh(V,q),G.md(V,q),q._interactor=new Xn(q),q.iv()},_m("TabView",v,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",tr,mh,"tabBackground","selectWidth",bo,"moveBackground","insertColor"],_tabPosition:kl,_tabHeight:gr,_tabGap:w.tabViewTabGap,_labelColor:w.tabViewLabelColor,_labelFont:w.tabViewLabelFont,_tabBackground:w.tabViewTabBackground,_selectWidth:w.tabViewSelectWidth,_selectBackground:w.tabViewSelectBackground,_moveBackground:w.tabViewMoveBackground,_insertColor:w.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(l,G,Q){var e,V=this._tabModel;return l instanceof Wm?(e=l,G&&e.setView(G)):(e=new Wm,e.setName(l),e.setView(G)),V.add(e),Q&&V.sm().ss(e),e},getLabel:function(W){return W.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(x){this._23o=x,this.iv()},get:function(D){var E=this,d=E._tabModel;if(Pn(D))return d._roots.get(D);if(pl(D)){var I;return d.each(function(L){D===E.getLabel(L)&&(I=L)}),I}return D instanceof Wm?D:o},select:function(A){this._tabModel.sm().ss(this.get(A))},remove:function(M){var U=this;if(M=U.get(M)){var $=U._tabModel,s=$._roots.indexOf(M);U._tabModel.remove(M),U.selectByIndex(--s)}},getCurrentTab:function(){return this._8o},hideTabView:function(r,C){C.parentNode===this._92O&&(ci(C)?(C.style.display=sl,C._tab_=r):Cc(C),Ul())},showTabView:function(V,g){ci(g)&&(g.style.display="block",g._tab_=V),g.parentNode!==this._92O&&(ke(this._92O,g),Ul())},_24o:function(){var J,a=this,C=a._8o,S=a._9o,T=a._tabModel.sm().ld();T&&(J=jg(T.getView())),J!==S&&(S&&(C.getView()&&C.getView().endEditing&&C.getView().endEditing(),a.hideTabView(C,S)),J&&a.showTabView(T,J)),a._8o=T,a._9o=J,C!==T&&a.onTabChanged(C,T)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(W,e){this.selectByIndex(--e)},selectByIndex:function(T){var R=this,G=R._tabModel,S=G.size();if(S&&!G.sm().ld()){T==o&&(T=0),T>=S&&(T=S-1),0>T&&(T=0);for(var w=T;w>=0;w--){var v=R.get(w);if(!v.isDisabled())return R.select(v),v}for(w=T+1;S>w;w++)if(v=R.get(w),!v.isDisabled())return R.select(v),v}},getTabWidth:function(g){var x=4,u=Wl(g.getIcon());u&&(x+=lj(u,g)+4);var X=this.getLabel(g);return X&&(x+=Xd(this.getLabelFont(g),X).width+4),g.isClosable()&&(x+=10),x},drawTab:function(n,V,x,C,m,F,N){var B,w=this,l=w._tabPosition,k=x+4,W=w._selectWidth,D=Wl(V.getIcon()),E=V.isDisabled(),p=w.getLabelColor(V),v=w.getLabelFont(V),c=w.getLabel(V),t=w._selectBackground,j=l===de+"-vertical",H=l===rb+"-vertical";(j||H)&&(k=C+4),E&&(n.globalAlpha=Bc),Ql(n,x,C,m,F,N),V===w._8o&&W&&(l===kl?Ql(n,x,C+F-W,m,W,t):l===de?Ql(n,x+m-W,C,W,F,t):l===rb?Ql(n,x,C,W,F,t):j?Ql(n,x+m-W,C,W,F,t):H?Ql(n,x,C,W,F,t):Ql(n,x,C,m,W,t));var R=m/2;if(j&&(Ii(n,R,C+F/2),Gg(n,s),Ii(n,-R,-C-F/2)),D){var h=sr(D,V),J=lj(D,V);if(j||H){var b=x+m/2,a=k+h/2;Ii(n,b,a),Gg(n,A),Ii(n,-b,-a),dj(n,D,x+m/2,k+h/2,V,w),Ii(n,b,a),Gg(n,-A),Ii(n,-b,-a),k+=h+4}else dj(n,D,k+J/2,C+F/2,V,w),k+=J+4}return j||H?(Ii(n,m/2,k+m/2),Gg(n,A),Ii(n,-m/2,-k-m/2),mc(n,c,v,p,x,k,F,m),Ii(n,m/2,k+m/2),Gg(n,-A),Ii(n,-m/2,-k-m/2)):mc(n,c,v,p,k,C,m,F),j&&(Ii(n,R,C+F/2),Gg(n,-s),Ii(n,-R,-C-F/2)),V.isClosable()&&(B=H?{x:x+m-12,y:C+F-12,width:12,height:12}:{x:x+m-12,y:C+2,width:12,height:12},this.drawCloseIcon(V,n,p,B)),E&&(n.globalAlpha=1),B},drawCloseIcon:function(Q,w,l,h){var M=h.x,f=h.y;w.strokeStyle=l,w.lineWidth=1,w.beginPath(),w.moveTo(M+2,f+8),w.lineTo(M+8,f+2),w.moveTo(M+8,f+8),w.lineTo(M+2,f+2),w.stroke()},getTabAt:function(d){var $=this._interactor._8Q(d);return $?$.tab:null},validateImpl:function(){var x=this;x._24o();var I,S=x._canvas,P=x._tabPosition,f=x._91O,z=x._92O,v=x._tabModel,s=x.getWidth(),w=x.getHeight(),l=x._tabHeight,m=x._7o,d=x._tabGap,o=P===kl,O=P===de,Y=P===rb,t=P===de+"-vertical",u=P===rb+"-vertical",e=x._23o,R=0;if((O||Y)&&v._roots.each(function(_){R=J(x.getTabWidth(_),R)}),o?(pq(f,0,0,s,l),I={x:0,y:l,width:s,height:J(0,w-l)}):O?(pq(f,0,0,R,w),I={x:R,y:0,width:J(0,s-R),height:w}):Y?(pq(f,s-R,0,R,w),I={x:0,y:0,width:J(0,s-R),height:w}):t?(pq(f,0,0,l,w),I={x:l,y:0,width:J(0,s-l),height:w}):u?(pq(f,s-l,0,l,w),I={x:0,y:0,width:J(0,s-l),height:w}):(pq(f,0,w-l,s,l),I={x:0,y:0,width:s,height:J(0,w-l)}),pq(z,I),t||u){x._9o&&(I.x=0,pq(x._8o.getView(),I)),ol(S,l,w);var W=vp(S),p=0;if(ln(W,0,x.ty(),1),W.clearRect(0,0,l,w),m.clear(),v._roots.each(function(i){if(i.isVisible()){var t,F=x.getTabWidth(i);e&&e.tab===i||(t=x.drawTab(W,i,0,p,l,F,x._tabBackground)),m.add({_75o:t,tab:i,startY:p,endY:p+F,height:F}),p+=F+d}}),x._23Q=J(0,p-d),e){var B=e.position;x.drawTab(W,e.tab,0,e.startY,l,e.height,x._moveBackground),Ql(W,0,B,l,1,x._insertColor)}if(W.restore(),x._selectionChanged){x._selectionChanged=!1;for(var k=x.ty(),E=0;E<m.size();E++){var i=m.get(E);if(i.tab===x._8o){if(i.endY+k<0){x.ty(-i.startY);break}if(i.startY+k>w){x.ty(w-i.endY);break}}}}x.ty(x.ty())}else if(O||Y){x._9o&&(I.x=0,pq(x._8o.getView(),I)),ol(S,R,w);var W=vp(S),p=0;if(ln(W,0,x.ty(),1),W.clearRect(0,0,R,w),m.clear(),v._roots.each(function(Z){if(Z.isVisible()){var E;e&&e.tab===Z||(E=x.drawTab(W,Z,0,p,R,l,x._tabBackground)),m.add({_75o:E,tab:Z,startY:p,endY:p+l,height:l}),p+=l+d}}),x._23Q=J(0,p-d),e){var B=e.position;x.drawTab(W,e.tab,0,e.startY,R,e.height,x._moveBackground),Ql(W,0,B,R,1,x._insertColor)}if(W.restore(),x._selectionChanged){x._selectionChanged=!1;for(var k=x.ty(),E=0;E<m.size();E++){var i=m.get(E);if(i.tab===x._8o){if(i.endY+k<0){x.ty(-i.startY);break}if(i.startY+k>w){x.ty(w-i.endY);break}}}}x.ty(x.ty())}else{x._9o&&(I.y=0,pq(x._8o.getView(),I)),ol(S,s,l);var W=vp(S),q=0;if(ln(W,x.tx(),0,1),W.clearRect(0,0,s,l),m.clear(),v._roots.each(function(j){if(j.isVisible()){var L,G=x.getTabWidth(j);e&&e.tab===j||(L=x.drawTab(W,j,q,0,G,l,x._tabBackground)),m.add({_75o:L,tab:j,startX:q,endX:q+G,width:G}),q+=G+d}}),x._64I=J(0,q-d),e){var B=e.position;x.drawTab(W,e.tab,e.startX,0,e.width,l,x._moveBackground),_h(W,x._insertColor,B,0,l)}if(W.restore(),x._selectionChanged){x._selectionChanged=!1;for(var b=x.tx(),E=0;E<m.size();E++){var i=m.get(E);if(i.tab===x._8o){if(i.endX+b<0){x.tx(-i.startX);break}if(i.startX+b>s){x.tx(s-i.endX);break}}}}x.tx(x.tx())}for(var K=[],a=z.children,E=0;E<a.length;E++){var G=a[E],U=G._tab_;U&&!v.contains(U)&&K.push(G)}K.forEach(function(o){z.removeChild(o)})}});var Xn=function(P){this.tv=P,this.addListeners()};_p(Xn,v,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(Y){this.handleScroll(Y,10*(Y.wheelDelta/40))},handle_DOMMouseScroll:function(T){this.handleScroll(T,10*-T.detail)},handleScroll:function(u,o){Eb(u);var D=this.tv,m=D._tabPosition;!D._40o()||m!==kl&&m!==uo||D.tx(this.tv.tx()+o),!D._41o()||m!==de&&m!==rb&&m!==de+"-vertical"&&m!==rb+"-vertical"||D.ty(this.tv.ty()+o)},_8Q:function(j){var Q,l,G=this.tv,T=G._tabPosition,c=G._7o;if(T===kl||T===uo){var C=G.lp(j).x;for(Q=0;Q<c.size();Q++)if(l=c.get(Q),l.startX<=C&&C<=l.endX)return l}else if(T===de||T===rb||T===de+"-vertical"||T===rb+"-vertical"){var W=G.lp(j).y;for(Q=0;Q<c.size();Q++)if(l=c.get(Q),l.startY<=W&&W<=l.endY)return l}return o},isClickable:function(S){var P=this.tv,C=P._tabPosition,u=this._73o=this._8Q(S);return!P._40o()||C!==kl&&C!==uo?!P._41o()||C!==de&&C!==rb&&C!==de+"-vertical"&&C!==rb+"-vertical"?u&&(!u.tab.isDisabled()||P.isMovable()):!0:!0},handle_mousemove:function(B){var $=this;mm?$._74o=$._8Q(B):$.getView().style.cursor=$.isClickable(B)?eb:""},handle_mousedown:function(b){this.handle_mousemove(b),this.handle_touchstart(b)},handle_touchstart:function(U){var J=this,k=J.tv,I=k._tabPosition;Eb(U),oh(U)&&J.isClickable(U)&&(I===kl||I===uo?(J.x=Qf(U).x,J.lp=k.lp(U),J.tx=k.tx()):(J.y=Qf(U).y,J.lp=k.lp(U),J.ty=k.ty()),Fr(J,U))},handleWindowMouseMove:function(i){this.handleWindowTouchMove(i)},handleWindowTouchMove:function(t){var C,s=this,S=s.tv,l=S._tabPosition,H=s._73o;if(l===kl||l===uo){if(C=Qf(t).x-s.x,!s._25o&&!s.moving&&T(C)>2&&(S._40o()&&!tl(t)?s._25o=1:H&&S.isMovable()&&(s.moving=1)),s._25o)S.tx(s.tx+C);else if(s.moving){var B=s.lp.x+C,N=S._tabGap/2;S._7o.each(function(h){var b=h.endX,p=B-h.startX<b-B;B>=h.startX&&b>=B&&S._7Q({tab:H.tab,startX:H.startX+C,width:H.width,front:p,insertTab:h.tab,position:p?J(0,h.startX-N):m(S._64I,b+N)})})}}else if(C=Qf(t).y-s.y,!s._25o&&!s.moving&&T(C)>2&&(S._41o()&&!tl(t)?s._25o=1:H&&S.isMovable()&&(s.moving=1)),s._25o)S.ty(s.ty+C);else if(s.moving){var D=s.lp.y+C,N=S._tabGap/2;S._7o.each(function(X){var V=X.endY,i=D-X.startY<V-D;D>=X.startY&&V>=D&&S._7Q({tab:H.tab,startY:H.startY+C,height:H.height,front:i,insertTab:X.tab,position:i?J(0,X.startY-N):m(S._23Q,V+N)})})}},handleWindowMouseUp:function(J){this.handleWindowTouchEnd(J)},handleWindowTouchEnd:function(){var j=this,P=j.tv,m=P._tabPosition,N=P.getTabModel(),S=N._roots,e=j._73o;if(j.moving){var V=P._23o;if(V&&V.insertTab!==V.tab){var l=V.tab,s=S.remove(l),x=S.indexOf(V.insertTab);x>=0&&(V.front||x++,x<=S.size()&&(S.add(l,x),N._38I(l,s,x)))}P._7Q(o),delete j.moving}else if(!j._25o&&e){l=e.tab;var Y=j._74o;if(!Y||Y.tab===l)if(!l.isDisabled()&&lq(e._75o,j.lp)){var F=function(){var b=S.indexOf(l);N.remove(l),P.onTabClosed(l,b)};P.onTabClosing(l,F)&&F()}else l.isDisabled()||P._8o===l||N.sm().ss(l)}j._25o=j._73o=j._74o=m===kl||m===uo?j.x=j.lp=j.tx=o:j.y=j.lp=j.ty=o}}),ym.PropertyView=function(R){var l=this;l._view=jh(1,l),l._canvas=ep(l._view),ke(l._view,l._79O=tq()),l._rows=new Uh,l._28o=new Uh,l._26o={},l._26Q={};var p=l._propertyModel=new hd,T=l.ivm;p.mm(T,l),p.md(T,l),p.mh(T,l),l.dm(R?R:new hd),new Ge(l)},_m("PropertyView",v,{ms_ac:[tr,rh,mh,hn,Bj,"categorizable",$g,Ae,El,Db,qd,Gp,Mi,vf,"selectRowIndex",bo,"background",pb,Cb,Jn,gg,xb],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:xh,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Ij,_background:w.propertyViewBackground,_expandIcon:w.propertyViewExpandIcon,_collapseIcon:w.propertyViewCollapseIcon,_scrollBarColor:Gn,_scrollBarSize:me,_autoHideScrollBar:Xg,_selectBackground:w.propertyViewSelectBackground,_rowHeight:Zg,_rowLineVisible:w.propertyViewRowLineVisible,_rowLineColor:w.propertyViewRowLineColor,_10I:.5,_columnLineVisible:w.propertyViewColumnLineVisible,_columnLineColor:w.propertyViewColumnLineColor,_labelColor:w.propertyViewLabelColor,_labelSelectColor:w.propertyViewLabelSelectColor,_labelFont:w.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(C){0>C&&(C=0),C>1&&(C=1);var E=this,r=E._10I;E._10I=C,E.fp("columnPosition",r,C)},getPropertyName:function(Z){return Z.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(A,N,Q){return Q===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(z,P){return P===this._selectRowIndex?this._labelSelectColor:z.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(E){var L=this.getHeight()-this._59I;return L>E&&(E=L),E>0?0:f(E)},isExpanded:function(p){if(!p)return!0;var A=this._26o[p];return A?A.isExpanded:!(this._26Q[p]===!1)},toggle:function(Q){var f=this;f.isExpanded(Q)?f.collapse(Q):f.expand(Q)},expandAll:function(){this.validate();for(var j in this._26o)this.expand(j)},expand:function(e){if(e&&e!==sl){var a=this,L=a._26o[e];L&&!L.isExpanded&&(L.isExpanded=!0,a.onExpanded(e),a.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var a in this._26o)this.collapse(a)},collapse:function(M){if(M&&M!==sl){var V=this,p=V._26o[M];p&&p.isExpanded&&(p.isExpanded=!1,V.onCollapsed(M),V.ivm())}},onCollapsed:function(){},getCategoryName:function(g){if(!this.isCategorizable())return sl;var j=g.getCategoryName();return j?j:sl},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(L){var k=this,J=k._dataModel;J!==L&&(J&&(J.umd(k.handlePropertyChange,k),k._selectionModel||J.sm().ums(k.handleSelectionChange,k)),k._dataModel=L,L.md(k.handlePropertyChange,k),k._selectionModel?k._selectionModel._21I(L):L.sm().ms(k.handleSelectionChange,k),k.fp(Ur,J,L))},isVisible:function(Q){return this._visibleFunc?this._visibleFunc(Q):!0},onPropertyChanged:function(s){var p=this,I=s.property;wf[I]?p.ivm():p.iv(),I===Kk&&p._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Oo},handlePropertyChange:function(C){this._27o===C.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var I=this;I._96I||(I.setSelectRowIndex(-1),I._96I=1,I.iv())},redraw:function(){this.iv()},validateModel:function(){var g=this,P=g._rows,G=g._28o,i={},B=new Uh,m=g._27o;g.updateCurrentData(),m!==g._27o&&g.endEditing(),P.clear(),G.clear(),g.getRawProperties().each(function(v){if(g.isVisible(v)){B.add(v);var A=g.getCategoryName(v);i[A]||(G.add(A,A===sl?0:C),i[A]={isExpanded:g.isExpanded(A),properties:new Uh})}}),g._sortFunc&&B.sort(g._sortFunc);for(var u in g._26o)g._26Q[u]=g.isExpanded(u);g._26o=i,G.each(function(t){t!==sl&&P.add(t);var c=i[t];c.isExpanded&&B.each(function(W){g.getCategoryName(W)===t&&(c.properties.add(W),P.add({property:W,data:g._27o}))},g)})},validateImpl:function(){var p=this;p._76o(),p._96I&&(p.validateModel(),delete p._96I);var $=p._canvas,f=p.getWidth(),O=p.getHeight(),Q=-p.ty(),S=p._rowHeight,H=p._indent,D=f-H,C=p._rows,n=C.size(),Z=p._9I=H+D*p._10I,g=p._59I=n*S;ol($,f,O),p._29I={x:0,y:Q,width:f,height:O},p._31I=y(Q/S),p._14I=E((Q+O)/S),p._31I<0&&(p._31I=0),p._14I>n&&(p._14I=n);var B,G=vp($),Y=p._background;ln(G,0,-Q,1),G.beginPath(),G.rect(0,Q,f,O),G.clip(),G.clearRect(0,Q,f,O),p._93db(G),Y&&Ql(G,0,0,H,g,Y);for(var _=p._31I;_<p._14I;_++){var r=C.get(_),Q=S*_;if(pl(r))Y&&Ql(G,H,Q,D,S,Y),B=Wl(p.isExpanded(r)?p._expandIcon:p._collapseIcon),B&&im(G,B,dg,0,Q,H,S),G.save(),G.beginPath(),G.rect(H,Q,D,S),G.clip(),p.drawCategoryName(G,r,_,H,Q,D,S),G.restore();else{var x=r.property,U=r.data,B=Wl(x.getIcon()),s=p._selectRowIndex===_?p.getSelectBackground():o;if(B&&im(G,B,dg,0,Q,H,S),s&&Ql(G,H,Q,D,S,s),G.save(),G.beginPath(),G.rect(H,Q,Z-H,S),G.clip(),p.drawPropertyName(G,x,_,H,Q,Z-H,S),G.restore(),!p.isEditing(U,x)){var i=Z+1,e=f-Z-1;G.save(),G.beginPath(),G.rect(i,Q,e,S),G.clip(),p._87o(p.drawPropertyValue(G,x,p.getValue(U,x),_,i,Q,e,S,U),_,i,Q,e,S),G.restore()}}p._rowLineVisible&&Ql(G,H,Q+S-1,D,1,p._rowLineColor)}p._columnLineVisible&&(Ql(G,Z,0,1,g,p._columnLineColor),Ql(G,f-1,0,1,g)),p._92db(G),p._93I(),G.restore(),p.ty(p.ty())},drawCategoryName:function(F,w,h,x,d,H,b){mc(F,w,this.getCategoryFont(w),this.getCategoryColor(w),x,d,H,b)},drawPropertyName:function(c,m,s,J,A,G,P){return m.drawPropertyName?(m.drawPropertyName(c,m,s,J,A,G,P,this),void 0):(mc(c,this.getPropertyName(m),this.getPropertyFont(m,s),this.getPropertyColor(m,s),J,A,G,P),void 0)},drawPropertyValue:function(Q,O,K,f,k,$,P,x,j){return O.drawPropertyValue?O.drawPropertyValue(Q,O,K,f,k,$,P,x,j,this):(tj(Q,K,O,this.getLabelFont(O,K,f),this.getLabelColor(O,K,f),k,$,P,x,j,this),void 0)},isPropertyEditable:function(x){return x.isEditable()&&this.isEditable()},setProperties:function(K){this._propertyModel.clear(),this.addProperties(K)},addProperties:function(t){if(t){var o=this._propertyModel;t.forEach(function(H){if(!(H instanceof Qq)){var Z=Yi(H.className);H=Zi(Z?Z:Qq,H)}o.add(H)})}},getRowIndexAt:function(N){var C=this,d=y(C.lp(N).y/C._rowHeight);return d>=0&&d<C._rows.size()?d:-1},getPropertyAt:function(V){var M=this,p=M.getRowIndexAt(V);return p>=0?M._rows.get(p).property:o},getToolTip:function(F){var r=this,p=r.getPropertyAt(F),M=r._27o;return p&&M?p.getToolTip(M,r._9I<r.lp(F).x,r):o}});var Ge=function($){this.pv=$,this.addListeners()};_p(Ge,v,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(e){this.getView().style.cursor=e},clear:function(){var O=this;O._62O=O.cp=O.ty=O.p=o,O.setCursor(Tf)},handle_mousedown:function(D){this.handle_touchstart(D)},handle_touchstart:function(D){var C=this,g=C.pv;Eb(D),g.setFocus(D)&&(oh(D)?(C.cp=Qf(D),C.ty=g.ty(),C.p=g.getColumnPosition(),C.handle_touchmove(D)):g.setSelectRowIndex(g.getRowIndexAt(D)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(x){this.handle_touchend(x)},handle_touchend:function(f){var o=this;if(o.cp&&!o._62O){var m=o.pv,r=m.lp(f),x=r.x,g=r.y,X=m._indent,J=m.getRowIndexAt(f),_=m._9I;if(J>=0){var l=m._rowHeight,h=l*J,P=m._rows.get(J),C=P.property;if(pl(P))Wl(m.isExpanded(P)?m._expandIcon:m._collapseIcon)&&x>=0&&X>=x&&g>=h&&h+l>=g?m.toggle(P):Gi(f)&&m.toggle(P);else if(x>_&&m.isPropertyEditable(C,f)){var Q={x:_+1,y:h,width:m.getWidth()-_-1,height:l},N={x:Q.x+m.tx(),y:Q.y+m.ty(),width:Q.width,height:Q.height},A=0,I=m._29I;Q.y<I.y?A=Q.y-I.y:Q.y+l>I.y+I.height&&(A=Q.y+l-I.y-I.height),A&&(m.ty(m.ty()-A),N.y-=A),m.beginEditing({data:P.data,property:C,value:m.getValue(P.data,C),event:f,rect:Q,editorRect:N,view:m})}}m.setSelectRowIndex(J)}o.clear()},handleWindowMouseMove:function(l){this.handleWindowTouchMove(l)},handleWindowTouchMove:function(q){var r=this,H=r.pv,a=r.ty,L=r.cp,X=Qf(q),t=r._62O;if("p"===t)H.setTranslateY(a+X.y-L.y);else if("c"===t){var B=H.getWidth()-H._indent;if(B>16){var _=r.p-(L.x-X.x)/B,N=16/B;N>_&&(_=N),_>1-N&&(_=1-N),H.setColumnPosition(_)}}else"s"===t&&H.setTranslateY(a+(L.y-X.y)*H._59I/H._29I.height)},handle_mousemove:function(p){this.handle_touchmove(p)},handle_touchmove:function(p){if(!mm&&oh(p)){var o=this,M=o.pv,E=T(M.lp(p).x-M._9I)<=(Em?8:3);
o.cp?o._62O||(E?(o._62O="c",Fr(o)):T(Qf(p).y-o.cp.y)>=2&&(o._62O=o.isV(p)?"s":"p",Fr(o))):(E?o.setCursor(wk):o.setCursor(Tf),o.isV(p)&&M._43o())}},isV:function(a){var W=this.pv,u=W._29I;return W._41o()&&u.x+u.width-W.lp(a).x<zo},handle_mousewheel:function(H){this.handleScroll(H,H.wheelDelta/40)},handle_DOMMouseScroll:function(d){2===d.axis&&this.handleScroll(d,-d.detail)},handleScroll:function(S,h){var U=this.pv;Eb(S),U.endEditing(),U.translate(0,h*U.getRowHeight())},handle_keydown:function(h){var c=this.pv,W=c._rows.size(),x=c._selectRowIndex+(ni(h)?-1:1);(ni(h)||Bd(h))&&(0>x&&(x=0),x>=W&&(x=W-1),c.setSelectRowIndex(x))}}),ym.ListView=function(A){this._5o(A),new An(this)},_m("ListView",v,{ms_ac:[tr,rh,mh,pb,$g,Cb,Jn,Ae,El,Gp,Mi,vf,Np,bo],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Ij,_rowHeight:Zg,_rowLineVisible:w.listViewRowLineVisible,_rowLineColor:w.listViewRowLineColor,_scrollBarColor:Gn,_scrollBarSize:me,_autoMakeVisible:Fd,_autoHideScrollBar:Xg,_selectBackground:w.listViewSelectBackground,_labelColor:w.listViewLabelColor,_labelSelectColor:w.listViewLabelSelectColor,_labelFont:w.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(y){var c=this,r=c._checkMode;c._checkMode=y,c.fp(Gf,r,y)},drawRow:function(f,H,a,C,i,z,W){var t=this,M=0,$=t._indent,c=t.getIconWidth(H);t.drawRowBackground(f,H,a,C,i,z,W),t._checkMode&&(dj(f,Wl(t.getCheckIcon(H)),M+$/2,i+W/2,H,t),M+=$),t.drawIcon(f,H,M,i,c,W),t.drawLabel(f,H,M+c,i,W)}});var An=function(x){this.list=x,this._lastSelectDataTime=Pg(),this.addListeners()};_p(An,v,{ms_listener:1,getView:function(){return this.list._view},clear:function(O){var N=this,_=N.list;O&&"d"===N._62O&&!N.dragCancel&&_.handleDragAndDrop(O,"end"),_.draggingData&&(_.draggingData=null,_.redraw()),N.dragCancel=N._62O=N._isV=N._isH=N.cp=N.tx=N.ty=o},handle_mousedown:function(W){this.handle_touchstart(W)},handle_touchstart:function(o){var C=this,D=C.list;if(Eb(o),D.setFocus(o)){var r=D.getDataAt(o);C.cp=Qf(o),C.tx=D.tx(),C.ty=D.ty(),oh(o)?r&&D.handleDragAndDrop&&!C.isV(o)&&!C.isH(o)&&(D.draggingData=r,D.redraw(),D.handleDragAndDrop(o,"prepare")):(r&&C._33o(o,r),C.clear(o))}},handleWindowMouseUp:function(E){this.clear(E)},handleWindowTouchEnd:function(p){this.clear(p)},handle_mouseup:function(Z){this.handle_touchend(Z)},handle_touchend:function(q){var o=this,P=o.list;if(!o._isV&&!o._isH&&o.cp&&!o._62O){var K=P.getDataAt(q);K?(P.isCheckMode()?o._34o(q,K):o._33o(q,K),Gi(q)?P.onDataDoubleClicked(K,q):P.onDataClicked(K,q)):P.handleBackgroundClick(q)}o.clear(q)},handleWindowMouseMove:function(P){this.handleWindowTouchMove(P)},handleWindowTouchMove:function(V){var v=this,m=v.list,t=v._62O,e=v.tx,k=v.ty,N=v.cp,g=Qf(V),b=m._29I;"p"===t?m.setTranslate(e+g.x-N.x,k+g.y-N.y):"v"===t?m.ty(k+(N.y-g.y)*m._59I/b.height):"h"===t?m.tx(e+(N.x-g.x)*m._91I/b.width):"d"===t&&(v.dragCancel||m.handleDragAndDrop(V,"between"))},handle_mousemove:function(W){this.handle_touchmove(W)},handle_touchmove:function(f){if(!mm&&oh(f)){var N=this,F=N.list;if(N._isV=N.isV(f),N._isH=N.isH(f),N.cp){if(!N._62O){if($q(Qf(f),N.cp)<2)return;N._isV?N._62O="v":N._isH?N._62O="h":F.draggingData&&!this.dragCancel?(N._62O="d",F.handleDragAndDrop(f,"begin")):N._62O="p",N._62O&&"d"!==N._62O&&F.draggingData&&(F.draggingData=null,F.redraw()),Fr(N)}}else N._isV&&F._43o(),N._isH&&F._42o()}},isV:function(n){var b=this.list,N=b._29I;return b._41o()&&N.x+N.width-b.lp(n).x<zo},isH:function(J){var L=this.list,E=L._29I;return L._40o()&&E.y+E.height-L.lp(J).y<zo},handle_mousewheel:function(R){this.handleScroll(R,R.wheelDelta/40,R.wheelDelta!==R.wheelDeltaX)},handle_DOMMouseScroll:function(C){this.handleScroll(C,-C.detail,1)},handleScroll:function(e,g,A){var O=this.list;Eb(e),O.endEditing&&O.endEditing(),A&&O._41o()?O.translate(0,g*O.getRowHeight()):O._40o()&&O.translate(10*g,0)},handle_keydown:function(J){if(!w.isInput(J.target)){var s,C=this.list,n=C.sm(),o=C._rows,g=o.size();if(Fp(J))C.selectAll();else if(jp(J))C.handleDelete&&C.handleDelete(J);else if(Ph(J))"d"!==this._62O||this.dragCancel||(C.handleDragAndDrop(J,"cancel"),this.dragCancel=!0);else if(rp(J))C.isCheckMode()&&(s=C.getFocusData(),s&&C.checkData(s));else if(ni(J)||Bd(J)){var I=C.isCheckMode();if(s=I?C.getFocusData():n.ld()){var h=C.getRowIndex(s);h>=0&&(ni(J)?0!==h&&(s=o.get(h-1),I?C.setFocusData(s):n.ss(s)):h!==g-1&&(s=o.get(h+1),I?C.setFocusData(s):n.ss(s)))}else g>0&&(s=o.get(0),I?C.setFocusData(s):n.ss(s))}}},_34o:function(i,L){var x=this.list,u=x.lp(i).x;return u>=0&&u<=x._indent?(x.checkData(L),void 0):(x.setFocusData(L),void 0)},_33o:function(J,b){var k=this.list,d=k.sm(),n=d.ld();if(tl(J))k.isSelected(b)?d.rs(b):d.as(b);else if(gb(J))if(n)for(var A=k.getRowIndex(n),q=k.getRowIndex(b);A!==q;)A+=q>A?1:-1,d.as(k._rows.get(A));else d.ss(b);else if(oh(J)){var F=Pg();if(d.contains(b)){var w=F-this._lastSelectDataTime;k.handleDataDoubleSelect&&w>500&&1500>w&&k.handleDataDoubleSelect(J,b)}d.ss(b),this._lastSelectDataTime=F}else d.contains(b)||d.ss(b)}}),ym.TreeView=function(d){var K=this;K._35o(),K._5o(d),new be(K)},_m("TreeView",v,{ms_ac:[tr,rh,mh,"rootVisible",Gf,"rootData",Ae,El,Gp,Mi,vf,$g,pb,Cb,Jn,Db,qd,Np,bo,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:o,_indent:Ij,_rowHeight:Zg,_rowLineVisible:w.treeViewRowLineVisible,_rowLineColor:w.treeViewRowLineColor,_scrollBarColor:Gn,_scrollBarSize:me,_autoHideScrollBar:Xg,_expandIcon:w.treeViewExpandIcon,_collapseIcon:w.treeViewCollapseIcon,_autoMakeVisible:Fd,_selectBackground:w.treeViewSelectBackground,_labelColor:w.treeViewLabelColor,_labelSelectColor:w.treeViewLabelSelectColor,_labelFont:w.treeViewLabelFont,_doubleClickToToggle:w.treeViewDoubleClickToToggle,drawRow:function(Q,e,v,B,N,d,h){var r=this;r.drawRowBackground(Q,e,v,B,N,d,h),r._97I(Q,e,v,0,N,d,h)},isOnToggleIcon:function(v){var O=this.getDataAt(v);if(O){var z=this.getIndent(),w=this.lp(v).x;if(Wl(this.getToggleIcon(O))){var e=z*this.getLevel(O);if(w>=e&&e+z>=w)return!0}}return!1}});var be=function(_){ek(be,this,[_])};_p(be,An,{toggle:function(J,M,k,Y){var I=this.list,Q=I.lp(J).x;if(Wl(I.getToggleIcon(M))){var d=k*Y;if(Q>=d&&d+k>=Q)return I.toggle(M),!0}return I.isDoubleClickToToggle()&&Gi(J)?(I.toggle(M),!0):!1},_34o:function(S,D){var G=this.list,H=G.lp(S).x,F=G._levelMap[D._id],V=G._indent,e=V*(F+1);return H>=e&&e+V>=H?(G.checkData(D),void 0):(this.toggle(S,D,V,F)||G.setFocusData(D),void 0)},_33o:function(P,$){var d=this,L=d.list;d.toggle(P,$,L._indent,L.getLevel($))||be.superClass._33o.call(d,P,$)},handle_keydown:function(n){if(us(n)||nq(n)){var M=this.list,P=M._rows,v=M.isCheckMode(),D=M.sm(),e=v?M.getFocusData():D.ld();e?e.hasChildren()&&(us(n)?M.collapse(e):M.expand(e)):P.size()>0&&(e=P.get(0),v?M.setFocusData(e):D.ss(e))}else be.superClass.handle_keydown.call(this,n)}});var ds=ym.TableView=function(l){this._98I(),this._5o(l),new pj(this)};_m("TableView",v,{ms_ac:[tr,rh,mh,"sortMode",hn,Bj,pb,Cb,Jn,gg,xb,"sortColumn",Ae,El,Gp,Mi,vf,Np,bo],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Wh,_editable:!0,_batchEditable:!1,_rowHeight:Zg,_rowLineVisible:w.tableViewRowLineVisible,_rowLineColor:w.tableViewRowLineColor,_columnLineVisible:w.tableViewColumnLineVisible,_columnLineColor:w.tableViewColumnLineColor,_scrollBarColor:Gn,_scrollBarSize:me,_autoHideScrollBar:Xg,_autoMakeVisible:Fd,_selectBackground:w.tableViewSelectBackground,_labelColor:w.tableViewLabelColor,_labelSelectColor:w.tableViewLabelSelectColor,_labelFont:w.tableViewLabelFont,getCheckColumn:function(){var Z=this;if(!Z._31o){var p=Z._31o=new Cj;p.setEditable(!0),p.setWidth(40),p.getValue=Z.getCheckColumValue,p.drawCell=Z.drawCheckColumnCell}return Z._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(A){var f=this,o=f._39o,h=f.getCheckColumn();A!==f.isCheckMode()&&(A?o.add(h,0):o.remove(h),f.fp(Gf,!A,A))},getCheckColumValue:function(D,S,G){return G.isSelected(D)},drawCheckColumnCell:function(b,h,e,a,P,V,_,I,q){dj(b,q.getCheckIcon(h),P+_/2,V+I/2,h,q)}});var pj=function(X){ek(pj,this,[X])};_p(pj,An,{_34o:function(f,F){var O=this.list,R=O._31o;if(O.isCellEditable(F,R,f)){var V=O._3Q(R),Y=O.lp(f).x;if(V&&Y>=V.startX&&Y<V.startX+R.getWidth())return O.checkData(F),void 0}O._37O(F,f),O.setFocusData(F)},_33o:function(K,F){this.list._37O(F,K),pj.superClass._33o.apply(this,arguments)}});var ae=ym.TreeTableView=function(H){var x=this,e=x._4o=new Cj;x._35o(),x._98I(),x._5o(H),e.setDisplayName("Name"),e.setEditable(!0),e.setWidth(180),e.drawCell=$j,e.getValue=lr,x._39o.add(e),new pn(x)},$j=function(j,l,q,z,R,g,v,A,u){u._97I(j,l,q,R,g,v,A)},lr=function(J,X,L){return L.getLabel(J)};_m("TreeTableView",v,{ms_ac:[tr,rh,mh,"sortMode",hn,Bj,$g,Gf,"rootData","rootVisible",Ae,El,"sortColumn",Db,qd,Gp,Mi,vf,Np,Jn,pb,Cb,gg,xb,bo,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Wh,_checkMode:o,_editable:!0,_batchEditable:!1,_indent:Ij,_rowHeight:Zg,_rowLineVisible:w.treeTableViewRowLineVisible,_rowLineColor:w.treeTableViewRowLineColor,_columnLineVisible:w.treeTableViewColumnLineVisible,_columnLineColor:w.treeTableViewColumnLineColor,_expandIcon:w.treeTableViewExpandIcon,_collapseIcon:w.treeTableViewCollapseIcon,_scrollBarColor:Gn,_scrollBarSize:me,_autoHideScrollBar:Xg,_autoMakeVisible:Fd,_selectBackground:w.treeTableViewSelectBackground,_labelColor:w.treeTableViewLabelColor,_labelSelectColor:w.treeTableViewLabelSelectColor,_labelFont:w.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var pn=function(o){ek(pn,this,[o])};_p(pn,An,{_34o:function(I,S){var E=this.list,$=E._4o,F=E._3Q($),P=E.lp(I).x;if(F){var L=E._indent,n=F.startX+L*E.getLevel(S);if(Wl(E.getToggleIcon(S))&&P>=n&&n+L>=P)return E.toggle(S),void 0;if(E.isCellEditable(S,$)&&(n+=L,P>=n&&n+L>=P))return E.checkData(S),void 0}E._37O(S,I),E.setFocusData(S)},_33o:function(C,M){var E=this.list,x=E.lp(C).x;if(Wl(E.getToggleIcon(M))){var d=E._3Q(E._4o);if(d){var R=E._indent,Y=d.startX+R*E.getLevel(M);if(x>=Y&&Y+R>=x)return E.toggle(M),void 0}}E._37O(M,C),pn.superClass._33o.apply(this,arguments)}});var Ci=ym.TableHeader=function(V){var X=this,M=X._view=jh(1,X),j=X._39o=V.getColumnModel(),s=X.iv;X.tv=X._tableView=V,X._60I=new Uh,X._canvas=ep(M),M.style.background=w.tableHeaderBackground||"",M.style.height=Nq+lo,j.mm(s,X),j.md(s,X),j.mh(s,X),V.mp(function(C){Rg[C.property]&&X.iv()},X),new fr(X),X.iv()};_m("TableHeader",v,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",tr,mh,$g,"moveBackground","insertColor",gg,xb,"resizable","movable"],_checkIcon:ch,_movable:!0,_resizable:!0,_labelColor:w.tableHeaderLabelColor,_labelFont:w.tableHeaderLabelFont,_columnLineColor:w.tableHeaderColumnLineColor,_columnLineVisible:w.tableHeaderColumnLineVisible,_sortDescIcon:w.tableHeaderSortDescIcon,_sortAscIcon:w.tableHeaderSortAscIcon,_moveBackground:w.tableHeaderMoveBackground,_insertColor:w.tableHeaderInsertColor,_indent:Ij,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(N){return N.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(Y){return Y.getColor()||this._labelColor},getLabelAlign:function(O){return O._align},onPropertyChanged:function(){this.iv()},_5Q:function(Z){this._61I=Z,this.iv()},getLogicalPoint:function(S){return xk(S,this._canvas,this.tv.tx())},validateImpl:function(){var o=this,A=o._canvas,G=o.getWidth(),p=o.getHeight(),Q=o.tv,I=o._60I,U=o._61I,w=-Q.tx(),s=0;(G!==A.clientWidth||p!==A.clientHeight)&&ol(A,G,p),I.clear(),o._39o._roots.each(function(d){if(d.isVisible()){var n=s+d.getWidth();w+G>=s&&n>=w&&I.add({column:d,startX:s}),s=n}});var W=vp(A);if(ln(W,-w,0,1),W.beginPath(),W.rect(w,0,G,p),W.clip(),W.clearRect(w,0,G,p),I.each(function(B){var a=B.column,h=B.startX,l=a.getWidth();l>0&&(W.save(),W.beginPath(),W.rect(h,0,l,p),W.clip(),U&&U.column===a||o.drawColumn(W,a,h,0,l,p),o._columnLineVisible&&Ql(W,h+l-1,0,1,p,o._columnLineColor),W.restore())}),U){var R=U.column,s=U.startX,x=U.position,F=R.getWidth();W.save(),W.beginPath(),W.rect(s,0,F,p),W.clip(),W.fillStyle=o._moveBackground,W.fill(),o.drawColumn(W,R,s,0,F,p),W.restore(),_h(W,o._insertColor,x,0,p)}W.restore()},_6Q:function(l){var E=this.tv;return E._31o===l&&E.sm().getSelectionMode()===_b},drawColumn:function(h,E,B,g,m,o){var X=this,s=X.tv,p=Wl(E.getIcon()),Q=X.getLabelAlign(E);if(X._6Q(E)){var G=Wl(X._checkIcon);dj(h,G,B+m/2,g+o/2,E,X)}else{var O=X.getLabel(E),y=X.getLabelFont(E),c=X.getLabelColor(E),T=Xd(y,O).width,W=p?X._indent:0;Q===de?(p&&im(h,p,dg,B,g,W,o),mc(h,O,y,c,B+W,g,m,o,de)):Q===rb?(p&&im(h,p,dg,B+m-T-W,g,W,o),mc(h,O,y,c,B,g,m,o,rb)):(p&&im(h,p,dg,B+(m-T-W)/2,g,W,o),mc(h,O,y,c,B+(m-T+W)/2,g,0,o,de))}if(E.isSortable()&&s.getSortColumn()===E&&(p=Wl(E.getSortOrder()===Gq?X._sortAscIcon:X._sortDescIcon))){var I=lj(p,E)/2+2;dj(h,p,Q===rb?B+I:B+m-I,g+o/2,E,s)}}});var fr=function(h){var w=this;w.th=h,w.tv=h._tableView,w.addListeners()};_p(fr,v,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(y){this.getView().style.cursor=y},handle_mousemove:function(P){if(!mm){var L=this;delete L._29o,L.setCursor(Tf);for(var j=L.th,i=j._60I,b=j.lp(P).x,r=i.size()-1;r>=0;r--){var N=i.get(r),I=N.column,S=N.startX+I.getWidth();if(j.isResizable()&&T(S-b)<=(Em?10:3))return L._29o=N,L.setCursor(wk),void 0;b>N.startX&&S>b&&(L._29o=N),(I.isClickable()||I.isSortable()||j.isMovable()||L.tv.getCheckColumn&&I===L.tv.getCheckColumn())&&b>N.startX&&S>b&&L.setCursor(eb)}}},handle_mousedown:function(B){this.handle_touchstart(B)},handle_touchstart:function(A){var n=this;Eb(A),n.tv.endEditing(),n.handle_mousemove(A),n._29o&&(n.x=Qf(A).x,n.lx=n.th.lp(A).x,n.w=n._29o.column.getWidth(),Fr(n,A))},handleWindowMouseMove:function(n){this.handleWindowTouchMove(n)},handleWindowTouchMove:function(w){var B=this,R=B.th,h=B.getView().style.cursor,N=B._29o,U=Qf(w).x-B.x;if(B.resizing||B.moving||(h===wk?B.resizing=1:R.isMovable()&&h===eb&&T(U)>2&&(B.moving=1)),B.resizing)N.column.setWidth(B.w+U);else if(B.moving){var L=B.lx+U;R._60I.each(function(x){var H=x.startX,G=H+x.column.getWidth();if(L>=H&&G>=L){var w={column:N.column,startX:N.startX+U,front:G-L>L-H,insertColumn:x.column};w.position=w.front?H:G,R._5Q(w)}})}},_16Q:function(q,M){var V=this,u=V.tv,S=V.th,x=S._checkIcon;if(S._6Q(q)){var O=Wl(x),d=V.lx,I=q.getWidth(),C=lj(O,q);if(d>=M+I/2-C&&M+I/2+C>=d){S.setCheckIcon(x===rg?ch:rg);var v=u.sm(),w=u._rows;return x===rg?v.rs(w):v.ss(w),u.onCheckColumnClicked(q),!0}}return!1},handleWindowMouseUp:function(F){this.handleWindowTouchEnd(F)},handleWindowTouchEnd:function(N){var b=this,d=b.tv,Q=b.th,h=b._29o;if(b.moving){var r=Q._61I;if(r&&r.insertColumn!==r.column){var q=r.column,L=d.getColumnModel()._roots,K=L.remove(q),J=L.indexOf(r.insertColumn);J>=0&&(r.front||J++,J<=L.size()&&(L.add(q,J),d.getColumnModel()._38I(q,K,J)))}Q._5Q(o),delete b.moving}else if(!b.resizing&&h){q=h.column;var $=Q.lp(N).x,z=h.startX,O=!0;if(Q.onColumnClicked){var W=Q.onColumnClicked(q,N,z);W===!1&&(O=!1)}if(O&&$>=z&&$<=z+q.getWidth()&&!b._16Q(q,z)){if(q.isSortable()){var j=d.getSortMode(),S=q.getSortOrder();j===Wh?d.getSortColumn()===q?(S===mf&&d.setSortColumn(o),q.setSortOrder(S===Gq?mf:Gq)):d.setSortColumn(q):"bistate"===j&&(d.getSortColumn()===q?q.setSortOrder(S===Gq?mf:Gq):d.setSortColumn(q))}d.onColumnClicked(q,N,z)}}b._29o=b.resizing=b.x=b.lx=b.w=o}}),ym.TablePane=function(E){this.init(new ds(E))},_m("TablePane",v,{ms_v:1,_44o:1}),ym.TreeTablePane=function(f){this.init(new ae(f))},_m("TreeTablePane",v,{ms_v:1,_44o:1}),ym.Toolbar=function(t){var f=this,r=f._view=jh(1,f),M=r.style;M.background=w.toolbarBackground||"",M.height=gr+lo,f._canvas=ep(r),f._30o=new Uh,f._90I=new Uh,f.setItems(t||[]),r.handleGroupSelectedChanged=function(M){if(M.isSelected()){var l=M.getGroupId();null!=l&&f._items.forEach(function(Y){var j=Y.element;j&&j!==M&&j.setSelected&&j.getGroupId&&j.getGroupId()===l&&j.setSelected(!1)})}},new of(f)},_m("Toolbar",v,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[mn,tr,mh,rh,bo,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:w.toolbarLabelColor,_labelSelectColor:w.toolbarLabelSelectColor,_labelFont:w.toolbarLabelFont,_selectBackground:w.toolbarSelectBackground,_itemGap:w.toolbarItemGap,_separatorColor:w.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(q){var j=this.getItemInfoAt(q);return j?j.item.toolTip:o},getLabelColor:function(g){return g&&g.selected&&g.type!==rg&&g.type!==og?this._labelSelectColor:this._labelColor},onPropertyChanged:function(Y){this.iv(),Y.property===mn&&this._items.forEach(function(D){cl(D)})},redraw:function(){this.iv()},addItem:function(d,L){var p=this._items;L==o?p.push(d):p.splice(L,0,d),this.fp(mn,o,p)},removeItem:function(e){if(e)for(var j=this._items,M=0;M<j.length;M++)e===j[M]&&(j.splice(M,1),this.fp(mn,o,j))},removeItemById:function(b){if(b!=o)for(var n=this._items,L=0;L<n.length;L++)if(b===n[L].id){var m=n.splice(L,1)[0];return this.fp(mn,o,n),m}},getItemById:function(A){if(A!=o)for(var q=this._items,x=0;x<q.length;x++){var l=q[x];if(A===l.id)return l}},setItemVisible:function(U,X){var b=this.getItemById(U);b&&(b.visible=X)},getItemInfos:function(){return this._30o},getItemInfoAt:function(k){var l=this,C=0,$=l._30o,E=l.lp(k),F=E.x,t=E.y;if(t>=0&&t<=l.getHeight())for(;C<$.size();C++){var V=$.get(C);if(V.startX<=F&&F<=V.endX)return V}return o},drawItem:function(b,Q,R,d,D){if(Q.visible===!1)return 0;if(pg(Q.visible)&&!Q.visible())return 0;var L=this,A=Q.disabled;A&&(b.globalAlpha=Bc);var c=L.drawItemImpl(b,Q,R,d,D),n=L._itemGap;return A&&(b.globalAlpha=1),this._currentItem!==Q||"separator"===Q||Q.separator===!0||Q.unfocusable||Tc(b,L._separatorColor,R-n/2,0,c+n,d),c},drawItemImpl:function(D,k,R,g,$){var V=this,r=V._view,s=V._itemGap,p=g/2,T=k.type,B=k.element,v=k.label;pl(B)&&(v=B,B=o);var n,i=V.getLabelFont(k),l=V.getLabelColor(k),S=k.selected,C=Wl(k.icon),x=lj(C,k),f=0,j=x+(v?Xd(i,v).width:0);if("separator"===k||k.separator===!0)return _h(D,V._separatorColor,R,g/4,p),1;if(B){C&&dj(D,C,R+x/2,p,k,V),mc(D,v,i,l,R+x,0,0,g);var W=jg(B);$||V._90I.add(W),W.parentNode!==r&&ke(r,W),B.iv&&B.iv(),B.validate&&B.validate();var P=W.getBoundingClientRect(),Y=P.width,e=W.style;return Il(W),e.left=V.tx()+R+j+lo,e.top=(g-P.height)/2+lo,j+Y}return T===og?n=Wl(S?oe:gc):T===rg&&(n=Wl(S?rg:ch)),n?(f=lj(n,k),dj(D,n,R+f/2,p,k,V),R+=f,j+=f):S&&Ql(D,R-s/2,0,j+s,g,V.getSelectBackground(k)),C&&dj(D,C,R+x/2,p,k,V),mc(D,v,i,l,R+x,0,0,g),j},validateImpl:function(){var z=this,H=z._canvas,E=z.getWidth(),y=z.getHeight(),s=z._30o,p=z._items;ol(H,E,y);var L=vp(H),o=z._itemGap,B=o/2;ln(L,z.tx(),0,1),L.clearRect(0,0,E,y);var W=z._90I;z._90I=new Uh,s.clear(),p.forEach(function(G){var A=z.drawItem(L,G,B,y);s.add({item:G,startX:B,endX:B+A,width:A}),A&&(B+=A+o)}),W.each(function(u){z._90I.contains(u)||Cc(u)});var M=z._64I;z._64I=J(0,B),L.restore(),z._stickToRight?(z._65O=0,L=vp(H),B=E-z._64I+o,ln(L,0,0,1),L.clearRect(0,0,E,y),s.clear(),p.forEach(function(r){var S=z.drawItem(L,r,B,y,!0);s.add({item:r,startX:B,endX:B+S,width:S}),S&&(B+=S+o)}),L.restore()):z.tx(z.tx()),M!==z._64I&&z.onSumWidthChanged(M,z._64I)},onSumWidthChanged:function(){},handleClick:function(j,m){var A=this,N=j.type,w=j.action,r=j.groupId,a=j.selected;j.disabled||(r!=o?a||(j.selected=!0,this._items.forEach(function(G){G.groupId===r&&j!==G&&(G.selected=!1)}),w&&j.action(j,A,m)):N===rg||"toggle"===N?(j.selected=!a,w&&j.action(j,A,m)):w&&j.action(j,A,m)),Ul(),A.iv()}});var of=function(M){this.tb=M,this.addListeners()};_p(of,v,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(a){this.handleScroll(a,10*(a.wheelDelta/40))},handle_DOMMouseScroll:function(e){this.handleScroll(e,10*-e.detail)},handleScroll:function(N,y){Eb(N);var V=this.tb;V.isScrollable()&&!V._stickToRight&&(V.tx(V.tx()+y),Jb())},handle_mousemove:function($){var A=this;mm||A.setItem($)},handle_mouseout:function(A){var c=this;A.target===c.getView()?c.tb.setCurrentItem(o):c.handle_mousemove(A)},handle_mousedown:function(G){this.handle_mousemove(G),this.handle_touchstart(G)},handle_touchstart:function(C){var A=this,c=A.tb,T=C.target;oh(C)&&(T===A.getView()||T===c._canvas)&&(Eb(C),c.setFocus(C)&&(this.setItem(C,!0),(c.isScrollable()||A.info&&!A.info.item.disabled)&&(A.x=Qf(C).x,A.tx=c.tx(),Fr(A,C))))},handleWindowMouseMove:function(u){this.handleWindowTouchMove(u)},handleWindowTouchMove:function(x){var c=this,n=c.tb;if(!n._stickToRight){var M=Qf(x).x-c.x;!c._25o&&T(M)>2&&n.isScrollable()&&(c._25o=1),c._25o&&n.tx(c.tx+M)}},handleWindowMouseUp:function($){this.handleWindowTouchEnd($)},handleWindowTouchEnd:function(P){var W=this,k=W.tb,w=W.info,Y=W.tb.getItemInfoAt(P);if(!W._25o&&w){var Z=w.item;Y&&Y.item===Z&&k.handleClick(Z,P)}W._25o=W.x=W.tx=o,W.setItem()},setItem:function(B,S){var R=this,D=R.tb,n=R.info=B?D.getItemInfoAt(B):o,h=n?n.item:o;D.setCurrentItem(h),S&&h&&pg(h.onDown)&&h.onDown(B)}}),ym.BorderPane=function(){this._view=jh(1,this),this.iv()},_m("BorderPane",v,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(j,U){this._12o("leftView",j),U!=o&&this.setLeftWidth(U)},getRightView:function(){return this._rightView},setRightView:function(l,n){this._12o("rightView",l),n!=o&&this.setRightWidth(n)},getTopView:function(){return this._topView},setTopView:function(u,c){this._12o("topView",u),c!=o&&this.setTopHeight(c)},getBottomView:function(){return this._bottomView},setBottomView:function(X,z){this._12o("bottomView",X),z!=o&&this.setBottomHeight(z)},getCenterView:function(){return this._centerView},setCenterView:function(D){this._12o("centerView",D)},_12o:function(L,f){var W=this,b="_"+L,B=W._view,F=W[b];F!==f&&(F&&(F.getView?Cc(F.getView()):Cc(F)),W[b]=f,f&&(f.getView?ke(B,f.getView(),1):ke(B,f,1)),W.fp(L,F,f))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var d=this,O=d._topView,W=d._bottomView,b=d._leftView,h=d._rightView,v=d._centerView,r=d.getWidth(),y=d.getHeight(),Z=0,R=0,H=r,G=y,m=0,M=0,T=0,n=0;O&&(m=d._topHeight==o?bq(O):d._topHeight,R=m),W&&(M=d._bottomHeight==o?bq(W):d._bottomHeight,G=y-M),b&&(T=d._leftWidth==o?vr(b):d._leftWidth,Z=T),h&&(n=d._rightWidth==o?vr(h):d._rightWidth,H=r-n);var j=J(0,H-Z),S=J(0,G-R);O&&pq(O,0,0,r,m),W&&pq(W,0,G,r,M),b&&pq(b,0,R,T,S),h&&pq(h,H,R,n,S),v&&pq(v,Z,R,j,S)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);