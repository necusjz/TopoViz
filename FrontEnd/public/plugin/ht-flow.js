!function(q){"use strict";var l=q.ht,J=l.Default,Y=J.getInternal(),R=Y.ui(),u=null,F="__segmentLengths",o="__lineTotalLength",b="__linePoints",B="__distance0",C="flow.count",D="flow.step",s="flow.element.max",n="flow.element.count",Q="flow.element.min",_="flow.element.space",d="flow.element.autorotate",x="flow.element.background",p="flow.element.shadow.max",y="flow.element.shadow.min",g="flow.element.shadow.begincolor",c="flow.element.shadow.endcolor",M="flow.element.shadow.visible",W="flow.element.image",f="flow",h=l.Math.Vector2,I=new h;new h,new h,l.List;var m=l.Default._edgeProtectMethod,E=m.getStraightLinePoints,G=function(M,I){for(var w=[],p=M.length,h=0;p>h;h++){var S=M[h];S._as&&(S=S._as);for(var C=S[0],K=1;K<S.length;K++)w.push([C,S[K]]),C=S[K]}for(var e=[],h=0;h<w.length;h++){var _=X(w[h][0],w[h][1],I);e.push(_)}return{distance:e,segments:w}},U=function(c,j,u){if(c){for(var v,C=G(c,j),L=C.distance,o=C.segments,e=1/0,l=null,x=0,d=L.length;d>x;x++){var E=L[x];E.z<e&&(v=x,e=E.z,l=E)}if(null==u&&(u=.1),l.z<u){for(var z=0,b=0;v>=b;b++)z+=J.getDistance(o[b][0],v>b?o[b][1]:l);return z}}},X=function(C,R,L){var V=C.x,n=C.y,T=R.x,I=R.y,o=L.x,y=L.y,c=T-V,G=I-n,k=Math.sqrt(c*c+G*G),d=c/k,P=G/k,U=(-V+o)*d+(-n+y)*P,X={x:V+U*d,y:n+U*P};return X.x>=Math.min(C.x,R.x)&&X.x<=Math.max(C.x,R.x)&&X.y>=Math.min(C.y,R.y)&&X.y<=Math.max(C.y,R.y)||(X.x=Math.abs(X.x-C.x)<Math.abs(X.x-R.x)?C.x:R.x,X.y=Math.abs(X.y-C.y)<Math.abs(X.y-R.y)?C.y:R.y),c=o-X.x,G=y-X.y,X.z=Math.sqrt(c*c+G*G),X},T=function(Y,E){if(Y){var w=G(Y,E).distance,f=1/0,L=null;return w.forEach(function(i){i.z<f&&(f=i.z,L=i)}),L}},j=m.calculateLineLength,V=m.calcSegmentIndexByDistance,N=m.calculatePointAlongLine,k=function(y,v,p){if(!y)return p;if(0===v){var i=y[0][0],G=y[0][1];return p+Math.atan2(G.y-i.y,G.x-i.x)}if(100===v){y=y[y.length-1];var i=y[y.length-2],G=y[y.length-1];return p+Math.atan2(G.y-i.y,G.x-i.x)}for(var e=0,$=[],h=y.length,k=0;h>k;k++){var l=y[k],C=j(l);e+=C,$.push(C)}for(var A=e*v/100,_=V(A,$),Y=0,B=0;_>B;B++)Y+=$[B];A-=Y;for(var z=N(y[_],A),H=y[_],I=0,R=0,S=0;S<H.length-1;S++){var T=H[S],w=H[S+1],c=w.x-T.x,q=w.y-T.y,b=Math.sqrt(c*c+q*q);if(I+=b,I>A){R=S;break}}var n=H[R];return p+Math.atan2(z.y-n.y,z.x-n.x)},t=function(t){var K=0;if(t)if(Array.isArray(t[0]))for(var v=t.length,U=0;v>U;U++){var q=t[U],F=j(q);K+=F}else K=j(t);return K},i=function(q,_,o,z){return I.set(_,o).rotateAround(null,z),q?{x:q.x+I.x,y:q.y+I.y}:{x:I.x,y:I.y}},a=function(P){var d=P._data,N=E(P);if(N){d.s("flow.reverse")&&(N.reverse(),N.forEach(function(c){c.reverse()}));for(var i=0,x=[],A=N.length,D=0;A>D;D++){var R=N[D],K=j(R);i+=K,x.push(K)}if(d[F]=x,d[o]=i,d[b]=N,d instanceof l.Edge){var $=J.unionPoint(N),q=$.x+$.width/2,B=$.y+$.height/2;d.$10e={x:q,y:B}}O(P,!0)}},K=m.getPercentPosition,O=function(_,O){var J=_._data,W=J[o],A=J.s(C),u=J.s(D),T=0,j=J[F],b=J.s(s),i=J.s(Q),G=J.s(n),d=(b-i)/(G-1),N=[];if(j){if(1===G)N.push(b);else if(2===G)N.push(b),N.push(i);else{if(!(G>2))return;N.push(b);for(var g=G-2;g>0;g--)N.push(i+d*g);N.push(i)}var H=0,M=0;N.forEach(function(g){G-1>H&&(M+=J.getFlowElementSpace(g)),H++}),M+=(b+i)/2,T=(W-A*M+M)/A;var q=_[B];for(null==q&&(q=0),O||(q+=u);q>W+M;){var t=_._overCount;t?t++:t=1,t>=A&&(t=null),_._overCount=t,J.s("flow.autoreverse")?t?q-=T+M:(q=0,J.s("flow.reverse",!J.s("flow.reverse"))):q-=T+M}_[B]=q}},S="prototype",e=l.graph.GraphView[S],L=l.Data[S],P=R.DataUI[S],w=R.ShapeUI[S],H=R.EdgeUI[S],v=l.DataModel[S],Z=l.Style;Z[s]==u&&(Z[s]=7),Z[Q]==u&&(Z[Q]=0),Z[C]==u&&(Z[C]=1),Z[D]==u&&(Z[D]=3),Z[n]==u&&(Z[n]=10),Z[_]==u&&(Z[_]=3.5),Z[d]==u&&(Z[d]=!1),Z[x]==u&&(Z[x]="rgba(255, 255, 114, 0.4)"),Z[g]==u&&(Z[g]="rgba(255, 255, 0, 0.3)"),Z[c]==u&&(Z[c]="rgba(255, 255, 0, 0)"),Z[M]==u&&(Z[M]=1),Z[p]==u&&(Z[p]=22),Z[y]==u&&(Z[y]=4),e.calculatePointLength=function(P,j,X){var K=this.getDataUI(P),m=E(K);return U(m,j,X)},J.calculatePointLength=function(J,V,M,R){var P=E(u,J,V);return U(P,M,R)},J.calculateClosestPointOnLine=X,e.calculateClosestPoint=function(r,C){var o=this.getDataUI(r),q=E(o);return T(q,C)},J.calculateClosestPoint=function(o,w,k){var $=E(u,o,w);return T($,k)},e.getPercentAngle=function(n,Q){var M=this.getDataUI(n),s=E(M);return n.getRotation?n.getRotation():0,k(s,Q,n.getRotation?n.getRotation():0)},J.getPercentAngle=function(v,J,M){var H=E(u,v,J);return k(H,M,0)},e.calculateLength=function(V){var g=this.getDataUI(V),L=E(g);return t(L)},J.calculateLength=function(h,l){var d=E(u,h,l);return t(d)},e.getPercentPosition=function(C,z){var Z=this.getDataUI(C),d=E(Z);return K(d,z)},J.getPercentPositionOnPoints=function(Y,S,B){var D=E(u,Y,S);return K(D,B)};var A=function(C){var L=C.data,W=this.dm();if(L&&"add"===C.kind){var P=W.$3e;P&&L.s(f)&&P.indexOf(L)<0&&P.push(L)}"clear"===C.kind&&(W.$3e=[])},r=function(U){var o=U.property,L=U.data,G=U.newValue,f=this.dm().$3e;if(f&&"s:flow"===o)if(G)f.indexOf(L)<0&&f.push(L);else for(var Q=f.length,K=0;Q>K;K++)if(f[K]===L){f.splice(K,1);break}},z=e.setDataModel;e.setDataModel=function(T){var V=this,J=V._dataModel;if(J!==T){J&&(J.umm(A,V),J.umd(r,V),J.$3e=[]),T.mm(A,V),T.md(r,V);var p=T.$3e=[];T.each(function(X){X.s(f)&&p.indexOf(X)<0&&p.push(X)}),z.call(V,T)}},L.getFlowElementSpace=function(){return this.s(_)};var $=function(e){var M=this,_=M._data,q=_[o],t=_[F],J=_[b],v=_.s(C),l=0,j=M[B],D=_.s(s),Z=_.s(Q),R=_.s(n),r=_.s(y),S=_.s(p),z=_.s(d),I=(S-r)/(R-1),Y=(D-Z)/(R-1),G=_.getRotation?_.getRotation():0,g=_.getPosition?_.p():_.$10e,T=[],m=[];if(j!=u){if(1===R)T.push(D);else if(2===R)T.push(D),T.push(Z);else{if(!(R>2))return;T.push(D);for(var f=R-2;f>0;f--)T.push(Z+Y*f);T.push(Z)}if(1===R)m.push(S);else if(2===R)m.push(S),m.push(r);else{if(!(R>2))return;m.push(S);for(var f=R-2;f>0;f--)m.push(r+I*f);m.push(r)}var E=0,k=0;T.forEach(function(e){R-1>E&&(k+=_.getFlowElementSpace(e)),E++}),k+=(D+Z)/2,l=(q-v*k+k)/v,e.save();for(var f=0;v>f;f++){var P=j,A=0,c=M._overCount,O=0;_.s("flow.autoreverse")&&c&&c>v-(f+1)||(P-=f*(l+k),E=0,T.forEach(function(y){var j=P-A;if(j>=0&&q>j){var K=!0,C=V(j,t);O=0;for(var B=0;C>B;B++)O+=t[B];if(j-=O,K){var Z=N(J[C],j),k=G;if(z){for(var W=J[C],n=0,Y=0,L=0;L<W.length-1;L++){var s=W[L],c=W[L+1],X=c.x-s.x,U=c.y-s.y,Q=Math.sqrt(X*X+U*U);if(n+=Q,n>j){Y=L;break}}var I=W[Y];k+=Math.atan2(Z.y-I.y,Z.x-I.x)}G&&(Z=i(g,Z.x-g.x,Z.y-g.y,G)),M.$5e(e,Z,y,m[E],k)}}A+=_.getFlowElementSpace(T[E]),E++}))}e.restore()}},Wl=H._80o;H._80o=function(J){Wl.call(this,J);var M=this,t=M._data,N=M.gv;t.s(f)&&N.$7e!=u&&$.call(M,J)};var Rh=w._80o;w._80o=function(F){Rh.call(this,F);var T=this,a=T._data,Z=T.gv;a.s(f)&&Z.$7e!=u&&$.call(T,F)};var Wi=H._79o,on=w._79o,Yq=function(){var i=this,E=i._data,x=E.s(s),K=!1,Q=u;if(i._6I||(K=!0),Q=E instanceof l.Edge?Wi.call(i):on.call(i),E.s(f)&&K){var r=E.s(p),v=E.s(M);v&&r>x&&(x=r),x>0&&J.grow(Q,Math.ceil(x/2)),a(i)}return!E.s(f)&&K&&(E[F]=E[o]=E[b]=i[B]=u),Q};w._79o=Yq,H._79o=Yq,P.$5e=function(S,j,B,C,E){var h=this,z=h._data,m=h.gv,V=z.s(x),D=z.s(g),I=z.s(c),l=z.s(M),s=m.$8e,n=z.s(W);if(s==u&&(s=m.$8e={}),S.beginPath(),n!=u){var A=J.getImage(n),L=B/2;S.translate(j.x,j.y),S.rotate(E),S.translate(-j.x,-j.y),J.drawImage(S,A,j.x-L,j.y-L,B,B,z),S.translate(j.x,j.y),S.rotate(-E),S.translate(-j.x,-j.y)}else if(m.__flowBatch){var r=m.__flowBatchGroup;r||(r=m.__flowBatchGroup={});var d=[j.x,j.y,B/2];r[V]?r[V].push(d):r[V]=[d]}else S.fillStyle=V,S.arc(j.x,j.y,B/2,0,2*Math.PI,!0),S.fill();if(l){var i=22,X=i+"_"+D+"_"+I,$=s[X];if($==u){var H=document.createElement("canvas");Y.setCanvas(H,i,i);var F=H.getContext("2d"),O=i/2,T=O,w=O;Y.translateAndScale(F,0,0,1),F.beginPath();var t=F.createRadialGradient(T,w,0,T,T,O);t.addColorStop(0,D),t.addColorStop(1,I),F.fillStyle=t,F.arc(T,w,O,0,2*Math.PI,!0),F.fill(),$=s[X]=H}var L=C/2;J.drawImage(S,$,j.x-L,j.y-L,C,C,z)}},e.$9e=function(){var m=this,O=m.dm().$3e;m._24I,O.forEach(function(f){m._24I[f._id]=f}),m.iv()};var jo=v.prepareRemove;v.prepareRemove=function(u){jo.call(this,u);var e=u._dataModel,x=e.$3e;if(x)for(var C=x.length,H=0;C>H;H++)if(x[H]===u){x.splice(H,1);break}},e.setFlowInterval=function(g){var W=this,L=W.$11e;W.$11e=g,W.fp("flowInterval",L,g),W.$7e!=u&&(clearInterval(W.$7e),delete W.$7e,W.enableFlow(g))},e.getFlowInterval=function(){return this.$11e},e.enableFlow=function(s){var y=this,z=y.dm(),n=z.$3e;y.$7e==u&&(n.forEach(function(X){var T=y.getDataUI(X);a(T)}),y.$7e=setInterval(function(){z.$3e.forEach(function(W){O(y.getDataUI(W))}),y.$9e()},s||y.$11e||50))},e.disableFlow=function(){var T=this;clearInterval(T.$7e),delete T.$7e;var C=T.dm().$3e;C&&T.$9e()};var Ao=function(){this.__flowBatchGroup={}},Vr=function(h){var o=this.__flowBatchGroup;if(o){h.save();for(var j in o){h.fillStyle=j,h.beginPath();var O=o[j];O.forEach(function($){h.moveTo($[0],$[1]),h.arc($[0],$[1],$[2],0,2*Math.PI,!0)}),h.fill()}h.restore()}};e.setFlowBatch=function(I){var f=this;!!f.__flowBatch!=!!I&&(f.__flowBatch=I,I?(f.addBottomPainter(Ao),f.addTopPainter(Vr)):(f.removeBottomPainter(Ao),f.removeTopPainter(Vr)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);